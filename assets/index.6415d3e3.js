(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))w(C);new MutationObserver(C=>{for(const D of C)if(D.type==="childList")for(const O of D.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&w(O)}).observe(document,{childList:!0,subtree:!0});function f(C){const D={};return C.integrity&&(D.integrity=C.integrity),C.referrerpolicy&&(D.referrerPolicy=C.referrerpolicy),C.crossorigin==="use-credentials"?D.credentials="include":C.crossorigin==="anonymous"?D.credentials="omit":D.credentials="same-origin",D}function w(C){if(C.ep)return;C.ep=!0;const D=f(C);fetch(C.href,D)}})();var gf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gC(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Kn={exports:{}},zn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W_=Symbol.for("react.element"),yC=Symbol.for("react.portal"),vC=Symbol.for("react.fragment"),xC=Symbol.for("react.strict_mode"),wC=Symbol.for("react.profiler"),bC=Symbol.for("react.provider"),AC=Symbol.for("react.context"),EC=Symbol.for("react.forward_ref"),CC=Symbol.for("react.suspense"),TC=Symbol.for("react.memo"),SC=Symbol.for("react.lazy"),Mb=Symbol.iterator;function IC(r){return r===null||typeof r!="object"?null:(r=Mb&&r[Mb]||r["@@iterator"],typeof r=="function"?r:null)}var QA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},e2=Object.assign,t2={};function qf(r,l,f){this.props=r,this.context=l,this.refs=t2,this.updater=f||QA}qf.prototype.isReactComponent={};qf.prototype.setState=function(r,l){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,l,"setState")};qf.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function n2(){}n2.prototype=qf.prototype;function pw(r,l,f){this.props=r,this.context=l,this.refs=t2,this.updater=f||QA}var fw=pw.prototype=new n2;fw.constructor=pw;e2(fw,qf.prototype);fw.isPureReactComponent=!0;var Bb=Array.isArray,i2=Object.prototype.hasOwnProperty,mw={current:null},r2={key:!0,ref:!0,__self:!0,__source:!0};function o2(r,l,f){var w,C={},D=null,O=null;if(l!=null)for(w in l.ref!==void 0&&(O=l.ref),l.key!==void 0&&(D=""+l.key),l)i2.call(l,w)&&!r2.hasOwnProperty(w)&&(C[w]=l[w]);var s=arguments.length-2;if(s===1)C.children=f;else if(1<s){for(var q=Array(s),be=0;be<s;be++)q[be]=arguments[be+2];C.children=q}if(r&&r.defaultProps)for(w in s=r.defaultProps,s)C[w]===void 0&&(C[w]=s[w]);return{$$typeof:W_,type:r,key:D,ref:O,props:C,_owner:mw.current}}function MC(r,l){return{$$typeof:W_,type:r.type,key:l,ref:r.ref,props:r.props,_owner:r._owner}}function _w(r){return typeof r=="object"&&r!==null&&r.$$typeof===W_}function BC(r){var l={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(f){return l[f]})}var Db=/\/+/g;function Gx(r,l){return typeof r=="object"&&r!==null&&r.key!=null?BC(""+r.key):l.toString(36)}function e0(r,l,f,w,C){var D=typeof r;(D==="undefined"||D==="boolean")&&(r=null);var O=!1;if(r===null)O=!0;else switch(D){case"string":case"number":O=!0;break;case"object":switch(r.$$typeof){case W_:case yC:O=!0}}if(O)return O=r,C=C(O),r=w===""?"."+Gx(O,0):w,Bb(C)?(f="",r!=null&&(f=r.replace(Db,"$&/")+"/"),e0(C,l,f,"",function(be){return be})):C!=null&&(_w(C)&&(C=MC(C,f+(!C.key||O&&O.key===C.key?"":(""+C.key).replace(Db,"$&/")+"/")+r)),l.push(C)),1;if(O=0,w=w===""?".":w+":",Bb(r))for(var s=0;s<r.length;s++){D=r[s];var q=w+Gx(D,s);O+=e0(D,l,f,q,C)}else if(q=IC(r),typeof q=="function")for(r=q.call(r),s=0;!(D=r.next()).done;)D=D.value,q=w+Gx(D,s++),O+=e0(D,l,f,q,C);else if(D==="object")throw l=String(r),Error("Objects are not valid as a React child (found: "+(l==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":l)+"). If you meant to render a collection of children, use an array instead.");return O}function Ly(r,l,f){if(r==null)return r;var w=[],C=0;return e0(r,w,"","",function(D){return l.call(f,D,C++)}),w}function DC(r){if(r._status===-1){var l=r._result;l=l(),l.then(function(f){(r._status===0||r._status===-1)&&(r._status=1,r._result=f)},function(f){(r._status===0||r._status===-1)&&(r._status=2,r._result=f)}),r._status===-1&&(r._status=0,r._result=l)}if(r._status===1)return r._result.default;throw r._result}var Fo={current:null},t0={transition:null},kC={ReactCurrentDispatcher:Fo,ReactCurrentBatchConfig:t0,ReactCurrentOwner:mw};zn.Children={map:Ly,forEach:function(r,l,f){Ly(r,function(){l.apply(this,arguments)},f)},count:function(r){var l=0;return Ly(r,function(){l++}),l},toArray:function(r){return Ly(r,function(l){return l})||[]},only:function(r){if(!_w(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};zn.Component=qf;zn.Fragment=vC;zn.Profiler=wC;zn.PureComponent=pw;zn.StrictMode=xC;zn.Suspense=CC;zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kC;zn.cloneElement=function(r,l,f){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var w=e2({},r.props),C=r.key,D=r.ref,O=r._owner;if(l!=null){if(l.ref!==void 0&&(D=l.ref,O=mw.current),l.key!==void 0&&(C=""+l.key),r.type&&r.type.defaultProps)var s=r.type.defaultProps;for(q in l)i2.call(l,q)&&!r2.hasOwnProperty(q)&&(w[q]=l[q]===void 0&&s!==void 0?s[q]:l[q])}var q=arguments.length-2;if(q===1)w.children=f;else if(1<q){s=Array(q);for(var be=0;be<q;be++)s[be]=arguments[be+2];w.children=s}return{$$typeof:W_,type:r.type,key:C,ref:D,props:w,_owner:O}};zn.createContext=function(r){return r={$$typeof:AC,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:bC,_context:r},r.Consumer=r};zn.createElement=o2;zn.createFactory=function(r){var l=o2.bind(null,r);return l.type=r,l};zn.createRef=function(){return{current:null}};zn.forwardRef=function(r){return{$$typeof:EC,render:r}};zn.isValidElement=_w;zn.lazy=function(r){return{$$typeof:SC,_payload:{_status:-1,_result:r},_init:DC}};zn.memo=function(r,l){return{$$typeof:TC,type:r,compare:l===void 0?null:l}};zn.startTransition=function(r){var l=t0.transition;t0.transition={};try{r()}finally{t0.transition=l}};zn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};zn.useCallback=function(r,l){return Fo.current.useCallback(r,l)};zn.useContext=function(r){return Fo.current.useContext(r)};zn.useDebugValue=function(){};zn.useDeferredValue=function(r){return Fo.current.useDeferredValue(r)};zn.useEffect=function(r,l){return Fo.current.useEffect(r,l)};zn.useId=function(){return Fo.current.useId()};zn.useImperativeHandle=function(r,l,f){return Fo.current.useImperativeHandle(r,l,f)};zn.useInsertionEffect=function(r,l){return Fo.current.useInsertionEffect(r,l)};zn.useLayoutEffect=function(r,l){return Fo.current.useLayoutEffect(r,l)};zn.useMemo=function(r,l){return Fo.current.useMemo(r,l)};zn.useReducer=function(r,l,f){return Fo.current.useReducer(r,l,f)};zn.useRef=function(r){return Fo.current.useRef(r)};zn.useState=function(r){return Fo.current.useState(r)};zn.useSyncExternalStore=function(r,l,f){return Fo.current.useSyncExternalStore(r,l,f)};zn.useTransition=function(){return Fo.current.useTransition()};zn.version="18.2.0";(function(r){r.exports=zn})(Kn);const zo=gC(Kn.exports);var s2={exports:{}},qs={},a2={exports:{}},l2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function l(wt,Jt){var Bt=wt.length;wt.push(Jt);e:for(;0<Bt;){var gn=Bt-1>>>1,oi=wt[gn];if(0<C(oi,Jt))wt[gn]=Jt,wt[Bt]=oi,Bt=gn;else break e}}function f(wt){return wt.length===0?null:wt[0]}function w(wt){if(wt.length===0)return null;var Jt=wt[0],Bt=wt.pop();if(Bt!==Jt){wt[0]=Bt;e:for(var gn=0,oi=wt.length,br=oi>>>1;gn<br;){var Fi=2*(gn+1)-1,Ki=wt[Fi],Ri=Fi+1,Gi=wt[Ri];if(0>C(Ki,Bt))Ri<oi&&0>C(Gi,Ki)?(wt[gn]=Gi,wt[Ri]=Bt,gn=Ri):(wt[gn]=Ki,wt[Fi]=Bt,gn=Fi);else if(Ri<oi&&0>C(Gi,Bt))wt[gn]=Gi,wt[Ri]=Bt,gn=Ri;else break e}}return Jt}function C(wt,Jt){var Bt=wt.sortIndex-Jt.sortIndex;return Bt!==0?Bt:wt.id-Jt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var D=performance;r.unstable_now=function(){return D.now()}}else{var O=Date,s=O.now();r.unstable_now=function(){return O.now()-s}}var q=[],be=[],je=1,Pe=null,Le=3,ct=!1,ht=!1,yt=!1,hn=typeof setTimeout=="function"?setTimeout:null,Te=typeof clearTimeout=="function"?clearTimeout:null,ge=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Se(wt){for(var Jt=f(be);Jt!==null;){if(Jt.callback===null)w(be);else if(Jt.startTime<=wt)w(be),Jt.sortIndex=Jt.expirationTime,l(q,Jt);else break;Jt=f(be)}}function it(wt){if(yt=!1,Se(wt),!ht)if(f(q)!==null)ht=!0,gs(ke);else{var Jt=f(be);Jt!==null&&Ni(it,Jt.startTime-wt)}}function ke(wt,Jt){ht=!1,yt&&(yt=!1,Te(Pt),Pt=-1),ct=!0;var Bt=Le;try{for(Se(Jt),Pe=f(q);Pe!==null&&(!(Pe.expirationTime>Jt)||wt&&!rr());){var gn=Pe.callback;if(typeof gn=="function"){Pe.callback=null,Le=Pe.priorityLevel;var oi=gn(Pe.expirationTime<=Jt);Jt=r.unstable_now(),typeof oi=="function"?Pe.callback=oi:Pe===f(q)&&w(q),Se(Jt)}else w(q);Pe=f(q)}if(Pe!==null)var br=!0;else{var Fi=f(be);Fi!==null&&Ni(it,Fi.startTime-Jt),br=!1}return br}finally{Pe=null,Le=Bt,ct=!1}}var ut=!1,bt=null,Pt=-1,zt=5,qt=-1;function rr(){return!(r.unstable_now()-qt<zt)}function Oo(){if(bt!==null){var wt=r.unstable_now();qt=wt;var Jt=!0;try{Jt=bt(!0,wt)}finally{Jt?go():(ut=!1,bt=null)}}else ut=!1}var go;if(typeof ge=="function")go=function(){ge(Oo)};else if(typeof MessageChannel<"u"){var _s=new MessageChannel,cn=_s.port2;_s.port1.onmessage=Oo,go=function(){cn.postMessage(null)}}else go=function(){hn(Oo,0)};function gs(wt){bt=wt,ut||(ut=!0,go())}function Ni(wt,Jt){Pt=hn(function(){wt(r.unstable_now())},Jt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(wt){wt.callback=null},r.unstable_continueExecution=function(){ht||ct||(ht=!0,gs(ke))},r.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):zt=0<wt?Math.floor(1e3/wt):5},r.unstable_getCurrentPriorityLevel=function(){return Le},r.unstable_getFirstCallbackNode=function(){return f(q)},r.unstable_next=function(wt){switch(Le){case 1:case 2:case 3:var Jt=3;break;default:Jt=Le}var Bt=Le;Le=Jt;try{return wt()}finally{Le=Bt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(wt,Jt){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var Bt=Le;Le=wt;try{return Jt()}finally{Le=Bt}},r.unstable_scheduleCallback=function(wt,Jt,Bt){var gn=r.unstable_now();switch(typeof Bt=="object"&&Bt!==null?(Bt=Bt.delay,Bt=typeof Bt=="number"&&0<Bt?gn+Bt:gn):Bt=gn,wt){case 1:var oi=-1;break;case 2:oi=250;break;case 5:oi=1073741823;break;case 4:oi=1e4;break;default:oi=5e3}return oi=Bt+oi,wt={id:je++,callback:Jt,priorityLevel:wt,startTime:Bt,expirationTime:oi,sortIndex:-1},Bt>gn?(wt.sortIndex=Bt,l(be,wt),f(q)===null&&wt===f(be)&&(yt?(Te(Pt),Pt=-1):yt=!0,Ni(it,Bt-gn))):(wt.sortIndex=oi,l(q,wt),ht||ct||(ht=!0,gs(ke))),wt},r.unstable_shouldYield=rr,r.unstable_wrapCallback=function(wt){var Jt=Le;return function(){var Bt=Le;Le=Jt;try{return wt.apply(this,arguments)}finally{Le=Bt}}}})(l2);(function(r){r.exports=l2})(a2);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u2=Kn.exports,js=a2.exports;function ft(r){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+r,f=1;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+r+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c2=new Set,D_={};function Zd(r,l){Rf(r,l),Rf(r+"Capture",l)}function Rf(r,l){for(D_[r]=l,r=0;r<l.length;r++)c2.add(l[r])}var Yu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),g1=Object.prototype.hasOwnProperty,zC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,kb={},zb={};function PC(r){return g1.call(zb,r)?!0:g1.call(kb,r)?!1:zC.test(r)?zb[r]=!0:(kb[r]=!0,!1)}function LC(r,l,f,w){if(f!==null&&f.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return w?!1:f!==null?!f.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function FC(r,l,f,w){if(l===null||typeof l>"u"||LC(r,l,f,w))return!0;if(w)return!1;if(f!==null)switch(f.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function Ro(r,l,f,w,C,D,O){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=w,this.attributeNamespace=C,this.mustUseProperty=f,this.propertyName=r,this.type=l,this.sanitizeURL=D,this.removeEmptyString=O}var qr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){qr[r]=new Ro(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var l=r[0];qr[l]=new Ro(l,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){qr[r]=new Ro(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){qr[r]=new Ro(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){qr[r]=new Ro(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){qr[r]=new Ro(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){qr[r]=new Ro(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){qr[r]=new Ro(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){qr[r]=new Ro(r,5,!1,r.toLowerCase(),null,!1,!1)});var gw=/[\-:]([a-z])/g;function yw(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var l=r.replace(gw,yw);qr[l]=new Ro(l,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var l=r.replace(gw,yw);qr[l]=new Ro(l,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var l=r.replace(gw,yw);qr[l]=new Ro(l,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){qr[r]=new Ro(r,1,!1,r.toLowerCase(),null,!1,!1)});qr.xlinkHref=new Ro("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){qr[r]=new Ro(r,1,!1,r.toLowerCase(),null,!0,!0)});function vw(r,l,f,w){var C=qr.hasOwnProperty(l)?qr[l]:null;(C!==null?C.type!==0:w||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(FC(l,f,C,w)&&(f=null),w||C===null?PC(l)&&(f===null?r.removeAttribute(l):r.setAttribute(l,""+f)):C.mustUseProperty?r[C.propertyName]=f===null?C.type===3?!1:"":f:(l=C.attributeName,w=C.attributeNamespace,f===null?r.removeAttribute(l):(C=C.type,f=C===3||C===4&&f===!0?"":""+f,w?r.setAttributeNS(w,l,f):r.setAttribute(l,f))))}var nc=u2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Fy=Symbol.for("react.element"),yf=Symbol.for("react.portal"),vf=Symbol.for("react.fragment"),xw=Symbol.for("react.strict_mode"),y1=Symbol.for("react.profiler"),h2=Symbol.for("react.provider"),d2=Symbol.for("react.context"),ww=Symbol.for("react.forward_ref"),v1=Symbol.for("react.suspense"),x1=Symbol.for("react.suspense_list"),bw=Symbol.for("react.memo"),ch=Symbol.for("react.lazy"),p2=Symbol.for("react.offscreen"),Pb=Symbol.iterator;function c_(r){return r===null||typeof r!="object"?null:(r=Pb&&r[Pb]||r["@@iterator"],typeof r=="function"?r:null)}var Li=Object.assign,Vx;function y_(r){if(Vx===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);Vx=l&&l[1]||""}return`
`+Vx+r}var jx=!1;function qx(r,l){if(!r||jx)return"";jx=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(be){var w=be}Reflect.construct(r,[],l)}else{try{l.call()}catch(be){w=be}r.call(l.prototype)}else{try{throw Error()}catch(be){w=be}r()}}catch(be){if(be&&w&&typeof be.stack=="string"){for(var C=be.stack.split(`
`),D=w.stack.split(`
`),O=C.length-1,s=D.length-1;1<=O&&0<=s&&C[O]!==D[s];)s--;for(;1<=O&&0<=s;O--,s--)if(C[O]!==D[s]){if(O!==1||s!==1)do if(O--,s--,0>s||C[O]!==D[s]){var q=`
`+C[O].replace(" at new "," at ");return r.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",r.displayName)),q}while(1<=O&&0<=s);break}}}finally{jx=!1,Error.prepareStackTrace=f}return(r=r?r.displayName||r.name:"")?y_(r):""}function RC(r){switch(r.tag){case 5:return y_(r.type);case 16:return y_("Lazy");case 13:return y_("Suspense");case 19:return y_("SuspenseList");case 0:case 2:case 15:return r=qx(r.type,!1),r;case 11:return r=qx(r.type.render,!1),r;case 1:return r=qx(r.type,!0),r;default:return""}}function w1(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case vf:return"Fragment";case yf:return"Portal";case y1:return"Profiler";case xw:return"StrictMode";case v1:return"Suspense";case x1:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case d2:return(r.displayName||"Context")+".Consumer";case h2:return(r._context.displayName||"Context")+".Provider";case ww:var l=r.render;return r=r.displayName,r||(r=l.displayName||l.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case bw:return l=r.displayName||null,l!==null?l:w1(r.type)||"Memo";case ch:l=r._payload,r=r._init;try{return w1(r(l))}catch{}}return null}function OC(r){var l=r.type;switch(r.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=l.render,r=r.displayName||r.name||"",l.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return w1(l);case 8:return l===xw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function Eh(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function f2(r){var l=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function UC(r){var l=f2(r)?"checked":"value",f=Object.getOwnPropertyDescriptor(r.constructor.prototype,l),w=""+r[l];if(!r.hasOwnProperty(l)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var C=f.get,D=f.set;return Object.defineProperty(r,l,{configurable:!0,get:function(){return C.call(this)},set:function(O){w=""+O,D.call(this,O)}}),Object.defineProperty(r,l,{enumerable:f.enumerable}),{getValue:function(){return w},setValue:function(O){w=""+O},stopTracking:function(){r._valueTracker=null,delete r[l]}}}}function Ry(r){r._valueTracker||(r._valueTracker=UC(r))}function m2(r){if(!r)return!1;var l=r._valueTracker;if(!l)return!0;var f=l.getValue(),w="";return r&&(w=f2(r)?r.checked?"true":"false":r.value),r=w,r!==f?(l.setValue(r),!0):!1}function d0(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function b1(r,l){var f=l.checked;return Li({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f!=null?f:r._wrapperState.initialChecked})}function Lb(r,l){var f=l.defaultValue==null?"":l.defaultValue,w=l.checked!=null?l.checked:l.defaultChecked;f=Eh(l.value!=null?l.value:f),r._wrapperState={initialChecked:w,initialValue:f,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function _2(r,l){l=l.checked,l!=null&&vw(r,"checked",l,!1)}function A1(r,l){_2(r,l);var f=Eh(l.value),w=l.type;if(f!=null)w==="number"?(f===0&&r.value===""||r.value!=f)&&(r.value=""+f):r.value!==""+f&&(r.value=""+f);else if(w==="submit"||w==="reset"){r.removeAttribute("value");return}l.hasOwnProperty("value")?E1(r,l.type,f):l.hasOwnProperty("defaultValue")&&E1(r,l.type,Eh(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(r.defaultChecked=!!l.defaultChecked)}function Fb(r,l,f){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var w=l.type;if(!(w!=="submit"&&w!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+r._wrapperState.initialValue,f||l===r.value||(r.value=l),r.defaultValue=l}f=r.name,f!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,f!==""&&(r.name=f)}function E1(r,l,f){(l!=="number"||d0(r.ownerDocument)!==r)&&(f==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+f&&(r.defaultValue=""+f))}var v_=Array.isArray;function Bf(r,l,f,w){if(r=r.options,l){l={};for(var C=0;C<f.length;C++)l["$"+f[C]]=!0;for(f=0;f<r.length;f++)C=l.hasOwnProperty("$"+r[f].value),r[f].selected!==C&&(r[f].selected=C),C&&w&&(r[f].defaultSelected=!0)}else{for(f=""+Eh(f),l=null,C=0;C<r.length;C++){if(r[C].value===f){r[C].selected=!0,w&&(r[C].defaultSelected=!0);return}l!==null||r[C].disabled||(l=r[C])}l!==null&&(l.selected=!0)}}function C1(r,l){if(l.dangerouslySetInnerHTML!=null)throw Error(ft(91));return Li({},l,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Rb(r,l){var f=l.value;if(f==null){if(f=l.children,l=l.defaultValue,f!=null){if(l!=null)throw Error(ft(92));if(v_(f)){if(1<f.length)throw Error(ft(93));f=f[0]}l=f}l==null&&(l=""),f=l}r._wrapperState={initialValue:Eh(f)}}function g2(r,l){var f=Eh(l.value),w=Eh(l.defaultValue);f!=null&&(f=""+f,f!==r.value&&(r.value=f),l.defaultValue==null&&r.defaultValue!==f&&(r.defaultValue=f)),w!=null&&(r.defaultValue=""+w)}function Ob(r){var l=r.textContent;l===r._wrapperState.initialValue&&l!==""&&l!==null&&(r.value=l)}function y2(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function T1(r,l){return r==null||r==="http://www.w3.org/1999/xhtml"?y2(l):r==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Oy,v2=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,f,w,C){MSApp.execUnsafeLocalFunction(function(){return r(l,f,w,C)})}:r}(function(r,l){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=l;else{for(Oy=Oy||document.createElement("div"),Oy.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Oy.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;l.firstChild;)r.appendChild(l.firstChild)}});function k_(r,l){if(l){var f=r.firstChild;if(f&&f===r.lastChild&&f.nodeType===3){f.nodeValue=l;return}}r.textContent=l}var b_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},NC=["Webkit","ms","Moz","O"];Object.keys(b_).forEach(function(r){NC.forEach(function(l){l=l+r.charAt(0).toUpperCase()+r.substring(1),b_[l]=b_[r]})});function x2(r,l,f){return l==null||typeof l=="boolean"||l===""?"":f||typeof l!="number"||l===0||b_.hasOwnProperty(r)&&b_[r]?(""+l).trim():l+"px"}function w2(r,l){r=r.style;for(var f in l)if(l.hasOwnProperty(f)){var w=f.indexOf("--")===0,C=x2(f,l[f],w);f==="float"&&(f="cssFloat"),w?r.setProperty(f,C):r[f]=C}}var GC=Li({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function S1(r,l){if(l){if(GC[r]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(ft(137,r));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(ft(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(ft(61))}if(l.style!=null&&typeof l.style!="object")throw Error(ft(62))}}function I1(r,l){if(r.indexOf("-")===-1)return typeof l.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var M1=null;function Aw(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var B1=null,Df=null,kf=null;function Ub(r){if(r=J_(r)){if(typeof B1!="function")throw Error(ft(280));var l=r.stateNode;l&&(l=N0(l),B1(r.stateNode,r.type,l))}}function b2(r){Df?kf?kf.push(r):kf=[r]:Df=r}function A2(){if(Df){var r=Df,l=kf;if(kf=Df=null,Ub(r),l)for(r=0;r<l.length;r++)Ub(l[r])}}function E2(r,l){return r(l)}function C2(){}var Hx=!1;function T2(r,l,f){if(Hx)return r(l,f);Hx=!0;try{return E2(r,l,f)}finally{Hx=!1,(Df!==null||kf!==null)&&(C2(),A2())}}function z_(r,l){var f=r.stateNode;if(f===null)return null;var w=N0(f);if(w===null)return null;f=w[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(r=r.type,w=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!w;break e;default:r=!1}if(r)return null;if(f&&typeof f!="function")throw Error(ft(231,l,typeof f));return f}var D1=!1;if(Yu)try{var h_={};Object.defineProperty(h_,"passive",{get:function(){D1=!0}}),window.addEventListener("test",h_,h_),window.removeEventListener("test",h_,h_)}catch{D1=!1}function VC(r,l,f,w,C,D,O,s,q){var be=Array.prototype.slice.call(arguments,3);try{l.apply(f,be)}catch(je){this.onError(je)}}var A_=!1,p0=null,f0=!1,k1=null,jC={onError:function(r){A_=!0,p0=r}};function qC(r,l,f,w,C,D,O,s,q){A_=!1,p0=null,VC.apply(jC,arguments)}function HC(r,l,f,w,C,D,O,s,q){if(qC.apply(this,arguments),A_){if(A_){var be=p0;A_=!1,p0=null}else throw Error(ft(198));f0||(f0=!0,k1=be)}}function Wd(r){var l=r,f=r;if(r.alternate)for(;l.return;)l=l.return;else{r=l;do l=r,(l.flags&4098)!==0&&(f=l.return),r=l.return;while(r)}return l.tag===3?f:null}function S2(r){if(r.tag===13){var l=r.memoizedState;if(l===null&&(r=r.alternate,r!==null&&(l=r.memoizedState)),l!==null)return l.dehydrated}return null}function Nb(r){if(Wd(r)!==r)throw Error(ft(188))}function $C(r){var l=r.alternate;if(!l){if(l=Wd(r),l===null)throw Error(ft(188));return l!==r?null:r}for(var f=r,w=l;;){var C=f.return;if(C===null)break;var D=C.alternate;if(D===null){if(w=C.return,w!==null){f=w;continue}break}if(C.child===D.child){for(D=C.child;D;){if(D===f)return Nb(C),r;if(D===w)return Nb(C),l;D=D.sibling}throw Error(ft(188))}if(f.return!==w.return)f=C,w=D;else{for(var O=!1,s=C.child;s;){if(s===f){O=!0,f=C,w=D;break}if(s===w){O=!0,w=C,f=D;break}s=s.sibling}if(!O){for(s=D.child;s;){if(s===f){O=!0,f=D,w=C;break}if(s===w){O=!0,w=D,f=C;break}s=s.sibling}if(!O)throw Error(ft(189))}}if(f.alternate!==w)throw Error(ft(190))}if(f.tag!==3)throw Error(ft(188));return f.stateNode.current===f?r:l}function I2(r){return r=$C(r),r!==null?M2(r):null}function M2(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var l=M2(r);if(l!==null)return l;r=r.sibling}return null}var B2=js.unstable_scheduleCallback,Gb=js.unstable_cancelCallback,ZC=js.unstable_shouldYield,WC=js.unstable_requestPaint,Wi=js.unstable_now,KC=js.unstable_getCurrentPriorityLevel,Ew=js.unstable_ImmediatePriority,D2=js.unstable_UserBlockingPriority,m0=js.unstable_NormalPriority,XC=js.unstable_LowPriority,k2=js.unstable_IdlePriority,F0=null,lu=null;function JC(r){if(lu&&typeof lu.onCommitFiberRoot=="function")try{lu.onCommitFiberRoot(F0,r,void 0,(r.current.flags&128)===128)}catch{}}var ul=Math.clz32?Math.clz32:eT,YC=Math.log,QC=Math.LN2;function eT(r){return r>>>=0,r===0?32:31-(YC(r)/QC|0)|0}var Uy=64,Ny=4194304;function x_(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function _0(r,l){var f=r.pendingLanes;if(f===0)return 0;var w=0,C=r.suspendedLanes,D=r.pingedLanes,O=f&268435455;if(O!==0){var s=O&~C;s!==0?w=x_(s):(D&=O,D!==0&&(w=x_(D)))}else O=f&~C,O!==0?w=x_(O):D!==0&&(w=x_(D));if(w===0)return 0;if(l!==0&&l!==w&&(l&C)===0&&(C=w&-w,D=l&-l,C>=D||C===16&&(D&4194240)!==0))return l;if((w&4)!==0&&(w|=f&16),l=r.entangledLanes,l!==0)for(r=r.entanglements,l&=w;0<l;)f=31-ul(l),C=1<<f,w|=r[f],l&=~C;return w}function tT(r,l){switch(r){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nT(r,l){for(var f=r.suspendedLanes,w=r.pingedLanes,C=r.expirationTimes,D=r.pendingLanes;0<D;){var O=31-ul(D),s=1<<O,q=C[O];q===-1?((s&f)===0||(s&w)!==0)&&(C[O]=tT(s,l)):q<=l&&(r.expiredLanes|=s),D&=~s}}function z1(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function z2(){var r=Uy;return Uy<<=1,(Uy&4194240)===0&&(Uy=64),r}function $x(r){for(var l=[],f=0;31>f;f++)l.push(r);return l}function K_(r,l,f){r.pendingLanes|=l,l!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,l=31-ul(l),r[l]=f}function iT(r,l){var f=r.pendingLanes&~l;r.pendingLanes=l,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=l,r.mutableReadLanes&=l,r.entangledLanes&=l,l=r.entanglements;var w=r.eventTimes;for(r=r.expirationTimes;0<f;){var C=31-ul(f),D=1<<C;l[C]=0,w[C]=-1,r[C]=-1,f&=~D}}function Cw(r,l){var f=r.entangledLanes|=l;for(r=r.entanglements;f;){var w=31-ul(f),C=1<<w;C&l|r[w]&l&&(r[w]|=l),f&=~C}}var ri=0;function P2(r){return r&=-r,1<r?4<r?(r&268435455)!==0?16:536870912:4:1}var L2,Tw,F2,R2,O2,P1=!1,Gy=[],_h=null,gh=null,yh=null,P_=new Map,L_=new Map,dh=[],rT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vb(r,l){switch(r){case"focusin":case"focusout":_h=null;break;case"dragenter":case"dragleave":gh=null;break;case"mouseover":case"mouseout":yh=null;break;case"pointerover":case"pointerout":P_.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":L_.delete(l.pointerId)}}function d_(r,l,f,w,C,D){return r===null||r.nativeEvent!==D?(r={blockedOn:l,domEventName:f,eventSystemFlags:w,nativeEvent:D,targetContainers:[C]},l!==null&&(l=J_(l),l!==null&&Tw(l)),r):(r.eventSystemFlags|=w,l=r.targetContainers,C!==null&&l.indexOf(C)===-1&&l.push(C),r)}function oT(r,l,f,w,C){switch(l){case"focusin":return _h=d_(_h,r,l,f,w,C),!0;case"dragenter":return gh=d_(gh,r,l,f,w,C),!0;case"mouseover":return yh=d_(yh,r,l,f,w,C),!0;case"pointerover":var D=C.pointerId;return P_.set(D,d_(P_.get(D)||null,r,l,f,w,C)),!0;case"gotpointercapture":return D=C.pointerId,L_.set(D,d_(L_.get(D)||null,r,l,f,w,C)),!0}return!1}function U2(r){var l=Rd(r.target);if(l!==null){var f=Wd(l);if(f!==null){if(l=f.tag,l===13){if(l=S2(f),l!==null){r.blockedOn=l,O2(r.priority,function(){F2(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){r.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}r.blockedOn=null}function n0(r){if(r.blockedOn!==null)return!1;for(var l=r.targetContainers;0<l.length;){var f=L1(r.domEventName,r.eventSystemFlags,l[0],r.nativeEvent);if(f===null){f=r.nativeEvent;var w=new f.constructor(f.type,f);M1=w,f.target.dispatchEvent(w),M1=null}else return l=J_(f),l!==null&&Tw(l),r.blockedOn=f,!1;l.shift()}return!0}function jb(r,l,f){n0(r)&&f.delete(l)}function sT(){P1=!1,_h!==null&&n0(_h)&&(_h=null),gh!==null&&n0(gh)&&(gh=null),yh!==null&&n0(yh)&&(yh=null),P_.forEach(jb),L_.forEach(jb)}function p_(r,l){r.blockedOn===l&&(r.blockedOn=null,P1||(P1=!0,js.unstable_scheduleCallback(js.unstable_NormalPriority,sT)))}function F_(r){function l(C){return p_(C,r)}if(0<Gy.length){p_(Gy[0],r);for(var f=1;f<Gy.length;f++){var w=Gy[f];w.blockedOn===r&&(w.blockedOn=null)}}for(_h!==null&&p_(_h,r),gh!==null&&p_(gh,r),yh!==null&&p_(yh,r),P_.forEach(l),L_.forEach(l),f=0;f<dh.length;f++)w=dh[f],w.blockedOn===r&&(w.blockedOn=null);for(;0<dh.length&&(f=dh[0],f.blockedOn===null);)U2(f),f.blockedOn===null&&dh.shift()}var zf=nc.ReactCurrentBatchConfig,g0=!0;function aT(r,l,f,w){var C=ri,D=zf.transition;zf.transition=null;try{ri=1,Sw(r,l,f,w)}finally{ri=C,zf.transition=D}}function lT(r,l,f,w){var C=ri,D=zf.transition;zf.transition=null;try{ri=4,Sw(r,l,f,w)}finally{ri=C,zf.transition=D}}function Sw(r,l,f,w){if(g0){var C=L1(r,l,f,w);if(C===null)n1(r,l,w,y0,f),Vb(r,w);else if(oT(C,r,l,f,w))w.stopPropagation();else if(Vb(r,w),l&4&&-1<rT.indexOf(r)){for(;C!==null;){var D=J_(C);if(D!==null&&L2(D),D=L1(r,l,f,w),D===null&&n1(r,l,w,y0,f),D===C)break;C=D}C!==null&&w.stopPropagation()}else n1(r,l,w,null,f)}}var y0=null;function L1(r,l,f,w){if(y0=null,r=Aw(w),r=Rd(r),r!==null)if(l=Wd(r),l===null)r=null;else if(f=l.tag,f===13){if(r=S2(l),r!==null)return r;r=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;r=null}else l!==r&&(r=null);return y0=r,null}function N2(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(KC()){case Ew:return 1;case D2:return 4;case m0:case XC:return 16;case k2:return 536870912;default:return 16}default:return 16}}var fh=null,Iw=null,i0=null;function G2(){if(i0)return i0;var r,l=Iw,f=l.length,w,C="value"in fh?fh.value:fh.textContent,D=C.length;for(r=0;r<f&&l[r]===C[r];r++);var O=f-r;for(w=1;w<=O&&l[f-w]===C[D-w];w++);return i0=C.slice(r,1<w?1-w:void 0)}function r0(r){var l=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&l===13&&(r=13)):r=l,r===10&&(r=13),32<=r||r===13?r:0}function Vy(){return!0}function qb(){return!1}function Hs(r){function l(f,w,C,D,O){this._reactName=f,this._targetInst=C,this.type=w,this.nativeEvent=D,this.target=O,this.currentTarget=null;for(var s in r)r.hasOwnProperty(s)&&(f=r[s],this[s]=f?f(D):D[s]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?Vy:qb,this.isPropagationStopped=qb,this}return Li(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Vy)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Vy)},persist:function(){},isPersistent:Vy}),l}var Hf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Mw=Hs(Hf),X_=Li({},Hf,{view:0,detail:0}),uT=Hs(X_),Zx,Wx,f_,R0=Li({},X_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bw,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==f_&&(f_&&r.type==="mousemove"?(Zx=r.screenX-f_.screenX,Wx=r.screenY-f_.screenY):Wx=Zx=0,f_=r),Zx)},movementY:function(r){return"movementY"in r?r.movementY:Wx}}),Hb=Hs(R0),cT=Li({},R0,{dataTransfer:0}),hT=Hs(cT),dT=Li({},X_,{relatedTarget:0}),Kx=Hs(dT),pT=Li({},Hf,{animationName:0,elapsedTime:0,pseudoElement:0}),fT=Hs(pT),mT=Li({},Hf,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),_T=Hs(mT),gT=Li({},Hf,{data:0}),$b=Hs(gT),yT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wT(r){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(r):(r=xT[r])?!!l[r]:!1}function Bw(){return wT}var bT=Li({},X_,{key:function(r){if(r.key){var l=yT[r.key]||r.key;if(l!=="Unidentified")return l}return r.type==="keypress"?(r=r0(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?vT[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bw,charCode:function(r){return r.type==="keypress"?r0(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?r0(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),AT=Hs(bT),ET=Li({},R0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zb=Hs(ET),CT=Li({},X_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bw}),TT=Hs(CT),ST=Li({},Hf,{propertyName:0,elapsedTime:0,pseudoElement:0}),IT=Hs(ST),MT=Li({},R0,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),BT=Hs(MT),DT=[9,13,27,32],Dw=Yu&&"CompositionEvent"in window,E_=null;Yu&&"documentMode"in document&&(E_=document.documentMode);var kT=Yu&&"TextEvent"in window&&!E_,V2=Yu&&(!Dw||E_&&8<E_&&11>=E_),Wb=String.fromCharCode(32),Kb=!1;function j2(r,l){switch(r){case"keyup":return DT.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function q2(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var xf=!1;function zT(r,l){switch(r){case"compositionend":return q2(l);case"keypress":return l.which!==32?null:(Kb=!0,Wb);case"textInput":return r=l.data,r===Wb&&Kb?null:r;default:return null}}function PT(r,l){if(xf)return r==="compositionend"||!Dw&&j2(r,l)?(r=G2(),i0=Iw=fh=null,xf=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return V2&&l.locale!=="ko"?null:l.data;default:return null}}var LT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xb(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l==="input"?!!LT[r.type]:l==="textarea"}function H2(r,l,f,w){b2(w),l=v0(l,"onChange"),0<l.length&&(f=new Mw("onChange","change",null,f,w),r.push({event:f,listeners:l}))}var C_=null,R_=null;function FT(r){nE(r,0)}function O0(r){var l=Af(r);if(m2(l))return r}function RT(r,l){if(r==="change")return l}var $2=!1;if(Yu){var Xx;if(Yu){var Jx="oninput"in document;if(!Jx){var Jb=document.createElement("div");Jb.setAttribute("oninput","return;"),Jx=typeof Jb.oninput=="function"}Xx=Jx}else Xx=!1;$2=Xx&&(!document.documentMode||9<document.documentMode)}function Yb(){C_&&(C_.detachEvent("onpropertychange",Z2),R_=C_=null)}function Z2(r){if(r.propertyName==="value"&&O0(R_)){var l=[];H2(l,R_,r,Aw(r)),T2(FT,l)}}function OT(r,l,f){r==="focusin"?(Yb(),C_=l,R_=f,C_.attachEvent("onpropertychange",Z2)):r==="focusout"&&Yb()}function UT(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return O0(R_)}function NT(r,l){if(r==="click")return O0(l)}function GT(r,l){if(r==="input"||r==="change")return O0(l)}function VT(r,l){return r===l&&(r!==0||1/r===1/l)||r!==r&&l!==l}var hl=typeof Object.is=="function"?Object.is:VT;function O_(r,l){if(hl(r,l))return!0;if(typeof r!="object"||r===null||typeof l!="object"||l===null)return!1;var f=Object.keys(r),w=Object.keys(l);if(f.length!==w.length)return!1;for(w=0;w<f.length;w++){var C=f[w];if(!g1.call(l,C)||!hl(r[C],l[C]))return!1}return!0}function Qb(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function eA(r,l){var f=Qb(r);r=0;for(var w;f;){if(f.nodeType===3){if(w=r+f.textContent.length,r<=l&&w>=l)return{node:f,offset:l-r};r=w}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=Qb(f)}}function W2(r,l){return r&&l?r===l?!0:r&&r.nodeType===3?!1:l&&l.nodeType===3?W2(r,l.parentNode):"contains"in r?r.contains(l):r.compareDocumentPosition?!!(r.compareDocumentPosition(l)&16):!1:!1}function K2(){for(var r=window,l=d0();l instanceof r.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)r=l.contentWindow;else break;l=d0(r.document)}return l}function kw(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l&&(l==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||l==="textarea"||r.contentEditable==="true")}function jT(r){var l=K2(),f=r.focusedElem,w=r.selectionRange;if(l!==f&&f&&f.ownerDocument&&W2(f.ownerDocument.documentElement,f)){if(w!==null&&kw(f)){if(l=w.start,r=w.end,r===void 0&&(r=l),"selectionStart"in f)f.selectionStart=l,f.selectionEnd=Math.min(r,f.value.length);else if(r=(l=f.ownerDocument||document)&&l.defaultView||window,r.getSelection){r=r.getSelection();var C=f.textContent.length,D=Math.min(w.start,C);w=w.end===void 0?D:Math.min(w.end,C),!r.extend&&D>w&&(C=w,w=D,D=C),C=eA(f,D);var O=eA(f,w);C&&O&&(r.rangeCount!==1||r.anchorNode!==C.node||r.anchorOffset!==C.offset||r.focusNode!==O.node||r.focusOffset!==O.offset)&&(l=l.createRange(),l.setStart(C.node,C.offset),r.removeAllRanges(),D>w?(r.addRange(l),r.extend(O.node,O.offset)):(l.setEnd(O.node,O.offset),r.addRange(l)))}}for(l=[],r=f;r=r.parentNode;)r.nodeType===1&&l.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<l.length;f++)r=l[f],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var qT=Yu&&"documentMode"in document&&11>=document.documentMode,wf=null,F1=null,T_=null,R1=!1;function tA(r,l,f){var w=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;R1||wf==null||wf!==d0(w)||(w=wf,"selectionStart"in w&&kw(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),T_&&O_(T_,w)||(T_=w,w=v0(F1,"onSelect"),0<w.length&&(l=new Mw("onSelect","select",null,l,f),r.push({event:l,listeners:w}),l.target=wf)))}function jy(r,l){var f={};return f[r.toLowerCase()]=l.toLowerCase(),f["Webkit"+r]="webkit"+l,f["Moz"+r]="moz"+l,f}var bf={animationend:jy("Animation","AnimationEnd"),animationiteration:jy("Animation","AnimationIteration"),animationstart:jy("Animation","AnimationStart"),transitionend:jy("Transition","TransitionEnd")},Yx={},X2={};Yu&&(X2=document.createElement("div").style,"AnimationEvent"in window||(delete bf.animationend.animation,delete bf.animationiteration.animation,delete bf.animationstart.animation),"TransitionEvent"in window||delete bf.transitionend.transition);function U0(r){if(Yx[r])return Yx[r];if(!bf[r])return r;var l=bf[r],f;for(f in l)if(l.hasOwnProperty(f)&&f in X2)return Yx[r]=l[f];return r}var J2=U0("animationend"),Y2=U0("animationiteration"),Q2=U0("animationstart"),eE=U0("transitionend"),tE=new Map,nA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Th(r,l){tE.set(r,l),Zd(l,[r])}for(var Qx=0;Qx<nA.length;Qx++){var e1=nA[Qx],HT=e1.toLowerCase(),$T=e1[0].toUpperCase()+e1.slice(1);Th(HT,"on"+$T)}Th(J2,"onAnimationEnd");Th(Y2,"onAnimationIteration");Th(Q2,"onAnimationStart");Th("dblclick","onDoubleClick");Th("focusin","onFocus");Th("focusout","onBlur");Th(eE,"onTransitionEnd");Rf("onMouseEnter",["mouseout","mouseover"]);Rf("onMouseLeave",["mouseout","mouseover"]);Rf("onPointerEnter",["pointerout","pointerover"]);Rf("onPointerLeave",["pointerout","pointerover"]);Zd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Zd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Zd("onBeforeInput",["compositionend","keypress","textInput","paste"]);Zd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Zd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Zd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var w_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ZT=new Set("cancel close invalid load scroll toggle".split(" ").concat(w_));function iA(r,l,f){var w=r.type||"unknown-event";r.currentTarget=f,HC(w,l,void 0,r),r.currentTarget=null}function nE(r,l){l=(l&4)!==0;for(var f=0;f<r.length;f++){var w=r[f],C=w.event;w=w.listeners;e:{var D=void 0;if(l)for(var O=w.length-1;0<=O;O--){var s=w[O],q=s.instance,be=s.currentTarget;if(s=s.listener,q!==D&&C.isPropagationStopped())break e;iA(C,s,be),D=q}else for(O=0;O<w.length;O++){if(s=w[O],q=s.instance,be=s.currentTarget,s=s.listener,q!==D&&C.isPropagationStopped())break e;iA(C,s,be),D=q}}}if(f0)throw r=k1,f0=!1,k1=null,r}function _i(r,l){var f=l[V1];f===void 0&&(f=l[V1]=new Set);var w=r+"__bubble";f.has(w)||(iE(l,r,2,!1),f.add(w))}function t1(r,l,f){var w=0;l&&(w|=4),iE(f,r,w,l)}var qy="_reactListening"+Math.random().toString(36).slice(2);function U_(r){if(!r[qy]){r[qy]=!0,c2.forEach(function(f){f!=="selectionchange"&&(ZT.has(f)||t1(f,!1,r),t1(f,!0,r))});var l=r.nodeType===9?r:r.ownerDocument;l===null||l[qy]||(l[qy]=!0,t1("selectionchange",!1,l))}}function iE(r,l,f,w){switch(N2(l)){case 1:var C=aT;break;case 4:C=lT;break;default:C=Sw}f=C.bind(null,l,f,r),C=void 0,!D1||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(C=!0),w?C!==void 0?r.addEventListener(l,f,{capture:!0,passive:C}):r.addEventListener(l,f,!0):C!==void 0?r.addEventListener(l,f,{passive:C}):r.addEventListener(l,f,!1)}function n1(r,l,f,w,C){var D=w;if((l&1)===0&&(l&2)===0&&w!==null)e:for(;;){if(w===null)return;var O=w.tag;if(O===3||O===4){var s=w.stateNode.containerInfo;if(s===C||s.nodeType===8&&s.parentNode===C)break;if(O===4)for(O=w.return;O!==null;){var q=O.tag;if((q===3||q===4)&&(q=O.stateNode.containerInfo,q===C||q.nodeType===8&&q.parentNode===C))return;O=O.return}for(;s!==null;){if(O=Rd(s),O===null)return;if(q=O.tag,q===5||q===6){w=D=O;continue e}s=s.parentNode}}w=w.return}T2(function(){var be=D,je=Aw(f),Pe=[];e:{var Le=tE.get(r);if(Le!==void 0){var ct=Mw,ht=r;switch(r){case"keypress":if(r0(f)===0)break e;case"keydown":case"keyup":ct=AT;break;case"focusin":ht="focus",ct=Kx;break;case"focusout":ht="blur",ct=Kx;break;case"beforeblur":case"afterblur":ct=Kx;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ct=Hb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ct=hT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ct=TT;break;case J2:case Y2:case Q2:ct=fT;break;case eE:ct=IT;break;case"scroll":ct=uT;break;case"wheel":ct=BT;break;case"copy":case"cut":case"paste":ct=_T;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ct=Zb}var yt=(l&4)!==0,hn=!yt&&r==="scroll",Te=yt?Le!==null?Le+"Capture":null:Le;yt=[];for(var ge=be,Se;ge!==null;){Se=ge;var it=Se.stateNode;if(Se.tag===5&&it!==null&&(Se=it,Te!==null&&(it=z_(ge,Te),it!=null&&yt.push(N_(ge,it,Se)))),hn)break;ge=ge.return}0<yt.length&&(Le=new ct(Le,ht,null,f,je),Pe.push({event:Le,listeners:yt}))}}if((l&7)===0){e:{if(Le=r==="mouseover"||r==="pointerover",ct=r==="mouseout"||r==="pointerout",Le&&f!==M1&&(ht=f.relatedTarget||f.fromElement)&&(Rd(ht)||ht[Qu]))break e;if((ct||Le)&&(Le=je.window===je?je:(Le=je.ownerDocument)?Le.defaultView||Le.parentWindow:window,ct?(ht=f.relatedTarget||f.toElement,ct=be,ht=ht?Rd(ht):null,ht!==null&&(hn=Wd(ht),ht!==hn||ht.tag!==5&&ht.tag!==6)&&(ht=null)):(ct=null,ht=be),ct!==ht)){if(yt=Hb,it="onMouseLeave",Te="onMouseEnter",ge="mouse",(r==="pointerout"||r==="pointerover")&&(yt=Zb,it="onPointerLeave",Te="onPointerEnter",ge="pointer"),hn=ct==null?Le:Af(ct),Se=ht==null?Le:Af(ht),Le=new yt(it,ge+"leave",ct,f,je),Le.target=hn,Le.relatedTarget=Se,it=null,Rd(je)===be&&(yt=new yt(Te,ge+"enter",ht,f,je),yt.target=Se,yt.relatedTarget=hn,it=yt),hn=it,ct&&ht)t:{for(yt=ct,Te=ht,ge=0,Se=yt;Se;Se=mf(Se))ge++;for(Se=0,it=Te;it;it=mf(it))Se++;for(;0<ge-Se;)yt=mf(yt),ge--;for(;0<Se-ge;)Te=mf(Te),Se--;for(;ge--;){if(yt===Te||Te!==null&&yt===Te.alternate)break t;yt=mf(yt),Te=mf(Te)}yt=null}else yt=null;ct!==null&&rA(Pe,Le,ct,yt,!1),ht!==null&&hn!==null&&rA(Pe,hn,ht,yt,!0)}}e:{if(Le=be?Af(be):window,ct=Le.nodeName&&Le.nodeName.toLowerCase(),ct==="select"||ct==="input"&&Le.type==="file")var ke=RT;else if(Xb(Le))if($2)ke=GT;else{ke=UT;var ut=OT}else(ct=Le.nodeName)&&ct.toLowerCase()==="input"&&(Le.type==="checkbox"||Le.type==="radio")&&(ke=NT);if(ke&&(ke=ke(r,be))){H2(Pe,ke,f,je);break e}ut&&ut(r,Le,be),r==="focusout"&&(ut=Le._wrapperState)&&ut.controlled&&Le.type==="number"&&E1(Le,"number",Le.value)}switch(ut=be?Af(be):window,r){case"focusin":(Xb(ut)||ut.contentEditable==="true")&&(wf=ut,F1=be,T_=null);break;case"focusout":T_=F1=wf=null;break;case"mousedown":R1=!0;break;case"contextmenu":case"mouseup":case"dragend":R1=!1,tA(Pe,f,je);break;case"selectionchange":if(qT)break;case"keydown":case"keyup":tA(Pe,f,je)}var bt;if(Dw)e:{switch(r){case"compositionstart":var Pt="onCompositionStart";break e;case"compositionend":Pt="onCompositionEnd";break e;case"compositionupdate":Pt="onCompositionUpdate";break e}Pt=void 0}else xf?j2(r,f)&&(Pt="onCompositionEnd"):r==="keydown"&&f.keyCode===229&&(Pt="onCompositionStart");Pt&&(V2&&f.locale!=="ko"&&(xf||Pt!=="onCompositionStart"?Pt==="onCompositionEnd"&&xf&&(bt=G2()):(fh=je,Iw="value"in fh?fh.value:fh.textContent,xf=!0)),ut=v0(be,Pt),0<ut.length&&(Pt=new $b(Pt,r,null,f,je),Pe.push({event:Pt,listeners:ut}),bt?Pt.data=bt:(bt=q2(f),bt!==null&&(Pt.data=bt)))),(bt=kT?zT(r,f):PT(r,f))&&(be=v0(be,"onBeforeInput"),0<be.length&&(je=new $b("onBeforeInput","beforeinput",null,f,je),Pe.push({event:je,listeners:be}),je.data=bt))}nE(Pe,l)})}function N_(r,l,f){return{instance:r,listener:l,currentTarget:f}}function v0(r,l){for(var f=l+"Capture",w=[];r!==null;){var C=r,D=C.stateNode;C.tag===5&&D!==null&&(C=D,D=z_(r,f),D!=null&&w.unshift(N_(r,D,C)),D=z_(r,l),D!=null&&w.push(N_(r,D,C))),r=r.return}return w}function mf(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function rA(r,l,f,w,C){for(var D=l._reactName,O=[];f!==null&&f!==w;){var s=f,q=s.alternate,be=s.stateNode;if(q!==null&&q===w)break;s.tag===5&&be!==null&&(s=be,C?(q=z_(f,D),q!=null&&O.unshift(N_(f,q,s))):C||(q=z_(f,D),q!=null&&O.push(N_(f,q,s)))),f=f.return}O.length!==0&&r.push({event:l,listeners:O})}var WT=/\r\n?/g,KT=/\u0000|\uFFFD/g;function oA(r){return(typeof r=="string"?r:""+r).replace(WT,`
`).replace(KT,"")}function Hy(r,l,f){if(l=oA(l),oA(r)!==l&&f)throw Error(ft(425))}function x0(){}var O1=null,U1=null;function N1(r,l){return r==="textarea"||r==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var G1=typeof setTimeout=="function"?setTimeout:void 0,XT=typeof clearTimeout=="function"?clearTimeout:void 0,sA=typeof Promise=="function"?Promise:void 0,JT=typeof queueMicrotask=="function"?queueMicrotask:typeof sA<"u"?function(r){return sA.resolve(null).then(r).catch(YT)}:G1;function YT(r){setTimeout(function(){throw r})}function i1(r,l){var f=l,w=0;do{var C=f.nextSibling;if(r.removeChild(f),C&&C.nodeType===8)if(f=C.data,f==="/$"){if(w===0){r.removeChild(C),F_(l);return}w--}else f!=="$"&&f!=="$?"&&f!=="$!"||w++;f=C}while(f);F_(l)}function vh(r){for(;r!=null;r=r.nextSibling){var l=r.nodeType;if(l===1||l===3)break;if(l===8){if(l=r.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return r}function aA(r){r=r.previousSibling;for(var l=0;r;){if(r.nodeType===8){var f=r.data;if(f==="$"||f==="$!"||f==="$?"){if(l===0)return r;l--}else f==="/$"&&l++}r=r.previousSibling}return null}var $f=Math.random().toString(36).slice(2),au="__reactFiber$"+$f,G_="__reactProps$"+$f,Qu="__reactContainer$"+$f,V1="__reactEvents$"+$f,QT="__reactListeners$"+$f,eS="__reactHandles$"+$f;function Rd(r){var l=r[au];if(l)return l;for(var f=r.parentNode;f;){if(l=f[Qu]||f[au]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(r=aA(r);r!==null;){if(f=r[au])return f;r=aA(r)}return l}r=f,f=r.parentNode}return null}function J_(r){return r=r[au]||r[Qu],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Af(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(ft(33))}function N0(r){return r[G_]||null}var j1=[],Ef=-1;function Sh(r){return{current:r}}function gi(r){0>Ef||(r.current=j1[Ef],j1[Ef]=null,Ef--)}function hi(r,l){Ef++,j1[Ef]=r.current,r.current=l}var Ch={},_o=Sh(Ch),ps=Sh(!1),Vd=Ch;function Of(r,l){var f=r.type.contextTypes;if(!f)return Ch;var w=r.stateNode;if(w&&w.__reactInternalMemoizedUnmaskedChildContext===l)return w.__reactInternalMemoizedMaskedChildContext;var C={},D;for(D in f)C[D]=l[D];return w&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=l,r.__reactInternalMemoizedMaskedChildContext=C),C}function fs(r){return r=r.childContextTypes,r!=null}function w0(){gi(ps),gi(_o)}function lA(r,l,f){if(_o.current!==Ch)throw Error(ft(168));hi(_o,l),hi(ps,f)}function rE(r,l,f){var w=r.stateNode;if(l=l.childContextTypes,typeof w.getChildContext!="function")return f;w=w.getChildContext();for(var C in w)if(!(C in l))throw Error(ft(108,OC(r)||"Unknown",C));return Li({},f,w)}function b0(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Ch,Vd=_o.current,hi(_o,r),hi(ps,ps.current),!0}function uA(r,l,f){var w=r.stateNode;if(!w)throw Error(ft(169));f?(r=rE(r,l,Vd),w.__reactInternalMemoizedMergedChildContext=r,gi(ps),gi(_o),hi(_o,r)):gi(ps),hi(ps,f)}var Wu=null,G0=!1,r1=!1;function oE(r){Wu===null?Wu=[r]:Wu.push(r)}function tS(r){G0=!0,oE(r)}function Ih(){if(!r1&&Wu!==null){r1=!0;var r=0,l=ri;try{var f=Wu;for(ri=1;r<f.length;r++){var w=f[r];do w=w(!0);while(w!==null)}Wu=null,G0=!1}catch(C){throw Wu!==null&&(Wu=Wu.slice(r+1)),B2(Ew,Ih),C}finally{ri=l,r1=!1}}return null}var Cf=[],Tf=0,A0=null,E0=0,Ca=[],Ta=0,jd=null,Ku=1,Xu="";function Ld(r,l){Cf[Tf++]=E0,Cf[Tf++]=A0,A0=r,E0=l}function sE(r,l,f){Ca[Ta++]=Ku,Ca[Ta++]=Xu,Ca[Ta++]=jd,jd=r;var w=Ku;r=Xu;var C=32-ul(w)-1;w&=~(1<<C),f+=1;var D=32-ul(l)+C;if(30<D){var O=C-C%5;D=(w&(1<<O)-1).toString(32),w>>=O,C-=O,Ku=1<<32-ul(l)+C|f<<C|w,Xu=D+r}else Ku=1<<D|f<<C|w,Xu=r}function zw(r){r.return!==null&&(Ld(r,1),sE(r,1,0))}function Pw(r){for(;r===A0;)A0=Cf[--Tf],Cf[Tf]=null,E0=Cf[--Tf],Cf[Tf]=null;for(;r===jd;)jd=Ca[--Ta],Ca[Ta]=null,Xu=Ca[--Ta],Ca[Ta]=null,Ku=Ca[--Ta],Ca[Ta]=null}var Vs=null,Gs=null,Si=!1,ll=null;function aE(r,l){var f=Sa(5,null,null,0);f.elementType="DELETED",f.stateNode=l,f.return=r,l=r.deletions,l===null?(r.deletions=[f],r.flags|=16):l.push(f)}function cA(r,l){switch(r.tag){case 5:var f=r.type;return l=l.nodeType!==1||f.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(r.stateNode=l,Vs=r,Gs=vh(l.firstChild),!0):!1;case 6:return l=r.pendingProps===""||l.nodeType!==3?null:l,l!==null?(r.stateNode=l,Vs=r,Gs=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(f=jd!==null?{id:Ku,overflow:Xu}:null,r.memoizedState={dehydrated:l,treeContext:f,retryLane:1073741824},f=Sa(18,null,null,0),f.stateNode=l,f.return=r,r.child=f,Vs=r,Gs=null,!0):!1;default:return!1}}function q1(r){return(r.mode&1)!==0&&(r.flags&128)===0}function H1(r){if(Si){var l=Gs;if(l){var f=l;if(!cA(r,l)){if(q1(r))throw Error(ft(418));l=vh(f.nextSibling);var w=Vs;l&&cA(r,l)?aE(w,f):(r.flags=r.flags&-4097|2,Si=!1,Vs=r)}}else{if(q1(r))throw Error(ft(418));r.flags=r.flags&-4097|2,Si=!1,Vs=r}}}function hA(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Vs=r}function $y(r){if(r!==Vs)return!1;if(!Si)return hA(r),Si=!0,!1;var l;if((l=r.tag!==3)&&!(l=r.tag!==5)&&(l=r.type,l=l!=="head"&&l!=="body"&&!N1(r.type,r.memoizedProps)),l&&(l=Gs)){if(q1(r))throw lE(),Error(ft(418));for(;l;)aE(r,l),l=vh(l.nextSibling)}if(hA(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ft(317));e:{for(r=r.nextSibling,l=0;r;){if(r.nodeType===8){var f=r.data;if(f==="/$"){if(l===0){Gs=vh(r.nextSibling);break e}l--}else f!=="$"&&f!=="$!"&&f!=="$?"||l++}r=r.nextSibling}Gs=null}}else Gs=Vs?vh(r.stateNode.nextSibling):null;return!0}function lE(){for(var r=Gs;r;)r=vh(r.nextSibling)}function Uf(){Gs=Vs=null,Si=!1}function Lw(r){ll===null?ll=[r]:ll.push(r)}var nS=nc.ReactCurrentBatchConfig;function sl(r,l){if(r&&r.defaultProps){l=Li({},l),r=r.defaultProps;for(var f in r)l[f]===void 0&&(l[f]=r[f]);return l}return l}var C0=Sh(null),T0=null,Sf=null,Fw=null;function Rw(){Fw=Sf=T0=null}function Ow(r){var l=C0.current;gi(C0),r._currentValue=l}function $1(r,l,f){for(;r!==null;){var w=r.alternate;if((r.childLanes&l)!==l?(r.childLanes|=l,w!==null&&(w.childLanes|=l)):w!==null&&(w.childLanes&l)!==l&&(w.childLanes|=l),r===f)break;r=r.return}}function Pf(r,l){T0=r,Fw=Sf=null,r=r.dependencies,r!==null&&r.firstContext!==null&&((r.lanes&l)!==0&&(ds=!0),r.firstContext=null)}function Ma(r){var l=r._currentValue;if(Fw!==r)if(r={context:r,memoizedValue:l,next:null},Sf===null){if(T0===null)throw Error(ft(308));Sf=r,T0.dependencies={lanes:0,firstContext:r}}else Sf=Sf.next=r;return l}var Od=null;function Uw(r){Od===null?Od=[r]:Od.push(r)}function uE(r,l,f,w){var C=l.interleaved;return C===null?(f.next=f,Uw(l)):(f.next=C.next,C.next=f),l.interleaved=f,ec(r,w)}function ec(r,l){r.lanes|=l;var f=r.alternate;for(f!==null&&(f.lanes|=l),f=r,r=r.return;r!==null;)r.childLanes|=l,f=r.alternate,f!==null&&(f.childLanes|=l),f=r,r=r.return;return f.tag===3?f.stateNode:null}var hh=!1;function Nw(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cE(r,l){r=r.updateQueue,l.updateQueue===r&&(l.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Ju(r,l){return{eventTime:r,lane:l,tag:0,payload:null,callback:null,next:null}}function xh(r,l,f){var w=r.updateQueue;if(w===null)return null;if(w=w.shared,(Zn&2)!==0){var C=w.pending;return C===null?l.next=l:(l.next=C.next,C.next=l),w.pending=l,ec(r,f)}return C=w.interleaved,C===null?(l.next=l,Uw(w)):(l.next=C.next,C.next=l),w.interleaved=l,ec(r,f)}function o0(r,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194240)!==0)){var w=l.lanes;w&=r.pendingLanes,f|=w,l.lanes=f,Cw(r,f)}}function dA(r,l){var f=r.updateQueue,w=r.alternate;if(w!==null&&(w=w.updateQueue,f===w)){var C=null,D=null;if(f=f.firstBaseUpdate,f!==null){do{var O={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};D===null?C=D=O:D=D.next=O,f=f.next}while(f!==null);D===null?C=D=l:D=D.next=l}else C=D=l;f={baseState:w.baseState,firstBaseUpdate:C,lastBaseUpdate:D,shared:w.shared,effects:w.effects},r.updateQueue=f;return}r=f.lastBaseUpdate,r===null?f.firstBaseUpdate=l:r.next=l,f.lastBaseUpdate=l}function S0(r,l,f,w){var C=r.updateQueue;hh=!1;var D=C.firstBaseUpdate,O=C.lastBaseUpdate,s=C.shared.pending;if(s!==null){C.shared.pending=null;var q=s,be=q.next;q.next=null,O===null?D=be:O.next=be,O=q;var je=r.alternate;je!==null&&(je=je.updateQueue,s=je.lastBaseUpdate,s!==O&&(s===null?je.firstBaseUpdate=be:s.next=be,je.lastBaseUpdate=q))}if(D!==null){var Pe=C.baseState;O=0,je=be=q=null,s=D;do{var Le=s.lane,ct=s.eventTime;if((w&Le)===Le){je!==null&&(je=je.next={eventTime:ct,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var ht=r,yt=s;switch(Le=l,ct=f,yt.tag){case 1:if(ht=yt.payload,typeof ht=="function"){Pe=ht.call(ct,Pe,Le);break e}Pe=ht;break e;case 3:ht.flags=ht.flags&-65537|128;case 0:if(ht=yt.payload,Le=typeof ht=="function"?ht.call(ct,Pe,Le):ht,Le==null)break e;Pe=Li({},Pe,Le);break e;case 2:hh=!0}}s.callback!==null&&s.lane!==0&&(r.flags|=64,Le=C.effects,Le===null?C.effects=[s]:Le.push(s))}else ct={eventTime:ct,lane:Le,tag:s.tag,payload:s.payload,callback:s.callback,next:null},je===null?(be=je=ct,q=Pe):je=je.next=ct,O|=Le;if(s=s.next,s===null){if(s=C.shared.pending,s===null)break;Le=s,s=Le.next,Le.next=null,C.lastBaseUpdate=Le,C.shared.pending=null}}while(1);if(je===null&&(q=Pe),C.baseState=q,C.firstBaseUpdate=be,C.lastBaseUpdate=je,l=C.shared.interleaved,l!==null){C=l;do O|=C.lane,C=C.next;while(C!==l)}else D===null&&(C.shared.lanes=0);Hd|=O,r.lanes=O,r.memoizedState=Pe}}function pA(r,l,f){if(r=l.effects,l.effects=null,r!==null)for(l=0;l<r.length;l++){var w=r[l],C=w.callback;if(C!==null){if(w.callback=null,w=f,typeof C!="function")throw Error(ft(191,C));C.call(w)}}}var hE=new u2.Component().refs;function Z1(r,l,f,w){l=r.memoizedState,f=f(w,l),f=f==null?l:Li({},l,f),r.memoizedState=f,r.lanes===0&&(r.updateQueue.baseState=f)}var V0={isMounted:function(r){return(r=r._reactInternals)?Wd(r)===r:!1},enqueueSetState:function(r,l,f){r=r._reactInternals;var w=Lo(),C=bh(r),D=Ju(w,C);D.payload=l,f!=null&&(D.callback=f),l=xh(r,D,C),l!==null&&(cl(l,r,C,w),o0(l,r,C))},enqueueReplaceState:function(r,l,f){r=r._reactInternals;var w=Lo(),C=bh(r),D=Ju(w,C);D.tag=1,D.payload=l,f!=null&&(D.callback=f),l=xh(r,D,C),l!==null&&(cl(l,r,C,w),o0(l,r,C))},enqueueForceUpdate:function(r,l){r=r._reactInternals;var f=Lo(),w=bh(r),C=Ju(f,w);C.tag=2,l!=null&&(C.callback=l),l=xh(r,C,w),l!==null&&(cl(l,r,w,f),o0(l,r,w))}};function fA(r,l,f,w,C,D,O){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(w,D,O):l.prototype&&l.prototype.isPureReactComponent?!O_(f,w)||!O_(C,D):!0}function dE(r,l,f){var w=!1,C=Ch,D=l.contextType;return typeof D=="object"&&D!==null?D=Ma(D):(C=fs(l)?Vd:_o.current,w=l.contextTypes,D=(w=w!=null)?Of(r,C):Ch),l=new l(f,D),r.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=V0,r.stateNode=l,l._reactInternals=r,w&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=C,r.__reactInternalMemoizedMaskedChildContext=D),l}function mA(r,l,f,w){r=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,w),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,w),l.state!==r&&V0.enqueueReplaceState(l,l.state,null)}function W1(r,l,f,w){var C=r.stateNode;C.props=f,C.state=r.memoizedState,C.refs=hE,Nw(r);var D=l.contextType;typeof D=="object"&&D!==null?C.context=Ma(D):(D=fs(l)?Vd:_o.current,C.context=Of(r,D)),C.state=r.memoizedState,D=l.getDerivedStateFromProps,typeof D=="function"&&(Z1(r,l,D,f),C.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(l=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),l!==C.state&&V0.enqueueReplaceState(C,C.state,null),S0(r,f,C,w),C.state=r.memoizedState),typeof C.componentDidMount=="function"&&(r.flags|=4194308)}function m_(r,l,f){if(r=f.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(ft(309));var w=f.stateNode}if(!w)throw Error(ft(147,r));var C=w,D=""+r;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===D?l.ref:(l=function(O){var s=C.refs;s===hE&&(s=C.refs={}),O===null?delete s[D]:s[D]=O},l._stringRef=D,l)}if(typeof r!="string")throw Error(ft(284));if(!f._owner)throw Error(ft(290,r))}return r}function Zy(r,l){throw r=Object.prototype.toString.call(l),Error(ft(31,r==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":r))}function _A(r){var l=r._init;return l(r._payload)}function pE(r){function l(Te,ge){if(r){var Se=Te.deletions;Se===null?(Te.deletions=[ge],Te.flags|=16):Se.push(ge)}}function f(Te,ge){if(!r)return null;for(;ge!==null;)l(Te,ge),ge=ge.sibling;return null}function w(Te,ge){for(Te=new Map;ge!==null;)ge.key!==null?Te.set(ge.key,ge):Te.set(ge.index,ge),ge=ge.sibling;return Te}function C(Te,ge){return Te=Ah(Te,ge),Te.index=0,Te.sibling=null,Te}function D(Te,ge,Se){return Te.index=Se,r?(Se=Te.alternate,Se!==null?(Se=Se.index,Se<ge?(Te.flags|=2,ge):Se):(Te.flags|=2,ge)):(Te.flags|=1048576,ge)}function O(Te){return r&&Te.alternate===null&&(Te.flags|=2),Te}function s(Te,ge,Se,it){return ge===null||ge.tag!==6?(ge=h1(Se,Te.mode,it),ge.return=Te,ge):(ge=C(ge,Se),ge.return=Te,ge)}function q(Te,ge,Se,it){var ke=Se.type;return ke===vf?je(Te,ge,Se.props.children,it,Se.key):ge!==null&&(ge.elementType===ke||typeof ke=="object"&&ke!==null&&ke.$$typeof===ch&&_A(ke)===ge.type)?(it=C(ge,Se.props),it.ref=m_(Te,ge,Se),it.return=Te,it):(it=h0(Se.type,Se.key,Se.props,null,Te.mode,it),it.ref=m_(Te,ge,Se),it.return=Te,it)}function be(Te,ge,Se,it){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Se.containerInfo||ge.stateNode.implementation!==Se.implementation?(ge=d1(Se,Te.mode,it),ge.return=Te,ge):(ge=C(ge,Se.children||[]),ge.return=Te,ge)}function je(Te,ge,Se,it,ke){return ge===null||ge.tag!==7?(ge=Gd(Se,Te.mode,it,ke),ge.return=Te,ge):(ge=C(ge,Se),ge.return=Te,ge)}function Pe(Te,ge,Se){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=h1(""+ge,Te.mode,Se),ge.return=Te,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case Fy:return Se=h0(ge.type,ge.key,ge.props,null,Te.mode,Se),Se.ref=m_(Te,null,ge),Se.return=Te,Se;case yf:return ge=d1(ge,Te.mode,Se),ge.return=Te,ge;case ch:var it=ge._init;return Pe(Te,it(ge._payload),Se)}if(v_(ge)||c_(ge))return ge=Gd(ge,Te.mode,Se,null),ge.return=Te,ge;Zy(Te,ge)}return null}function Le(Te,ge,Se,it){var ke=ge!==null?ge.key:null;if(typeof Se=="string"&&Se!==""||typeof Se=="number")return ke!==null?null:s(Te,ge,""+Se,it);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case Fy:return Se.key===ke?q(Te,ge,Se,it):null;case yf:return Se.key===ke?be(Te,ge,Se,it):null;case ch:return ke=Se._init,Le(Te,ge,ke(Se._payload),it)}if(v_(Se)||c_(Se))return ke!==null?null:je(Te,ge,Se,it,null);Zy(Te,Se)}return null}function ct(Te,ge,Se,it,ke){if(typeof it=="string"&&it!==""||typeof it=="number")return Te=Te.get(Se)||null,s(ge,Te,""+it,ke);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case Fy:return Te=Te.get(it.key===null?Se:it.key)||null,q(ge,Te,it,ke);case yf:return Te=Te.get(it.key===null?Se:it.key)||null,be(ge,Te,it,ke);case ch:var ut=it._init;return ct(Te,ge,Se,ut(it._payload),ke)}if(v_(it)||c_(it))return Te=Te.get(Se)||null,je(ge,Te,it,ke,null);Zy(ge,it)}return null}function ht(Te,ge,Se,it){for(var ke=null,ut=null,bt=ge,Pt=ge=0,zt=null;bt!==null&&Pt<Se.length;Pt++){bt.index>Pt?(zt=bt,bt=null):zt=bt.sibling;var qt=Le(Te,bt,Se[Pt],it);if(qt===null){bt===null&&(bt=zt);break}r&&bt&&qt.alternate===null&&l(Te,bt),ge=D(qt,ge,Pt),ut===null?ke=qt:ut.sibling=qt,ut=qt,bt=zt}if(Pt===Se.length)return f(Te,bt),Si&&Ld(Te,Pt),ke;if(bt===null){for(;Pt<Se.length;Pt++)bt=Pe(Te,Se[Pt],it),bt!==null&&(ge=D(bt,ge,Pt),ut===null?ke=bt:ut.sibling=bt,ut=bt);return Si&&Ld(Te,Pt),ke}for(bt=w(Te,bt);Pt<Se.length;Pt++)zt=ct(bt,Te,Pt,Se[Pt],it),zt!==null&&(r&&zt.alternate!==null&&bt.delete(zt.key===null?Pt:zt.key),ge=D(zt,ge,Pt),ut===null?ke=zt:ut.sibling=zt,ut=zt);return r&&bt.forEach(function(rr){return l(Te,rr)}),Si&&Ld(Te,Pt),ke}function yt(Te,ge,Se,it){var ke=c_(Se);if(typeof ke!="function")throw Error(ft(150));if(Se=ke.call(Se),Se==null)throw Error(ft(151));for(var ut=ke=null,bt=ge,Pt=ge=0,zt=null,qt=Se.next();bt!==null&&!qt.done;Pt++,qt=Se.next()){bt.index>Pt?(zt=bt,bt=null):zt=bt.sibling;var rr=Le(Te,bt,qt.value,it);if(rr===null){bt===null&&(bt=zt);break}r&&bt&&rr.alternate===null&&l(Te,bt),ge=D(rr,ge,Pt),ut===null?ke=rr:ut.sibling=rr,ut=rr,bt=zt}if(qt.done)return f(Te,bt),Si&&Ld(Te,Pt),ke;if(bt===null){for(;!qt.done;Pt++,qt=Se.next())qt=Pe(Te,qt.value,it),qt!==null&&(ge=D(qt,ge,Pt),ut===null?ke=qt:ut.sibling=qt,ut=qt);return Si&&Ld(Te,Pt),ke}for(bt=w(Te,bt);!qt.done;Pt++,qt=Se.next())qt=ct(bt,Te,Pt,qt.value,it),qt!==null&&(r&&qt.alternate!==null&&bt.delete(qt.key===null?Pt:qt.key),ge=D(qt,ge,Pt),ut===null?ke=qt:ut.sibling=qt,ut=qt);return r&&bt.forEach(function(Oo){return l(Te,Oo)}),Si&&Ld(Te,Pt),ke}function hn(Te,ge,Se,it){if(typeof Se=="object"&&Se!==null&&Se.type===vf&&Se.key===null&&(Se=Se.props.children),typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case Fy:e:{for(var ke=Se.key,ut=ge;ut!==null;){if(ut.key===ke){if(ke=Se.type,ke===vf){if(ut.tag===7){f(Te,ut.sibling),ge=C(ut,Se.props.children),ge.return=Te,Te=ge;break e}}else if(ut.elementType===ke||typeof ke=="object"&&ke!==null&&ke.$$typeof===ch&&_A(ke)===ut.type){f(Te,ut.sibling),ge=C(ut,Se.props),ge.ref=m_(Te,ut,Se),ge.return=Te,Te=ge;break e}f(Te,ut);break}else l(Te,ut);ut=ut.sibling}Se.type===vf?(ge=Gd(Se.props.children,Te.mode,it,Se.key),ge.return=Te,Te=ge):(it=h0(Se.type,Se.key,Se.props,null,Te.mode,it),it.ref=m_(Te,ge,Se),it.return=Te,Te=it)}return O(Te);case yf:e:{for(ut=Se.key;ge!==null;){if(ge.key===ut)if(ge.tag===4&&ge.stateNode.containerInfo===Se.containerInfo&&ge.stateNode.implementation===Se.implementation){f(Te,ge.sibling),ge=C(ge,Se.children||[]),ge.return=Te,Te=ge;break e}else{f(Te,ge);break}else l(Te,ge);ge=ge.sibling}ge=d1(Se,Te.mode,it),ge.return=Te,Te=ge}return O(Te);case ch:return ut=Se._init,hn(Te,ge,ut(Se._payload),it)}if(v_(Se))return ht(Te,ge,Se,it);if(c_(Se))return yt(Te,ge,Se,it);Zy(Te,Se)}return typeof Se=="string"&&Se!==""||typeof Se=="number"?(Se=""+Se,ge!==null&&ge.tag===6?(f(Te,ge.sibling),ge=C(ge,Se),ge.return=Te,Te=ge):(f(Te,ge),ge=h1(Se,Te.mode,it),ge.return=Te,Te=ge),O(Te)):f(Te,ge)}return hn}var Nf=pE(!0),fE=pE(!1),Y_={},uu=Sh(Y_),V_=Sh(Y_),j_=Sh(Y_);function Ud(r){if(r===Y_)throw Error(ft(174));return r}function Gw(r,l){switch(hi(j_,l),hi(V_,r),hi(uu,Y_),r=l.nodeType,r){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:T1(null,"");break;default:r=r===8?l.parentNode:l,l=r.namespaceURI||null,r=r.tagName,l=T1(l,r)}gi(uu),hi(uu,l)}function Gf(){gi(uu),gi(V_),gi(j_)}function mE(r){Ud(j_.current);var l=Ud(uu.current),f=T1(l,r.type);l!==f&&(hi(V_,r),hi(uu,f))}function Vw(r){V_.current===r&&(gi(uu),gi(V_))}var zi=Sh(0);function I0(r){for(var l=r;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var o1=[];function jw(){for(var r=0;r<o1.length;r++)o1[r]._workInProgressVersionPrimary=null;o1.length=0}var s0=nc.ReactCurrentDispatcher,s1=nc.ReactCurrentBatchConfig,qd=0,Pi=null,xr=null,kr=null,M0=!1,S_=!1,q_=0,iS=0;function po(){throw Error(ft(321))}function qw(r,l){if(l===null)return!1;for(var f=0;f<l.length&&f<r.length;f++)if(!hl(r[f],l[f]))return!1;return!0}function Hw(r,l,f,w,C,D){if(qd=D,Pi=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,s0.current=r===null||r.memoizedState===null?aS:lS,r=f(w,C),S_){D=0;do{if(S_=!1,q_=0,25<=D)throw Error(ft(301));D+=1,kr=xr=null,l.updateQueue=null,s0.current=uS,r=f(w,C)}while(S_)}if(s0.current=B0,l=xr!==null&&xr.next!==null,qd=0,kr=xr=Pi=null,M0=!1,l)throw Error(ft(300));return r}function $w(){var r=q_!==0;return q_=0,r}function su(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kr===null?Pi.memoizedState=kr=r:kr=kr.next=r,kr}function Ba(){if(xr===null){var r=Pi.alternate;r=r!==null?r.memoizedState:null}else r=xr.next;var l=kr===null?Pi.memoizedState:kr.next;if(l!==null)kr=l,xr=r;else{if(r===null)throw Error(ft(310));xr=r,r={memoizedState:xr.memoizedState,baseState:xr.baseState,baseQueue:xr.baseQueue,queue:xr.queue,next:null},kr===null?Pi.memoizedState=kr=r:kr=kr.next=r}return kr}function H_(r,l){return typeof l=="function"?l(r):l}function a1(r){var l=Ba(),f=l.queue;if(f===null)throw Error(ft(311));f.lastRenderedReducer=r;var w=xr,C=w.baseQueue,D=f.pending;if(D!==null){if(C!==null){var O=C.next;C.next=D.next,D.next=O}w.baseQueue=C=D,f.pending=null}if(C!==null){D=C.next,w=w.baseState;var s=O=null,q=null,be=D;do{var je=be.lane;if((qd&je)===je)q!==null&&(q=q.next={lane:0,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null}),w=be.hasEagerState?be.eagerState:r(w,be.action);else{var Pe={lane:je,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null};q===null?(s=q=Pe,O=w):q=q.next=Pe,Pi.lanes|=je,Hd|=je}be=be.next}while(be!==null&&be!==D);q===null?O=w:q.next=s,hl(w,l.memoizedState)||(ds=!0),l.memoizedState=w,l.baseState=O,l.baseQueue=q,f.lastRenderedState=w}if(r=f.interleaved,r!==null){C=r;do D=C.lane,Pi.lanes|=D,Hd|=D,C=C.next;while(C!==r)}else C===null&&(f.lanes=0);return[l.memoizedState,f.dispatch]}function l1(r){var l=Ba(),f=l.queue;if(f===null)throw Error(ft(311));f.lastRenderedReducer=r;var w=f.dispatch,C=f.pending,D=l.memoizedState;if(C!==null){f.pending=null;var O=C=C.next;do D=r(D,O.action),O=O.next;while(O!==C);hl(D,l.memoizedState)||(ds=!0),l.memoizedState=D,l.baseQueue===null&&(l.baseState=D),f.lastRenderedState=D}return[D,w]}function _E(){}function gE(r,l){var f=Pi,w=Ba(),C=l(),D=!hl(w.memoizedState,C);if(D&&(w.memoizedState=C,ds=!0),w=w.queue,Zw(xE.bind(null,f,w,r),[r]),w.getSnapshot!==l||D||kr!==null&&kr.memoizedState.tag&1){if(f.flags|=2048,$_(9,vE.bind(null,f,w,C,l),void 0,null),zr===null)throw Error(ft(349));(qd&30)!==0||yE(f,l,C)}return C}function yE(r,l,f){r.flags|=16384,r={getSnapshot:l,value:f},l=Pi.updateQueue,l===null?(l={lastEffect:null,stores:null},Pi.updateQueue=l,l.stores=[r]):(f=l.stores,f===null?l.stores=[r]:f.push(r))}function vE(r,l,f,w){l.value=f,l.getSnapshot=w,wE(l)&&bE(r)}function xE(r,l,f){return f(function(){wE(l)&&bE(r)})}function wE(r){var l=r.getSnapshot;r=r.value;try{var f=l();return!hl(r,f)}catch{return!0}}function bE(r){var l=ec(r,1);l!==null&&cl(l,r,1,-1)}function gA(r){var l=su();return typeof r=="function"&&(r=r()),l.memoizedState=l.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:H_,lastRenderedState:r},l.queue=r,r=r.dispatch=sS.bind(null,Pi,r),[l.memoizedState,r]}function $_(r,l,f,w){return r={tag:r,create:l,destroy:f,deps:w,next:null},l=Pi.updateQueue,l===null?(l={lastEffect:null,stores:null},Pi.updateQueue=l,l.lastEffect=r.next=r):(f=l.lastEffect,f===null?l.lastEffect=r.next=r:(w=f.next,f.next=r,r.next=w,l.lastEffect=r)),r}function AE(){return Ba().memoizedState}function a0(r,l,f,w){var C=su();Pi.flags|=r,C.memoizedState=$_(1|l,f,void 0,w===void 0?null:w)}function j0(r,l,f,w){var C=Ba();w=w===void 0?null:w;var D=void 0;if(xr!==null){var O=xr.memoizedState;if(D=O.destroy,w!==null&&qw(w,O.deps)){C.memoizedState=$_(l,f,D,w);return}}Pi.flags|=r,C.memoizedState=$_(1|l,f,D,w)}function yA(r,l){return a0(8390656,8,r,l)}function Zw(r,l){return j0(2048,8,r,l)}function EE(r,l){return j0(4,2,r,l)}function CE(r,l){return j0(4,4,r,l)}function TE(r,l){if(typeof l=="function")return r=r(),l(r),function(){l(null)};if(l!=null)return r=r(),l.current=r,function(){l.current=null}}function SE(r,l,f){return f=f!=null?f.concat([r]):null,j0(4,4,TE.bind(null,l,r),f)}function Ww(){}function IE(r,l){var f=Ba();l=l===void 0?null:l;var w=f.memoizedState;return w!==null&&l!==null&&qw(l,w[1])?w[0]:(f.memoizedState=[r,l],r)}function ME(r,l){var f=Ba();l=l===void 0?null:l;var w=f.memoizedState;return w!==null&&l!==null&&qw(l,w[1])?w[0]:(r=r(),f.memoizedState=[r,l],r)}function BE(r,l,f){return(qd&21)===0?(r.baseState&&(r.baseState=!1,ds=!0),r.memoizedState=f):(hl(f,l)||(f=z2(),Pi.lanes|=f,Hd|=f,r.baseState=!0),l)}function rS(r,l){var f=ri;ri=f!==0&&4>f?f:4,r(!0);var w=s1.transition;s1.transition={};try{r(!1),l()}finally{ri=f,s1.transition=w}}function DE(){return Ba().memoizedState}function oS(r,l,f){var w=bh(r);if(f={lane:w,action:f,hasEagerState:!1,eagerState:null,next:null},kE(r))zE(l,f);else if(f=uE(r,l,f,w),f!==null){var C=Lo();cl(f,r,w,C),PE(f,l,w)}}function sS(r,l,f){var w=bh(r),C={lane:w,action:f,hasEagerState:!1,eagerState:null,next:null};if(kE(r))zE(l,C);else{var D=r.alternate;if(r.lanes===0&&(D===null||D.lanes===0)&&(D=l.lastRenderedReducer,D!==null))try{var O=l.lastRenderedState,s=D(O,f);if(C.hasEagerState=!0,C.eagerState=s,hl(s,O)){var q=l.interleaved;q===null?(C.next=C,Uw(l)):(C.next=q.next,q.next=C),l.interleaved=C;return}}catch{}finally{}f=uE(r,l,C,w),f!==null&&(C=Lo(),cl(f,r,w,C),PE(f,l,w))}}function kE(r){var l=r.alternate;return r===Pi||l!==null&&l===Pi}function zE(r,l){S_=M0=!0;var f=r.pending;f===null?l.next=l:(l.next=f.next,f.next=l),r.pending=l}function PE(r,l,f){if((f&4194240)!==0){var w=l.lanes;w&=r.pendingLanes,f|=w,l.lanes=f,Cw(r,f)}}var B0={readContext:Ma,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},aS={readContext:Ma,useCallback:function(r,l){return su().memoizedState=[r,l===void 0?null:l],r},useContext:Ma,useEffect:yA,useImperativeHandle:function(r,l,f){return f=f!=null?f.concat([r]):null,a0(4194308,4,TE.bind(null,l,r),f)},useLayoutEffect:function(r,l){return a0(4194308,4,r,l)},useInsertionEffect:function(r,l){return a0(4,2,r,l)},useMemo:function(r,l){var f=su();return l=l===void 0?null:l,r=r(),f.memoizedState=[r,l],r},useReducer:function(r,l,f){var w=su();return l=f!==void 0?f(l):l,w.memoizedState=w.baseState=l,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:l},w.queue=r,r=r.dispatch=oS.bind(null,Pi,r),[w.memoizedState,r]},useRef:function(r){var l=su();return r={current:r},l.memoizedState=r},useState:gA,useDebugValue:Ww,useDeferredValue:function(r){return su().memoizedState=r},useTransition:function(){var r=gA(!1),l=r[0];return r=rS.bind(null,r[1]),su().memoizedState=r,[l,r]},useMutableSource:function(){},useSyncExternalStore:function(r,l,f){var w=Pi,C=su();if(Si){if(f===void 0)throw Error(ft(407));f=f()}else{if(f=l(),zr===null)throw Error(ft(349));(qd&30)!==0||yE(w,l,f)}C.memoizedState=f;var D={value:f,getSnapshot:l};return C.queue=D,yA(xE.bind(null,w,D,r),[r]),w.flags|=2048,$_(9,vE.bind(null,w,D,f,l),void 0,null),f},useId:function(){var r=su(),l=zr.identifierPrefix;if(Si){var f=Xu,w=Ku;f=(w&~(1<<32-ul(w)-1)).toString(32)+f,l=":"+l+"R"+f,f=q_++,0<f&&(l+="H"+f.toString(32)),l+=":"}else f=iS++,l=":"+l+"r"+f.toString(32)+":";return r.memoizedState=l},unstable_isNewReconciler:!1},lS={readContext:Ma,useCallback:IE,useContext:Ma,useEffect:Zw,useImperativeHandle:SE,useInsertionEffect:EE,useLayoutEffect:CE,useMemo:ME,useReducer:a1,useRef:AE,useState:function(){return a1(H_)},useDebugValue:Ww,useDeferredValue:function(r){var l=Ba();return BE(l,xr.memoizedState,r)},useTransition:function(){var r=a1(H_)[0],l=Ba().memoizedState;return[r,l]},useMutableSource:_E,useSyncExternalStore:gE,useId:DE,unstable_isNewReconciler:!1},uS={readContext:Ma,useCallback:IE,useContext:Ma,useEffect:Zw,useImperativeHandle:SE,useInsertionEffect:EE,useLayoutEffect:CE,useMemo:ME,useReducer:l1,useRef:AE,useState:function(){return l1(H_)},useDebugValue:Ww,useDeferredValue:function(r){var l=Ba();return xr===null?l.memoizedState=r:BE(l,xr.memoizedState,r)},useTransition:function(){var r=l1(H_)[0],l=Ba().memoizedState;return[r,l]},useMutableSource:_E,useSyncExternalStore:gE,useId:DE,unstable_isNewReconciler:!1};function Vf(r,l){try{var f="",w=l;do f+=RC(w),w=w.return;while(w);var C=f}catch(D){C=`
Error generating stack: `+D.message+`
`+D.stack}return{value:r,source:l,stack:C,digest:null}}function u1(r,l,f){return{value:r,source:null,stack:f!=null?f:null,digest:l!=null?l:null}}function K1(r,l){try{console.error(l.value)}catch(f){setTimeout(function(){throw f})}}var cS=typeof WeakMap=="function"?WeakMap:Map;function LE(r,l,f){f=Ju(-1,f),f.tag=3,f.payload={element:null};var w=l.value;return f.callback=function(){k0||(k0=!0,ow=w),K1(r,l)},f}function FE(r,l,f){f=Ju(-1,f),f.tag=3;var w=r.type.getDerivedStateFromError;if(typeof w=="function"){var C=l.value;f.payload=function(){return w(C)},f.callback=function(){K1(r,l)}}var D=r.stateNode;return D!==null&&typeof D.componentDidCatch=="function"&&(f.callback=function(){K1(r,l),typeof w!="function"&&(wh===null?wh=new Set([this]):wh.add(this));var O=l.stack;this.componentDidCatch(l.value,{componentStack:O!==null?O:""})}),f}function vA(r,l,f){var w=r.pingCache;if(w===null){w=r.pingCache=new cS;var C=new Set;w.set(l,C)}else C=w.get(l),C===void 0&&(C=new Set,w.set(l,C));C.has(f)||(C.add(f),r=ES.bind(null,r,l,f),l.then(r,r))}function xA(r){do{var l;if((l=r.tag===13)&&(l=r.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return r;r=r.return}while(r!==null);return null}function wA(r,l,f,w,C){return(r.mode&1)===0?(r===l?r.flags|=65536:(r.flags|=128,f.flags|=131072,f.flags&=-52805,f.tag===1&&(f.alternate===null?f.tag=17:(l=Ju(-1,1),l.tag=2,xh(f,l,1))),f.lanes|=1),r):(r.flags|=65536,r.lanes=C,r)}var hS=nc.ReactCurrentOwner,ds=!1;function Po(r,l,f,w){l.child=r===null?fE(l,null,f,w):Nf(l,r.child,f,w)}function bA(r,l,f,w,C){f=f.render;var D=l.ref;return Pf(l,C),w=Hw(r,l,f,w,D,C),f=$w(),r!==null&&!ds?(l.updateQueue=r.updateQueue,l.flags&=-2053,r.lanes&=~C,tc(r,l,C)):(Si&&f&&zw(l),l.flags|=1,Po(r,l,w,C),l.child)}function AA(r,l,f,w,C){if(r===null){var D=f.type;return typeof D=="function"&&!nb(D)&&D.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(l.tag=15,l.type=D,RE(r,l,D,w,C)):(r=h0(f.type,null,w,l,l.mode,C),r.ref=l.ref,r.return=l,l.child=r)}if(D=r.child,(r.lanes&C)===0){var O=D.memoizedProps;if(f=f.compare,f=f!==null?f:O_,f(O,w)&&r.ref===l.ref)return tc(r,l,C)}return l.flags|=1,r=Ah(D,w),r.ref=l.ref,r.return=l,l.child=r}function RE(r,l,f,w,C){if(r!==null){var D=r.memoizedProps;if(O_(D,w)&&r.ref===l.ref)if(ds=!1,l.pendingProps=w=D,(r.lanes&C)!==0)(r.flags&131072)!==0&&(ds=!0);else return l.lanes=r.lanes,tc(r,l,C)}return X1(r,l,f,w,C)}function OE(r,l,f){var w=l.pendingProps,C=w.children,D=r!==null?r.memoizedState:null;if(w.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},hi(Mf,Ns),Ns|=f;else{if((f&1073741824)===0)return r=D!==null?D.baseLanes|f:f,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:r,cachePool:null,transitions:null},l.updateQueue=null,hi(Mf,Ns),Ns|=r,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},w=D!==null?D.baseLanes:f,hi(Mf,Ns),Ns|=w}else D!==null?(w=D.baseLanes|f,l.memoizedState=null):w=f,hi(Mf,Ns),Ns|=w;return Po(r,l,C,f),l.child}function UE(r,l){var f=l.ref;(r===null&&f!==null||r!==null&&r.ref!==f)&&(l.flags|=512,l.flags|=2097152)}function X1(r,l,f,w,C){var D=fs(f)?Vd:_o.current;return D=Of(l,D),Pf(l,C),f=Hw(r,l,f,w,D,C),w=$w(),r!==null&&!ds?(l.updateQueue=r.updateQueue,l.flags&=-2053,r.lanes&=~C,tc(r,l,C)):(Si&&w&&zw(l),l.flags|=1,Po(r,l,f,C),l.child)}function EA(r,l,f,w,C){if(fs(f)){var D=!0;b0(l)}else D=!1;if(Pf(l,C),l.stateNode===null)l0(r,l),dE(l,f,w),W1(l,f,w,C),w=!0;else if(r===null){var O=l.stateNode,s=l.memoizedProps;O.props=s;var q=O.context,be=f.contextType;typeof be=="object"&&be!==null?be=Ma(be):(be=fs(f)?Vd:_o.current,be=Of(l,be));var je=f.getDerivedStateFromProps,Pe=typeof je=="function"||typeof O.getSnapshotBeforeUpdate=="function";Pe||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(s!==w||q!==be)&&mA(l,O,w,be),hh=!1;var Le=l.memoizedState;O.state=Le,S0(l,w,O,C),q=l.memoizedState,s!==w||Le!==q||ps.current||hh?(typeof je=="function"&&(Z1(l,f,je,w),q=l.memoizedState),(s=hh||fA(l,f,s,w,Le,q,be))?(Pe||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(l.flags|=4194308)):(typeof O.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=w,l.memoizedState=q),O.props=w,O.state=q,O.context=be,w=s):(typeof O.componentDidMount=="function"&&(l.flags|=4194308),w=!1)}else{O=l.stateNode,cE(r,l),s=l.memoizedProps,be=l.type===l.elementType?s:sl(l.type,s),O.props=be,Pe=l.pendingProps,Le=O.context,q=f.contextType,typeof q=="object"&&q!==null?q=Ma(q):(q=fs(f)?Vd:_o.current,q=Of(l,q));var ct=f.getDerivedStateFromProps;(je=typeof ct=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(s!==Pe||Le!==q)&&mA(l,O,w,q),hh=!1,Le=l.memoizedState,O.state=Le,S0(l,w,O,C);var ht=l.memoizedState;s!==Pe||Le!==ht||ps.current||hh?(typeof ct=="function"&&(Z1(l,f,ct,w),ht=l.memoizedState),(be=hh||fA(l,f,be,w,Le,ht,q)||!1)?(je||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(w,ht,q),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(w,ht,q)),typeof O.componentDidUpdate=="function"&&(l.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof O.componentDidUpdate!="function"||s===r.memoizedProps&&Le===r.memoizedState||(l.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||s===r.memoizedProps&&Le===r.memoizedState||(l.flags|=1024),l.memoizedProps=w,l.memoizedState=ht),O.props=w,O.state=ht,O.context=q,w=be):(typeof O.componentDidUpdate!="function"||s===r.memoizedProps&&Le===r.memoizedState||(l.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||s===r.memoizedProps&&Le===r.memoizedState||(l.flags|=1024),w=!1)}return J1(r,l,f,w,D,C)}function J1(r,l,f,w,C,D){UE(r,l);var O=(l.flags&128)!==0;if(!w&&!O)return C&&uA(l,f,!1),tc(r,l,D);w=l.stateNode,hS.current=l;var s=O&&typeof f.getDerivedStateFromError!="function"?null:w.render();return l.flags|=1,r!==null&&O?(l.child=Nf(l,r.child,null,D),l.child=Nf(l,null,s,D)):Po(r,l,s,D),l.memoizedState=w.state,C&&uA(l,f,!0),l.child}function NE(r){var l=r.stateNode;l.pendingContext?lA(r,l.pendingContext,l.pendingContext!==l.context):l.context&&lA(r,l.context,!1),Gw(r,l.containerInfo)}function CA(r,l,f,w,C){return Uf(),Lw(C),l.flags|=256,Po(r,l,f,w),l.child}var Y1={dehydrated:null,treeContext:null,retryLane:0};function Q1(r){return{baseLanes:r,cachePool:null,transitions:null}}function GE(r,l,f){var w=l.pendingProps,C=zi.current,D=!1,O=(l.flags&128)!==0,s;if((s=O)||(s=r!==null&&r.memoizedState===null?!1:(C&2)!==0),s?(D=!0,l.flags&=-129):(r===null||r.memoizedState!==null)&&(C|=1),hi(zi,C&1),r===null)return H1(l),r=l.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?((l.mode&1)===0?l.lanes=1:r.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(O=w.children,r=w.fallback,D?(w=l.mode,D=l.child,O={mode:"hidden",children:O},(w&1)===0&&D!==null?(D.childLanes=0,D.pendingProps=O):D=$0(O,w,0,null),r=Gd(r,w,f,null),D.return=l,r.return=l,D.sibling=r,l.child=D,l.child.memoizedState=Q1(f),l.memoizedState=Y1,r):Kw(l,O));if(C=r.memoizedState,C!==null&&(s=C.dehydrated,s!==null))return dS(r,l,O,w,s,C,f);if(D){D=w.fallback,O=l.mode,C=r.child,s=C.sibling;var q={mode:"hidden",children:w.children};return(O&1)===0&&l.child!==C?(w=l.child,w.childLanes=0,w.pendingProps=q,l.deletions=null):(w=Ah(C,q),w.subtreeFlags=C.subtreeFlags&14680064),s!==null?D=Ah(s,D):(D=Gd(D,O,f,null),D.flags|=2),D.return=l,w.return=l,w.sibling=D,l.child=w,w=D,D=l.child,O=r.child.memoizedState,O=O===null?Q1(f):{baseLanes:O.baseLanes|f,cachePool:null,transitions:O.transitions},D.memoizedState=O,D.childLanes=r.childLanes&~f,l.memoizedState=Y1,w}return D=r.child,r=D.sibling,w=Ah(D,{mode:"visible",children:w.children}),(l.mode&1)===0&&(w.lanes=f),w.return=l,w.sibling=null,r!==null&&(f=l.deletions,f===null?(l.deletions=[r],l.flags|=16):f.push(r)),l.child=w,l.memoizedState=null,w}function Kw(r,l){return l=$0({mode:"visible",children:l},r.mode,0,null),l.return=r,r.child=l}function Wy(r,l,f,w){return w!==null&&Lw(w),Nf(l,r.child,null,f),r=Kw(l,l.pendingProps.children),r.flags|=2,l.memoizedState=null,r}function dS(r,l,f,w,C,D,O){if(f)return l.flags&256?(l.flags&=-257,w=u1(Error(ft(422))),Wy(r,l,O,w)):l.memoizedState!==null?(l.child=r.child,l.flags|=128,null):(D=w.fallback,C=l.mode,w=$0({mode:"visible",children:w.children},C,0,null),D=Gd(D,C,O,null),D.flags|=2,w.return=l,D.return=l,w.sibling=D,l.child=w,(l.mode&1)!==0&&Nf(l,r.child,null,O),l.child.memoizedState=Q1(O),l.memoizedState=Y1,D);if((l.mode&1)===0)return Wy(r,l,O,null);if(C.data==="$!"){if(w=C.nextSibling&&C.nextSibling.dataset,w)var s=w.dgst;return w=s,D=Error(ft(419)),w=u1(D,w,void 0),Wy(r,l,O,w)}if(s=(O&r.childLanes)!==0,ds||s){if(w=zr,w!==null){switch(O&-O){case 4:C=2;break;case 16:C=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:C=32;break;case 536870912:C=268435456;break;default:C=0}C=(C&(w.suspendedLanes|O))!==0?0:C,C!==0&&C!==D.retryLane&&(D.retryLane=C,ec(r,C),cl(w,r,C,-1))}return tb(),w=u1(Error(ft(421))),Wy(r,l,O,w)}return C.data==="$?"?(l.flags|=128,l.child=r.child,l=CS.bind(null,r),C._reactRetry=l,null):(r=D.treeContext,Gs=vh(C.nextSibling),Vs=l,Si=!0,ll=null,r!==null&&(Ca[Ta++]=Ku,Ca[Ta++]=Xu,Ca[Ta++]=jd,Ku=r.id,Xu=r.overflow,jd=l),l=Kw(l,w.children),l.flags|=4096,l)}function TA(r,l,f){r.lanes|=l;var w=r.alternate;w!==null&&(w.lanes|=l),$1(r.return,l,f)}function c1(r,l,f,w,C){var D=r.memoizedState;D===null?r.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:w,tail:f,tailMode:C}:(D.isBackwards=l,D.rendering=null,D.renderingStartTime=0,D.last=w,D.tail=f,D.tailMode=C)}function VE(r,l,f){var w=l.pendingProps,C=w.revealOrder,D=w.tail;if(Po(r,l,w.children,f),w=zi.current,(w&2)!==0)w=w&1|2,l.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=l.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&TA(r,f,l);else if(r.tag===19)TA(r,f,l);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===l)break e;for(;r.sibling===null;){if(r.return===null||r.return===l)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}w&=1}if(hi(zi,w),(l.mode&1)===0)l.memoizedState=null;else switch(C){case"forwards":for(f=l.child,C=null;f!==null;)r=f.alternate,r!==null&&I0(r)===null&&(C=f),f=f.sibling;f=C,f===null?(C=l.child,l.child=null):(C=f.sibling,f.sibling=null),c1(l,!1,C,f,D);break;case"backwards":for(f=null,C=l.child,l.child=null;C!==null;){if(r=C.alternate,r!==null&&I0(r)===null){l.child=C;break}r=C.sibling,C.sibling=f,f=C,C=r}c1(l,!0,f,null,D);break;case"together":c1(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function l0(r,l){(l.mode&1)===0&&r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2)}function tc(r,l,f){if(r!==null&&(l.dependencies=r.dependencies),Hd|=l.lanes,(f&l.childLanes)===0)return null;if(r!==null&&l.child!==r.child)throw Error(ft(153));if(l.child!==null){for(r=l.child,f=Ah(r,r.pendingProps),l.child=f,f.return=l;r.sibling!==null;)r=r.sibling,f=f.sibling=Ah(r,r.pendingProps),f.return=l;f.sibling=null}return l.child}function pS(r,l,f){switch(l.tag){case 3:NE(l),Uf();break;case 5:mE(l);break;case 1:fs(l.type)&&b0(l);break;case 4:Gw(l,l.stateNode.containerInfo);break;case 10:var w=l.type._context,C=l.memoizedProps.value;hi(C0,w._currentValue),w._currentValue=C;break;case 13:if(w=l.memoizedState,w!==null)return w.dehydrated!==null?(hi(zi,zi.current&1),l.flags|=128,null):(f&l.child.childLanes)!==0?GE(r,l,f):(hi(zi,zi.current&1),r=tc(r,l,f),r!==null?r.sibling:null);hi(zi,zi.current&1);break;case 19:if(w=(f&l.childLanes)!==0,(r.flags&128)!==0){if(w)return VE(r,l,f);l.flags|=128}if(C=l.memoizedState,C!==null&&(C.rendering=null,C.tail=null,C.lastEffect=null),hi(zi,zi.current),w)break;return null;case 22:case 23:return l.lanes=0,OE(r,l,f)}return tc(r,l,f)}var jE,ew,qE,HE;jE=function(r,l){for(var f=l.child;f!==null;){if(f.tag===5||f.tag===6)r.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return;f=f.return}f.sibling.return=f.return,f=f.sibling}};ew=function(){};qE=function(r,l,f,w){var C=r.memoizedProps;if(C!==w){r=l.stateNode,Ud(uu.current);var D=null;switch(f){case"input":C=b1(r,C),w=b1(r,w),D=[];break;case"select":C=Li({},C,{value:void 0}),w=Li({},w,{value:void 0}),D=[];break;case"textarea":C=C1(r,C),w=C1(r,w),D=[];break;default:typeof C.onClick!="function"&&typeof w.onClick=="function"&&(r.onclick=x0)}S1(f,w);var O;f=null;for(be in C)if(!w.hasOwnProperty(be)&&C.hasOwnProperty(be)&&C[be]!=null)if(be==="style"){var s=C[be];for(O in s)s.hasOwnProperty(O)&&(f||(f={}),f[O]="")}else be!=="dangerouslySetInnerHTML"&&be!=="children"&&be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&be!=="autoFocus"&&(D_.hasOwnProperty(be)?D||(D=[]):(D=D||[]).push(be,null));for(be in w){var q=w[be];if(s=C!=null?C[be]:void 0,w.hasOwnProperty(be)&&q!==s&&(q!=null||s!=null))if(be==="style")if(s){for(O in s)!s.hasOwnProperty(O)||q&&q.hasOwnProperty(O)||(f||(f={}),f[O]="");for(O in q)q.hasOwnProperty(O)&&s[O]!==q[O]&&(f||(f={}),f[O]=q[O])}else f||(D||(D=[]),D.push(be,f)),f=q;else be==="dangerouslySetInnerHTML"?(q=q?q.__html:void 0,s=s?s.__html:void 0,q!=null&&s!==q&&(D=D||[]).push(be,q)):be==="children"?typeof q!="string"&&typeof q!="number"||(D=D||[]).push(be,""+q):be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&(D_.hasOwnProperty(be)?(q!=null&&be==="onScroll"&&_i("scroll",r),D||s===q||(D=[])):(D=D||[]).push(be,q))}f&&(D=D||[]).push("style",f);var be=D;(l.updateQueue=be)&&(l.flags|=4)}};HE=function(r,l,f,w){f!==w&&(l.flags|=4)};function __(r,l){if(!Si)switch(r.tailMode){case"hidden":l=r.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?r.tail=null:f.sibling=null;break;case"collapsed":f=r.tail;for(var w=null;f!==null;)f.alternate!==null&&(w=f),f=f.sibling;w===null?l||r.tail===null?r.tail=null:r.tail.sibling=null:w.sibling=null}}function fo(r){var l=r.alternate!==null&&r.alternate.child===r.child,f=0,w=0;if(l)for(var C=r.child;C!==null;)f|=C.lanes|C.childLanes,w|=C.subtreeFlags&14680064,w|=C.flags&14680064,C.return=r,C=C.sibling;else for(C=r.child;C!==null;)f|=C.lanes|C.childLanes,w|=C.subtreeFlags,w|=C.flags,C.return=r,C=C.sibling;return r.subtreeFlags|=w,r.childLanes=f,l}function fS(r,l,f){var w=l.pendingProps;switch(Pw(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fo(l),null;case 1:return fs(l.type)&&w0(),fo(l),null;case 3:return w=l.stateNode,Gf(),gi(ps),gi(_o),jw(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(r===null||r.child===null)&&($y(l)?l.flags|=4:r===null||r.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,ll!==null&&(lw(ll),ll=null))),ew(r,l),fo(l),null;case 5:Vw(l);var C=Ud(j_.current);if(f=l.type,r!==null&&l.stateNode!=null)qE(r,l,f,w,C),r.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!w){if(l.stateNode===null)throw Error(ft(166));return fo(l),null}if(r=Ud(uu.current),$y(l)){w=l.stateNode,f=l.type;var D=l.memoizedProps;switch(w[au]=l,w[G_]=D,r=(l.mode&1)!==0,f){case"dialog":_i("cancel",w),_i("close",w);break;case"iframe":case"object":case"embed":_i("load",w);break;case"video":case"audio":for(C=0;C<w_.length;C++)_i(w_[C],w);break;case"source":_i("error",w);break;case"img":case"image":case"link":_i("error",w),_i("load",w);break;case"details":_i("toggle",w);break;case"input":Lb(w,D),_i("invalid",w);break;case"select":w._wrapperState={wasMultiple:!!D.multiple},_i("invalid",w);break;case"textarea":Rb(w,D),_i("invalid",w)}S1(f,D),C=null;for(var O in D)if(D.hasOwnProperty(O)){var s=D[O];O==="children"?typeof s=="string"?w.textContent!==s&&(D.suppressHydrationWarning!==!0&&Hy(w.textContent,s,r),C=["children",s]):typeof s=="number"&&w.textContent!==""+s&&(D.suppressHydrationWarning!==!0&&Hy(w.textContent,s,r),C=["children",""+s]):D_.hasOwnProperty(O)&&s!=null&&O==="onScroll"&&_i("scroll",w)}switch(f){case"input":Ry(w),Fb(w,D,!0);break;case"textarea":Ry(w),Ob(w);break;case"select":case"option":break;default:typeof D.onClick=="function"&&(w.onclick=x0)}w=C,l.updateQueue=w,w!==null&&(l.flags|=4)}else{O=C.nodeType===9?C:C.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=y2(f)),r==="http://www.w3.org/1999/xhtml"?f==="script"?(r=O.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof w.is=="string"?r=O.createElement(f,{is:w.is}):(r=O.createElement(f),f==="select"&&(O=r,w.multiple?O.multiple=!0:w.size&&(O.size=w.size))):r=O.createElementNS(r,f),r[au]=l,r[G_]=w,jE(r,l,!1,!1),l.stateNode=r;e:{switch(O=I1(f,w),f){case"dialog":_i("cancel",r),_i("close",r),C=w;break;case"iframe":case"object":case"embed":_i("load",r),C=w;break;case"video":case"audio":for(C=0;C<w_.length;C++)_i(w_[C],r);C=w;break;case"source":_i("error",r),C=w;break;case"img":case"image":case"link":_i("error",r),_i("load",r),C=w;break;case"details":_i("toggle",r),C=w;break;case"input":Lb(r,w),C=b1(r,w),_i("invalid",r);break;case"option":C=w;break;case"select":r._wrapperState={wasMultiple:!!w.multiple},C=Li({},w,{value:void 0}),_i("invalid",r);break;case"textarea":Rb(r,w),C=C1(r,w),_i("invalid",r);break;default:C=w}S1(f,C),s=C;for(D in s)if(s.hasOwnProperty(D)){var q=s[D];D==="style"?w2(r,q):D==="dangerouslySetInnerHTML"?(q=q?q.__html:void 0,q!=null&&v2(r,q)):D==="children"?typeof q=="string"?(f!=="textarea"||q!=="")&&k_(r,q):typeof q=="number"&&k_(r,""+q):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(D_.hasOwnProperty(D)?q!=null&&D==="onScroll"&&_i("scroll",r):q!=null&&vw(r,D,q,O))}switch(f){case"input":Ry(r),Fb(r,w,!1);break;case"textarea":Ry(r),Ob(r);break;case"option":w.value!=null&&r.setAttribute("value",""+Eh(w.value));break;case"select":r.multiple=!!w.multiple,D=w.value,D!=null?Bf(r,!!w.multiple,D,!1):w.defaultValue!=null&&Bf(r,!!w.multiple,w.defaultValue,!0);break;default:typeof C.onClick=="function"&&(r.onclick=x0)}switch(f){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}}w&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return fo(l),null;case 6:if(r&&l.stateNode!=null)HE(r,l,r.memoizedProps,w);else{if(typeof w!="string"&&l.stateNode===null)throw Error(ft(166));if(f=Ud(j_.current),Ud(uu.current),$y(l)){if(w=l.stateNode,f=l.memoizedProps,w[au]=l,(D=w.nodeValue!==f)&&(r=Vs,r!==null))switch(r.tag){case 3:Hy(w.nodeValue,f,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Hy(w.nodeValue,f,(r.mode&1)!==0)}D&&(l.flags|=4)}else w=(f.nodeType===9?f:f.ownerDocument).createTextNode(w),w[au]=l,l.stateNode=w}return fo(l),null;case 13:if(gi(zi),w=l.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Si&&Gs!==null&&(l.mode&1)!==0&&(l.flags&128)===0)lE(),Uf(),l.flags|=98560,D=!1;else if(D=$y(l),w!==null&&w.dehydrated!==null){if(r===null){if(!D)throw Error(ft(318));if(D=l.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(ft(317));D[au]=l}else Uf(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;fo(l),D=!1}else ll!==null&&(lw(ll),ll=null),D=!0;if(!D)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=f,l):(w=w!==null,w!==(r!==null&&r.memoizedState!==null)&&w&&(l.child.flags|=8192,(l.mode&1)!==0&&(r===null||(zi.current&1)!==0?wr===0&&(wr=3):tb())),l.updateQueue!==null&&(l.flags|=4),fo(l),null);case 4:return Gf(),ew(r,l),r===null&&U_(l.stateNode.containerInfo),fo(l),null;case 10:return Ow(l.type._context),fo(l),null;case 17:return fs(l.type)&&w0(),fo(l),null;case 19:if(gi(zi),D=l.memoizedState,D===null)return fo(l),null;if(w=(l.flags&128)!==0,O=D.rendering,O===null)if(w)__(D,!1);else{if(wr!==0||r!==null&&(r.flags&128)!==0)for(r=l.child;r!==null;){if(O=I0(r),O!==null){for(l.flags|=128,__(D,!1),w=O.updateQueue,w!==null&&(l.updateQueue=w,l.flags|=4),l.subtreeFlags=0,w=f,f=l.child;f!==null;)D=f,r=w,D.flags&=14680066,O=D.alternate,O===null?(D.childLanes=0,D.lanes=r,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=O.childLanes,D.lanes=O.lanes,D.child=O.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=O.memoizedProps,D.memoizedState=O.memoizedState,D.updateQueue=O.updateQueue,D.type=O.type,r=O.dependencies,D.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),f=f.sibling;return hi(zi,zi.current&1|2),l.child}r=r.sibling}D.tail!==null&&Wi()>jf&&(l.flags|=128,w=!0,__(D,!1),l.lanes=4194304)}else{if(!w)if(r=I0(O),r!==null){if(l.flags|=128,w=!0,f=r.updateQueue,f!==null&&(l.updateQueue=f,l.flags|=4),__(D,!0),D.tail===null&&D.tailMode==="hidden"&&!O.alternate&&!Si)return fo(l),null}else 2*Wi()-D.renderingStartTime>jf&&f!==1073741824&&(l.flags|=128,w=!0,__(D,!1),l.lanes=4194304);D.isBackwards?(O.sibling=l.child,l.child=O):(f=D.last,f!==null?f.sibling=O:l.child=O,D.last=O)}return D.tail!==null?(l=D.tail,D.rendering=l,D.tail=l.sibling,D.renderingStartTime=Wi(),l.sibling=null,f=zi.current,hi(zi,w?f&1|2:f&1),l):(fo(l),null);case 22:case 23:return eb(),w=l.memoizedState!==null,r!==null&&r.memoizedState!==null!==w&&(l.flags|=8192),w&&(l.mode&1)!==0?(Ns&1073741824)!==0&&(fo(l),l.subtreeFlags&6&&(l.flags|=8192)):fo(l),null;case 24:return null;case 25:return null}throw Error(ft(156,l.tag))}function mS(r,l){switch(Pw(l),l.tag){case 1:return fs(l.type)&&w0(),r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 3:return Gf(),gi(ps),gi(_o),jw(),r=l.flags,(r&65536)!==0&&(r&128)===0?(l.flags=r&-65537|128,l):null;case 5:return Vw(l),null;case 13:if(gi(zi),r=l.memoizedState,r!==null&&r.dehydrated!==null){if(l.alternate===null)throw Error(ft(340));Uf()}return r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 19:return gi(zi),null;case 4:return Gf(),null;case 10:return Ow(l.type._context),null;case 22:case 23:return eb(),null;case 24:return null;default:return null}}var Ky=!1,mo=!1,_S=typeof WeakSet=="function"?WeakSet:Set,Ot=null;function If(r,l){var f=r.ref;if(f!==null)if(typeof f=="function")try{f(null)}catch(w){Ui(r,l,w)}else f.current=null}function tw(r,l,f){try{f()}catch(w){Ui(r,l,w)}}var SA=!1;function gS(r,l){if(O1=g0,r=K2(),kw(r)){if("selectionStart"in r)var f={start:r.selectionStart,end:r.selectionEnd};else e:{f=(f=r.ownerDocument)&&f.defaultView||window;var w=f.getSelection&&f.getSelection();if(w&&w.rangeCount!==0){f=w.anchorNode;var C=w.anchorOffset,D=w.focusNode;w=w.focusOffset;try{f.nodeType,D.nodeType}catch{f=null;break e}var O=0,s=-1,q=-1,be=0,je=0,Pe=r,Le=null;t:for(;;){for(var ct;Pe!==f||C!==0&&Pe.nodeType!==3||(s=O+C),Pe!==D||w!==0&&Pe.nodeType!==3||(q=O+w),Pe.nodeType===3&&(O+=Pe.nodeValue.length),(ct=Pe.firstChild)!==null;)Le=Pe,Pe=ct;for(;;){if(Pe===r)break t;if(Le===f&&++be===C&&(s=O),Le===D&&++je===w&&(q=O),(ct=Pe.nextSibling)!==null)break;Pe=Le,Le=Pe.parentNode}Pe=ct}f=s===-1||q===-1?null:{start:s,end:q}}else f=null}f=f||{start:0,end:0}}else f=null;for(U1={focusedElem:r,selectionRange:f},g0=!1,Ot=l;Ot!==null;)if(l=Ot,r=l.child,(l.subtreeFlags&1028)!==0&&r!==null)r.return=l,Ot=r;else for(;Ot!==null;){l=Ot;try{var ht=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(ht!==null){var yt=ht.memoizedProps,hn=ht.memoizedState,Te=l.stateNode,ge=Te.getSnapshotBeforeUpdate(l.elementType===l.type?yt:sl(l.type,yt),hn);Te.__reactInternalSnapshotBeforeUpdate=ge}break;case 3:var Se=l.stateNode.containerInfo;Se.nodeType===1?Se.textContent="":Se.nodeType===9&&Se.documentElement&&Se.removeChild(Se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ft(163))}}catch(it){Ui(l,l.return,it)}if(r=l.sibling,r!==null){r.return=l.return,Ot=r;break}Ot=l.return}return ht=SA,SA=!1,ht}function I_(r,l,f){var w=l.updateQueue;if(w=w!==null?w.lastEffect:null,w!==null){var C=w=w.next;do{if((C.tag&r)===r){var D=C.destroy;C.destroy=void 0,D!==void 0&&tw(l,f,D)}C=C.next}while(C!==w)}}function q0(r,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var f=l=l.next;do{if((f.tag&r)===r){var w=f.create;f.destroy=w()}f=f.next}while(f!==l)}}function nw(r){var l=r.ref;if(l!==null){var f=r.stateNode;switch(r.tag){case 5:r=f;break;default:r=f}typeof l=="function"?l(r):l.current=r}}function $E(r){var l=r.alternate;l!==null&&(r.alternate=null,$E(l)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(l=r.stateNode,l!==null&&(delete l[au],delete l[G_],delete l[V1],delete l[QT],delete l[eS])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function ZE(r){return r.tag===5||r.tag===3||r.tag===4}function IA(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ZE(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function iw(r,l,f){var w=r.tag;if(w===5||w===6)r=r.stateNode,l?f.nodeType===8?f.parentNode.insertBefore(r,l):f.insertBefore(r,l):(f.nodeType===8?(l=f.parentNode,l.insertBefore(r,f)):(l=f,l.appendChild(r)),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=x0));else if(w!==4&&(r=r.child,r!==null))for(iw(r,l,f),r=r.sibling;r!==null;)iw(r,l,f),r=r.sibling}function rw(r,l,f){var w=r.tag;if(w===5||w===6)r=r.stateNode,l?f.insertBefore(r,l):f.appendChild(r);else if(w!==4&&(r=r.child,r!==null))for(rw(r,l,f),r=r.sibling;r!==null;)rw(r,l,f),r=r.sibling}var Vr=null,al=!1;function uh(r,l,f){for(f=f.child;f!==null;)WE(r,l,f),f=f.sibling}function WE(r,l,f){if(lu&&typeof lu.onCommitFiberUnmount=="function")try{lu.onCommitFiberUnmount(F0,f)}catch{}switch(f.tag){case 5:mo||If(f,l);case 6:var w=Vr,C=al;Vr=null,uh(r,l,f),Vr=w,al=C,Vr!==null&&(al?(r=Vr,f=f.stateNode,r.nodeType===8?r.parentNode.removeChild(f):r.removeChild(f)):Vr.removeChild(f.stateNode));break;case 18:Vr!==null&&(al?(r=Vr,f=f.stateNode,r.nodeType===8?i1(r.parentNode,f):r.nodeType===1&&i1(r,f),F_(r)):i1(Vr,f.stateNode));break;case 4:w=Vr,C=al,Vr=f.stateNode.containerInfo,al=!0,uh(r,l,f),Vr=w,al=C;break;case 0:case 11:case 14:case 15:if(!mo&&(w=f.updateQueue,w!==null&&(w=w.lastEffect,w!==null))){C=w=w.next;do{var D=C,O=D.destroy;D=D.tag,O!==void 0&&((D&2)!==0||(D&4)!==0)&&tw(f,l,O),C=C.next}while(C!==w)}uh(r,l,f);break;case 1:if(!mo&&(If(f,l),w=f.stateNode,typeof w.componentWillUnmount=="function"))try{w.props=f.memoizedProps,w.state=f.memoizedState,w.componentWillUnmount()}catch(s){Ui(f,l,s)}uh(r,l,f);break;case 21:uh(r,l,f);break;case 22:f.mode&1?(mo=(w=mo)||f.memoizedState!==null,uh(r,l,f),mo=w):uh(r,l,f);break;default:uh(r,l,f)}}function MA(r){var l=r.updateQueue;if(l!==null){r.updateQueue=null;var f=r.stateNode;f===null&&(f=r.stateNode=new _S),l.forEach(function(w){var C=TS.bind(null,r,w);f.has(w)||(f.add(w),w.then(C,C))})}}function ol(r,l){var f=l.deletions;if(f!==null)for(var w=0;w<f.length;w++){var C=f[w];try{var D=r,O=l,s=O;e:for(;s!==null;){switch(s.tag){case 5:Vr=s.stateNode,al=!1;break e;case 3:Vr=s.stateNode.containerInfo,al=!0;break e;case 4:Vr=s.stateNode.containerInfo,al=!0;break e}s=s.return}if(Vr===null)throw Error(ft(160));WE(D,O,C),Vr=null,al=!1;var q=C.alternate;q!==null&&(q.return=null),C.return=null}catch(be){Ui(C,l,be)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)KE(l,r),l=l.sibling}function KE(r,l){var f=r.alternate,w=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(ol(l,r),ou(r),w&4){try{I_(3,r,r.return),q0(3,r)}catch(yt){Ui(r,r.return,yt)}try{I_(5,r,r.return)}catch(yt){Ui(r,r.return,yt)}}break;case 1:ol(l,r),ou(r),w&512&&f!==null&&If(f,f.return);break;case 5:if(ol(l,r),ou(r),w&512&&f!==null&&If(f,f.return),r.flags&32){var C=r.stateNode;try{k_(C,"")}catch(yt){Ui(r,r.return,yt)}}if(w&4&&(C=r.stateNode,C!=null)){var D=r.memoizedProps,O=f!==null?f.memoizedProps:D,s=r.type,q=r.updateQueue;if(r.updateQueue=null,q!==null)try{s==="input"&&D.type==="radio"&&D.name!=null&&_2(C,D),I1(s,O);var be=I1(s,D);for(O=0;O<q.length;O+=2){var je=q[O],Pe=q[O+1];je==="style"?w2(C,Pe):je==="dangerouslySetInnerHTML"?v2(C,Pe):je==="children"?k_(C,Pe):vw(C,je,Pe,be)}switch(s){case"input":A1(C,D);break;case"textarea":g2(C,D);break;case"select":var Le=C._wrapperState.wasMultiple;C._wrapperState.wasMultiple=!!D.multiple;var ct=D.value;ct!=null?Bf(C,!!D.multiple,ct,!1):Le!==!!D.multiple&&(D.defaultValue!=null?Bf(C,!!D.multiple,D.defaultValue,!0):Bf(C,!!D.multiple,D.multiple?[]:"",!1))}C[G_]=D}catch(yt){Ui(r,r.return,yt)}}break;case 6:if(ol(l,r),ou(r),w&4){if(r.stateNode===null)throw Error(ft(162));C=r.stateNode,D=r.memoizedProps;try{C.nodeValue=D}catch(yt){Ui(r,r.return,yt)}}break;case 3:if(ol(l,r),ou(r),w&4&&f!==null&&f.memoizedState.isDehydrated)try{F_(l.containerInfo)}catch(yt){Ui(r,r.return,yt)}break;case 4:ol(l,r),ou(r);break;case 13:ol(l,r),ou(r),C=r.child,C.flags&8192&&(D=C.memoizedState!==null,C.stateNode.isHidden=D,!D||C.alternate!==null&&C.alternate.memoizedState!==null||(Yw=Wi())),w&4&&MA(r);break;case 22:if(je=f!==null&&f.memoizedState!==null,r.mode&1?(mo=(be=mo)||je,ol(l,r),mo=be):ol(l,r),ou(r),w&8192){if(be=r.memoizedState!==null,(r.stateNode.isHidden=be)&&!je&&(r.mode&1)!==0)for(Ot=r,je=r.child;je!==null;){for(Pe=Ot=je;Ot!==null;){switch(Le=Ot,ct=Le.child,Le.tag){case 0:case 11:case 14:case 15:I_(4,Le,Le.return);break;case 1:If(Le,Le.return);var ht=Le.stateNode;if(typeof ht.componentWillUnmount=="function"){w=Le,f=Le.return;try{l=w,ht.props=l.memoizedProps,ht.state=l.memoizedState,ht.componentWillUnmount()}catch(yt){Ui(w,f,yt)}}break;case 5:If(Le,Le.return);break;case 22:if(Le.memoizedState!==null){DA(Pe);continue}}ct!==null?(ct.return=Le,Ot=ct):DA(Pe)}je=je.sibling}e:for(je=null,Pe=r;;){if(Pe.tag===5){if(je===null){je=Pe;try{C=Pe.stateNode,be?(D=C.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none"):(s=Pe.stateNode,q=Pe.memoizedProps.style,O=q!=null&&q.hasOwnProperty("display")?q.display:null,s.style.display=x2("display",O))}catch(yt){Ui(r,r.return,yt)}}}else if(Pe.tag===6){if(je===null)try{Pe.stateNode.nodeValue=be?"":Pe.memoizedProps}catch(yt){Ui(r,r.return,yt)}}else if((Pe.tag!==22&&Pe.tag!==23||Pe.memoizedState===null||Pe===r)&&Pe.child!==null){Pe.child.return=Pe,Pe=Pe.child;continue}if(Pe===r)break e;for(;Pe.sibling===null;){if(Pe.return===null||Pe.return===r)break e;je===Pe&&(je=null),Pe=Pe.return}je===Pe&&(je=null),Pe.sibling.return=Pe.return,Pe=Pe.sibling}}break;case 19:ol(l,r),ou(r),w&4&&MA(r);break;case 21:break;default:ol(l,r),ou(r)}}function ou(r){var l=r.flags;if(l&2){try{e:{for(var f=r.return;f!==null;){if(ZE(f)){var w=f;break e}f=f.return}throw Error(ft(160))}switch(w.tag){case 5:var C=w.stateNode;w.flags&32&&(k_(C,""),w.flags&=-33);var D=IA(r);rw(r,D,C);break;case 3:case 4:var O=w.stateNode.containerInfo,s=IA(r);iw(r,s,O);break;default:throw Error(ft(161))}}catch(q){Ui(r,r.return,q)}r.flags&=-3}l&4096&&(r.flags&=-4097)}function yS(r,l,f){Ot=r,XE(r)}function XE(r,l,f){for(var w=(r.mode&1)!==0;Ot!==null;){var C=Ot,D=C.child;if(C.tag===22&&w){var O=C.memoizedState!==null||Ky;if(!O){var s=C.alternate,q=s!==null&&s.memoizedState!==null||mo;s=Ky;var be=mo;if(Ky=O,(mo=q)&&!be)for(Ot=C;Ot!==null;)O=Ot,q=O.child,O.tag===22&&O.memoizedState!==null?kA(C):q!==null?(q.return=O,Ot=q):kA(C);for(;D!==null;)Ot=D,XE(D),D=D.sibling;Ot=C,Ky=s,mo=be}BA(r)}else(C.subtreeFlags&8772)!==0&&D!==null?(D.return=C,Ot=D):BA(r)}}function BA(r){for(;Ot!==null;){var l=Ot;if((l.flags&8772)!==0){var f=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:mo||q0(5,l);break;case 1:var w=l.stateNode;if(l.flags&4&&!mo)if(f===null)w.componentDidMount();else{var C=l.elementType===l.type?f.memoizedProps:sl(l.type,f.memoizedProps);w.componentDidUpdate(C,f.memoizedState,w.__reactInternalSnapshotBeforeUpdate)}var D=l.updateQueue;D!==null&&pA(l,D,w);break;case 3:var O=l.updateQueue;if(O!==null){if(f=null,l.child!==null)switch(l.child.tag){case 5:f=l.child.stateNode;break;case 1:f=l.child.stateNode}pA(l,O,f)}break;case 5:var s=l.stateNode;if(f===null&&l.flags&4){f=s;var q=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":q.autoFocus&&f.focus();break;case"img":q.src&&(f.src=q.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var be=l.alternate;if(be!==null){var je=be.memoizedState;if(je!==null){var Pe=je.dehydrated;Pe!==null&&F_(Pe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ft(163))}mo||l.flags&512&&nw(l)}catch(Le){Ui(l,l.return,Le)}}if(l===r){Ot=null;break}if(f=l.sibling,f!==null){f.return=l.return,Ot=f;break}Ot=l.return}}function DA(r){for(;Ot!==null;){var l=Ot;if(l===r){Ot=null;break}var f=l.sibling;if(f!==null){f.return=l.return,Ot=f;break}Ot=l.return}}function kA(r){for(;Ot!==null;){var l=Ot;try{switch(l.tag){case 0:case 11:case 15:var f=l.return;try{q0(4,l)}catch(q){Ui(l,f,q)}break;case 1:var w=l.stateNode;if(typeof w.componentDidMount=="function"){var C=l.return;try{w.componentDidMount()}catch(q){Ui(l,C,q)}}var D=l.return;try{nw(l)}catch(q){Ui(l,D,q)}break;case 5:var O=l.return;try{nw(l)}catch(q){Ui(l,O,q)}}}catch(q){Ui(l,l.return,q)}if(l===r){Ot=null;break}var s=l.sibling;if(s!==null){s.return=l.return,Ot=s;break}Ot=l.return}}var vS=Math.ceil,D0=nc.ReactCurrentDispatcher,Xw=nc.ReactCurrentOwner,Ia=nc.ReactCurrentBatchConfig,Zn=0,zr=null,ir=null,jr=0,Ns=0,Mf=Sh(0),wr=0,Z_=null,Hd=0,H0=0,Jw=0,M_=null,hs=null,Yw=0,jf=1/0,Zu=null,k0=!1,ow=null,wh=null,Xy=!1,mh=null,z0=0,B_=0,sw=null,u0=-1,c0=0;function Lo(){return(Zn&6)!==0?Wi():u0!==-1?u0:u0=Wi()}function bh(r){return(r.mode&1)===0?1:(Zn&2)!==0&&jr!==0?jr&-jr:nS.transition!==null?(c0===0&&(c0=z2()),c0):(r=ri,r!==0||(r=window.event,r=r===void 0?16:N2(r.type)),r)}function cl(r,l,f,w){if(50<B_)throw B_=0,sw=null,Error(ft(185));K_(r,f,w),((Zn&2)===0||r!==zr)&&(r===zr&&((Zn&2)===0&&(H0|=f),wr===4&&ph(r,jr)),ms(r,w),f===1&&Zn===0&&(l.mode&1)===0&&(jf=Wi()+500,G0&&Ih()))}function ms(r,l){var f=r.callbackNode;nT(r,l);var w=_0(r,r===zr?jr:0);if(w===0)f!==null&&Gb(f),r.callbackNode=null,r.callbackPriority=0;else if(l=w&-w,r.callbackPriority!==l){if(f!=null&&Gb(f),l===1)r.tag===0?tS(zA.bind(null,r)):oE(zA.bind(null,r)),JT(function(){(Zn&6)===0&&Ih()}),f=null;else{switch(P2(w)){case 1:f=Ew;break;case 4:f=D2;break;case 16:f=m0;break;case 536870912:f=k2;break;default:f=m0}f=rC(f,JE.bind(null,r))}r.callbackPriority=l,r.callbackNode=f}}function JE(r,l){if(u0=-1,c0=0,(Zn&6)!==0)throw Error(ft(327));var f=r.callbackNode;if(Lf()&&r.callbackNode!==f)return null;var w=_0(r,r===zr?jr:0);if(w===0)return null;if((w&30)!==0||(w&r.expiredLanes)!==0||l)l=P0(r,w);else{l=w;var C=Zn;Zn|=2;var D=QE();(zr!==r||jr!==l)&&(Zu=null,jf=Wi()+500,Nd(r,l));do try{bS();break}catch(s){YE(r,s)}while(1);Rw(),D0.current=D,Zn=C,ir!==null?l=0:(zr=null,jr=0,l=wr)}if(l!==0){if(l===2&&(C=z1(r),C!==0&&(w=C,l=aw(r,C))),l===1)throw f=Z_,Nd(r,0),ph(r,w),ms(r,Wi()),f;if(l===6)ph(r,w);else{if(C=r.current.alternate,(w&30)===0&&!xS(C)&&(l=P0(r,w),l===2&&(D=z1(r),D!==0&&(w=D,l=aw(r,D))),l===1))throw f=Z_,Nd(r,0),ph(r,w),ms(r,Wi()),f;switch(r.finishedWork=C,r.finishedLanes=w,l){case 0:case 1:throw Error(ft(345));case 2:Fd(r,hs,Zu);break;case 3:if(ph(r,w),(w&130023424)===w&&(l=Yw+500-Wi(),10<l)){if(_0(r,0)!==0)break;if(C=r.suspendedLanes,(C&w)!==w){Lo(),r.pingedLanes|=r.suspendedLanes&C;break}r.timeoutHandle=G1(Fd.bind(null,r,hs,Zu),l);break}Fd(r,hs,Zu);break;case 4:if(ph(r,w),(w&4194240)===w)break;for(l=r.eventTimes,C=-1;0<w;){var O=31-ul(w);D=1<<O,O=l[O],O>C&&(C=O),w&=~D}if(w=C,w=Wi()-w,w=(120>w?120:480>w?480:1080>w?1080:1920>w?1920:3e3>w?3e3:4320>w?4320:1960*vS(w/1960))-w,10<w){r.timeoutHandle=G1(Fd.bind(null,r,hs,Zu),w);break}Fd(r,hs,Zu);break;case 5:Fd(r,hs,Zu);break;default:throw Error(ft(329))}}}return ms(r,Wi()),r.callbackNode===f?JE.bind(null,r):null}function aw(r,l){var f=M_;return r.current.memoizedState.isDehydrated&&(Nd(r,l).flags|=256),r=P0(r,l),r!==2&&(l=hs,hs=f,l!==null&&lw(l)),r}function lw(r){hs===null?hs=r:hs.push.apply(hs,r)}function xS(r){for(var l=r;;){if(l.flags&16384){var f=l.updateQueue;if(f!==null&&(f=f.stores,f!==null))for(var w=0;w<f.length;w++){var C=f[w],D=C.getSnapshot;C=C.value;try{if(!hl(D(),C))return!1}catch{return!1}}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function ph(r,l){for(l&=~Jw,l&=~H0,r.suspendedLanes|=l,r.pingedLanes&=~l,r=r.expirationTimes;0<l;){var f=31-ul(l),w=1<<f;r[f]=-1,l&=~w}}function zA(r){if((Zn&6)!==0)throw Error(ft(327));Lf();var l=_0(r,0);if((l&1)===0)return ms(r,Wi()),null;var f=P0(r,l);if(r.tag!==0&&f===2){var w=z1(r);w!==0&&(l=w,f=aw(r,w))}if(f===1)throw f=Z_,Nd(r,0),ph(r,l),ms(r,Wi()),f;if(f===6)throw Error(ft(345));return r.finishedWork=r.current.alternate,r.finishedLanes=l,Fd(r,hs,Zu),ms(r,Wi()),null}function Qw(r,l){var f=Zn;Zn|=1;try{return r(l)}finally{Zn=f,Zn===0&&(jf=Wi()+500,G0&&Ih())}}function $d(r){mh!==null&&mh.tag===0&&(Zn&6)===0&&Lf();var l=Zn;Zn|=1;var f=Ia.transition,w=ri;try{if(Ia.transition=null,ri=1,r)return r()}finally{ri=w,Ia.transition=f,Zn=l,(Zn&6)===0&&Ih()}}function eb(){Ns=Mf.current,gi(Mf)}function Nd(r,l){r.finishedWork=null,r.finishedLanes=0;var f=r.timeoutHandle;if(f!==-1&&(r.timeoutHandle=-1,XT(f)),ir!==null)for(f=ir.return;f!==null;){var w=f;switch(Pw(w),w.tag){case 1:w=w.type.childContextTypes,w!=null&&w0();break;case 3:Gf(),gi(ps),gi(_o),jw();break;case 5:Vw(w);break;case 4:Gf();break;case 13:gi(zi);break;case 19:gi(zi);break;case 10:Ow(w.type._context);break;case 22:case 23:eb()}f=f.return}if(zr=r,ir=r=Ah(r.current,null),jr=Ns=l,wr=0,Z_=null,Jw=H0=Hd=0,hs=M_=null,Od!==null){for(l=0;l<Od.length;l++)if(f=Od[l],w=f.interleaved,w!==null){f.interleaved=null;var C=w.next,D=f.pending;if(D!==null){var O=D.next;D.next=C,w.next=O}f.pending=w}Od=null}return r}function YE(r,l){do{var f=ir;try{if(Rw(),s0.current=B0,M0){for(var w=Pi.memoizedState;w!==null;){var C=w.queue;C!==null&&(C.pending=null),w=w.next}M0=!1}if(qd=0,kr=xr=Pi=null,S_=!1,q_=0,Xw.current=null,f===null||f.return===null){wr=1,Z_=l,ir=null;break}e:{var D=r,O=f.return,s=f,q=l;if(l=jr,s.flags|=32768,q!==null&&typeof q=="object"&&typeof q.then=="function"){var be=q,je=s,Pe=je.tag;if((je.mode&1)===0&&(Pe===0||Pe===11||Pe===15)){var Le=je.alternate;Le?(je.updateQueue=Le.updateQueue,je.memoizedState=Le.memoizedState,je.lanes=Le.lanes):(je.updateQueue=null,je.memoizedState=null)}var ct=xA(O);if(ct!==null){ct.flags&=-257,wA(ct,O,s,D,l),ct.mode&1&&vA(D,be,l),l=ct,q=be;var ht=l.updateQueue;if(ht===null){var yt=new Set;yt.add(q),l.updateQueue=yt}else ht.add(q);break e}else{if((l&1)===0){vA(D,be,l),tb();break e}q=Error(ft(426))}}else if(Si&&s.mode&1){var hn=xA(O);if(hn!==null){(hn.flags&65536)===0&&(hn.flags|=256),wA(hn,O,s,D,l),Lw(Vf(q,s));break e}}D=q=Vf(q,s),wr!==4&&(wr=2),M_===null?M_=[D]:M_.push(D),D=O;do{switch(D.tag){case 3:D.flags|=65536,l&=-l,D.lanes|=l;var Te=LE(D,q,l);dA(D,Te);break e;case 1:s=q;var ge=D.type,Se=D.stateNode;if((D.flags&128)===0&&(typeof ge.getDerivedStateFromError=="function"||Se!==null&&typeof Se.componentDidCatch=="function"&&(wh===null||!wh.has(Se)))){D.flags|=65536,l&=-l,D.lanes|=l;var it=FE(D,s,l);dA(D,it);break e}}D=D.return}while(D!==null)}tC(f)}catch(ke){l=ke,ir===f&&f!==null&&(ir=f=f.return);continue}break}while(1)}function QE(){var r=D0.current;return D0.current=B0,r===null?B0:r}function tb(){(wr===0||wr===3||wr===2)&&(wr=4),zr===null||(Hd&268435455)===0&&(H0&268435455)===0||ph(zr,jr)}function P0(r,l){var f=Zn;Zn|=2;var w=QE();(zr!==r||jr!==l)&&(Zu=null,Nd(r,l));do try{wS();break}catch(C){YE(r,C)}while(1);if(Rw(),Zn=f,D0.current=w,ir!==null)throw Error(ft(261));return zr=null,jr=0,wr}function wS(){for(;ir!==null;)eC(ir)}function bS(){for(;ir!==null&&!ZC();)eC(ir)}function eC(r){var l=iC(r.alternate,r,Ns);r.memoizedProps=r.pendingProps,l===null?tC(r):ir=l,Xw.current=null}function tC(r){var l=r;do{var f=l.alternate;if(r=l.return,(l.flags&32768)===0){if(f=fS(f,l,Ns),f!==null){ir=f;return}}else{if(f=mS(f,l),f!==null){f.flags&=32767,ir=f;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{wr=6,ir=null;return}}if(l=l.sibling,l!==null){ir=l;return}ir=l=r}while(l!==null);wr===0&&(wr=5)}function Fd(r,l,f){var w=ri,C=Ia.transition;try{Ia.transition=null,ri=1,AS(r,l,f,w)}finally{Ia.transition=C,ri=w}return null}function AS(r,l,f,w){do Lf();while(mh!==null);if((Zn&6)!==0)throw Error(ft(327));f=r.finishedWork;var C=r.finishedLanes;if(f===null)return null;if(r.finishedWork=null,r.finishedLanes=0,f===r.current)throw Error(ft(177));r.callbackNode=null,r.callbackPriority=0;var D=f.lanes|f.childLanes;if(iT(r,D),r===zr&&(ir=zr=null,jr=0),(f.subtreeFlags&2064)===0&&(f.flags&2064)===0||Xy||(Xy=!0,rC(m0,function(){return Lf(),null})),D=(f.flags&15990)!==0,(f.subtreeFlags&15990)!==0||D){D=Ia.transition,Ia.transition=null;var O=ri;ri=1;var s=Zn;Zn|=4,Xw.current=null,gS(r,f),KE(f,r),jT(U1),g0=!!O1,U1=O1=null,r.current=f,yS(f),WC(),Zn=s,ri=O,Ia.transition=D}else r.current=f;if(Xy&&(Xy=!1,mh=r,z0=C),D=r.pendingLanes,D===0&&(wh=null),JC(f.stateNode),ms(r,Wi()),l!==null)for(w=r.onRecoverableError,f=0;f<l.length;f++)C=l[f],w(C.value,{componentStack:C.stack,digest:C.digest});if(k0)throw k0=!1,r=ow,ow=null,r;return(z0&1)!==0&&r.tag!==0&&Lf(),D=r.pendingLanes,(D&1)!==0?r===sw?B_++:(B_=0,sw=r):B_=0,Ih(),null}function Lf(){if(mh!==null){var r=P2(z0),l=Ia.transition,f=ri;try{if(Ia.transition=null,ri=16>r?16:r,mh===null)var w=!1;else{if(r=mh,mh=null,z0=0,(Zn&6)!==0)throw Error(ft(331));var C=Zn;for(Zn|=4,Ot=r.current;Ot!==null;){var D=Ot,O=D.child;if((Ot.flags&16)!==0){var s=D.deletions;if(s!==null){for(var q=0;q<s.length;q++){var be=s[q];for(Ot=be;Ot!==null;){var je=Ot;switch(je.tag){case 0:case 11:case 15:I_(8,je,D)}var Pe=je.child;if(Pe!==null)Pe.return=je,Ot=Pe;else for(;Ot!==null;){je=Ot;var Le=je.sibling,ct=je.return;if($E(je),je===be){Ot=null;break}if(Le!==null){Le.return=ct,Ot=Le;break}Ot=ct}}}var ht=D.alternate;if(ht!==null){var yt=ht.child;if(yt!==null){ht.child=null;do{var hn=yt.sibling;yt.sibling=null,yt=hn}while(yt!==null)}}Ot=D}}if((D.subtreeFlags&2064)!==0&&O!==null)O.return=D,Ot=O;else e:for(;Ot!==null;){if(D=Ot,(D.flags&2048)!==0)switch(D.tag){case 0:case 11:case 15:I_(9,D,D.return)}var Te=D.sibling;if(Te!==null){Te.return=D.return,Ot=Te;break e}Ot=D.return}}var ge=r.current;for(Ot=ge;Ot!==null;){O=Ot;var Se=O.child;if((O.subtreeFlags&2064)!==0&&Se!==null)Se.return=O,Ot=Se;else e:for(O=ge;Ot!==null;){if(s=Ot,(s.flags&2048)!==0)try{switch(s.tag){case 0:case 11:case 15:q0(9,s)}}catch(ke){Ui(s,s.return,ke)}if(s===O){Ot=null;break e}var it=s.sibling;if(it!==null){it.return=s.return,Ot=it;break e}Ot=s.return}}if(Zn=C,Ih(),lu&&typeof lu.onPostCommitFiberRoot=="function")try{lu.onPostCommitFiberRoot(F0,r)}catch{}w=!0}return w}finally{ri=f,Ia.transition=l}}return!1}function PA(r,l,f){l=Vf(f,l),l=LE(r,l,1),r=xh(r,l,1),l=Lo(),r!==null&&(K_(r,1,l),ms(r,l))}function Ui(r,l,f){if(r.tag===3)PA(r,r,f);else for(;l!==null;){if(l.tag===3){PA(l,r,f);break}else if(l.tag===1){var w=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(wh===null||!wh.has(w))){r=Vf(f,r),r=FE(l,r,1),l=xh(l,r,1),r=Lo(),l!==null&&(K_(l,1,r),ms(l,r));break}}l=l.return}}function ES(r,l,f){var w=r.pingCache;w!==null&&w.delete(l),l=Lo(),r.pingedLanes|=r.suspendedLanes&f,zr===r&&(jr&f)===f&&(wr===4||wr===3&&(jr&130023424)===jr&&500>Wi()-Yw?Nd(r,0):Jw|=f),ms(r,l)}function nC(r,l){l===0&&((r.mode&1)===0?l=1:(l=Ny,Ny<<=1,(Ny&130023424)===0&&(Ny=4194304)));var f=Lo();r=ec(r,l),r!==null&&(K_(r,l,f),ms(r,f))}function CS(r){var l=r.memoizedState,f=0;l!==null&&(f=l.retryLane),nC(r,f)}function TS(r,l){var f=0;switch(r.tag){case 13:var w=r.stateNode,C=r.memoizedState;C!==null&&(f=C.retryLane);break;case 19:w=r.stateNode;break;default:throw Error(ft(314))}w!==null&&w.delete(l),nC(r,f)}var iC;iC=function(r,l,f){if(r!==null)if(r.memoizedProps!==l.pendingProps||ps.current)ds=!0;else{if((r.lanes&f)===0&&(l.flags&128)===0)return ds=!1,pS(r,l,f);ds=(r.flags&131072)!==0}else ds=!1,Si&&(l.flags&1048576)!==0&&sE(l,E0,l.index);switch(l.lanes=0,l.tag){case 2:var w=l.type;l0(r,l),r=l.pendingProps;var C=Of(l,_o.current);Pf(l,f),C=Hw(null,l,w,r,C,f);var D=$w();return l.flags|=1,typeof C=="object"&&C!==null&&typeof C.render=="function"&&C.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,fs(w)?(D=!0,b0(l)):D=!1,l.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,Nw(l),C.updater=V0,l.stateNode=C,C._reactInternals=l,W1(l,w,r,f),l=J1(null,l,w,!0,D,f)):(l.tag=0,Si&&D&&zw(l),Po(null,l,C,f),l=l.child),l;case 16:w=l.elementType;e:{switch(l0(r,l),r=l.pendingProps,C=w._init,w=C(w._payload),l.type=w,C=l.tag=IS(w),r=sl(w,r),C){case 0:l=X1(null,l,w,r,f);break e;case 1:l=EA(null,l,w,r,f);break e;case 11:l=bA(null,l,w,r,f);break e;case 14:l=AA(null,l,w,sl(w.type,r),f);break e}throw Error(ft(306,w,""))}return l;case 0:return w=l.type,C=l.pendingProps,C=l.elementType===w?C:sl(w,C),X1(r,l,w,C,f);case 1:return w=l.type,C=l.pendingProps,C=l.elementType===w?C:sl(w,C),EA(r,l,w,C,f);case 3:e:{if(NE(l),r===null)throw Error(ft(387));w=l.pendingProps,D=l.memoizedState,C=D.element,cE(r,l),S0(l,w,null,f);var O=l.memoizedState;if(w=O.element,D.isDehydrated)if(D={element:w,isDehydrated:!1,cache:O.cache,pendingSuspenseBoundaries:O.pendingSuspenseBoundaries,transitions:O.transitions},l.updateQueue.baseState=D,l.memoizedState=D,l.flags&256){C=Vf(Error(ft(423)),l),l=CA(r,l,w,f,C);break e}else if(w!==C){C=Vf(Error(ft(424)),l),l=CA(r,l,w,f,C);break e}else for(Gs=vh(l.stateNode.containerInfo.firstChild),Vs=l,Si=!0,ll=null,f=fE(l,null,w,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(Uf(),w===C){l=tc(r,l,f);break e}Po(r,l,w,f)}l=l.child}return l;case 5:return mE(l),r===null&&H1(l),w=l.type,C=l.pendingProps,D=r!==null?r.memoizedProps:null,O=C.children,N1(w,C)?O=null:D!==null&&N1(w,D)&&(l.flags|=32),UE(r,l),Po(r,l,O,f),l.child;case 6:return r===null&&H1(l),null;case 13:return GE(r,l,f);case 4:return Gw(l,l.stateNode.containerInfo),w=l.pendingProps,r===null?l.child=Nf(l,null,w,f):Po(r,l,w,f),l.child;case 11:return w=l.type,C=l.pendingProps,C=l.elementType===w?C:sl(w,C),bA(r,l,w,C,f);case 7:return Po(r,l,l.pendingProps,f),l.child;case 8:return Po(r,l,l.pendingProps.children,f),l.child;case 12:return Po(r,l,l.pendingProps.children,f),l.child;case 10:e:{if(w=l.type._context,C=l.pendingProps,D=l.memoizedProps,O=C.value,hi(C0,w._currentValue),w._currentValue=O,D!==null)if(hl(D.value,O)){if(D.children===C.children&&!ps.current){l=tc(r,l,f);break e}}else for(D=l.child,D!==null&&(D.return=l);D!==null;){var s=D.dependencies;if(s!==null){O=D.child;for(var q=s.firstContext;q!==null;){if(q.context===w){if(D.tag===1){q=Ju(-1,f&-f),q.tag=2;var be=D.updateQueue;if(be!==null){be=be.shared;var je=be.pending;je===null?q.next=q:(q.next=je.next,je.next=q),be.pending=q}}D.lanes|=f,q=D.alternate,q!==null&&(q.lanes|=f),$1(D.return,f,l),s.lanes|=f;break}q=q.next}}else if(D.tag===10)O=D.type===l.type?null:D.child;else if(D.tag===18){if(O=D.return,O===null)throw Error(ft(341));O.lanes|=f,s=O.alternate,s!==null&&(s.lanes|=f),$1(O,f,l),O=D.sibling}else O=D.child;if(O!==null)O.return=D;else for(O=D;O!==null;){if(O===l){O=null;break}if(D=O.sibling,D!==null){D.return=O.return,O=D;break}O=O.return}D=O}Po(r,l,C.children,f),l=l.child}return l;case 9:return C=l.type,w=l.pendingProps.children,Pf(l,f),C=Ma(C),w=w(C),l.flags|=1,Po(r,l,w,f),l.child;case 14:return w=l.type,C=sl(w,l.pendingProps),C=sl(w.type,C),AA(r,l,w,C,f);case 15:return RE(r,l,l.type,l.pendingProps,f);case 17:return w=l.type,C=l.pendingProps,C=l.elementType===w?C:sl(w,C),l0(r,l),l.tag=1,fs(w)?(r=!0,b0(l)):r=!1,Pf(l,f),dE(l,w,C),W1(l,w,C,f),J1(null,l,w,!0,r,f);case 19:return VE(r,l,f);case 22:return OE(r,l,f)}throw Error(ft(156,l.tag))};function rC(r,l){return B2(r,l)}function SS(r,l,f,w){this.tag=r,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sa(r,l,f,w){return new SS(r,l,f,w)}function nb(r){return r=r.prototype,!(!r||!r.isReactComponent)}function IS(r){if(typeof r=="function")return nb(r)?1:0;if(r!=null){if(r=r.$$typeof,r===ww)return 11;if(r===bw)return 14}return 2}function Ah(r,l){var f=r.alternate;return f===null?(f=Sa(r.tag,l,r.key,r.mode),f.elementType=r.elementType,f.type=r.type,f.stateNode=r.stateNode,f.alternate=r,r.alternate=f):(f.pendingProps=l,f.type=r.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=r.flags&14680064,f.childLanes=r.childLanes,f.lanes=r.lanes,f.child=r.child,f.memoizedProps=r.memoizedProps,f.memoizedState=r.memoizedState,f.updateQueue=r.updateQueue,l=r.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=r.sibling,f.index=r.index,f.ref=r.ref,f}function h0(r,l,f,w,C,D){var O=2;if(w=r,typeof r=="function")nb(r)&&(O=1);else if(typeof r=="string")O=5;else e:switch(r){case vf:return Gd(f.children,C,D,l);case xw:O=8,C|=8;break;case y1:return r=Sa(12,f,l,C|2),r.elementType=y1,r.lanes=D,r;case v1:return r=Sa(13,f,l,C),r.elementType=v1,r.lanes=D,r;case x1:return r=Sa(19,f,l,C),r.elementType=x1,r.lanes=D,r;case p2:return $0(f,C,D,l);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case h2:O=10;break e;case d2:O=9;break e;case ww:O=11;break e;case bw:O=14;break e;case ch:O=16,w=null;break e}throw Error(ft(130,r==null?r:typeof r,""))}return l=Sa(O,f,l,C),l.elementType=r,l.type=w,l.lanes=D,l}function Gd(r,l,f,w){return r=Sa(7,r,w,l),r.lanes=f,r}function $0(r,l,f,w){return r=Sa(22,r,w,l),r.elementType=p2,r.lanes=f,r.stateNode={isHidden:!1},r}function h1(r,l,f){return r=Sa(6,r,null,l),r.lanes=f,r}function d1(r,l,f){return l=Sa(4,r.children!==null?r.children:[],r.key,l),l.lanes=f,l.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},l}function MS(r,l,f,w,C){this.tag=l,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$x(0),this.expirationTimes=$x(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$x(0),this.identifierPrefix=w,this.onRecoverableError=C,this.mutableSourceEagerHydrationData=null}function ib(r,l,f,w,C,D,O,s,q){return r=new MS(r,l,f,s,q),l===1?(l=1,D===!0&&(l|=8)):l=0,D=Sa(3,null,null,l),r.current=D,D.stateNode=r,D.memoizedState={element:w,isDehydrated:f,cache:null,transitions:null,pendingSuspenseBoundaries:null},Nw(D),r}function BS(r,l,f){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yf,key:w==null?null:""+w,children:r,containerInfo:l,implementation:f}}function oC(r){if(!r)return Ch;r=r._reactInternals;e:{if(Wd(r)!==r||r.tag!==1)throw Error(ft(170));var l=r;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(fs(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(ft(171))}if(r.tag===1){var f=r.type;if(fs(f))return rE(r,f,l)}return l}function sC(r,l,f,w,C,D,O,s,q){return r=ib(f,w,!0,r,C,D,O,s,q),r.context=oC(null),f=r.current,w=Lo(),C=bh(f),D=Ju(w,C),D.callback=l!=null?l:null,xh(f,D,C),r.current.lanes=C,K_(r,C,w),ms(r,w),r}function Z0(r,l,f,w){var C=l.current,D=Lo(),O=bh(C);return f=oC(f),l.context===null?l.context=f:l.pendingContext=f,l=Ju(D,O),l.payload={element:r},w=w===void 0?null:w,w!==null&&(l.callback=w),r=xh(C,l,O),r!==null&&(cl(r,C,O,D),o0(r,C,O)),O}function L0(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function LA(r,l){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var f=r.retryLane;r.retryLane=f!==0&&f<l?f:l}}function rb(r,l){LA(r,l),(r=r.alternate)&&LA(r,l)}function DS(){return null}var aC=typeof reportError=="function"?reportError:function(r){console.error(r)};function ob(r){this._internalRoot=r}W0.prototype.render=ob.prototype.render=function(r){var l=this._internalRoot;if(l===null)throw Error(ft(409));Z0(r,l,null,null)};W0.prototype.unmount=ob.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var l=r.containerInfo;$d(function(){Z0(null,r,null,null)}),l[Qu]=null}};function W0(r){this._internalRoot=r}W0.prototype.unstable_scheduleHydration=function(r){if(r){var l=R2();r={blockedOn:null,target:r,priority:l};for(var f=0;f<dh.length&&l!==0&&l<dh[f].priority;f++);dh.splice(f,0,r),f===0&&U2(r)}};function sb(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function K0(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function FA(){}function kS(r,l,f,w,C){if(C){if(typeof w=="function"){var D=w;w=function(){var be=L0(O);D.call(be)}}var O=sC(l,w,r,0,null,!1,!1,"",FA);return r._reactRootContainer=O,r[Qu]=O.current,U_(r.nodeType===8?r.parentNode:r),$d(),O}for(;C=r.lastChild;)r.removeChild(C);if(typeof w=="function"){var s=w;w=function(){var be=L0(q);s.call(be)}}var q=ib(r,0,!1,null,null,!1,!1,"",FA);return r._reactRootContainer=q,r[Qu]=q.current,U_(r.nodeType===8?r.parentNode:r),$d(function(){Z0(l,q,f,w)}),q}function X0(r,l,f,w,C){var D=f._reactRootContainer;if(D){var O=D;if(typeof C=="function"){var s=C;C=function(){var q=L0(O);s.call(q)}}Z0(l,O,r,C)}else O=kS(f,l,r,C,w);return L0(O)}L2=function(r){switch(r.tag){case 3:var l=r.stateNode;if(l.current.memoizedState.isDehydrated){var f=x_(l.pendingLanes);f!==0&&(Cw(l,f|1),ms(l,Wi()),(Zn&6)===0&&(jf=Wi()+500,Ih()))}break;case 13:$d(function(){var w=ec(r,1);if(w!==null){var C=Lo();cl(w,r,1,C)}}),rb(r,1)}};Tw=function(r){if(r.tag===13){var l=ec(r,134217728);if(l!==null){var f=Lo();cl(l,r,134217728,f)}rb(r,134217728)}};F2=function(r){if(r.tag===13){var l=bh(r),f=ec(r,l);if(f!==null){var w=Lo();cl(f,r,l,w)}rb(r,l)}};R2=function(){return ri};O2=function(r,l){var f=ri;try{return ri=r,l()}finally{ri=f}};B1=function(r,l,f){switch(l){case"input":if(A1(r,f),l=f.name,f.type==="radio"&&l!=null){for(f=r;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<f.length;l++){var w=f[l];if(w!==r&&w.form===r.form){var C=N0(w);if(!C)throw Error(ft(90));m2(w),A1(w,C)}}}break;case"textarea":g2(r,f);break;case"select":l=f.value,l!=null&&Bf(r,!!f.multiple,l,!1)}};E2=Qw;C2=$d;var zS={usingClientEntryPoint:!1,Events:[J_,Af,N0,b2,A2,Qw]},g_={findFiberByHostInstance:Rd,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},PS={bundleType:g_.bundleType,version:g_.version,rendererPackageName:g_.rendererPackageName,rendererConfig:g_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:nc.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=I2(r),r===null?null:r.stateNode},findFiberByHostInstance:g_.findFiberByHostInstance||DS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Jy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Jy.isDisabled&&Jy.supportsFiber)try{F0=Jy.inject(PS),lu=Jy}catch{}}qs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zS;qs.createPortal=function(r,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sb(l))throw Error(ft(200));return BS(r,l,null,f)};qs.createRoot=function(r,l){if(!sb(r))throw Error(ft(299));var f=!1,w="",C=aC;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(w=l.identifierPrefix),l.onRecoverableError!==void 0&&(C=l.onRecoverableError)),l=ib(r,1,!1,null,null,f,!1,w,C),r[Qu]=l.current,U_(r.nodeType===8?r.parentNode:r),new ob(l)};qs.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var l=r._reactInternals;if(l===void 0)throw typeof r.render=="function"?Error(ft(188)):(r=Object.keys(r).join(","),Error(ft(268,r)));return r=I2(l),r=r===null?null:r.stateNode,r};qs.flushSync=function(r){return $d(r)};qs.hydrate=function(r,l,f){if(!K0(l))throw Error(ft(200));return X0(null,r,l,!0,f)};qs.hydrateRoot=function(r,l,f){if(!sb(r))throw Error(ft(405));var w=f!=null&&f.hydratedSources||null,C=!1,D="",O=aC;if(f!=null&&(f.unstable_strictMode===!0&&(C=!0),f.identifierPrefix!==void 0&&(D=f.identifierPrefix),f.onRecoverableError!==void 0&&(O=f.onRecoverableError)),l=sC(l,null,r,1,f!=null?f:null,C,!1,D,O),r[Qu]=l.current,U_(r),w)for(r=0;r<w.length;r++)f=w[r],C=f._getVersion,C=C(f._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[f,C]:l.mutableSourceEagerHydrationData.push(f,C);return new W0(l)};qs.render=function(r,l,f){if(!K0(l))throw Error(ft(200));return X0(null,r,l,!1,f)};qs.unmountComponentAtNode=function(r){if(!K0(r))throw Error(ft(40));return r._reactRootContainer?($d(function(){X0(null,null,r,!1,function(){r._reactRootContainer=null,r[Qu]=null})}),!0):!1};qs.unstable_batchedUpdates=Qw;qs.unstable_renderSubtreeIntoContainer=function(r,l,f,w){if(!K0(f))throw Error(ft(200));if(r==null||r._reactInternals===void 0)throw Error(ft(38));return X0(r,l,f,!1,w)};qs.version="18.2.0-next-9e3b772b8-20220608";(function(r){function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(f){console.error(f)}}l(),r.exports=qs})(s2);var lC,RA=s2.exports;lC=RA.createRoot,RA.hydrateRoot;var uC={exports:{}};(function(r,l){(function(f,w){r.exports=w()})(gf,function(){var f,w,C;function D(s,q){if(!f)f=q;else if(!w)w=q;else{var be="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+f+")(sharedChunk); ("+w+")(sharedChunk); self.onerror = null;",je={};f(je),C=q(je),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(C.workerUrl=window.URL.createObjectURL(new Blob([be],{type:"text/javascript"})))}}D(["exports"],function(s){var q=typeof self<"u"?self:{},be="2.11.0";let je;const Pe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(je==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{je=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{je=t}}return je},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Le={supported:!1,testSupport:function(t){!yt&&ht&&(hn?Te(t):ct=t)}};let ct,ht,yt=!1,hn=!1;function Te(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ht),t.isContextLost())return;Le.supported=!0}catch{}t.deleteTexture(e),yt=!0}q.document&&(ht=q.document.createElement("img"),ht.onload=function(){ct&&Te(ct),ct=null,hn=!0},ht.onerror=function(){yt=!0,ct=null},ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ge="01";var Se=it;function it(t,e,n,o){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=o}it.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,o=0;o<8;o++){var u=this.sampleCurveX(n)-t;if(Math.abs(u)<e)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=u/d}var m=0,y=1;for(n=t,o=0;o<20&&(u=this.sampleCurveX(n),!(Math.abs(u-t)<e));o++)t>u?m=n:y=n,n=.5*(y-m)+m;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var ke=ut;function ut(t,e){this.x=t,this.y=e}ut.prototype={clone:function(){return new ut(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),u=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ut.convert=function(t){return t instanceof ut?t:Array.isArray(t)?new ut(t[0],t[1]):t};const bt=Math.PI/180,Pt=180/Math.PI;function zt(t){return t*bt}function qt(t){return t*Pt}const rr=[[0,0],[1,0],[1,1],[0,1]];function Oo(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function go(t,e,n,o){const u=new Se(t,e,n,o);return function(d){return u.solve(d)}}const _s=go(.25,.1,.25,1);function cn(t,e,n){return Math.min(n,Math.max(e,t))}function gs(t,e,n){return(n=cn((n-t)/(e-t),0,1))*n*(3-2*n)}function Ni(t,e,n){const o=n-e,u=((t-e)%o+o)%o+e;return u===e?n:u}function wt(t,e,n){if(!t.length)return n(null,[]);let o=t.length;const u=new Array(t.length);let d=null;t.forEach((m,y)=>{e(m,(x,b)=>{x&&(d=x),u[y]=b,--o==0&&n(d,u)})})}function Jt(t){const e=[];for(const n in t)e.push(t[n]);return e}function Bt(t,...e){for(const n of e)for(const o in n)t[o]=n[o];return t}let gn=1;function oi(){return gn++}function br(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Fi(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Ki(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ri(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Gi(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Hr(t,e,n){const o={};for(const u in t)o[u]=e.call(n||this,t[u],u,t);return o}function ys(t,e,n){const o={};for(const u in t)e.call(n||this,t[u],u,t)&&(o[u]=t[u]);return o}function Pr(t){return Array.isArray(t)?t.map(Pr):typeof t=="object"&&t?Hr(t,Pr):t}const Da={};function Xn(t){Da[t]||(typeof console<"u"&&console.warn(t),Da[t]=!0)}function $r(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Qt(t){let e=0;for(let n,o,u=0,d=t.length,m=d-1;u<d;m=u++)n=t[u],o=t[m],e+=(o.x-n.x)*(n.y+o.y);return e}function or(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function cu(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,u,d)=>{const m=u||d;return e[o]=!m||m.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Vi=null;function ka(t){if(Vi==null){const e=t.navigator?t.navigator.userAgent:null;Vi=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Vi}function hu(t){try{const e=q[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Zr(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Ar="mapbox-tiles";let Ii,yo,pl=500,vs=50;function fl(){try{return q.caches}catch{}}function Wr(){fl()&&!Ii&&(Ii=q.caches.open(Ar))}function Uo(t){const e=t.indexOf("?");if(e<0)return t;const n=function(u){const d=u.indexOf("?");return d>0?u.slice(d+1).split("&"):[]}(t),o=n.filter(u=>{const d=u.split("=");return d[0]==="language"||d[0]==="worldview"});return o.length?`${t.slice(0,e)}?${o.join("&")}`:t.slice(0,e)}let $s=1/0;const sr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(sr);class za extends Error{constructor(e,n,o){n===401&&La(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Zs=or()?()=>self.worker&&self.worker.referrer:()=>(q.location.protocol==="blob:"?q.parent:q).location.href,No=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Zs())&&!/^\w+:/.test(n))){if(q.fetch&&q.Request&&q.AbortController&&q.Request.prototype.hasOwnProperty("signal"))return function(o,u){const d=new q.AbortController,m=new q.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Zs(),signal:d.signal});let y=!1,x=!1;const b=(T=m.url).indexOf("sku=")>0&&La(T);var T;o.type==="json"&&m.headers.set("Accept","application/json");const M=(L,F,N)=>{if(x)return;if(L&&L.message!=="SecurityError"&&Xn(L),F&&N)return B(F);const H=Date.now();q.fetch(m).then(re=>{if(re.ok){const ce=b?re.clone():null;return B(re,ce,H)}return u(new za(re.statusText,re.status,o.url))}).catch(re=>{re.code!==20&&u(new Error(re.message))})},B=(L,F,N)=>{(o.type==="arrayBuffer"?L.arrayBuffer():o.type==="json"?L.json():L.text()).then(H=>{x||(F&&N&&function(re,ce,ie){if(Wr(),!Ii)return;const ae={status:ce.status,statusText:ce.statusText,headers:new q.Headers};ce.headers.forEach((Fe,ze)=>ae.headers.set(ze,Fe));const me=cu(ce.headers.get("Cache-Control")||"");if(me["no-store"])return;me["max-age"]&&ae.headers.set("Expires",new Date(ie+1e3*me["max-age"]).toUTCString());const de=ae.headers.get("Expires");de&&(new Date(de).getTime()-ie<42e4||function(Fe,ze){if(yo===void 0)try{new Response(new ReadableStream),yo=!0}catch{yo=!1}yo?ze(Fe.body):Fe.blob().then(ze)}(ce,Fe=>{const ze=new q.Response(Fe,ae);Wr(),Ii&&Ii.then(Ge=>Ge.put(Uo(re.url),ze)).catch(Ge=>Xn(Ge.message))}))}(m,F,N),y=!0,u(null,H,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(H=>{x||u(new Error(H.message))})};return b?function(L,F){if(Wr(),!Ii)return F(null);const N=Uo(L.url);Ii.then(H=>{H.match(N).then(re=>{const ce=function(ie){if(!ie)return!1;const ae=new Date(ie.headers.get("Expires")||0),me=cu(ie.headers.get("Cache-Control")||"");return ae>Date.now()&&!me["no-cache"]}(re);H.delete(N),ce&&H.put(N,re.clone()),F(null,re,ce)}).catch(F)}).catch(F)}(m,M):M(null,null),{cancel:()=>{x=!0,y||d.abort()}}}(t,e);if(or()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(o,u){const d=new q.XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const m in o.headers)d.setRequestHeader(m,o.headers[m]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let m=d.response;if(o.type==="json")try{m=JSON.parse(d.response)}catch(y){return u(y)}u(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else u(new za(d.statusText,d.status,o.url))},d.send(o.body),{cancel:()=>d.abort()}}(t,e)},Go=function(t,e){return No(Bt(t,{type:"arrayBuffer"}),e)};function Pa(t){const e=q.document.createElement("a");return e.href=t,e.protocol===q.document.location.protocol&&e.host===q.document.location.host}const ml="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ws,Ks;Ws=[],Ks=0;const _l=function(t,e){if(Le.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ks>=Pe.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ws.push(d),d}Ks++;let n=!1;const o=()=>{if(!n)for(n=!0,Ks--;Ws.length&&Ks<Pe.MAX_PARALLEL_IMAGE_REQUESTS;){const d=Ws.shift(),{requestParameters:m,callback:y,cancelled:x}=d;x||(d.cancel=_l(m,y).cancel)}},u=Go(t,(d,m,y,x)=>{o(),d?e(d):m&&(q.createImageBitmap?function(b,T){const M=new q.Blob([new Uint8Array(b)],{type:"image/png"});q.createImageBitmap(M).then(B=>{T(null,B)}).catch(B=>{T(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(b,T)=>e(b,T,y,x)):function(b,T){const M=new q.Image,B=q.URL;M.onload=()=>{T(null,M),B.revokeObjectURL(M.src),M.onload=null,q.requestAnimationFrame(()=>{M.src=ml})},M.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new q.Blob([new Uint8Array(b)],{type:"image/png"});M.src=b.byteLength?B.createObjectURL(L):ml}(m,(b,T)=>e(b,T,y,x)))});return{cancel:()=>{u.cancel(),o()}}},gl="NO_ACCESS_TOKEN";function Kr(t){return t.indexOf("mapbox:")===0}function La(t){return Pe.API_URL_REGEX.test(t)}function ic(t){return Pe.API_STYLE_REGEX.test(t)&&!yl(t)}function yl(t){return Pe.API_SPRITE_REGEX.test(t)}const vl=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Er(t){const e=t.match(vl);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Xs(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function du(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(q.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Fa{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=du(Pe.ACCESS_TOKEN);let o="";return o=n&&n.u?q.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,d)=>String.fromCharCode(Number("0x"+d)))):Pe.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=hu("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const u=q.localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));const d=q.localStorage.getItem(o);d&&(this.anonId=d)}catch{Xn("Unable to read from LocalStorage")}}saveEventData(){const e=hu("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{q.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&q.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Xn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,u){if(!Pe.EVENTS_URL)return;const d=Er(Pe.EVENTS_URL);d.params.push(`access_token=${u||Pe.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},y=n?Bt(m,n):m,x={url:Xs(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(b,T){return No(Bt(b,{method:"POST"}),T)}(x,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(u)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const ne=new class extends Fa{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Pe.EVENTS_URL&&Pe.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Kr(n)||La(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=du(Pe.ACCESS_TOKEN),n=e?e.u:Pe.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;Ki(this.anonId)||(this.anonId=br(),o=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),m=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;o=o||y>=1||y<-1||d.getDate()!==m.getDate()}else o=!0;o?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:be,skuId:ge,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},t):this.processRequests()}},R=ne.postTurnstileEvent.bind(ne),V=new class extends Fa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,o){this.skuToken=e,this.errorCb=o,Pe.EVENTS_URL&&(n||Pe.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(gl)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ki(this.anonId)||(this.anonId=br()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:be,skuId:ge,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}},ee=V.postMapLoadEvent.bind(V),se=new class extends Fa{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Pe.EVENTS_URL&&(t||Pe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:n}=this.queue.shift(),o=function(u){const d=q.performance.getEntriesByType("resource"),m=q.performance.getEntriesByType("mark"),y=function(B){const L={};if(B){for(const F in B)if(F!=="other")for(const N of B[F]){const H=`${F}RequestCount`,re=`${F}ResolveRangeMin`,ce=`${F}ResolveRangeMax`;L[re]=Math.min(L[re]||1/0,N.startTime),L[ce]=Math.max(L[ce]||-1/0,N.responseEnd),L[H]===void 0&&(L[H]=0),++L[H]}}return L}(function(B,L){const F={};if(B)for(const N of B){const H=L(N);F[H]===void 0&&(F[H]=[]),F[H].push(N)}return F}(d,_t)),x=q.devicePixelRatio,b=q.navigator.connection||q.navigator.mozConnection||q.navigator.webkitConnection,T={counters:[],metadata:[],attributes:[]},M=(B,L,F)=>{F!=null&&B.push({name:L,value:F.toString()})};for(const B in y)M(T.counters,B,y[B]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(M(T.counters,"interactionRangeMin",u.interactionRange[0]),M(T.counters,"interactionRangeMax",u.interactionRange[1])),m)for(const B of Object.keys(Be)){const L=Be[B],F=m.find(N=>N.name===L);F&&M(T.counters,L,F.startTime)}return M(T.attributes,"style",function(B){if(B)for(const L of B){const F=L.name.split("?")[0];if(ic(F)){const N=F.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(d)),M(T.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),M(T.attributes,"fogEnabled",u.fogEnabled?"true":"false"),M(T.attributes,"projection",u.projection.name),M(T.attributes,"zoom",u.zoom),M(T.metadata,"devicePixelRatio",x),M(T.metadata,"connectionEffectiveType",b?b.effectiveType:void 0),M(T.metadata,"navigatorUserAgent",q.navigator.userAgent),M(T.metadata,"screenWidth",q.screen.width),M(T.metadata,"screenHeight",q.screen.height),M(T.metadata,"windowWidth",q.innerWidth),M(T.metadata,"windowHeight",q.innerHeight),M(T.metadata,"mapWidth",u.width/x),M(T.metadata,"mapHeight",u.height/x),M(T.metadata,"webglRenderer",u.renderer),M(T.metadata,"webglVendor",u.vendor),M(T.metadata,"sdkVersion",be),M(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(n);for(const u of o.metadata);for(const u of o.counters);for(const u of o.attributes);this.postEvent(e,o,()=>{},t)}},fe=se.postPerformanceEvent.bind(se),Ee=new class extends Fa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,o){if(!Pe.API_URL||!Pe.SESSION_PATH)return;const u=Er(Pe.API_URL+Pe.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${o||Pe.ACCESS_TOKEN||""}`);const d={url:Xs(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,y){return No(Bt(m,{method:"GET"}),y)}(d,m=>{this.pendingRequest=null,n(m),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,n,o){this.skuToken=e,this.errorCb=o,Pe.SESSION_PATH&&Pe.API_URL&&(n||Pe.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(gl)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}},Ae=Ee.getSessionAPI.bind(Ee),_e=new Set,Be={create:"create",load:"load",fullLoad:"fullLoad"},Ke={mark(t){q.performance.mark(t)},measure(t,e,n){q.performance.measure(t,e,n)}};function _t(t){const e=t.name.split("?")[0];return e.includes("mapbox-gl.js")?"javascript":e.includes("mapbox-gl.css")?"css":function(n){return Pe.API_FONTS_REGEX.test(n)}(e)?"fontRange":yl(e)?"sprite":ic(e)?"style":function(n){return Pe.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}const Je=q.performance;function Ft(t){const e=t?t.url.toString():void 0;return Je.getEntriesByName(e)}let Dt,Mt,Gt,sn;const An={now:()=>Gt!==void 0?Gt:q.performance.now(),setNow(t){Gt=t},restoreNow(){Gt=void 0},frame(t){const e=q.requestAnimationFrame(t);return{cancel:()=>q.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:o}=t;sn||(sn=q.document.createElement("canvas"));const u=sn.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return(n>sn.width||o>sn.height)&&(sn.width=n,sn.height=o),u.clearRect(-e,-e,n+2*e,o+2*e),u.drawImage(t,0,0,n,o),u.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:t=>(Dt||(Dt=q.document.createElement("a")),Dt.href=t,Dt.href),get devicePixelRatio(){return q.devicePixelRatio},get prefersReducedMotion(){return!!q.matchMedia&&(Mt==null&&(Mt=q.matchMedia("(prefers-reduced-motion: reduce)")),Mt.matches)}};function Rt(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Pn(t,e,n){if(n&&n[t]){const o=n[t].indexOf(e);o!==-1&&n[t].splice(o,1)}}class Tn{constructor(e,n={}){Bt(this,n),this.type=e}}class Js extends Tn{constructor(e,n={}){super("error",Bt({error:e},n))}}class xs{on(e,n){return this._listeners=this._listeners||{},Rt(e,n,this._listeners),this}off(e,n){return Pn(e,n,this._listeners),Pn(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Rt(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new Tn(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of d)Pn(o,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(Bt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Js&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ue=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Vo(t,...e){for(const n of e)for(const o in n)t[o]=n[o];return t}function ui(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ws(t){if(Array.isArray(t))return t.map(ws);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=ws(t[n]);return e}return ui(t)}class Kd extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var jo=Kd;class xl{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(e){return new xl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Xd=xl;const Ra={kind:"null"},pt={kind:"number"},nn={kind:"string"},an={kind:"boolean"},qo={kind:"color"},Oa={kind:"object"},rn={kind:"value"},wl={kind:"collator"},bl={kind:"formatted"},Ua={kind:"resolvedImage"};function Cr(t,e){return{kind:"array",itemType:t,N:e}}function Nn(t){if(t.kind==="array"){const e=Nn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Jf=[Ra,pt,nn,an,qo,bl,Oa,Cr(rn),Ua];function Xr(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Xr(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of Jf)if(!Xr(n,e))return null}}return`Expected ${Nn(t)} but found ${Nn(e)} instead.`}function Al(t,e){return e.some(n=>n.kind===t.kind)}function Xi(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var Ys,pu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function fu(t){return(t=Math.round(t))<0?0:t>255?255:t}function mu(t){return fu(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function El(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Qs(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Ys={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in pu)return pu[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=n.indexOf("("),u=n.indexOf(")");if(o!==-1&&u+1===n.length){var d=n.substr(0,o),m=n.substr(o+1,u-(o+1)).split(","),y=1;switch(d){case"rgba":if(m.length!==4)return null;y=El(m.pop());case"rgb":return m.length!==3?null:[mu(m[0]),mu(m[1]),mu(m[2]),y];case"hsla":if(m.length!==4)return null;y=El(m.pop());case"hsl":if(m.length!==3)return null;var x=(parseFloat(m[0])%360+360)%360/360,b=El(m[1]),T=El(m[2]),M=T<=.5?T*(b+1):T+b-T*b,B=2*T-M;return[fu(255*Qs(B,M,x+1/3)),fu(255*Qs(B,M,x)),fu(255*Qs(B,M,x-1/3)),y];default:return null}}return null}}catch{}class ji{constructor(e,n,o,u=1){this.r=e,this.g=n,this.b=o,this.a=u}static parse(e){if(!e)return;if(e instanceof ji)return e;if(typeof e!="string")return;const n=Ys(e);return n?new ji(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,o,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${u})`}toArray(){const{r:e,g:n,b:o,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*n/u,255*o/u,u]}toArray01(){const{r:e,g:n,b:o,a:u}=this;return u===0?[0,0,0,0]:[e/u,n/u,o/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:o,a:u}=this;return[e,n,o,u]}}ji.black=new ji(0,0,0,1),ji.white=new ji(1,1,1,1),ji.transparent=new ji(0,0,0,0),ji.red=new ji(1,0,0,1),ji.blue=new ji(0,0,1,1);var ai=ji;class Mh{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bh{constructor(e,n,o,u,d){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=u,this.textColor=d}}class ar{constructor(e){this.sections=e}static fromString(e){return new ar([new Bh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ar?e:ar.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(o)}return e}}class lr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new lr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Jd(t,e,n,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,n,o]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Na(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof ai||t instanceof Mh||t instanceof ar||t instanceof lr)return!0;if(Array.isArray(t)){for(const e of t)if(!Na(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Na(t[e]))return!1;return!0}return!1}function yi(t){if(t===null)return Ra;if(typeof t=="string")return nn;if(typeof t=="boolean")return an;if(typeof t=="number")return pt;if(t instanceof ai)return qo;if(t instanceof Mh)return wl;if(t instanceof ar)return bl;if(t instanceof lr)return Ua;if(Array.isArray(t)){const e=t.length;let n;for(const o of t){const u=yi(o);if(n){if(n===u)continue;n=rn;break}n=u}return Cr(n||rn,e)}return Oa}function _u(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof ai||t instanceof ar||t instanceof lr?t.toString():JSON.stringify(t)}class gu{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Na(e[1]))return n.error("invalid value");const o=e[1];let u=yi(o);const d=n.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new gu(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ai?["rgba"].concat(this.value.toArray()):this.value instanceof ar?this.value.serialize():this.value}}var yu=gu,qi=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Dh={string:nn,number:pt,boolean:an,object:Oa};class kh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,u=1;const d=e[0];if(d==="array"){let y,x;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in Dh)||b==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Dh[b],u++}else y=rn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}o=Cr(y,x)}else o=Dh[d];const m=[];for(;u<e.length;u++){const y=n.parse(e[u],u,rn);if(!y)return null;m.push(y)}return new kh(o,m)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!Xr(this.type,yi(o)))return o;if(n===this.args.length-1)throw new qi(`Expected value to be of type ${Nn(this.type)}, but found ${Nn(yi(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(o=>o.serialize()))}}var Ho=kh;class kn{constructor(e){this.type=bl,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let d=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,pt),!x))return null;let b=null;if(y["text-font"]&&(b=n.parse(y["text-font"],1,Cr(nn)),!b))return null;let T=null;if(y["text-color"]&&(T=n.parse(y["text-color"],1,qo),!T))return null;const M=u[u.length-1];M.scale=x,M.font=b,M.textColor=T}else{const x=n.parse(e[m],1,rn);if(!x)return null;const b=x.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new kn(u)}evaluate(e){return new ar(this.sections.map(n=>{const o=n.content.evaluate(e);return yi(o)===Ua?new Bh("",o,null,null,null):new Bh(_u(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class Gn{constructor(e){this.type=Ua,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,nn);return o?new Gn(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=lr.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Yf={"to-boolean":an,"to-color":qo,"to-number":pt,"to-string":nn};class zh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const u=Yf[o],d=[];for(let m=1;m<e.length;m++){const y=n.parse(e[m],m,rn);if(!y)return null;d.push(y)}return new zh(u,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let n,o;for(const u of this.args){if(n=u.evaluate(e),o=null,n instanceof ai)return n;if(typeof n=="string"){const d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Jd(n[0],n[1],n[2],n[3]),!o))return new ai(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new qi(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new qi(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?ar.fromString(_u(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?lr.fromString(_u(this.args[0].evaluate(e))):_u(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new kn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Gn(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Cl=zh;const Qf=["Unknown","Point","LineString","Polygon"];var Yd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(o*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ai.parse(t)),e}};class Ga{constructor(e,n,o,u){this.name=e,this.type=n,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const o=e[0],u=Ga.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=m.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let x=null;for(const[b,T]of y){x=new xu(n.registry,n.path,null,n.scope);const M=[];let B=!1;for(let L=1;L<e.length;L++){const F=e[L],N=Array.isArray(b)?b[L-1]:b.type,H=x.parse(F,1+M.length,N);if(!H){B=!0;break}M.push(H)}if(!B)if(Array.isArray(b)&&b.length!==M.length)x.error(`Expected ${b.length} arguments, but found ${M.length} instead.`);else{for(let L=0;L<M.length;L++){const F=Array.isArray(b)?b[L]:b.type,N=M[L];x.concat(L+1).checkSubtype(F,N.type)}if(x.errors.length===0)return new Ga(o,d,T,M)}}if(y.length===1)n.errors.push(...x.errors);else{const b=(y.length?y:m).map(([M])=>{return B=M,Array.isArray(B)?`(${B.map(Nn).join(", ")})`:`(${Nn(B.type)}...)`;var B}).join(" | "),T=[];for(let M=1;M<e.length;M++){const B=n.parse(e[M],1+T.length);if(!B)return null;T.push(Nn(B.type))}n.error(`Expected arguments of type ${b}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){Ga.definitions=n;for(const o in n)e[o]=Ga}}var Jr=Ga;class rc{constructor(e,n,o){this.type=wl,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,an);if(!u)return null;const d=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,an);if(!d)return null;let m=null;return o.locale&&(m=n.parse(o.locale,1,nn),!m)?null:new rc(u,d,m)}evaluate(e){return new Mh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const si=8192;function vu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function $o(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function vo(t,e){const n=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*si),Math.round(o*u*si)]}function oc(t,e,n){const o=t[0]-e[0],u=t[1]-e[1],d=t[0]-n[0],m=t[1]-n[1];return o*m-d*u==0&&o*d<=0&&u*m<=0}function ur(t,e){let n=!1;for(let m=0,y=e.length;m<y;m++){const x=e[m];for(let b=0,T=x.length;b<T-1;b++){if(oc(t,x[b],x[b+1]))return!1;(u=x[b])[1]>(o=t)[1]!=(d=x[b+1])[1]>o[1]&&o[0]<(d[0]-u[0])*(o[1]-u[1])/(d[1]-u[1])+u[0]&&(n=!n)}}var o,u,d;return n}function Ph(t,e){for(let n=0;n<e.length;n++)if(ur(t,e[n]))return!0;return!1}function sc(t,e,n,o){const u=o[0]-n[0],d=o[1]-n[1],m=(t[0]-n[0])*d-u*(t[1]-n[1]),y=(e[0]-n[0])*d-u*(e[1]-n[1]);return m>0&&y<0||m<0&&y>0}function Lh(t,e,n){for(const b of n)for(let T=0;T<b.length-1;++T)if((y=[(m=b[T+1])[0]-(d=b[T])[0],m[1]-d[1]])[0]*(x=[(u=e)[0]-(o=t)[0],u[1]-o[1]])[1]-y[1]*x[0]!=0&&sc(o,u,d,m)&&sc(d,m,o,u))return!0;var o,u,d,m,y,x;return!1}function ac(t,e){for(let n=0;n<t.length;++n)if(!ur(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Lh(t[n],t[n+1],e))return!1;return!0}function lc(t,e){for(let n=0;n<e.length;n++)if(ac(t,e[n]))return!0;return!1}function ea(t,e,n){const o=[];for(let u=0;u<t.length;u++){const d=[];for(let m=0;m<t[u].length;m++){const y=vo(t[u][m],n);vu(e,y),d.push(y)}o.push(d)}return o}function cr(t,e,n){const o=[];for(let u=0;u<t.length;u++){const d=ea(t[u],e,n);o.push(d)}return o}function Fh(t,e,n,o){if(t[0]<n[0]||t[0]>n[2]){const u=.5*o;let d=t[0]-n[0]>u?-o:n[0]-t[0]>u?o:0;d===0&&(d=t[0]-n[2]>u?-o:n[2]-t[0]>u?o:0),t[0]+=d}vu(e,t)}function hr(t,e,n,o){const u=Math.pow(2,o.z)*si,d=[o.x*si,o.y*si],m=[];if(!t)return m;for(const y of t)for(const x of y){const b=[x.x+d[0],x.y+d[1]];Fh(b,e,n,u),m.push(b)}return m}function Rh(t,e,n,o){const u=Math.pow(2,o.z)*si,d=[o.x*si,o.y*si],m=[];if(!t)return m;for(const x of t){const b=[];for(const T of x){const M=[T.x+d[0],T.y+d[1]];vu(e,M),b.push(M)}m.push(b)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of m)for(const b of x)Fh(b,e,n,u)}var y;return m}class xo{constructor(e,n){this.type=an,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Na(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let u=0;u<o.features.length;++u){const d=o.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new xo(o,o.features[u].geometry)}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new xo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new xo(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(o.type==="Polygon"){const y=ea(o.coordinates,d,m),x=hr(n.geometry(),u,d,m);if(!$o(u,d))return!1;for(const b of x)if(!ur(b,y))return!1}if(o.type==="MultiPolygon"){const y=cr(o.coordinates,d,m),x=hr(n.geometry(),u,d,m);if(!$o(u,d))return!1;for(const b of x)if(!Ph(b,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(o.type==="Polygon"){const y=ea(o.coordinates,d,m),x=Rh(n.geometry(),u,d,m);if(!$o(u,d))return!1;for(const b of x)if(!ac(b,y))return!1}if(o.type==="MultiPolygon"){const y=cr(o.coordinates,d,m),x=Rh(n.geometry(),u,d,m);if(!$o(u,d))return!1;for(const b of x)if(!lc(b,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var dn=xo;function ta(t){if(t instanceof Jr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof dn)return!1;let e=!0;return t.eachChild(n=>{e&&!ta(n)&&(e=!1)}),e}function Tl(t){if(t instanceof Jr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Tl(n)&&(e=!1)}),e}function Jn(t,e){if(t instanceof Jr&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(o=>{n&&!Jn(o,e)&&(n=!1)}),n}class wo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new wo(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var uc=wo;class cc{constructor(e,n=[],o,u=new Xd,d=[]){this.registry=e,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=d,this.expectedType=o}parse(e,n,o,u,d={}){return n?this.concat(n,o,u)._parse(e,d):this._parse(e,d)}_parse(e,n){function o(u,d,m){return m==="assert"?new Ho(d,[u]):m==="coerce"?new Cl(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[u];if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(y,x))return null}else m=o(m,y,n.typeAnnotation||"coerce");else m=o(m,y,n.typeAnnotation||"assert")}if(!(m instanceof yu)&&m.type.kind!=="resolvedImage"&&hc(m)){const y=new Yd;try{m=new yu(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const u=typeof e=="number"?this.path.concat(e):this.path,d=o?this.scope.concat(o):this.scope;return new cc(this.registry,u,n||null,d,this.errors)}error(e,...n){const o=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new jo(o,e))}checkSubtype(e,n){const o=Xr(e,n);return o&&this.error(o),o}}var xu=cc;function hc(t){if(t instanceof uc)return hc(t.boundExpression);if(t instanceof Jr&&t.name==="error"||t instanceof rc||t instanceof dn)return!1;const e=t instanceof Cl||t instanceof Ho;let n=!0;return t.eachChild(o=>{n=e?n&&hc(o):n&&o instanceof yu}),!!n&&ta(t)&&Jn(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function wu(t,e){const n=t.length-1;let o,u,d=0,m=n,y=0;for(;d<=m;)if(y=Math.floor((d+m)/2),o=t[y],u=t[y+1],o<=e){if(y===n||e<u)return y;d=y+1}else{if(!(o>e))throw new qi("Input is not a number.");m=y-1}return 0}class na{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,d]of o)this.labels.push(u),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,pt);if(!o)return null;const u=[];let d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let m=1;m<e.length;m+=2){const y=m===1?-1/0:e[m],x=e[m+1],b=m,T=m+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const M=n.parse(x,T,d);if(!M)return null;d=d||M.type,u.push([y,M])}return new na(d,o,u)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return o[0].evaluate(e);const d=n.length;return u>=n[d-1]?o[d-1].evaluate(e):o[wu(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Va=na;function mn(t,e,n){return t*(1-n)+e*n}var bo=Object.freeze({__proto__:null,number:mn,color:function(t,e,n){return new ai(mn(t.r,e.r,n),mn(t.g,e.g,n),mn(t.b,e.b,n),mn(t.a,e.a,n))},array:function(t,e,n){return t.map((o,u)=>mn(o,e[u],n))}});const Oh=.95047,Uh=1.08883,Nh=4/29,Sl=6/29,dc=3*Sl*Sl,Gh=Math.PI/180,Qd=180/Math.PI;function bu(t){return t>.008856451679035631?Math.pow(t,1/3):t/dc+Nh}function Il(t){return t>Sl?t*t*t:dc*(t-Nh)}function Vh(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Au(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function dr(t){const e=Au(t.r),n=Au(t.g),o=Au(t.b),u=bu((.4124564*e+.3575761*n+.1804375*o)/Oh),d=bu((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-bu((.0193339*e+.119192*n+.9503041*o)/Uh)),alpha:t.a}}function pc(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*Il(e),n=Oh*Il(n),o=Uh*Il(o),new ai(Vh(3.2404542*n-1.5371385*e-.4985314*o),Vh(-.969266*n+1.8760108*e+.041556*o),Vh(.0556434*n-.2040259*e+1.0572252*o),t.alpha)}function Eu(t,e,n){const o=e-t;return t+n*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ml={forward:dr,reverse:pc,interpolate:function(t,e,n){return{l:mn(t.l,e.l,n),a:mn(t.a,e.a,n),b:mn(t.b,e.b,n),alpha:mn(t.alpha,e.alpha,n)}}},Bl={forward:function(t){const{l:e,a:n,b:o}=dr(t),u=Math.atan2(o,n)*Qd;return{h:u<0?u+360:u,c:Math.sqrt(n*n+o*o),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Gh,n=t.c;return pc({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Eu(t.h,e.h,n),c:mn(t.c,e.c,n),l:mn(t.l,e.l,n),alpha:mn(t.alpha,e.alpha,n)}}};var ep=Object.freeze({__proto__:null,lab:Ml,hcl:Bl});class fc{constructor(e,n,o,u,d){this.type=e,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of d)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,n,o,u){let d=0;if(e.name==="exponential")d=mc(n,e.base,o,u);else if(e.name==="linear")d=mc(n,1,o,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;d=new Se(m[0],m[1],m[2],m[3]).solve(mc(n,1,o,u))}return d}static parse(e,n){let[o,u,d,...m]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const b=u[1];if(typeof b!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:b}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const b=u.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,pt),!d)return null;const y=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=qo:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let b=0;b<m.length;b+=2){const T=m[b],M=m[b+1],B=b+3,L=b+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(y.length&&y[y.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const F=n.parse(M,L,x);if(!F)return null;x=x||F.type,y.push([T,F])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new fc(x,o,u,d,y):n.error(`Type ${Nn(x)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return o[0].evaluate(e);const d=n.length;if(u>=n[d-1])return o[d-1].evaluate(e);const m=wu(n,u),y=fc.interpolationFactor(this.interpolation,u,n[m],n[m+1]),x=o[m].evaluate(e),b=o[m+1].evaluate(e);return this.operator==="interpolate"?bo[this.type.kind.toLowerCase()](x,b,y):this.operator==="interpolate-hcl"?Bl.reverse(Bl.interpolate(Bl.forward(x),Bl.forward(b),y)):Ml.reverse(Ml.interpolate(Ml.forward(x),Ml.forward(b),y))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function mc(t,e,n,o){const u=o-n,d=t-n;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}var Zo=fc;class jh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const d=[];for(const y of e.slice(1)){const x=n.parse(y,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}const m=u&&d.some(y=>Xr(u,y.type));return new jh(m?rn:o,d)}evaluate(e){let n,o=null,u=0;for(const d of this.args){if(u++,o=d.evaluate(e),o&&o instanceof lr&&!o.available&&(n||(n=o),o=null,u===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var ja=jh;class qh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const m=e[d];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=n.parse(e[d+1],d+1);if(!y)return null;o.push([m,y])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return u?new qh(o,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}var Hh=qh;class Dl{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,pt),u=n.parse(e[2],2,Cr(n.expectedType||rn));return o&&u?new Dl(u.type.itemType,o,u):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new qi(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new qi(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new qi(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var $h=Dl;class Wo{constructor(e,n){this.type=an,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,rn),u=n.parse(e[2],2,rn);return o&&u?Al(o.type,[an,nn,pt,Ra,rn])?new Wo(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Xi(n,["boolean","string","number","null"]))throw new qi(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(yi(n))} instead.`);if(!Xi(o,["string","array"]))throw new qi(`Expected second argument to be of type array or string, but found ${Nn(yi(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var _c=Wo;class Cu{constructor(e,n,o){this.type=pt,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,rn),u=n.parse(e[2],2,rn);if(!o||!u)return null;if(!Al(o.type,[an,nn,pt,Ra,rn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(o.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,pt);return d?new Cu(o,u,d):null}return new Cu(o,u)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Xi(n,["boolean","string","number","null"]))throw new qi(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(yi(n))} instead.`);if(!Xi(o,["string","array"]))throw new qi(`Expected second argument to be of type array or string, but found ${Nn(yi(o))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return o.indexOf(n,u)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var tp=Cu;class gc{constructor(e,n,o,u,d,m){this.inputType=e,this.type=n,this.input=o,this.cases=u,this.outputs=d,this.otherwise=m}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const d={},m=[];for(let b=2;b<e.length-1;b+=2){let T=e[b];const M=e[b+1];Array.isArray(T)||(T=[T]);const B=n.concat(b);if(T.length===0)return B.error("Expected at least one branch label.");for(const F of T){if(typeof F!="number"&&typeof F!="string")return B.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,yi(F)))return null}else o=yi(F);if(d[String(F)]!==void 0)return B.error("Branch labels must be unique.");d[String(F)]=m.length}const L=n.parse(M,b,u);if(!L)return null;u=u||L.type,m.push(L)}const y=n.parse(e[1],1,rn);if(!y)return null;const x=n.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(o,y.type)?null:new gc(o,u,y,d,m,x):null}evaluate(e){const n=this.input.evaluate(e);return(yi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],u={};for(const m of n){const y=u[this.cases[m]];y===void 0?(u[this.cases[m]]=o.length,o.push([this.cases[m],[m]])):o[y][1].push(m)}const d=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,y]of o)e.push(y.length===1?d(y[0]):y.map(d)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var kl=gc;class Lr{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const y=n.parse(e[m],m,an);if(!y)return null;const x=n.parse(e[m+1],m+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const d=n.parse(e[e.length-1],e.length-1,o);return d?new Lr(o,u,d):null}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var np=Lr;class yc{constructor(e,n,o,u){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,rn),u=n.parse(e[2],2,pt);if(!o||!u)return null;if(!Al(o.type,[Cr(rn),nn,rn]))return n.error(`Expected first argument to be of type array or string, but found ${Nn(o.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,pt);return d?new yc(o.type,o,u,d):null}return new yc(o.type,o,u)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Xi(n,["string","array"]))throw new qi(`Expected first argument to be of type array or string, but found ${Nn(yi(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(o,u)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var vc=yc;function Zh(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Wh(t,e,n,o){return o.compare(e,n)===0}function zl(t,e,n){const o=t!=="=="&&t!=="!=";return class cC{constructor(d,m,y){this.type=an,this.lhs=d,this.rhs=m,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const y=d[0];let x=m.parse(d[1],1,rn);if(!x)return null;if(!Zh(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Nn(x.type)}'.`);let b=m.parse(d[2],2,rn);if(!b)return null;if(!Zh(y,b.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Nn(b.type)}'.`);if(x.type.kind!==b.type.kind&&x.type.kind!=="value"&&b.type.kind!=="value")return m.error(`Cannot compare types '${Nn(x.type)}' and '${Nn(b.type)}'.`);o&&(x.type.kind==="value"&&b.type.kind!=="value"?x=new Ho(b.type,[x]):x.type.kind!=="value"&&b.type.kind==="value"&&(b=new Ho(x.type,[b])));let T=null;if(d.length===4){if(x.type.kind!=="string"&&b.type.kind!=="string"&&x.type.kind!=="value"&&b.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(T=m.parse(d[3],3,wl),!T)return null}return new cC(x,b,T)}evaluate(d){const m=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=yi(m),b=yi(y);if(x.kind!==b.kind||x.kind!=="string"&&x.kind!=="number")throw new qi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${b.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=yi(m),b=yi(y);if(x.kind!=="string"||b.kind!=="string")return e(d,m,y)}return this.collator?n(d,m,y,this.collator.evaluate(d)):e(d,m,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[t];return this.eachChild(m=>{d.push(m.serialize())}),d}}}const Pl=zl("==",function(t,e,n){return e===n},Wh),Ce=zl("!=",function(t,e,n){return e!==n},function(t,e,n,o){return!Wh(0,e,n,o)}),Ze=zl("<",function(t,e,n){return e<n},function(t,e,n,o){return o.compare(e,n)<0}),Ne=zl(">",function(t,e,n){return e>n},function(t,e,n,o){return o.compare(e,n)>0}),It=zl("<=",function(t,e,n){return e<=n},function(t,e,n,o){return o.compare(e,n)<=0}),on=zl(">=",function(t,e,n){return e>=n},function(t,e,n,o){return o.compare(e,n)>=0});class Bn{constructor(e,n,o,u,d,m){this.type=nn,this.number=e,this.locale=n,this.currency=o,this.unit=u,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,pt);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=n.parse(u.locale,1,nn),!d))return null;let m=null;if(u.currency&&(m=n.parse(u.currency,1,nn),!m))return null;let y=null;if(u.unit&&(y=n.parse(u.unit,1,nn),!y))return null;let x=null;if(u["min-fraction-digits"]&&(x=n.parse(u["min-fraction-digits"],1,pt),!x))return null;let b=null;return u["max-fraction-digits"]&&(b=n.parse(u["max-fraction-digits"],1,pt),!b)?null:new Bn(o,d,m,y,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class di{constructor(e){this.type=pt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Nn(o.type)} instead.`):new di(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new qi(`Expected value to be of type string or array, but found ${Nn(yi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Wn={"==":Pl,"!=":Ce,">":Ne,"<":Ze,">=":on,"<=":It,array:Ho,at:$h,boolean:Ho,case:np,coalesce:ja,collator:rc,format:kn,image:Gn,in:_c,"index-of":tp,interpolate:Zo,"interpolate-hcl":Zo,"interpolate-lab":Zo,length:di,let:Hh,literal:yu,match:kl,number:Ho,"number-format":Bn,object:Ho,slice:vc,step:Va,string:Ho,"to-boolean":Cl,"to-color":Cl,"to-number":Cl,"to-string":Cl,var:uc,within:dn};function xc(t,[e,n,o,u]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);const d=u?u.evaluate(t):1,m=Jd(e,n,o,d);if(m)throw new qi(m);return new ai(e/255*d,n/255*d,o/255*d,d)}function ip(t,e){return t in e}function Tr(t,e){const n=e[t];return n===void 0?null:n}function Ko(t){return{type:t}}Jr.register(Wn,{error:[{kind:"error"},[nn],(t,[e])=>{throw new qi(e.evaluate(t))}],typeof:[nn,[rn],(t,[e])=>Nn(yi(e.evaluate(t)))],"to-rgba":[Cr(pt,4),[qo],(t,[e])=>e.evaluate(t).toArray()],rgb:[qo,[pt,pt,pt],xc],rgba:[qo,[pt,pt,pt,pt],xc],has:{type:an,overloads:[[[nn],(t,[e])=>ip(e.evaluate(t),t.properties())],[[nn,Oa],(t,[e,n])=>ip(e.evaluate(t),n.evaluate(t))]]},get:{type:rn,overloads:[[[nn],(t,[e])=>Tr(e.evaluate(t),t.properties())],[[nn,Oa],(t,[e,n])=>Tr(e.evaluate(t),n.evaluate(t))]]},"feature-state":[rn,[nn],(t,[e])=>Tr(e.evaluate(t),t.featureState||{})],properties:[Oa,[],t=>t.properties()],"geometry-type":[nn,[],t=>t.geometryType()],id:[rn,[],t=>t.id()],zoom:[pt,[],t=>t.globals.zoom],pitch:[pt,[],t=>t.globals.pitch||0],"distance-from-center":[pt,[],t=>t.distanceFromCenter()],"heatmap-density":[pt,[],t=>t.globals.heatmapDensity||0],"line-progress":[pt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[pt,[],t=>t.globals.skyRadialProgress||0],accumulated:[rn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[pt,Ko(pt),(t,e)=>{let n=0;for(const o of e)n+=o.evaluate(t);return n}],"*":[pt,Ko(pt),(t,e)=>{let n=1;for(const o of e)n*=o.evaluate(t);return n}],"-":{type:pt,overloads:[[[pt,pt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[pt],(t,[e])=>-e.evaluate(t)]]},"/":[pt,[pt,pt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[pt,[pt,pt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[pt,[],()=>Math.LN2],pi:[pt,[],()=>Math.PI],e:[pt,[],()=>Math.E],"^":[pt,[pt,pt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[pt,[pt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))],log2:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[pt,[pt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[pt,[pt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[pt,[pt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[pt,[pt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[pt,[pt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[pt,[pt],(t,[e])=>Math.atan(e.evaluate(t))],min:[pt,Ko(pt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[pt,Ko(pt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[pt,[pt],(t,[e])=>Math.abs(e.evaluate(t))],round:[pt,[pt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[pt,[pt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[pt,[pt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[an,[nn,rn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[an,[rn],(t,[e])=>t.id()===e.value],"filter-type-==":[an,[nn],(t,[e])=>t.geometryType()===e.value],"filter-<":[an,[nn,rn],(t,[e,n])=>{const o=t.properties()[e.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[an,[rn],(t,[e])=>{const n=t.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[an,[nn,rn],(t,[e,n])=>{const o=t.properties()[e.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[an,[rn],(t,[e])=>{const n=t.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[an,[nn,rn],(t,[e,n])=>{const o=t.properties()[e.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[an,[rn],(t,[e])=>{const n=t.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[an,[nn,rn],(t,[e,n])=>{const o=t.properties()[e.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[an,[rn],(t,[e])=>{const n=t.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[an,[rn],(t,[e])=>e.value in t.properties()],"filter-has-id":[an,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[an,[Cr(nn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[an,[Cr(rn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[an,[nn,Cr(rn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[an,[nn,Cr(rn)],(t,[e,n])=>function(o,u,d,m){for(;d<=m;){const y=d+m>>1;if(u[y]===o)return!0;u[y]>o?m=y-1:d=y+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:an,overloads:[[[an,an],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Ko(an),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:an,overloads:[[[an,an],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Ko(an),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[an,[an],(t,[e])=>!e.evaluate(t)],"is-supported-script":[an,[nn],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[nn,[nn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[nn,[nn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[nn,Ko(rn),(t,e)=>e.map(n=>_u(n.evaluate(t))).join("")],"resolved-locale":[nn,[wl],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Ll=Wn;function ia(t){return{result:"success",value:t}}function Yr(t){return{result:"error",value:t}}function bs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Rn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Xo(t){return!!t.expression&&t.expression.interpolated}function xn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Qr(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function em(t){return t}function rp(t,e){const n=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",u=o||!(o||t.property!==void 0),d=t.type||(Xo(e)?"exponential":"interval");if(n&&((t=Vo({},t)).stops&&(t.stops=t.stops.map(b=>[b[0],ai.parse(b[1])])),t.default=ai.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!ep[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,y,x;if(d==="exponential")m=Rl;else if(d==="interval")m=Jo;else if(d==="categorical"){m=wc,y=Object.create(null);for(const b of t.stops)y[b[0]]=b[1];x=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);m=bc}if(o){const b={},T=[];for(let L=0;L<t.stops.length;L++){const F=t.stops[L],N=F[0].zoom;b[N]===void 0&&(b[N]={zoom:N,type:t.type,property:t.property,default:t.default,stops:[]},T.push(N)),b[N].stops.push([F[0].value,F[1]])}const M=[];for(const L of T)M.push([b[L].zoom,rp(b[L],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Zo.interpolationFactor.bind(void 0,B),zoomStops:M.map(L=>L[0]),evaluate:({zoom:L},F)=>Rl({stops:M,base:t.base},e,L).evaluate(L,F)}}if(u){const b=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Zo.interpolationFactor.bind(void 0,b),zoomStops:t.stops.map(T=>T[0]),evaluate:({zoom:T})=>m(t,e,T,y,x)}}return{kind:"source",evaluate(b,T){const M=T&&T.properties?T.properties[t.property]:void 0;return M===void 0?Fl(t.default,e.default):m(t,e,M,y,x)}}}function Fl(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function wc(t,e,n,o,u){return Fl(typeof n===u?o[n]:void 0,t.default,e.default)}function Jo(t,e,n){if(xn(n)!=="number")return Fl(t.default,e.default);const o=t.stops.length;if(o===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[o-1][0])return t.stops[o-1][1];const u=wu(t.stops.map(d=>d[0]),n);return t.stops[u][1]}function Rl(t,e,n){const o=t.base!==void 0?t.base:1;if(xn(n)!=="number")return Fl(t.default,e.default);const u=t.stops.length;if(u===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];const d=wu(t.stops.map(T=>T[0]),n),m=function(T,M,B,L){const F=L-B,N=T-B;return F===0?0:M===1?N/F:(Math.pow(M,N)-1)/(Math.pow(M,F)-1)}(n,o,t.stops[d][0],t.stops[d+1][0]),y=t.stops[d][1],x=t.stops[d+1][1];let b=bo[e.type]||em;if(t.colorSpace&&t.colorSpace!=="rgb"){const T=ep[t.colorSpace];b=(M,B)=>T.reverse(T.interpolate(T.forward(M),T.forward(B),m))}return typeof y.evaluate=="function"?{evaluate(...T){const M=y.evaluate.apply(void 0,T),B=x.evaluate.apply(void 0,T);if(M!==void 0&&B!==void 0)return b(M,B,m)}}:b(y,x,m)}function bc(t,e,n){return e.type==="color"?n=ai.parse(n):e.type==="formatted"?n=ar.fromString(n.toString()):e.type==="resolvedImage"?n=lr.fromString(n.toString()):xn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Fl(n,t.default,e.default)}class ra{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new Yd,this._defaultValue=n?function(o){return o.type==="color"&&(Qr(o.default)||Array.isArray(o.default))?new ai(0,0,0,0):o.type==="color"?ai.parse(o.default)||null:o.default===void 0?null:o.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,u,d,m,y,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,u,d,m,y,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new qi(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Ol(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ll}function oa(t,e){const n=new xu(Ll,[],e?function(u){const d={color:qo,string:nn,number:pt,enum:nn,boolean:an,formatted:bl,resolvedImage:Ua};return u.type==="array"?Cr(d[u.value]||rn,u.length):d[u.type]}(e):void 0),o=n.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ia(new ra(o,e)):Yr(n.errors)}class qa{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Tl(n.expression)}evaluateWithoutErrorHandling(e,n,o,u,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,u,d,m)}evaluate(e,n,o,u,d,m){return this._styleExpression.evaluate(e,n,o,u,d,m)}}class Tu{constructor(e,n,o,u){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Tl(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,o,u,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,u,d,m)}evaluate(e,n,o,u,d,m){return this._styleExpression.evaluate(e,n,o,u,d,m)}interpolationFactor(e,n,o){return this.interpolationType?Zo.interpolationFactor(this.interpolationType,e,n,o):0}}function As(t,e){if((t=oa(t,e)).result==="error")return t;const n=t.value.expression,o=ta(n);if(!o&&!bs(e))return Yr([new jo("","data expressions not supported")]);const u=Jn(n,["zoom","pitch","distance-from-center"]);if(!u&&!Rn(e))return Yr([new jo("","zoom expressions not supported")]);const d=sa(n);return d||u?d instanceof jo?Yr([d]):d instanceof Zo&&!Xo(e)?Yr([new jo("",'"interpolate" expressions cannot be used with this property')]):ia(d?new Tu(o?"camera":"composite",t.value,d.labels,d instanceof Zo?d.interpolation:void 0):new qa(o?"constant":"source",t.value)):Yr([new jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pr{constructor(e,n){this._parameters=e,this._specification=n,Vo(this,rp(this._parameters,this._specification))}static deserialize(e){return new pr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function sa(t){let e=null;if(t instanceof Hh)e=sa(t.result);else if(t instanceof ja){for(const n of t.args)if(e=sa(n),e)break}else(t instanceof Va||t instanceof Zo)&&t.input instanceof Jr&&t.input.name==="zoom"&&(e=t);return e instanceof jo||t.eachChild(n=>{const o=sa(n);o instanceof jo?e=o:!e&&o?e=new jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class gt{constructor(e,n,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function Fr(t){const e=t.key,n=t.value,o=t.valueSpec||{},u=t.objectElementValidators||{},d=t.style,m=t.styleSpec;let y=[];const x=xn(n);if(x!=="object")return[new gt(e,n,`object expected, ${x} found`)];for(const b in n){const T=b.split(".")[0],M=o[T]||o["*"];let B;u[T]?B=u[T]:o[T]?B=Mi:u["*"]?B=u["*"]:o["*"]&&(B=Mi),B?y=y.concat(B({key:(e&&`${e}.`)+b,value:n[b],valueSpec:M,style:d,styleSpec:m,object:n,objectKey:b},n)):y.push(new gt(e,n[b],`unknown property "${b}"`))}for(const b in o)u[b]||o[b].required&&o[b].default===void 0&&n[b]===void 0&&y.push(new gt(e,n,`missing required property "${b}"`));return y}function Kh(t){const e=t.value,n=t.valueSpec,o=t.style,u=t.styleSpec,d=t.key,m=t.arrayElementValidator||Mi;if(xn(e)!=="array")return[new gt(d,e,`array expected, ${xn(e)} found`)];if(n.length&&e.length!==n.length)return[new gt(d,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new gt(d,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let y={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};u.$version<7&&(y.function=n.function),xn(n.value)==="object"&&(y=n.value);let x=[];for(let b=0;b<e.length;b++)x=x.concat(m({array:e,arrayIndex:b,value:e[b],valueSpec:y,style:o,styleSpec:u,key:`${d}[${b}]`}));return x}function Su(t){const e=t.key,n=t.value,o=t.valueSpec;let u=xn(n);if(u==="number"&&n!=n&&(u="NaN"),u!=="number")return[new gt(e,n,`number expected, ${u} found`)];if("minimum"in o){let d=o.minimum;if(xn(o.minimum)==="array"&&(d=o.minimum[t.arrayIndex]),n<d)return[new gt(e,n,`${n} is less than the minimum value ${d}`)]}if("maximum"in o){let d=o.maximum;if(xn(o.maximum)==="array"&&(d=o.maximum[t.arrayIndex]),n>d)return[new gt(e,n,`${n} is greater than the maximum value ${d}`)]}return[]}function Ul(t){const e=t.valueSpec,n=ui(t.value.type);let o,u,d,m={};const y=n!=="categorical"&&t.value.property===void 0,x=!y,b=xn(t.value.stops)==="array"&&xn(t.value.stops[0])==="array"&&xn(t.value.stops[0][0])==="object",T=Fr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(L){if(n==="identity")return[new gt(L.key,L.value,'identity function may not have a "stops" property')];let F=[];const N=L.value;return F=F.concat(Kh({key:L.key,value:N,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:M})),xn(N)==="array"&&N.length===0&&F.push(new gt(L.key,N,"array must have at least one stop")),F},default:function(L){return Mi({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return n==="identity"&&y&&T.push(new gt(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||T.push(new gt(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!Xo(t.valueSpec)&&T.push(new gt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(x&&!bs(t.valueSpec)?T.push(new gt(t.key,t.value,"property functions not supported")):y&&!Rn(t.valueSpec)&&T.push(new gt(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!b||t.value.property!==void 0||T.push(new gt(t.key,t.value,'"property" property is required')),T;function M(L){let F=[];const N=L.value,H=L.key;if(xn(N)!=="array")return[new gt(H,N,`array expected, ${xn(N)} found`)];if(N.length!==2)return[new gt(H,N,`array length 2 expected, length ${N.length} found`)];if(b){if(xn(N[0])!=="object")return[new gt(H,N,`object expected, ${xn(N[0])} found`)];if(N[0].zoom===void 0)return[new gt(H,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new gt(H,N,"object stop key must have value")];const re=ui(N[0].zoom);if(typeof re!="number")return[new gt(H,N[0].zoom,"stop zoom values must be numbers")];if(d&&d>re)return[new gt(H,N[0].zoom,"stop zoom values must appear in ascending order")];re!==d&&(d=re,u=void 0,m={}),F=F.concat(Fr({key:`${H}[0]`,value:N[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Su,value:B}}))}else F=F.concat(B({key:`${H}[0]`,value:N[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},N));return Ol(ws(N[1]))?F.concat([new gt(`${H}[1]`,N[1],"expressions are not allowed in function stops.")]):F.concat(Mi({key:`${H}[1]`,value:N[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function B(L,F){const N=xn(L.value),H=ui(L.value),re=L.value!==null?L.value:F;if(o){if(N!==o)return[new gt(L.key,re,`${N} stop domain type must match previous stop domain type ${o}`)]}else o=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new gt(L.key,re,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&n!=="categorical"){let ce=`number expected, ${N} found`;return bs(e)&&n===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gt(L.key,re,ce)]}return n!=="categorical"||N!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?n!=="categorical"&&N==="number"&&typeof H=="number"&&typeof u=="number"&&u!==void 0&&H<u?[new gt(L.key,re,"stop domain values must appear in ascending order")]:(u=H,n==="categorical"&&H in m?[new gt(L.key,re,"stop domain values must be unique")]:(m[H]=!0,[])):[new gt(L.key,re,`integer expected, found ${String(H)}`)]}}function Ao(t){const e=(t.expressionContext==="property"?As:oa)(ws(t.value),t.valueSpec);if(e.result==="error")return e.value.map(o=>new gt(`${t.key}${o.key}`,t.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new gt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Tl(n))return[new gt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return op(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Jn(n,["zoom","feature-state"]))return[new gt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!ta(n))return[new gt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function op(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)n.delete(u);if(n.size===0)return[];const o=[];return t instanceof Jr&&n.has(t.name)?[new gt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{o.push(...op(u,e))}),o)}function Iu(t){const e=t.key,n=t.value,o=t.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(ui(n))===-1&&u.push(new gt(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(ui(n))===-1&&u.push(new gt(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Xh(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Xh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ac(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xh(t)||(t=Nl(t));const n=t;let o=!0;try{o=function(b){if(!Es(b))return b;let T=ws(b);return xi(T),T=vi(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const u=Ue[`filter_${e}`],d=oa(o,u);let m=null;if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));m=(b,T,M)=>d.value.evaluate(b,T,{},M);let y=null,x=null;if(o!==n){const b=oa(n,u);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));y=(T,M,B,L,F)=>b.value.evaluate(T,M,{},B,void 0,void 0,L,F),x=!ta(b.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:sp(o),needFeature:!!x}}function vi(t){if(!Array.isArray(t))return t;const e=function(n){if(Rr.has(n[0])){for(let o=1;o<n.length;o++)if(Es(n[o]))return!0}return n}(t);return e===!0?e:e.map(n=>vi(n))}function xi(t){let e=!1;const n=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||Es(t[o]),n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Es(t[1]);for(let o=2;o<t.length-1;o+=2)n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Es(t[1]);for(let o=1;o<t.length-1;o+=2)n.push(t[o+1])}e&&(t.length=0,t.push("any",...n));for(let o=1;o<t.length;o++)xi(t[o])}function Es(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Es(t[n]))return!0;return!1}const Rr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Mu(t,e){return t<e?-1:t>e?1:0}function sp(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(sp(t[e]))return!0;return!1}function Nl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Ha(t[1],t[2],"=="):e==="!="?aa(Ha(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ha(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Nl))):e==="all"?["all"].concat(t.slice(1).map(Nl)):e==="none"?["all"].concat(t.slice(1).map(Nl).map(aa)):e==="in"?Ec(t[1],t.slice(2)):e==="!in"?aa(Ec(t[1],t.slice(2))):e==="has"?Cs(t[1]):e==="!has"?aa(Cs(t[1])):e!=="within"||t;var n}function Ha(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Ec(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Mu)]]:["filter-in-small",t,["literal",e]]}}function Cs(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function aa(t){return["!",t]}function Ts(t){return Xh(ws(t.value))?Ao(Vo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Bu(t)}function Bu(t){const e=t.value,n=t.key;if(xn(e)!=="array")return[new gt(n,e,`array expected, ${xn(e)} found`)];const o=t.styleSpec;let u,d=[];if(e.length<1)return[new gt(n,e,"filter array must have at least 1 element")];switch(d=d.concat(Iu({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:t.style,styleSpec:t.styleSpec})),ui(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ui(e[1])==="$type"&&d.push(new gt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new gt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=xn(e[1]),u!=="string"&&d.push(new gt(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let m=2;m<e.length;m++)u=xn(e[m]),ui(e[1])==="$type"?d=d.concat(Iu({key:`${n}[${m}]`,value:e[m],valueSpec:o.geometry_type,style:t.style,styleSpec:t.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new gt(`${n}[${m}]`,e[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)d=d.concat(Bu({key:`${n}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=xn(e[1]),e.length!==2?d.push(new gt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new gt(`${n}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=xn(e[1]),e.length!==2?d.push(new gt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&d.push(new gt(`${n}[1]`,e[1],`object expected, ${u} found`))}return d}function $a(t,e){const n=t.key,o=t.style,u=t.styleSpec,d=t.value,m=t.objectKey,y=u[`${e}_${t.layerType}`];if(!y)return[];const x=m.match(/^(.*)-transition$/);if(e==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return Mi({key:n,value:d,valueSpec:u.transition,style:o,styleSpec:u});const b=t.valueSpec||y[m];if(!b)return[new gt(n,d,`unknown property "${m}"`)];let T;if(xn(d)==="string"&&bs(b)&&!b.tokens&&(T=/^{([^}]+)}$/.exec(d)))return[new gt(n,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const M=[];return t.layerType==="symbol"&&(m==="text-field"&&o&&!o.glyphs&&M.push(new gt(n,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Qr(ws(d))&&ui(d.type)==="identity"&&M.push(new gt(n,d,'"text-font" does not support identity functions'))),M.concat(Mi({key:t.key,value:d,valueSpec:b,style:o,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:m}))}function Cc(t){return $a(t,"paint")}function ap(t){return $a(t,"layout")}function Jh(t){let e=[];const n=t.value,o=t.key,u=t.style,d=t.styleSpec;n.type||n.ref||e.push(new gt(o,n,'either "type" or "ref" is required'));let m=ui(n.type);const y=ui(n.ref);if(n.id){const x=ui(n.id);for(let b=0;b<t.arrayIndex;b++){const T=u.layers[b];ui(T.id)===x&&e.push(new gt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${T.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(b=>{b in n&&e.push(new gt(o,n[b],`"${b}" is prohibited for ref layers`))}),u.layers.forEach(b=>{ui(b.id)===y&&(x=b)}),x?x.ref?e.push(new gt(o,n.ref,"ref cannot reference another ref layer")):m=ui(x.type):typeof y=="string"&&e.push(new gt(o,n.ref,`ref layer "${y}" not found`))}else if(m!=="background"&&m!=="sky")if(n.source){const x=u.sources&&u.sources[n.source],b=x&&ui(x.type);x?b==="vector"&&m==="raster"?e.push(new gt(o,n.source,`layer "${n.id}" requires a raster source`)):b==="raster"&&m!=="raster"?e.push(new gt(o,n.source,`layer "${n.id}" requires a vector source`)):b!=="vector"||n["source-layer"]?b==="raster-dem"&&m!=="hillshade"?e.push(new gt(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||b==="geojson"&&x.lineMetrics||e.push(new gt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new gt(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new gt(o,n.source,`source "${n.source}" not found`))}else e.push(new gt(o,n,'missing required property "source"'));return e=e.concat(Fr({key:o,value:n,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Mi({key:`${o}.type`,value:n.type,valueSpec:d.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:x=>Ts(Vo({layerType:m},x)),layout:x=>Fr({layer:n,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>ap(Vo({layerType:m},b))}}),paint:x=>Fr({layer:n,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>Cc(Vo({layerType:m},b))}})}})),e}function Za(t){const e=t.value,n=t.key,o=xn(e);return o!=="string"?[new gt(n,e,`string expected, ${o} found`)]:[]}const lp={promoteId:function({key:t,value:e}){if(xn(e)==="string")return Za({key:t,value:e});{const n=[];for(const o in e)n.push(...Za({key:`${t}.${o}`,value:e[o]}));return n}}};function Wa(t){const e=t.value,n=t.key,o=t.styleSpec,u=t.style;if(!e.type)return[new gt(n,e,'"type" is required')];const d=ui(e.type);let m;switch(d){case"vector":case"raster":case"raster-dem":return m=Fr({key:n,value:e,valueSpec:o[`source_${d.replace("-","_")}`],style:t.style,styleSpec:o,objectElementValidators:lp}),m;case"geojson":if(m=Fr({key:n,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,objectElementValidators:lp}),e.cluster)for(const y in e.clusterProperties){const[x,b]=e.clusterProperties[y],T=typeof x=="string"?[x,["accumulated"],["get",y]]:x;m.push(...Ao({key:`${n}.${y}.map`,value:b,expressionContext:"cluster-map"})),m.push(...Ao({key:`${n}.${y}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return m;case"video":return Fr({key:n,value:e,valueSpec:o.source_video,style:u,styleSpec:o});case"image":return Fr({key:n,value:e,valueSpec:o.source_image,style:u,styleSpec:o});case"canvas":return[new gt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Iu({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:o})}}function Ss(t){const e=t.value,n=t.styleSpec,o=n.light,u=t.style;let d=[];const m=xn(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new gt("light",e,`object expected, ${m} found`)]),d;for(const y in e){const x=y.match(/^(.*)-transition$/);d=d.concat(x&&o[x[1]]&&o[x[1]].transition?Mi({key:y,value:e[y],valueSpec:n.transition,style:u,styleSpec:n}):o[y]?Mi({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:n}):[new gt(y,e[y],`unknown property "${y}"`)])}return d}function Tc(t){const e=t.value,n=t.key,o=t.style,u=t.styleSpec,d=u.terrain;let m=[];const y=xn(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new gt("terrain",e,`object expected, ${y} found`)]),m;for(const x in e){const b=x.match(/^(.*)-transition$/);m=m.concat(b&&d[b[1]]&&d[b[1]].transition?Mi({key:x,value:e[x],valueSpec:u.transition,style:o,styleSpec:u}):d[x]?Mi({key:x,value:e[x],valueSpec:d[x],style:o,styleSpec:u}):[new gt(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=o.sources&&o.sources[e.source],b=x&&ui(x.type);x?b!=="raster-dem"&&m.push(new gt(n,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):m.push(new gt(n,e.source,`source "${e.source}" not found`))}else m.push(new gt(n,e,'terrain is missing required property "source"'));return m}function W(t){const e=t.value,n=t.style,o=t.styleSpec,u=o.fog;let d=[];const m=xn(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new gt("fog",e,`object expected, ${m} found`)]),d;for(const y in e){const x=y.match(/^(.*)-transition$/);d=d.concat(x&&u[x[1]]&&u[x[1]].transition?Mi({key:y,value:e[y],valueSpec:o.transition,style:n,styleSpec:o}):u[y]?Mi({key:y,value:e[y],valueSpec:u[y],style:n,styleSpec:o}):[new gt(y,e[y],`unknown property "${y}"`)])}return d}const la={"*":()=>[],array:Kh,boolean:function(t){const e=t.value,n=t.key,o=xn(e);return o!=="boolean"?[new gt(n,e,`boolean expected, ${o} found`)]:[]},number:Su,color:function(t){const e=t.key,n=t.value,o=xn(n);return o!=="string"?[new gt(e,n,`color expected, ${o} found`)]:Ys(n)===null?[new gt(e,n,`color expected, "${n}" found`)]:[]},enum:Iu,filter:Ts,function:Ul,layer:Jh,object:Fr,source:Wa,light:Ss,terrain:Tc,fog:W,string:Za,formatted:function(t){return Za(t).length===0?[]:Ao(t)},resolvedImage:function(t){return Za(t).length===0?[]:Ao(t)},projection:function(t){const e=t.value,n=t.styleSpec,o=n.projection,u=t.style;let d=[];const m=xn(e);if(m==="object")for(const y in e)d=d.concat(Mi({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:n}));else m!=="string"&&(d=d.concat([new gt("projection",e,`object or string expected, ${m} found`)]));return d}};function Mi(t){const e=t.value,n=t.valueSpec,o=t.styleSpec;return n.expression&&Qr(ui(e))?Ul(t):n.expression&&Ol(ws(e))?Ao(t):n.type&&la[n.type]?la[n.type](t):Fr(Vo({},t,{valueSpec:n.type?o[n.type]:n}))}function Sr(t){const e=t.value,n=t.key,o=Za(t);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new gt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new gt(n,e,'"glyphs" url must include a "{range}" token'))),o}function yn(t,e=Ue){return Is(Mi({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Sr,"*":()=>[]}}))}const tm=t=>Is(Cc(t)),nm=t=>Is(ap(t));function Is(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Ms(t,e){let n=!1;if(e&&e.length)for(const o of e)t.fire(new Js(new Error(o.message))),n=!0;return n}var Gl=Yo;function Yo(t,e,n){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var d=0;d<this.d*this.d;d++){var m=u[3+d],y=u[3+d+1];o.push(m===y?null:u.subarray(m,y))}var x=u[3+o.length+1];this.keys=u.subarray(u[3+o.length],x),this.bboxes=u.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var b=0;b<this.d*this.d;b++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var T=n/e*t;this.min=-T,this.max=t+T}Yo.prototype.insert=function(t,e,n,o,u){this._forEachCell(e,n,o,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u)},Yo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Yo.prototype._insertCell=function(t,e,n,o,u,d){this.cells[u].push(d)},Yo.prototype.query=function(t,e,n,o,u){var d=this.min,m=this.max;if(t<=d&&e<=d&&m<=n&&m<=o&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,n,o,this._queryCell,y,{},u),y},Yo.prototype._queryCell=function(t,e,n,o,u,d,m,y){var x=this.cells[u];if(x!==null)for(var b=this.keys,T=this.bboxes,M=0;M<x.length;M++){var B=x[M];if(m[B]===void 0){var L=4*B;(y?y(T[L+0],T[L+1],T[L+2],T[L+3]):t<=T[L+2]&&e<=T[L+3]&&n>=T[L+0]&&o>=T[L+1])?(m[B]=!0,d.push(b[B])):m[B]=!1}}},Yo.prototype._forEachCell=function(t,e,n,o,u,d,m,y){for(var x=this._convertToCellCoord(t),b=this._convertToCellCoord(e),T=this._convertToCellCoord(n),M=this._convertToCellCoord(o),B=x;B<=T;B++)for(var L=b;L<=M;L++){var F=this.d*L+B;if((!y||y(this._convertFromCellCoord(B),this._convertFromCellCoord(L),this._convertFromCellCoord(B+1),this._convertFromCellCoord(L+1)))&&u.call(this,t,e,n,o,F,d,m,y))return}},Yo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Yo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Yo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var d=e,m=0;m<t.length;m++){var y=t[m];u[3+m]=d,u.set(y,d),d+=y.length}return u[3+t.length]=d,u.set(this.keys,d),u[3+t.length+1]=d+=this.keys.length,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer};const Sc={};function vt(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Sc[e]={klass:t,omit:n.omit||[]}}vt(Object,"Object"),Gl.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Gl.deserialize=function(t){return new Gl(t.buffer)},Object.defineProperty(Gl,"name",{value:"Grid"}),vt(Gl,"Grid"),vt(ai,"Color"),vt(Error,"Error"),vt(za,"AJAXError"),vt(lr,"ResolvedImage"),vt(pr,"StylePropertyFunction"),vt(ra,"StyleExpression",{omit:["_evaluator"]}),vt(Tu,"ZoomDependentExpression"),vt(qa,"ZoomConstantExpression"),vt(Jr,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ll)Sc[Ll[t]._classRegistryKey]||vt(Ll[t],`Expression${t}`);function up(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Qo(t){return q.ImageBitmap&&t instanceof q.ImageBitmap}function Du(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(up(t)||Qo(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof q.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const o of t)n.push(Du(o,e));return n}if(typeof t=="object"){const n=t.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const u=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const d in t)t.hasOwnProperty(d)&&(Sc[o].omit.indexOf(d)>=0||(u[d]=Du(t[d],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(u.$name=o),u}throw new Error("can't serialize object of type "+typeof t)}function ua(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||up(t)||Qo(t)||ArrayBuffer.isView(t)||t instanceof q.ImageData)return t;if(Array.isArray(t))return t.map(ua);if(typeof t=="object"){const e=t.$name||"Object",{klass:n}=Sc[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const o=Object.create(n.prototype);for(const u of Object.keys(t))u!=="$name"&&(o[u]=ua(t[u]));return o}throw new Error("can't deserialize object of type "+typeof t)}class cp{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const hp=t=>t>=1536&&t<=1791,ku=t=>t>=1872&&t<=1919,es=t=>t>=2208&&t<=2303,Yh=t=>t>=11904&&t<=12031,dp=t=>t>=12032&&t<=12255,Qh=t=>t>=12272&&t<=12287,zu=t=>t>=12288&&t<=12351,Ic=t=>t>=12352&&t<=12447,Eo=t=>t>=12448&&t<=12543,Mc=t=>t>=12544&&t<=12591,Bc=t=>t>=12704&&t<=12735,eo=t=>t>=12736&&t<=12783,pp=t=>t>=12784&&t<=12799,ed=t=>t>=12800&&t<=13055,fp=t=>t>=13056&&t<=13311,mp=t=>t>=13312&&t<=19903,td=t=>t>=19968&&t<=40959,Pu=t=>t>=40960&&t<=42127,nd=t=>t>=42128&&t<=42191,_p=t=>t>=44032&&t<=55215,gp=t=>t>=63744&&t<=64255,Lu=t=>t>=64336&&t<=65023,Vl=t=>t>=65040&&t<=65055,Ka=t=>t>=65072&&t<=65103,Fu=t=>t>=65104&&t<=65135,c=t=>t>=65136&&t<=65279,i=t=>t>=65280&&t<=65519;function a(t){for(const e of t)if(v(e.charCodeAt(0)))return!0;return!1}function p(t){for(const e of t)if(!g(e.charCodeAt(0)))return!1;return!0}function g(t){return!(hp(t)||ku(t)||es(t)||Lu(t)||c(t))}function v(t){return!(t!==746&&t!==747&&(t<4352||!(Bc(t)||Mc(t)||Ka(t)&&!(t>=65097&&t<=65103)||gp(t)||fp(t)||Yh(t)||eo(t)||!(!zu(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||mp(t)||td(t)||ed(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||_p(t)||Ic(t)||Qh(t)||(e=>e>=12688&&e<=12703)(t)||dp(t)||pp(t)||Eo(t)&&t!==12540||!(!i(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Fu(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||Vl(t)||(e=>e>=19904&&e<=19967)(t)||Pu(t)||nd(t))))}function A(t){return!(v(t)||function(e){return!!((n=>n>=128&&n<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(n=>n>=8192&&n<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&e!==9251||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||zu(e)||Eo(e)||(n=>n>=57344&&n<=63743)(e)||Ka(e)||Fu(e)||i(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function S(t){return t>=1424&&t<=2303||Lu(t)||c(t)}function I(t,e){return!(!e&&S(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=>n>=6016&&n<=6143)(t))}function k(t){for(const e of t)if(S(e.charCodeAt(0)))return!0;return!1}const P="deferred",U="loading",j="loaded";let J=null,K="unavailable",Q=null;const Z=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(K="error"),J&&J(t)};function $(){te.fire(new Tn("pluginStateChange",{pluginStatus:K,pluginURL:Q}))}const te=new xs,X=function(){return K},le=function(){if(K!==P||!Q)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");K=U,$(),Q&&Go({url:Q},t=>{t?Z(t):(K=j,$())})},ue={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>K===j||ue.applyArabicShaping!=null,isLoading:()=>K===U,setState(t){K=t.pluginStatus,Q=t.pluginURL},isParsed:()=>ue.applyArabicShaping!=null&&ue.processBidirectionalText!=null&&ue.processStyledBidirectionalText!=null,getPluginURL:()=>Q};class oe{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cp,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,o){for(const u of n)if(!I(u.charCodeAt(0),o))return!1;return!0}(e,ue.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class pe{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,u){if(Qr(o))return new pr(o,u);if(Ol(o)){const d=As(o,u);if(d.result==="error")throw new Error(d.value.map(m=>`${m.key}: ${m.message}`).join(", "));return d.value}{let d=o;return typeof o=="string"&&u.type==="color"&&(d=ai.parse(o)),{kind:"constant",evaluate:()=>d}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class we{constructor(e){this.property=e,this.value=new pe(e,void 0)}transitioned(e,n){return new De(this.property,this.value,n,Bt({},e.transition,this.transition),e.now)}untransitioned(){return new De(this.property,this.value,null,{},0)}}class Re{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Pr(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new we(this._values[e].property)),this._values[e].value=new pe(this._values[e].property,n===null?void 0:Pr(n))}getTransition(e){return Pr(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new we(this._values[e].property)),this._values[e].transition=Pr(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const o=new Ye(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,n._values[u]);return o}untransitioned(){const e=new Ye(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class De{constructor(e,n,o,u,d){const m=u.delay||0,y=u.duration||0;d=d||0,this.property=e,this.value=n,this.begin=d+m,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const u=e.now||0,d=this.value.possiblyEvaluate(e,n,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return m.possiblyEvaluate(e,n,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,n,o),d,Oo(y))}}return d}}class Ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const u=new He(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,n,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class xe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Pr(this._values[e].value)}setValue(e,n){this._values[e]=new pe(this._values[e].property,n===null?void 0:Pr(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const u=new He(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,n,o);return u}}class qe{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,u){return this.property.evaluate(this.value,this.parameters,e,n,o,u)}}class He{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ie{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){const u=bo[this.specification.type];return u?u(e,n,o):e}}class ye{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,u){return new qe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,u)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new qe(this,{kind:"constant",value:void 0},e.parameters);const u=bo[this.specification.type];return u?new qe(this,{kind:"constant",value:u(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,u,d,m){return e.kind==="constant"?e.value:e.evaluate(n,o,u,d,m)}}class dt extends ye{possiblyEvaluate(e,n,o,u){if(e.value===void 0)return new qe(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const d=e.expression.evaluate(n,null,{},o,u),m=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(m,m,m,n);return new qe(this,{kind:"constant",value:y},n)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new qe(this,{kind:"constant",value:d},n)}return new qe(this,e.expression,n)}evaluate(e,n,o,u,d,m){if(e.kind==="source"){const y=e.evaluate(n,o,u,d,m);return this._calculate(y,y,y,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,u),e.evaluate({zoom:Math.floor(n.zoom)},o,u),e.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):e.value}_calculate(e,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:n,other:o}:{from:o,to:n,other:e}}interpolate(e){return e}}class ot{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(n,null,{},o,u);return this._calculate(d,d,d,n)}return this._calculate(e.expression.evaluate(new oe(Math.floor(n.zoom-1),n)),e.expression.evaluate(new oe(Math.floor(n.zoom),n)),e.expression.evaluate(new oe(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class lt{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,u){return!!e.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class st{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new oe(0,{});for(const o in e){const u=e[o];u.specification.overridable&&this.overridableProperties.push(o);const d=this.defaultPropertyValues[o]=new pe(u,void 0),m=this.defaultTransitionablePropertyValues[o]=new we(u);this.defaultTransitioningPropertyValues[o]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate(n)}}}function Et(t,e){return 256*(t=cn(Math.floor(t),0,255))+cn(Math.floor(e),0,255)}vt(ye,"DataDrivenProperty"),vt(Ie,"DataConstantProperty"),vt(dt,"CrossFadedDataDrivenProperty"),vt(ot,"CrossFadedProperty"),vt(lt,"ColorRampProperty");const Ut={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Lt{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class St{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function at(t,e=1){let n=0,o=0;return{members:t.map(u=>{const d=Ut[u.type].BYTES_PER_ELEMENT,m=n=Zt(n,Math.max(e,d)),y=u.components||1;return o=Math.max(o,d),n+=d*y,{name:u.name,type:u.type,components:y,offset:m}}),size:Zt(n,Math.max(o,e)),alignment:e}}function Zt(t,e){return Math.ceil(t/e)*e}class Yt extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=o,e}}Yt.prototype.bytesPerElement=4,vt(Yt,"StructArrayLayout2i4");class Dn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const d=3*e;return this.int16[d+0]=n,this.int16[d+1]=o,this.int16[d+2]=u,e}}Dn.prototype.bytesPerElement=6,vt(Dn,"StructArrayLayout3i6");class Ln extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,u)}emplace(e,n,o,u,d){const m=4*e;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=d,e}}Ln.prototype.bytesPerElement=8,vt(Ln,"StructArrayLayout4i8");class En extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,d,m,y)}emplace(e,n,o,u,d,m,y,x){const b=6*e,T=12*e,M=3*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.uint8[T+4]=u,this.uint8[T+5]=d,this.uint8[T+6]=m,this.uint8[T+7]=y,this.float32[M+2]=x,e}}En.prototype.bytesPerElement=12,vt(En,"StructArrayLayout2i4ub1f12");class wi extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,u)}emplace(e,n,o,u,d){const m=4*e;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=d,e}}wi.prototype.bytesPerElement=16,vt(wi,"StructArrayLayout4f16");class Ji extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m,y,x,b,T){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,o,u,d,m,y,x,b,T)}emplace(e,n,o,u,d,m,y,x,b,T,M){const B=10*e;return this.uint16[B+0]=n,this.uint16[B+1]=o,this.uint16[B+2]=u,this.uint16[B+3]=d,this.uint16[B+4]=m,this.uint16[B+5]=y,this.uint16[B+6]=x,this.uint16[B+7]=b,this.uint16[B+8]=T,this.uint16[B+9]=M,e}}Ji.prototype.bytesPerElement=20,vt(Ji,"StructArrayLayout10ui20");class Co extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m,y,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,u,d,m,y,x)}emplace(e,n,o,u,d,m,y,x,b){const T=8*e;return this.uint16[T+0]=n,this.uint16[T+1]=o,this.uint16[T+2]=u,this.uint16[T+3]=d,this.uint16[T+4]=m,this.uint16[T+5]=y,this.uint16[T+6]=x,this.uint16[T+7]=b,e}}Co.prototype.bytesPerElement=16,vt(Co,"StructArrayLayout8ui16");class Fn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,u,d,m)}emplace(e,n,o,u,d,m,y){const x=6*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=d,this.int16[x+4]=m,this.int16[x+5]=y,e}}Fn.prototype.bytesPerElement=12,vt(Fn,"StructArrayLayout6i12");class ti extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m,y,x,b,T,M,B){const L=this.length;return this.resize(L+1),this.emplace(L,e,n,o,u,d,m,y,x,b,T,M,B)}emplace(e,n,o,u,d,m,y,x,b,T,M,B,L){const F=12*e;return this.int16[F+0]=n,this.int16[F+1]=o,this.int16[F+2]=u,this.int16[F+3]=d,this.uint16[F+4]=m,this.uint16[F+5]=y,this.uint16[F+6]=x,this.uint16[F+7]=b,this.int16[F+8]=T,this.int16[F+9]=M,this.int16[F+10]=B,this.int16[F+11]=L,e}}ti.prototype.bytesPerElement=24,vt(ti,"StructArrayLayout4i4ui4i24");class Cn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,u,d,m)}emplace(e,n,o,u,d,m,y){const x=10*e,b=5*e;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=u,this.float32[b+2]=d,this.float32[b+3]=m,this.float32[b+4]=y,e}}Cn.prototype.bytesPerElement=20,vt(Cn,"StructArrayLayout3i3f20");class ci extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}ci.prototype.bytesPerElement=4,vt(ci,"StructArrayLayout1ul4");class Yi extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m,y,x,b,T,M,B,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,u,d,m,y,x,b,T,M,B,L)}emplace(e,n,o,u,d,m,y,x,b,T,M,B,L,F){const N=20*e,H=10*e;return this.int16[N+0]=n,this.int16[N+1]=o,this.int16[N+2]=u,this.int16[N+3]=d,this.int16[N+4]=m,this.float32[H+3]=y,this.float32[H+4]=x,this.float32[H+5]=b,this.float32[H+6]=T,this.int16[N+14]=M,this.uint32[H+8]=B,this.uint16[N+18]=L,this.uint16[N+19]=F,e}}Yi.prototype.bytesPerElement=40,vt(Yi,"StructArrayLayout5i4f1i1ul2ui40");class On extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,d,m,y)}emplace(e,n,o,u,d,m,y,x){const b=8*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+4]=d,this.int16[b+5]=m,this.int16[b+6]=y,this.int16[b+7]=x,e}}On.prototype.bytesPerElement=16,vt(On,"StructArrayLayout3i2i2i16");class Ir extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,u,d)}emplace(e,n,o,u,d,m){const y=4*e,x=8*e;return this.float32[y+0]=n,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=d,this.int16[x+7]=m,e}}Ir.prototype.bytesPerElement=16,vt(Ir,"StructArrayLayout2f1f2i16");class Bs extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,u)}emplace(e,n,o,u,d){const m=12*e,y=3*e;return this.uint8[m+0]=n,this.uint8[m+1]=o,this.float32[y+1]=u,this.float32[y+2]=d,e}}Bs.prototype.bytesPerElement=12,vt(Bs,"StructArrayLayout2ub2f12");class to extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const d=3*e;return this.float32[d+0]=n,this.float32[d+1]=o,this.float32[d+2]=u,e}}to.prototype.bytesPerElement=12,vt(to,"StructArrayLayout3f12");class Hi extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=o,this.uint16[d+2]=u,e}}Hi.prototype.bytesPerElement=6,vt(Hi,"StructArrayLayout3ui6");class jl extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m,y,x,b,T,M,B,L,F,N,H,re,ce,ie,ae,me){const de=this.length;return this.resize(de+1),this.emplace(de,e,n,o,u,d,m,y,x,b,T,M,B,L,F,N,H,re,ce,ie,ae,me)}emplace(e,n,o,u,d,m,y,x,b,T,M,B,L,F,N,H,re,ce,ie,ae,me,de){const Fe=30*e,ze=15*e,Ge=60*e;return this.int16[Fe+0]=n,this.int16[Fe+1]=o,this.int16[Fe+2]=u,this.float32[ze+2]=d,this.float32[ze+3]=m,this.uint16[Fe+8]=y,this.uint16[Fe+9]=x,this.uint32[ze+5]=b,this.uint32[ze+6]=T,this.uint32[ze+7]=M,this.uint16[Fe+16]=B,this.uint16[Fe+17]=L,this.uint16[Fe+18]=F,this.float32[ze+10]=N,this.float32[ze+11]=H,this.uint8[Ge+48]=re,this.uint8[Ge+49]=ce,this.uint8[Ge+50]=ie,this.uint32[ze+13]=ae,this.int16[Fe+28]=me,this.uint8[Ge+58]=de,e}}jl.prototype.bytesPerElement=60,vt(jl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ts extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d,m,y,x,b,T,M,B,L,F,N,H,re,ce,ie,ae,me,de,Fe,ze,Ge,nt,Oe,$e,We,Xe){const rt=this.length;return this.resize(rt+1),this.emplace(rt,e,n,o,u,d,m,y,x,b,T,M,B,L,F,N,H,re,ce,ie,ae,me,de,Fe,ze,Ge,nt,Oe,$e,We,Xe)}emplace(e,n,o,u,d,m,y,x,b,T,M,B,L,F,N,H,re,ce,ie,ae,me,de,Fe,ze,Ge,nt,Oe,$e,We,Xe,rt){const Ve=38*e,At=19*e;return this.int16[Ve+0]=n,this.int16[Ve+1]=o,this.int16[Ve+2]=u,this.float32[At+2]=d,this.float32[At+3]=m,this.int16[Ve+8]=y,this.int16[Ve+9]=x,this.int16[Ve+10]=b,this.int16[Ve+11]=T,this.int16[Ve+12]=M,this.int16[Ve+13]=B,this.uint16[Ve+14]=L,this.uint16[Ve+15]=F,this.uint16[Ve+16]=N,this.uint16[Ve+17]=H,this.uint16[Ve+18]=re,this.uint16[Ve+19]=ce,this.uint16[Ve+20]=ie,this.uint16[Ve+21]=ae,this.uint16[Ve+22]=me,this.uint16[Ve+23]=de,this.uint16[Ve+24]=Fe,this.uint16[Ve+25]=ze,this.uint16[Ve+26]=Ge,this.uint16[Ve+27]=nt,this.uint16[Ve+28]=Oe,this.uint32[At+15]=$e,this.float32[At+16]=We,this.float32[At+17]=Xe,this.float32[At+18]=rt,e}}ts.prototype.bytesPerElement=76,vt(ts,"StructArrayLayout3i2f6i15ui1ul3f76");class Ht extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Ht.prototype.bytesPerElement=4,vt(Ht,"StructArrayLayout1f4");class ns extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,o,u,d)}emplace(e,n,o,u,d,m){const y=5*e;return this.float32[y+0]=n,this.float32[y+1]=o,this.float32[y+2]=u,this.float32[y+3]=d,this.float32[y+4]=m,e}}ns.prototype.bytesPerElement=20,vt(ns,"StructArrayLayout5f20");class ca extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,u)}emplace(e,n,o,u,d){const m=6*e;return this.uint32[3*e+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=u,this.uint16[m+4]=d,e}}ca.prototype.bytesPerElement=12,vt(ca,"StructArrayLayout1ul3ui12");class fr extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,e}}fr.prototype.bytesPerElement=4,vt(fr,"StructArrayLayout2ui4");class Dc extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Dc.prototype.bytesPerElement=2,vt(Dc,"StructArrayLayout1ui2");class yp extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=o,e}}yp.prototype.bytesPerElement=8,vt(yp,"StructArrayLayout2f8");class ng extends Lt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ng.prototype.size=12;class To extends Fn{get(e){return new ng(this,e)}}vt(To,"FillExtrusionExtArray");class ig extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ig.prototype.size=40;class kc extends Yi{get(e){return new ig(this,e)}}vt(kc,"CollisionBoxArray");class vp extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}vp.prototype.size=60;class im extends jl{get(e){return new vp(this,e)}}vt(im,"PlacedSymbolArray");class rm extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}rm.prototype.size=76;class no extends ts{get(e){return new rm(this,e)}}vt(no,"SymbolInstanceArray");class Xa extends Ht{getoffsetX(e){return this.float32[1*e+0]}}vt(Xa,"GlyphOffsetArray");class xp extends Dn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}vt(xp,"SymbolLineVertexArray");class om extends Lt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}om.prototype.size=12;class id extends ca{get(e){return new om(this,e)}}vt(id,"FeatureIndexArray");class sm extends Lt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}sm.prototype.size=4;class wp extends fr{get(e){return new sm(this,e)}}vt(wp,"FillExtrusionCentroidArray");class am extends Lt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}am.prototype.size=12;class bp extends Fn{get(e){return new am(this,e)}}vt(bp,"CircleGlobeExtArray");const lm=at([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ql=at([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var zc={exports:{}},Ja={exports:{}};Ja.exports=function(t,e){var n,o,u,d,m,y,x,b;for(o=t.length-(n=3&t.length),u=e,m=3432918353,y=461845907,b=0;b<o;)x=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24,++b,u=27492+(65535&(d=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&t.charCodeAt(b+2))<<16;case 2:x^=(255&t.charCodeAt(b+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&t.charCodeAt(b)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var um={exports:{}};um.exports=function(t,e){for(var n,o=t.length,u=e^o,d=0;o>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++d;switch(o){case 3:u^=(255&t.charCodeAt(d+2))<<16;case 2:u^=(255&t.charCodeAt(d+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(d)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var cm=Ja.exports,hm=um.exports;zc.exports=cm,zc.exports.murmur3=cm,zc.exports.murmur2=hm;class Ap{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,u){this.ids.push(rg(e)),this.positions.push(n,o,u)}getPositions(e){const n=rg(e);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=n?u=m:o=m+1}const d=[];for(;this.ids[o]===n;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(e,n){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return dm(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const n=new Ap;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function rg(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:zc.exports(String(t))}function dm(t,e,n,o){for(;n<o;){const u=t[n+o>>1];let d=n-1,m=o+1;for(;;){do d++;while(t[d]<u);do m--;while(t[m]>u);if(d>=m)break;rd(t,d,m),rd(e,3*d,3*m),rd(e,3*d+1,3*m+1),rd(e,3*d+2,3*m+2)}m-n<o-m?(dm(t,e,n,m),n=m+1):(dm(t,e,m+1,o),o=m)}}function rd(t,e,n){const o=t[e];t[e]=t[n],t[n]=o}vt(Ap,"FeaturePositionMap");class ha{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Ep extends ha{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class pm extends ha{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class fm extends ha{constructor(e){super(e),this.current=ai.transparent}set(e,n,o){this.fetchUniformLocation(e,n)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const io=new Float32Array(16),da=new Float32Array(9),ov=new Float32Array(4);function mm(t){return[Et(255*t.r,255*t.g),Et(255*t.b,255*t.a)]}class Hl{constructor(e,n,o){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=o}setUniform(e,n,o,u,d){n.set(e,d,u.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new fm(e):new Ep(e)}}class Ds{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=n.tl.concat(n.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,n,o,u,d){const m=d==="u_pattern_to"||d==="u_dash_to"?this.patternTo:d==="u_pattern_from"||d==="u_dash_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&n.set(e,d,m)}getBinding(e,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new pm(e):new Ep(e)}}class pa{constructor(e,n,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,o,u,d,m){const y=this.paintVertexArray.length,x=this.expression.evaluate(new oe(0),n,{},d,u,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)}updatePaintArray(e,n,o,u,d){const m=this.expression.evaluate({zoom:0},o,u,void 0,d);this._setPaintValue(e,n,m)}_setPaintValue(e,n,o){if(this.type==="color"){const u=mm(o);for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class is{constructor(e,n,o,u,d,m){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,n,o,u,d,m){const y=this.expression.evaluate(new oe(this.zoom),n,{},d,u,m),x=this.expression.evaluate(new oe(this.zoom+1),n,{},d,u,m),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,y,x)}updatePaintArray(e,n,o,u,d){const m=this.expression.evaluate({zoom:this.zoom},o,u,void 0,d),y=this.expression.evaluate({zoom:this.zoom+1},o,u,void 0,d);this._setPaintValue(e,n,m,y)}_setPaintValue(e,n,o,u){if(this.type==="color"){const d=mm(o),m=mm(u);for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,d[0],d[1],m[0],m[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,o,u,d){const m=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,y=cn(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);n.set(e,d,y)}getBinding(e,n){return new Ep(e)}}class $l{constructor(e,n,o,u,d,m,y){this.expression=e,this.type=o,this.useIntegerZoom=u,this.zoom=d,this.layerId=y,this.paintVertexAttributes=(o==="array"?ql:lm).members;for(let x=0;x<n.length;++x);this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,u,d,m){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(e,n,o,u){if(!u||!o)return;const{min:d,mid:m,max:y}=o,x=u[d],b=u[m],T=u[y];if(x&&b&&T)for(let M=e;M<n;M++)this._setPaintValue(this.zoomInPaintVertexArray,M,b,x),this._setPaintValue(this.zoomOutPaintVertexArray,M,b,T)}_setPaintValue(e,n,o,u){e.emplace(n,o.tl[0],o.tl[1],o.br[0],o.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],o.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ya{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){if(!o(d))continue;const m=e.paint.get(d);if(!(m instanceof qe&&bs(m.property.specification)))continue;const y=sv(d,e.type),x=m.value,b=m.property.specification.type,T=m.property.useIntegerZoom,M=m.property.specification["property-type"],B=M==="cross-faded"||M==="cross-faded-data-driven",L=String(d)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||L)if(x.kind==="source"||L||B){const F=sd(d,b,"source");this.binders[d]=B?new $l(x,y,b,T,n,F,e.id):new pa(x,y,b,F),u.push(`/a_${d}`)}else{const F=sd(d,b,"composite");this.binders[d]=new is(x,y,b,T,n,F),u.push(`/z_${d}`)}else this.binders[d]=B?new Ds(x.value,y):new Hl(x.value,y,b),u.push(`/u_${d}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof pa||n instanceof is?n.maxValue:0}populatePaintArrays(e,n,o,u,d,m){for(const y in this.binders){const x=this.binders[y];(x instanceof pa||x instanceof is||x instanceof $l)&&x.populatePaintArray(e,n,o,u,d,m)}}setConstantPatternPositions(e,n){for(const o in this.binders){const u=this.binders[o];u instanceof Ds&&u.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,u,d,m){let y=!1;for(const x in e){const b=n.getPositions(x);for(const T of b){const M=o.feature(T.index);for(const B in this.binders){const L=this.binders[B];if((L instanceof pa||L instanceof is||L instanceof $l)&&L.expression.isStateDependent===!0){const F=u.paint.get(B);L.expression=F.value,L.updatePaintArray(T.start,T.end,M,e[x],d,m),y=!0}}}}return y}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Hl||o instanceof Ds)&&e.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof pa||o instanceof is||o instanceof $l)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Hl||o instanceof Ds||o instanceof is)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Hl||u instanceof Ds||u instanceof is)for(const d of u.uniformNames)n.push({name:d,property:o,binding:u.getBinding(e,d)})}return n}setUniforms(e,n,o,u,d){for(const{name:m,property:y,binding:x}of o)this.binders[y].setUniform(e,x,d,u.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof $l){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof pa||o instanceof is)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof pa||o instanceof is||o instanceof $l)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof pa||n instanceof is||n instanceof $l)&&n.destroy()}}}class rs{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Ya(u,n,o);this.needsUpload=!1,this._featureMap=new Ap,this._bufferOffset=0}populatePaintArrays(e,n,o,u,d,m,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,u,d,m,y);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,u,d){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,u,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const od={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function sv(t,e){return od[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const og={"line-pattern":{source:Ji,composite:Ji},"fill-pattern":{source:Ji,composite:Ji},"fill-extrusion-pattern":{source:Ji,composite:Ji},"line-dasharray":{source:Co,composite:Co}},sg={color:{source:yp,composite:wi},number:{source:Ht,composite:yp}};function sd(t,e,n){const o=og[t];return o&&o[n]||sg[e][n]}vt(Hl,"ConstantBinder"),vt(Ds,"CrossFadedConstantBinder"),vt(pa,"SourceExpressionBinder"),vt($l,"CrossFadedCompositeBinder"),vt(is,"CompositeExpressionBinder"),vt(Ya,"ProgramConfiguration",{omit:["_buffers"]}),vt(rs,"ProgramConfigurationSet");const ad="-transition";class ro extends xs{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new xe(n.layout)),n.paint)){this._transitionablePaint=new Re(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new He(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(nm,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return Gi(e,ad)?this._transitionablePaint.getTransition(e.slice(0,-ad.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(tm,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(Gi(e,ad))return this._transitionablePaint.setTransition(e.slice(0,-ad.length),n||void 0),!1;{const u=this._transitionablePaint._values[e],d=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||m||d||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ys(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,u,d={}){return(!d||d.validate!==!1)&&Ms(this,e.call(yn,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:Ue,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof qe&&bs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ac(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const _m=at([{name:"a_pos",components:2,type:"Int16"}],4),Cp=at([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class bi{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,u){let d=this.segments[this.segments.length-1];return e>bi.MAX_VERTEX_ARRAY_LENGTH&&Xn(`Max vertices per segment is ${bi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>bi.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,u){return new bi([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}bi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vt(bi,"SegmentVector");var Nt=8192;class ks{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof vn?new vn(e.lng,e.lat):vn.convert(e),this}setSouthWest(e){return this._sw=e instanceof vn?new vn(e.lng,e.lat):vn.convert(e),this}extend(e){const n=this._sw,o=this._ne;let u,d;if(e instanceof vn)u=e,d=e;else{if(!(e instanceof ks))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ks.convert(e)):this.extend(vn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(vn.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return n||o?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new vn(u.lng,u.lat),this._ne=new vn(d.lng,d.lat)),this}getCenter(){return new vn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vn(this.getWest(),this.getNorth())}getSouthEast(){return new vn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:o}=vn.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&u}static convert(e){return!e||e instanceof ks?e:new ks(e)}}const ld=63710088e-1;class vn{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vn(Ni(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,u=e.lat*n,d=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return ld*Math.acos(Math.min(d,1))}toBounds(e=0){const n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new ks(new vn(this.lng-o,this.lat-n),new vn(this.lng+o,this.lat+n))}static convert(e){if(e instanceof vn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new vn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new vn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ag=2*Math.PI*ld;function Tp(t){return ag*Math.cos(t*Math.PI/180)}function Qi(t){return(180+t)/360}function zs(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function So(t,e){return t/Tp(e)}function Io(t){return 360*t-180}function $i(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function lg(t,e){return t*Tp($i(e))}const fa=85.051129;function ma(t){return 1/Math.cos(t*Math.PI/180)}class Zl{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=vn.convert(e);return new Zl(Qi(o.lng),zs(o.lat),So(n,o.lat))}toLngLat(){return new vn(Io(this.x),$i(this.y))}toAltitude(){return lg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ag*ma($i(this.y))}}function ud(t,e,n,o,u,d,m,y,x){const b=(e+o)/2,T=(n+u)/2,M=new ke(b,T);y(M),function(B,L,F,N,H,re){const ce=F-H,ie=N-re;return Math.abs((N-L)*ce-(F-B)*ie)/Math.hypot(ce,ie)}(M.x,M.y,d.x,d.y,m.x,m.y)>=x?(ud(t,e,n,b,T,d,M,y,x),ud(t,b,T,o,u,M,m,y,x)):t.push(m)}function Sp(t,e,n){let o=t[0],u=o.x,d=o.y;e(o);const m=[o];for(let y=1;y<t.length;y++){const x=t[y],{x:b,y:T}=x;e(x),ud(m,u,d,b,T,o,x,e,n),u=b,d=T,o=x}return m}function Pc(t,e,n,o){if(o(e,n)){const u=e.add(n)._mult(.5);Pc(t,e,u,o),Pc(t,u,n,o)}else t.push(n)}function Lc(t,e){let n=t[0];const o=[n];for(let u=1;u<t.length;u++){const d=t[u];Pc(o,n,d,e),n=d}return o}const Wt=Math.pow(2,14)-1,cd=-Wt-1;function gm(t,e){const n=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=cn(n,cd,Wt),t.y=cn(o,cd,Wt),(n<t.x||n>t.x+1||o<t.y||o>t.y+1)&&Xn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Or(t,e,n){const o=t.loadGeometry(),u=t.extent,d=Nt/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x,y:b,projection:T}=n,M=B=>{const L=Io((e.x+B.x/u)/m),F=$i((e.y+B.y/u)/m),N=T.project(L,F);B.x=(N.x*y-x)*u,B.y=(N.y*y-b)*u};for(let B=0;B<o.length;B++)if(t.type!==1)o[B]=Sp(o[B],M,1);else{const L=[];for(const F of o[B])F.x<0||F.x>=u||F.y<0||F.y>=u||(M(F),L.push(F));o[B]=L}}for(const m of o)for(const y of m)gm(y,d);return o}function Ru(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Or(t):[]}}function Fc(t,e,n,o,u){t.emplaceBack(2*e+(o+1)/2,2*n+(u+1)/2)}function hd(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class er{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Yt,this.indexArray=new Hi,this.segments=new bi,this.programConfigurations=new rs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,u){const d=this.layers[0],m=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:b,id:T,index:M,sourceLayerIndex:B}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Ru(b,L);if(!this.layers[0]._featureFilter.filter(new oe(this.zoom),F,o))continue;const N=y?y.evaluate(F,{},o):void 0,H={id:T,properties:b.properties,type:b.type,sourceLayerIndex:B,index:M,geometry:L?F.geometry:Or(b,o,u),patterns:{},sortKey:N};m.push(H)}y&&m.sort((b,T)=>b.sortKey-T.sortKey);let x=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new bp,x=u.projection);for(const b of m){const{geometry:T,index:M,sourceLayerIndex:B}=b,L=e[M].feature;this.addFeature(b,T,M,n.availableImages,o,x),n.featureIndex.insert(L,T,M,B,this.index)}}update(e,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_m.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Cp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,o,u,d,m){for(const y of n)for(const x of y){const b=x.x,T=x.y;if(b<0||b>=Nt||T<0||T>=Nt)continue;if(m){const L=m.projectTilePoint(b,T,d),F=m.upVector(d,b,T),N=this.globeExtVertexArray;hd(N,L,F),hd(N,L,F),hd(N,L,F),hd(N,L,F)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=M.vertexLength;Fc(this.layoutVertexArray,b,T,-1,-1),Fc(this.layoutVertexArray,b,T,1,-1),Fc(this.layoutVertexArray,b,T,1,1),Fc(this.layoutVertexArray,b,T,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},u,d)}}function ug(t,e){for(let n=0;n<t.length;n++)if(Bi(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Bi(t,e[n]))return!0;return!!Ip(t,e)}function av(t,e,n){return!!Bi(t,e)||!!vm(e,t,n)}function ym(t,e){if(t.length===1)return _a(e,t[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let u=0;u<o.length;u++)if(Bi(t,o[u]))return!0}for(let n=0;n<t.length;n++)if(_a(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ip(t,e[n]))return!0;return!1}function lv(t,e,n){if(t.length>1){if(Ip(t,e))return!0;for(let o=0;o<e.length;o++)if(vm(e[o],t,n))return!0}for(let o=0;o<t.length;o++)if(vm(t[o],e,n))return!0;return!1}function Ip(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){const o=t[n],u=t[n+1];for(let d=0;d<e.length-1;d++)if(uv(o,u,e[d],e[d+1]))return!0}return!1}function uv(t,e,n,o){return $r(t,n,o)!==$r(e,n,o)&&$r(t,e,n)!==$r(t,e,o)}function vm(t,e,n){const o=n*n;if(e.length===1)return t.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(cg(t,e[u-1],e[u])<o)return!0;return!1}function cg(t,e,n){const o=e.distSqr(n);if(o===0)return t.distSqr(e);const u=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/o;return t.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function _a(t,e){let n,o,u,d=!1;for(let m=0;m<t.length;m++){n=t[m];for(let y=0,x=n.length-1;y<n.length;x=y++)o=n[y],u=n[x],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(d=!d)}return d}function Bi(t,e){let n=!1;for(let o=0,u=t.length-1;o<t.length;u=o++){const d=t[o],m=t[u];d.y>e.y!=m.y>e.y&&e.x<(m.x-d.x)*(e.y-d.y)/(m.y-d.y)+d.x&&(n=!n)}return n}function Mp(t,e,n,o,u){for(const m of t)if(e<=m.x&&n<=m.y&&o>=m.x&&u>=m.y)return!0;const d=[new ke(e,n),new ke(e,u),new ke(o,u),new ke(o,n)];if(t.length>2){for(const m of d)if(Bi(t,m))return!0}for(let m=0;m<t.length-1;m++)if(cv(t[m],t[m+1],d))return!0;return!1}function cv(t,e,n){const o=n[0],u=n[2];if(t.x<o.x&&e.x<o.x||t.x>u.x&&e.x>u.x||t.y<o.y&&e.y<o.y||t.y>u.y&&e.y>u.y)return!1;const d=$r(t,e,n[0]);return d!==$r(t,e,n[1])||d!==$r(t,e,n[2])||d!==$r(t,e,n[3])}function Wl(t,e,n){const o=e.paint.get(t).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Bp(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function hg(t,e,n,o,u){if(!e[0]&&!e[1])return t;const d=ke.convert(e)._mult(u);n==="viewport"&&d._rotate(-o);const m=[];for(let y=0;y<t.length;y++)m.push(t[y].sub(d));return m}function Rc(t,e,n,o){const u=ke.convert(t)._mult(o);return e==="viewport"&&u._rotate(-n),u}vt(er,"CircleBucket",{omit:["layers"]});const dg=new st({"circle-sort-key":new ye(Ue.layout_circle["circle-sort-key"])});var pg={paint:new st({"circle-radius":new ye(Ue.paint_circle["circle-radius"]),"circle-color":new ye(Ue.paint_circle["circle-color"]),"circle-blur":new ye(Ue.paint_circle["circle-blur"]),"circle-opacity":new ye(Ue.paint_circle["circle-opacity"]),"circle-translate":new Ie(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Ie(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ie(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ie(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ye(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ye(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ye(Ue.paint_circle["circle-stroke-opacity"])}),layout:dg},Dp=1e-6,oo=typeof Float32Array<"u"?Float32Array:Array;function fg(){var t=new oo(9);return oo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function mg(t,e,n){var o=e[0],u=e[1],d=e[2],m=e[3],y=e[4],x=e[5],b=e[6],T=e[7],M=e[8],B=n[0],L=n[1],F=n[2],N=n[3],H=n[4],re=n[5],ce=n[6],ie=n[7],ae=n[8];return t[0]=B*o+L*m+F*b,t[1]=B*u+L*y+F*T,t[2]=B*d+L*x+F*M,t[3]=N*o+H*m+re*b,t[4]=N*u+H*y+re*T,t[5]=N*d+H*x+re*M,t[6]=ce*o+ie*m+ae*b,t[7]=ce*u+ie*y+ae*T,t[8]=ce*d+ie*x+ae*M,t}function Ps(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kp(t,e){var n=e[0],o=e[1],u=e[2],d=e[3],m=e[4],y=e[5],x=e[6],b=e[7],T=e[8],M=e[9],B=e[10],L=e[11],F=e[12],N=e[13],H=e[14],re=e[15],ce=n*y-o*m,ie=n*x-u*m,ae=n*b-d*m,me=o*x-u*y,de=o*b-d*y,Fe=u*b-d*x,ze=T*N-M*F,Ge=T*H-B*F,nt=T*re-L*F,Oe=M*H-B*N,$e=M*re-L*N,We=B*re-L*H,Xe=ce*We-ie*$e+ae*Oe+me*nt-de*Ge+Fe*ze;return Xe?(t[0]=(y*We-x*$e+b*Oe)*(Xe=1/Xe),t[1]=(u*$e-o*We-d*Oe)*Xe,t[2]=(N*Fe-H*de+re*me)*Xe,t[3]=(B*de-M*Fe-L*me)*Xe,t[4]=(x*nt-m*We-b*Ge)*Xe,t[5]=(n*We-u*nt+d*Ge)*Xe,t[6]=(H*ae-F*Fe-re*ie)*Xe,t[7]=(T*Fe-B*ae+L*ie)*Xe,t[8]=(m*$e-y*nt+b*ze)*Xe,t[9]=(o*nt-n*$e-d*ze)*Xe,t[10]=(F*de-N*ae+re*ce)*Xe,t[11]=(M*ae-T*de-L*ce)*Xe,t[12]=(y*Ge-m*Oe-x*ze)*Xe,t[13]=(n*Oe-o*Ge+u*ze)*Xe,t[14]=(N*ie-F*me-H*ce)*Xe,t[15]=(T*me-M*ie+B*ce)*Xe,t):null}function Oc(t,e,n){var o=e[0],u=e[1],d=e[2],m=e[3],y=e[4],x=e[5],b=e[6],T=e[7],M=e[8],B=e[9],L=e[10],F=e[11],N=e[12],H=e[13],re=e[14],ce=e[15],ie=n[0],ae=n[1],me=n[2],de=n[3];return t[0]=ie*o+ae*y+me*M+de*N,t[1]=ie*u+ae*x+me*B+de*H,t[2]=ie*d+ae*b+me*L+de*re,t[3]=ie*m+ae*T+me*F+de*ce,t[4]=(ie=n[4])*o+(ae=n[5])*y+(me=n[6])*M+(de=n[7])*N,t[5]=ie*u+ae*x+me*B+de*H,t[6]=ie*d+ae*b+me*L+de*re,t[7]=ie*m+ae*T+me*F+de*ce,t[8]=(ie=n[8])*o+(ae=n[9])*y+(me=n[10])*M+(de=n[11])*N,t[9]=ie*u+ae*x+me*B+de*H,t[10]=ie*d+ae*b+me*L+de*re,t[11]=ie*m+ae*T+me*F+de*ce,t[12]=(ie=n[12])*o+(ae=n[13])*y+(me=n[14])*M+(de=n[15])*N,t[13]=ie*u+ae*x+me*B+de*H,t[14]=ie*d+ae*b+me*L+de*re,t[15]=ie*m+ae*T+me*F+de*ce,t}function Ou(t,e,n){var o,u,d,m,y,x,b,T,M,B,L,F,N=n[0],H=n[1],re=n[2];return e===t?(t[12]=e[0]*N+e[4]*H+e[8]*re+e[12],t[13]=e[1]*N+e[5]*H+e[9]*re+e[13],t[14]=e[2]*N+e[6]*H+e[10]*re+e[14],t[15]=e[3]*N+e[7]*H+e[11]*re+e[15]):(u=e[1],d=e[2],m=e[3],y=e[4],x=e[5],b=e[6],T=e[7],M=e[8],B=e[9],L=e[10],F=e[11],t[0]=o=e[0],t[1]=u,t[2]=d,t[3]=m,t[4]=y,t[5]=x,t[6]=b,t[7]=T,t[8]=M,t[9]=B,t[10]=L,t[11]=F,t[12]=o*N+y*H+M*re+e[12],t[13]=u*N+x*H+B*re+e[13],t[14]=d*N+b*H+L*re+e[14],t[15]=m*N+T*H+F*re+e[15]),t}function Kl(t,e,n){var o=n[0],u=n[1],d=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Uu(t,e,n){var o=Math.sin(n),u=Math.cos(n),d=e[4],m=e[5],y=e[6],x=e[7],b=e[8],T=e[9],M=e[10],B=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*u+b*o,t[5]=m*u+T*o,t[6]=y*u+M*o,t[7]=x*u+B*o,t[8]=b*u-d*o,t[9]=T*u-m*o,t[10]=M*u-y*o,t[11]=B*u-x*o,t}function Uc(t,e,n){var o=Math.sin(n),u=Math.cos(n),d=e[0],m=e[1],y=e[2],x=e[3],b=e[8],T=e[9],M=e[10],B=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u-b*o,t[1]=m*u-T*o,t[2]=y*u-M*o,t[3]=x*u-B*o,t[8]=d*o+b*u,t[9]=m*o+T*u,t[10]=y*o+M*u,t[11]=x*o+B*u,t}function xm(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wm(t,e,n){var o,u,d,m=n[0],y=n[1],x=n[2],b=Math.hypot(m,y,x);return b<Dp?null:(m*=b=1/b,y*=b,x*=b,o=Math.sin(e),u=Math.cos(e),t[0]=m*m*(d=1-u)+u,t[1]=y*m*d+x*o,t[2]=x*m*d-y*o,t[3]=0,t[4]=m*y*d-x*o,t[5]=y*y*d+u,t[6]=x*y*d+m*o,t[7]=0,t[8]=m*x*d+y*o,t[9]=y*x*d-m*o,t[10]=x*x*d+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var zp=Oc;function Pp(){var t=new oo(3);return oo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ls(t){var e=new oo(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Fs(t){return Math.hypot(t[0],t[1],t[2])}function Nc(t,e,n){var o=new oo(3);return o[0]=t,o[1]=e,o[2]=n,o}function ga(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function bm(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function _g(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function dd(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function pd(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Mo(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function fd(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t}function Mr(t,e){var n=e[0],o=e[1],u=e[2],d=n*n+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t}function os(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Am(t,e,n){var o=e[0],u=e[1],d=e[2],m=n[0],y=n[1],x=n[2];return t[0]=u*x-d*y,t[1]=d*m-o*x,t[2]=o*y-u*m,t}function Ai(t,e,n){var o=e[0],u=e[1],d=e[2],m=n[3]*o+n[7]*u+n[11]*d+n[15];return t[0]=(n[0]*o+n[4]*u+n[8]*d+n[12])/(m=m||1),t[1]=(n[1]*o+n[5]*u+n[9]*d+n[13])/m,t[2]=(n[2]*o+n[6]*u+n[10]*d+n[14])/m,t}function gg(t,e,n){var o=n[0],u=n[1],d=n[2],m=e[0],y=e[1],x=e[2],b=u*x-d*y,T=d*m-o*x,M=o*y-u*m,B=u*M-d*T,L=d*b-o*M,F=o*T-u*b,N=2*n[3];return T*=N,M*=N,L*=2,F*=2,t[0]=m+(b*=N)+(B*=2),t[1]=y+T+L,t[2]=x+M+F,t}var Gc,ss=bm,yg=_g,hv=Fs;function vg(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function xg(t,e){var n=e[0],o=e[1],u=e[2],d=e[3],m=n*n+o*o+u*u+d*d;return m>0&&(m=1/Math.sqrt(m)),t[0]=n*m,t[1]=o*m,t[2]=u*m,t[3]=d*m,t}function Xl(t,e,n){var o=e[0],u=e[1],d=e[2],m=e[3];return t[0]=n[0]*o+n[4]*u+n[8]*d+n[12]*m,t[1]=n[1]*o+n[5]*u+n[9]*d+n[13]*m,t[2]=n[2]*o+n[6]*u+n[10]*d+n[14]*m,t[3]=n[3]*o+n[7]*u+n[11]*d+n[15]*m,t}function wg(){var t=new oo(4);return oo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function bg(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ag(t,e,n){n*=.5;var o=e[0],u=e[1],d=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=o*x+m*y,t[1]=u*x+d*y,t[2]=d*x-u*y,t[3]=m*x-o*y,t}function Eg(t,e,n){n*=.5;var o=e[0],u=e[1],d=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=o*x-d*y,t[1]=u*x+m*y,t[2]=d*x+o*y,t[3]=m*x-u*y,t}Pp(),Gc=new oo(4),oo!=Float32Array&&(Gc[0]=0,Gc[1]=0,Gc[2]=0,Gc[3]=0);var dv=xg;Pp(),Nc(1,0,0),Nc(0,1,0),wg(),wg(),fg();class Em{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){const u=os(n,this.dir);if(Math.abs(u)<1e-6)return!1;const d=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,o[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,n,o){if(function(L,F){var N=L[0],H=L[1],re=L[2],ce=F[0],ie=F[1],ae=F[2];return Math.abs(N-ce)<=Dp*Math.max(1,Math.abs(N),Math.abs(ce))&&Math.abs(H-ie)<=Dp*Math.max(1,Math.abs(H),Math.abs(ie))&&Math.abs(re-ae)<=Dp*Math.max(1,Math.abs(re),Math.abs(ae))}(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;const[u,d,m]=this.dir,y=this.pos[0]-e[0],x=this.pos[1]-e[1],b=this.pos[2]-e[2],T=u*u+d*d+m*m,M=2*(y*u+x*d+b*m),B=M*M-4*T*(y*y+x*x+b*b-n*n);if(B<0){const L=Math.max(-M/2,0),F=y+u*L,N=x+d*L,H=b+m*L,re=Math.hypot(F,N,H);return o[0]=F*n/re,o[1]=N*n/re,o[2]=H*n/re,!1}{const L=(-M-Math.sqrt(B))/(2*T);if(L<0){const F=Math.hypot(y,x,b);return o[0]=y*n/F,o[1]=x*n/F,o[2]=b*n/F,!1}return o[0]=y+u*L,o[1]=x+d*L,o[2]=b+m*L,!0}}}class so{constructor(e,n,o,u,d){this.TL=e,this.TR=n,this.BR=o,this.BL=u,this.horizon=d}static fromInvProjectionMatrix(e,n,o){const u=[-1,1,1],d=[1,1,1],m=[1,-1,1],y=[-1,-1,1],x=Ai(u,u,e),b=Ai(d,d,e),T=Ai(m,m,e),M=Ai(y,y,e);return new so(x,b,T,M,n/o)}}class Cm{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,o,u){const d=Math.pow(2,o),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const b=Xl([],x,e),T=1/b[3]/n*d;return function(M,B,L){return M[0]=B[0]*L[0],M[1]=B[1]*L[1],M[2]=B[2]*L[2],M[3]=B[3]*L[3],M}(b,b,[T,T,u?1/b[3]:T,T])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const b=Mr([],Am([],ss([],m[x[0]],m[x[1]]),ss([],m[x[2]],m[x[1]]))),T=-os(b,m[x[1]]);return b.concat(T)});return new Cm(m,y)}}class Br{static fromPoints(e){const n=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const u of e)dd(n,n,u),pd(o,o,u);return new Br(n,o)}static applyTransform(e,n){const o=e.getCorners();for(let u=0;u<o.length;++u)Ai(o[u],o[u],n);return Br.fromPoints(o)}constructor(e,n){this.min=e,this.max=n,this.center=Mo([],ga([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],o=Ls(this.min),u=Ls(this.max);for(let d=0;d<n.length;d++)o[d]=n[d]?this.min[d]:this.center[d],u[d]=n[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new Br(o,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let o=!0;for(let u=0;u<e.planes.length;u++){const d=e.planes[u];let m=0;for(let y=0;y<n.length;y++)m+=os(d,n[y])+d[3]>=0;if(m===0)return 0;m!==n.length&&(o=!1)}if(o)return 2;for(let u=0;u<3;u++){let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const x=e.points[y][u]-this.min[u];d=Math.min(d,x),m=Math.max(m,x)}if(m<0||d>this.max[u]-this.min[u])return 0}return 1}}function Cg(t,e,n,o,u,d,m,y,x){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(x*=t.pixelToTileUnitsFactor);const b=t.tileID.canonical,T=n.projection.upVectorScale(b,n.center.lat,n.worldSize).metersToTile;for(const M of e)for(const B of M){const L=B.add(y),F=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(L.x,L.y,!0):0,N=n.projection.projectTilePoint(L.x,L.y,b);if(F>0){const ie=n.projection.upVector(b,L.x,L.y);N.x+=ie[0]*T*F,N.y+=ie[1]*T*F,N.z+=ie[2]*T*F}const H=d?L:Tg(N.x,N.y,N.z,o),re=d?t.tilespaceRays.map(ie=>fv(ie,F)):t.queryGeometry.screenGeometry,ce=Xl([],[N.x,N.y,N.z,1],o);if(!m&&d?x*=ce[3]/n.cameraToCenterDistance:m&&!d&&(x*=n.cameraToCenterDistance/ce[3]),d){const ie=$i((B.y/Nt+b.y)/(1<<b.z));x/=n.projection.pixelsPerMeter(ie,1)/So(1,ie)}if(av(re,H,x))return!0}return!1}function Tg(t,e,n,o){const u=Xl([],[t,e,n,1],o);return new ke(u[0]/u[3],u[1]/u[3])}const Sg=Nc(0,0,0),pv=Nc(0,0,1);function fv(t,e){const n=Pp();return Sg[2]=e,t.intersectsPlane(Sg,pv,n),new ke(n[0],n[1])}class Ig extends er{}function Lp(t,{width:e,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*o)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*o);return t.width=e,t.height=n,t.data=u,t}function Mg(t,e,n){const{width:o,height:u}=e;o===t.width&&u===t.height||(Tm(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,u)},n),t.width=o,t.height=u,t.data=e.data)}function Tm(t,e,n,o,u,d){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||n.x>t.width-u.width||n.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,y=e.data;for(let x=0;x<u.height;x++){const b=((n.y+x)*t.width+n.x)*d,T=((o.y+x)*e.width+o.x)*d;for(let M=0;M<u.width*d;M++)y[T+M]=m[b+M]}return e}vt(Ig,"HeatmapBucket",{omit:["layers"]});class Qa{constructor(e,n){Lp(this,e,1,n)}resize(e){Mg(this,new Qa(e),1)}clone(){return new Qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,u,d){Tm(e,n,o,u,d,1)}}class ao{constructor(e,n){Lp(this,e,4,n)}resize(e){Mg(this,new ao(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,u,d){Tm(e,n,o,u,d,4)}}vt(Qa,"AlphaImage"),vt(ao,"RGBAImage");var mv={paint:new st({"heatmap-radius":new ye(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ye(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ie(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new lt(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ie(Ue.paint_heatmap["heatmap-opacity"])})};function Sm(t){const e={},n=t.resolution||256,o=t.clips?t.clips.length:1,u=t.image||new ao({width:n,height:o}),d=(m,y,x)=>{e[t.evaluationKey]=x;const b=t.expression.evaluate(e);u.data[m+y+0]=Math.floor(255*b.r/b.a),u.data[m+y+1]=Math.floor(255*b.g/b.a),u.data[m+y+2]=Math.floor(255*b.b/b.a),u.data[m+y+3]=Math.floor(255*b.a)};if(t.clips)for(let m=0,y=0;m<o;++m,y+=4*n)for(let x=0,b=0;x<n;x++,b+=4){const T=x/(n-1),{start:M,end:B}=t.clips[m];d(y,b,M*(1-T)+B*T)}else for(let m=0,y=0;m<n;m++,y+=4)d(0,y,m/(n-1));return u}var _v={paint:new st({"hillshade-illumination-direction":new Ie(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ie(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ie(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ie(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ie(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ie(Ue.paint_hillshade["hillshade-accent-color"])})};const gv=at([{name:"a_pos",components:2,type:"Int16"}],4),{members:yv}=gv;var md={exports:{}};function Fp(t,e,n){n=n||2;var o,u,d,m,y,x,b,T=e&&e.length,M=T?e[0]*n:t.length,B=Bg(t,0,M,n,!0),L=[];if(!B||B.next===B.prev)return L;if(T&&(B=function(N,H,re,ce){var ie,ae,me,de=[];for(ie=0,ae=H.length;ie<ae;ie++)(me=Bg(N,H[ie]*ce,ie<ae-1?H[ie+1]*ce:N.length,ce,!1))===me.next&&(me.steiner=!0),de.push(Cv(me));for(de.sort(Av),ie=0;ie<de.length;ie++)re=Ev(de[ie],re);return re}(t,e,B,n)),t.length>80*n){o=d=t[0],u=m=t[1];for(var F=n;F<M;F+=n)(y=t[F])<o&&(o=y),(x=t[F+1])<u&&(u=x),y>d&&(d=y),x>m&&(m=x);b=(b=Math.max(d-o,m-u))!==0?32767/b:0}return _d(B,L,n,o,u,b,0),L}function Bg(t,e,n,o,u){var d,m;if(u===Bm(t,e,n,o)>0)for(d=e;d<n;d+=o)m=gd(d,t[d],t[d+1],m);else for(d=n-o;d>=e;d-=o)m=gd(d,t[d],t[d+1],m);return m&&Op(m,m.next)&&(yd(m),m=m.next),m}function Nu(t,e){if(!t)return t;e||(e=t);var n,o=t;do if(n=!1,o.steiner||!Op(o,o.next)&&pi(o.prev,o,o.next)!==0)o=o.next;else{if(yd(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function _d(t,e,n,o,u,d,m){if(t){!m&&d&&function(T,M,B,L){var F=T;do F.z===0&&(F.z=Rp(F.x,F.y,M,B,L)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==T);F.prevZ.nextZ=null,F.prevZ=null,function(N){var H,re,ce,ie,ae,me,de,Fe,ze=1;do{for(re=N,N=null,ae=null,me=0;re;){for(me++,ce=re,de=0,H=0;H<ze&&(de++,ce=ce.nextZ);H++);for(Fe=ze;de>0||Fe>0&&ce;)de!==0&&(Fe===0||!ce||re.z<=ce.z)?(ie=re,re=re.nextZ,de--):(ie=ce,ce=ce.nextZ,Fe--),ae?ae.nextZ=ie:N=ie,ie.prevZ=ae,ae=ie;re=ce}ae.nextZ=null,ze*=2}while(me>1)}(F)}(t,o,u,d);for(var y,x,b=t;t.prev!==t.next;)if(y=t.prev,x=t.next,d?xv(t,o,u,d):vv(t))e.push(y.i/n|0),e.push(t.i/n|0),e.push(x.i/n|0),yd(t),t=x.next,b=x.next;else if((t=x)===b){m?m===1?_d(t=wv(Nu(t),e,n),e,n,o,u,d,2):m===2&&bv(t,e,n,o,u,d):_d(Nu(t),e,n,o,u,d,1);break}}}function vv(t){var e=t.prev,n=t,o=t.next;if(pi(e,n,o)>=0)return!1;for(var u=e.x,d=n.x,m=o.x,y=e.y,x=n.y,b=o.y,T=u<d?u<m?u:m:d<m?d:m,M=y<x?y<b?y:b:x<b?x:b,B=u>d?u>m?u:m:d>m?d:m,L=y>x?y>b?y:b:x>b?x:b,F=o.next;F!==e;){if(F.x>=T&&F.x<=B&&F.y>=M&&F.y<=L&&Vc(u,y,d,x,m,b,F.x,F.y)&&pi(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function xv(t,e,n,o){var u=t.prev,d=t,m=t.next;if(pi(u,d,m)>=0)return!1;for(var y=u.x,x=d.x,b=m.x,T=u.y,M=d.y,B=m.y,L=y<x?y<b?y:b:x<b?x:b,F=T<M?T<B?T:B:M<B?M:B,N=y>x?y>b?y:b:x>b?x:b,H=T>M?T>B?T:B:M>B?M:B,re=Rp(L,F,e,n,o),ce=Rp(N,H,e,n,o),ie=t.prevZ,ae=t.nextZ;ie&&ie.z>=re&&ae&&ae.z<=ce;){if(ie.x>=L&&ie.x<=N&&ie.y>=F&&ie.y<=H&&ie!==u&&ie!==m&&Vc(y,T,x,M,b,B,ie.x,ie.y)&&pi(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ae.x>=L&&ae.x<=N&&ae.y>=F&&ae.y<=H&&ae!==u&&ae!==m&&Vc(y,T,x,M,b,B,ae.x,ae.y)&&pi(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ie&&ie.z>=re;){if(ie.x>=L&&ie.x<=N&&ie.y>=F&&ie.y<=H&&ie!==u&&ie!==m&&Vc(y,T,x,M,b,B,ie.x,ie.y)&&pi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ae&&ae.z<=ce;){if(ae.x>=L&&ae.x<=N&&ae.y>=F&&ae.y<=H&&ae!==u&&ae!==m&&Vc(y,T,x,M,b,B,ae.x,ae.y)&&pi(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function wv(t,e,n){var o=t;do{var u=o.prev,d=o.next.next;!Op(u,d)&&Dg(u,o,o.next,d)&&jc(u,d)&&jc(d,u)&&(e.push(u.i/n|0),e.push(o.i/n|0),e.push(d.i/n|0),yd(o),yd(o.next),o=t=d),o=o.next}while(o!==t);return Nu(o)}function bv(t,e,n,o,u,d){var m=t;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&Tv(m,y)){var x=kg(m,y);return m=Nu(m,m.next),x=Nu(x,x.next),_d(m,e,n,o,u,d,0),void _d(x,e,n,o,u,d,0)}y=y.next}m=m.next}while(m!==t)}function Av(t,e){return t.x-e.x}function Ev(t,e){var n=function(u,d){var m,y=d,x=u.x,b=u.y,T=-1/0;do{if(b<=y.y&&b>=y.next.y&&y.next.y!==y.y){var M=y.x+(b-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(M<=x&&M>T&&(T=M,m=y.x<y.next.x?y:y.next,M===x))return m}y=y.next}while(y!==d);if(!m)return null;var B,L=m,F=m.x,N=m.y,H=1/0;y=m;do x>=y.x&&y.x>=F&&x!==y.x&&Vc(b<N?x:T,b,F,N,b<N?T:x,b,y.x,y.y)&&(B=Math.abs(b-y.y)/(x-y.x),jc(y,u)&&(B<H||B===H&&(y.x>m.x||y.x===m.x&&Im(m,y)))&&(m=y,H=B)),y=y.next;while(y!==L);return m}(t,e);if(!n)return e;var o=kg(n,t);return Nu(o,o.next),Nu(n,n.next)}function Im(t,e){return pi(t.prev,t,e.prev)<0&&pi(e.next,t,t.next)<0}function Rp(t,e,n,o,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Cv(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Vc(t,e,n,o,u,d,m,y){return(u-m)*(e-y)>=(t-m)*(d-y)&&(t-m)*(o-y)>=(n-m)*(e-y)&&(n-m)*(d-y)>=(u-m)*(o-y)}function Tv(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,o){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&Dg(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1}(t,e)&&(jc(t,e)&&jc(e,t)&&function(n,o){var u=n,d=!1,m=(n.x+o.x)/2,y=(n.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==n);return d}(t,e)&&(pi(t.prev,t,e.prev)||pi(t,e.prev,e))||Op(t,e)&&pi(t.prev,t,t.next)>0&&pi(e.prev,e,e.next)>0)}function pi(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Op(t,e){return t.x===e.x&&t.y===e.y}function Dg(t,e,n,o){var u=Np(pi(t,e,n)),d=Np(pi(t,e,o)),m=Np(pi(n,o,t)),y=Np(pi(n,o,e));return u!==d&&m!==y||!(u!==0||!Up(t,n,e))||!(d!==0||!Up(t,o,e))||!(m!==0||!Up(n,t,o))||!(y!==0||!Up(n,e,o))}function Up(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Np(t){return t>0?1:t<0?-1:0}function jc(t,e){return pi(t.prev,t,t.next)<0?pi(t,e,t.next)>=0&&pi(t,t.prev,e)>=0:pi(t,e,t.prev)<0||pi(t,t.next,e)<0}function kg(t,e){var n=new Mm(t.i,t.x,t.y),o=new Mm(e.i,e.x,e.y),u=t.next,d=e.prev;return t.next=e,e.prev=t,n.next=u,u.prev=n,o.next=n,n.prev=o,d.next=o,o.prev=d,o}function gd(t,e,n,o){var u=new Mm(t,e,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function yd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Mm(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bm(t,e,n,o){for(var u=0,d=e,m=n-o;d<n;d+=o)u+=(t[m]-t[d])*(t[d+1]+t[m+1]),m=d;return u}function Sv(t,e,n,o,u){zg(t,e,n||0,o||t.length-1,u||Iv)}function zg(t,e,n,o,u){for(;o>n;){if(o-n>600){var d=o-n+1,m=e-n+1,y=Math.log(d),x=.5*Math.exp(2*y/3),b=.5*Math.sqrt(y*x*(d-x)/d)*(m-d/2<0?-1:1);zg(t,e,Math.max(n,Math.floor(e-m*x/d+b)),Math.min(o,Math.floor(e+(d-m)*x/d+b)),u)}var T=t[e],M=n,B=o;for(vd(t,n,e),u(t[o],T)>0&&vd(t,n,o);M<B;){for(vd(t,M,B),M++,B--;u(t[M],T)<0;)M++;for(;u(t[B],T)>0;)B--}u(t[n],T)===0?vd(t,n,B):vd(t,++B,o),B<=e&&(n=B+1),e<=B&&(o=B-1)}}function vd(t,e,n){var o=t[e];t[e]=t[n],t[n]=o}function Iv(t,e){return t<e?-1:t>e?1:0}function Dm(t,e){const n=t.length;if(n<=1)return[t];const o=[];let u,d;for(let m=0;m<n;m++){const y=Qt(t[m]);y!==0&&(t[m].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(u&&o.push(u),u=[t[m]]):u.push(t[m]))}if(u&&o.push(u),e>1)for(let m=0;m<o.length;m++)o[m].length<=e||(Sv(o[m],e,1,o[m].length-1,Mv),o[m]=o[m].slice(0,e));return o}function Mv(t,e){return e.area-t.area}function km(t,e,n){const o=n.patternDependencies;let u=!1;for(const d of e){const m=d.paint.get(`${t}-pattern`);m.isConstant()||(u=!0);const y=m.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function zm(t,e,n,o,u){const d=u.patternDependencies;for(const m of e){const y=m.paint.get(`${t}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:o-1},n,{},u.availableImages),b=y.evaluate({zoom:o},n,{},u.availableImages),T=y.evaluate({zoom:o+1},n,{},u.availableImages);x=x&&x.name?x.name:x,b=b&&b.name?b.name:b,T=T&&T.name?T.name:T,d[x]=!0,d[b]=!0,d[T]=!0,n.patterns[m.id]={min:x,mid:b,max:T}}}return n}md.exports=Fp,md.exports.default=Fp,Fp.deviation=function(t,e,n,o){var u=e&&e.length,d=Math.abs(Bm(t,0,u?e[0]*n:t.length,n));if(u)for(var m=0,y=e.length;m<y;m++)d-=Math.abs(Bm(t,e[m]*n,m<y-1?e[m+1]*n:t.length,n));var x=0;for(m=0;m<o.length;m+=3){var b=o[m]*n,T=o[m+1]*n,M=o[m+2]*n;x+=Math.abs((t[b]-t[M])*(t[T+1]-t[b+1])-(t[b]-t[T])*(t[M+1]-t[b+1]))}return d===0&&x===0?0:Math.abs((x-d)/d)},Fp.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,u=0;u<t.length;u++){for(var d=0;d<t[u].length;d++)for(var m=0;m<e;m++)n.vertices.push(t[u][d][m]);u>0&&n.holes.push(o+=t[u-1].length)}return n};class Gp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yt,this.indexArray=new Hi,this.indexArray2=new fr,this.programConfigurations=new rs(e.layers,e.zoom),this.segments=new bi,this.segments2=new bi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,o,u){this.hasPattern=km("fill",this.layers,n);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:x,index:b,sourceLayerIndex:T}of e){const M=this.layers[0]._featureFilter.needGeometry,B=Ru(y,M);if(!this.layers[0]._featureFilter.filter(new oe(this.zoom),B,o))continue;const L=d?d.evaluate(B,{},o,n.availableImages):void 0,F={id:x,properties:y.properties,type:y.type,sourceLayerIndex:T,index:b,geometry:M?B.geometry:Or(y,o,u),patterns:{},sortKey:L};m.push(F)}d&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:b,sourceLayerIndex:T}=y;if(this.hasPattern){const M=zm("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(y,x,b,o,{},n.availableImages);n.featureIndex.insert(e[b].feature,x,b,T,this.index)}}update(e,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,u)}addFeatures(e,n,o,u,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,o,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,u,d,m=[]){for(const y of Dm(n,500)){let x=0;for(const F of y)x+=F.length;const b=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),T=b.vertexLength,M=[],B=[];for(const F of y){if(F.length===0)continue;F!==y[0]&&B.push(M.length/2);const N=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),H=N.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(H+F.length-1,H),M.push(F[0].x),M.push(F[0].y);for(let re=1;re<F.length;re++)this.layoutVertexArray.emplaceBack(F[re].x,F[re].y),this.indexArray2.emplaceBack(H+re-1,H+re),M.push(F[re].x),M.push(F[re].y);N.vertexLength+=F.length,N.primitiveLength+=F.length}const L=md.exports(M,B);for(let F=0;F<L.length;F+=3)this.indexArray.emplaceBack(T+L[F],T+L[F+1],T+L[F+2]);b.vertexLength+=x,b.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,m,u)}}vt(Gp,"FillBucket",{omit:["layers","patternFeatures"]});const Bv=new st({"fill-sort-key":new ye(Ue.layout_fill["fill-sort-key"])});var Dv={paint:new st({"fill-antialias":new Ie(Ue.paint_fill["fill-antialias"]),"fill-opacity":new ye(Ue.paint_fill["fill-opacity"]),"fill-color":new ye(Ue.paint_fill["fill-color"]),"fill-outline-color":new ye(Ue.paint_fill["fill-outline-color"]),"fill-translate":new Ie(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Ie(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new dt(Ue.paint_fill["fill-pattern"])}),layout:Bv};const kv=at([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zv=at([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Pg=at([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Lg}=kv;var Vp={},Pv=ke,Fg=qc;function qc(t,e,n,o,u){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=u,t.readFields(jp,this,e)}function jp(t,e,n){t==1?e.id=n.readVarint():t==2?function(o,u){for(var d=o.readVarint()+o.pos;o.pos<d;){var m=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[m]=y}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function Lv(t){for(var e,n,o=0,u=0,d=t.length,m=d-1;u<d;m=u++)o+=((n=t[m]).x-(e=t[u]).x)*(e.y+n.y);return o}qc.types=["Unknown","Point","LineString","Polygon"],qc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,o=1,u=0,d=0,m=0,y=[];t.pos<n;){if(u<=0){var x=t.readVarint();o=7&x,u=x>>3}if(u--,o===1||o===2)d+=t.readSVarint(),m+=t.readSVarint(),o===1&&(e&&y.push(e),e=[]),e.push(new Pv(d,m));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&y.push(e),y},qc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,o=0,u=0,d=0,m=1/0,y=-1/0,x=1/0,b=-1/0;t.pos<e;){if(o<=0){var T=t.readVarint();n=7&T,o=T>>3}if(o--,n===1||n===2)(u+=t.readSVarint())<m&&(m=u),u>y&&(y=u),(d+=t.readSVarint())<x&&(x=d),d>b&&(b=d);else if(n!==7)throw new Error("unknown command "+n)}return[m,x,y,b]},qc.prototype.toGeoJSON=function(t,e,n){var o,u,d=this.extent*Math.pow(2,n),m=this.extent*t,y=this.extent*e,x=this.loadGeometry(),b=qc.types[this.type];function T(L){for(var F=0;F<L.length;F++){var N=L[F];L[F]=[360*(N.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(o=0;o<x.length;o++)M[o]=x[o][0];T(x=M);break;case 2:for(o=0;o<x.length;o++)T(x[o]);break;case 3:for(x=function(L){var F=L.length;if(F<=1)return[L];for(var N,H,re=[],ce=0;ce<F;ce++){var ie=Lv(L[ce]);ie!==0&&(H===void 0&&(H=ie<0),H===ie<0?(N&&re.push(N),N=[L[ce]]):N.push(L[ce]))}return N&&re.push(N),re}(x),o=0;o<x.length;o++)for(u=0;u<x[o].length;u++)T(x[o][u])}x.length===1?x=x[0]:b="Multi"+b;var B={type:"Feature",geometry:{type:b,coordinates:x},properties:this.properties};return"id"in this&&(B.id=this.id),B};var Fv=Fg,Rg=Og;function Og(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Rv,this,e),this.length=this._features.length}function Rv(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(o){for(var u=null,d=o.readVarint()+o.pos;o.pos<d;){var m=o.readVarint()>>3;u=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}return u}(n))}Og.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Fv(this._pbf,e,this.extent,this._keys,this._values)};var Ov=Rg;function Uv(t,e,n){if(t===3){var o=new Ov(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}var Pm=Vp.VectorTile=function(t,e){this.layers=t.readFields(Uv,{},e)},qp=Vp.VectorTileFeature=Fg;function Hp(t,e,n,o){const u=[],d=o===0?(m,y,x,b,T,M)=>{m.push(new ke(M,x+(M-y)/(b-y)*(T-x)))}:(m,y,x,b,T,M)=>{m.push(new ke(y+(M-x)/(T-x)*(b-y),M))};for(const m of t){const y=[];for(const x of m){if(x.length<=2)continue;const b=[];for(let B=0;B<x.length-1;B++){const L=x[B].x,F=x[B].y,N=x[B+1].x,H=x[B+1].y,re=o===0?L:F,ce=o===0?N:H;re<e?ce>e&&d(b,L,F,N,H,e):re>n?ce<n&&d(b,L,F,N,H,n):b.push(x[B]),ce<e&&re>=e&&d(b,L,F,N,H,e),ce>n&&re<=n&&d(b,L,F,N,H,n)}let T=x[x.length-1];const M=o===0?T.x:T.y;M>=e&&M<=n&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),y.push(b))}y.length&&u.push(y)}return u}Vp.VectorTileLayer=Rg;const Nv=qp.types,$p=Math.pow(2,13);function xd(t,e,n,o,u,d,m,y){t.emplaceBack((e<<1)+m,(n<<1)+d,(Math.floor(o*$p)<<1)+u,Math.round(y))}function Hc(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Lm{constructor(){this.acc=new ke(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ke(e.x,e.y),this.max=new ke(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const o=this.min,u=this.max;e.x<o.x?o.x=e.x:e.x>u.x&&(u.x=e.x),e.y<o.y?o.y=e.y:e.y>u.y&&(u.y=e.y),((e.x===0||e.x===Nt)&&e.x===n.x)!=((e.y===0||e.y===Nt)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,mn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Nt!=e.x>Nt&&this.addBorderIntersection(1,mn(n.y,e.y,(Nt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,mn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Nt!=e.y>Nt&&this.addBorderIntersection(3,mn(n.x,e.x,(Nt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((n,o)=>n+o.edges,0);return e!==0?this.acc.div(e)._round():new ke(0,0)}span(){return new ke(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Gu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Ln,this.centroidVertexArray=new wp,this.indexArray=new Hi,this.programConfigurations=new rs(e.layers,e.zoom),this.segments=new bi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,o,u){this.features=[],this.hasPattern=km("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){const m=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*m/(m*m+1)/Nt/(1<<d.z)}(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:m,index:y,sourceLayerIndex:x}of e){const b=this.layers[0]._featureFilter.needGeometry,T=Ru(d,b);if(!this.layers[0]._featureFilter.filter(new oe(this.zoom),T,o))continue;const M={id:m,sourceLayerIndex:x,index:y,geometry:b?T.geometry:Or(d,o,u),properties:d.properties,type:d.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(zm("fill-extrusion",this.layers,M,this.zoom,n)):this.addFeature(M,M.geometry,y,o,{},n.availableImages,u),n.featureIndex.insert(d,M.geometry,y,x,this.index,B)}this.sortBorders()}addFeatures(e,n,o,u,d){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,n,o,u,d)}this.sortBorders()}update(e,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Pg.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,zv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,u,d,m,y){const x=[new ke(0,0),new ke(Nt,Nt)],b=y.projection,T=b.name==="globe",M=this.enableTerrain&&!T?new Lm:null,B=Nv[e.type]==="Polygon";T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new To);const L=Dm(n,500);for(let re=L.length-1;re>=0;re--){const ce=L[re];(ce.length===0||(F=ce[0]).every(ie=>ie.x<=0)||F.every(ie=>ie.x>=Nt)||F.every(ie=>ie.y<=0)||F.every(ie=>ie.y>=Nt))&&L.splice(re,1)}var F;let N;if(T)N=wd(L,x,u);else{N=[];for(const re of L)N.push({polygon:re,bounds:x})}const H=B?this.edgeRadius:0;for(const{polygon:re,bounds:ce}of N){let ie=0,ae=0;for(const de of re)B&&!de[0].equals(de[de.length-1])&&de.push(de[0]),ae+=B?de.length-1:de.length;const me=this.segments.prepareSegment((B?5:4)*ae,this.layoutVertexArray,this.indexArray);if(B){const de=[],Fe=[];ie=me.vertexLength;for(const Ge of re){let nt,Oe;Ge.length&&Ge!==re[0]&&Fe.push(de.length/2),nt=Ge[1].sub(Ge[0])._perp()._unit();for(let $e=1;$e<Ge.length;$e++){const We=Ge[$e],Xe=Ge[$e===Ge.length-1?1:$e+1];let{x:rt,y:Ve}=We;if(H){Oe=Xe.sub(We)._perp()._unit();const At=nt.add(Oe)._unit(),$t=H*Math.min(4,1/(nt.x*At.x+nt.y*At.y));rt+=$t*At.x,Ve+=$t*At.y,nt=Oe}xd(this.layoutVertexArray,rt,Ve,0,0,1,1,0),me.vertexLength++,de.push(We.x,We.y),T&&Hc(this.layoutVertexExtArray,b.projectTilePoint(rt,Ve,u),b.upVector(u,rt,Ve))}}const ze=md.exports(de,Fe);for(let Ge=0;Ge<ze.length;Ge+=3)this.indexArray.emplaceBack(ie+ze[Ge],ie+ze[Ge+2],ie+ze[Ge+1]),me.primitiveLength++}for(const de of re){M&&de.length&&M.startRing(de[0]);let Fe,ze,Ge,nt=de.length>4&&Ng(de[de.length-2],de[0],de[1]),Oe=H?Ug(de[de.length-2],de[0],de[1],H):0;ze=de[1].sub(de[0])._perp()._unit();let $e=!0;for(let We=1,Xe=0;We<de.length;We++){let rt=de[We-1],Ve=de[We];const At=de[We===de.length-1?1:We+1];if(M&&B&&M.currentPolyCount.top++,Om(Ve,rt,ce)){H&&(ze=At.sub(Ve)._perp()._unit(),$e=!$e);continue}M&&M.append(Ve,rt);const $t=Ve.sub(rt)._perp(),Tt=$t.x/(Math.abs($t.x)+Math.abs($t.y)),Ct=$t.y>0?1:0,mt=rt.dist(Ve);if(Xe+mt>32768&&(Xe=0),H){Ge=At.sub(Ve)._perp()._unit();let In=Rm(rt,Ve,At,Fm(ze,Ge),H);isNaN(In)&&(In=0);const Xt=Ve.sub(rt)._unit();rt=rt.add(Xt.mult(Oe))._round(),Ve=Ve.add(Xt.mult(-In))._round(),Oe=In,ze=Ge}const jt=me.vertexLength,en=de.length>4&&Ng(rt,Ve,At);let tn=Gg(Xe,nt,$e);if(xd(this.layoutVertexArray,rt.x,rt.y,Tt,Ct,0,0,tn),xd(this.layoutVertexArray,rt.x,rt.y,Tt,Ct,0,1,tn),Xe+=mt,tn=Gg(Xe,en,!$e),nt=en,xd(this.layoutVertexArray,Ve.x,Ve.y,Tt,Ct,0,0,tn),xd(this.layoutVertexArray,Ve.x,Ve.y,Tt,Ct,0,1,tn),me.vertexLength+=4,this.indexArray.emplaceBack(jt+0,jt+1,jt+2),this.indexArray.emplaceBack(jt+1,jt+3,jt+2),me.primitiveLength+=2,H){const In=ie+(We===1?de.length-2:We-2),Xt=We===1?ie:In+1;if(this.indexArray.emplaceBack(jt+1,In,jt+3),this.indexArray.emplaceBack(In,Xt,jt+3),me.primitiveLength+=2,Fe===void 0&&(Fe=jt),!Om(At,de[We],ce)){const ni=We===de.length-1?Fe:me.vertexLength;this.indexArray.emplaceBack(jt+2,jt+3,ni),this.indexArray.emplaceBack(jt+3,ni+1,ni),this.indexArray.emplaceBack(jt+3,Xt,ni+1),me.primitiveLength+=3}$e=!$e}if(T){const In=this.layoutVertexExtArray,Xt=b.projectTilePoint(rt.x,rt.y,u),ni=b.projectTilePoint(Ve.x,Ve.y,u),un=b.upVector(u,rt.x,rt.y),fn=b.upVector(u,Ve.x,Ve.y);Hc(In,Xt,un),Hc(In,Xt,un),Hc(In,ni,fn),Hc(In,ni,fn)}}B&&(ie+=de.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const re=M.borders,ce=this.featuresOnBorder.push(M)-1;for(let ie=0;ie<4;ie++)re[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(ce)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,m,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,n,o=!0){let u,d;if(e)if(e.y!==0){const y=n.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else u=Math.ceil(7*(e.x+450)),d=0;else u=0,d=+o;let m=o?this.centroidVertexArray.length:n.vertexArrayOffset;for(const y of n.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let x=0;x<y.top;x++)this.centroidVertexArray.emplace(m++,u,d);for(let x=0;x<2*y.edges;x++)this.centroidVertexArray.emplace(m++,0,d),this.centroidVertexArray.emplace(m++,u,d)}}}function Fm(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Ug(t,e,n,o){const u=e.sub(t)._perp()._unit(),d=n.sub(e)._perp()._unit();return Rm(t,e,n,Fm(u,d),o)}function Rm(t,e,n,o,u){const d=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(n)/3,u*d/o)}function Om(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function Ng(t,e,n){if(t.x<0||t.x>=Nt||e.x<0||e.x>=Nt||n.x<0||n.x>=Nt)return!1;const o=n.sub(e),u=o.perp(),d=t.sub(e);return(o.x*d.x+o.y*d.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(d.x*d.x+d.y*d.y))>-.866&&u.x*d.x+u.y*d.y<0}function Gg(t,e,n){const o=e?2|t:-3&t;return n?1|o:-2&o}function Vg(){const t=Math.PI/32,e=Math.tan(t),n=ld;return n*Math.sqrt(1+2*e*e)-n}function wd(t,e,n){const o=1<<n.z,u=Io(n.x/o),d=Io((n.x+1)/o),m=$i(n.y/o),y=$i((n.y+1)/o);return function(x,b,T,M,B=0,L){const F=[];if(!x.length||!T||!M)return F;const N=(de,Fe)=>{for(const ze of de)F.push({polygon:ze,bounds:Fe})},H=Math.ceil(Math.log2(T)),re=Math.ceil(Math.log2(M)),ce=H-re,ie=[];for(let de=0;de<Math.abs(ce);de++)ie.push(ce>0?0:1);for(let de=0;de<Math.min(H,re);de++)ie.push(0),ie.push(1);let ae=x;if(ae=Hp(ae,b[0].y-B,b[1].y+B,1),ae=Hp(ae,b[0].x-B,b[1].x+B,0),!ae.length)return F;const me=[];for(ie.length?me.push({polygons:ae,bounds:b,depth:0}):N(ae,b);me.length;){const de=me.pop(),Fe=de.depth,ze=ie[Fe],Ge=de.bounds[0],nt=de.bounds[1],Oe=ze===0?Ge.x:Ge.y,$e=ze===0?nt.x:nt.y,We=L?L(ze,Oe,$e):.5*(Oe+$e),Xe=Hp(de.polygons,Oe-B,We+B,ze),rt=Hp(de.polygons,We-B,$e+B,ze);if(Xe.length){const Ve=[Ge,new ke(ze===0?We:nt.x,ze===1?We:nt.y)];ie.length>Fe+1?me.push({polygons:Xe,bounds:Ve,depth:Fe+1}):N(Xe,Ve)}if(rt.length){const Ve=[new ke(ze===0?We:Ge.x,ze===1?We:Ge.y),nt];ie.length>Fe+1?me.push({polygons:rt,bounds:Ve,depth:Fe+1}):N(rt,Ve)}}return F}(t,e,Math.ceil((d-u)/11.25),Math.ceil((m-y)/11.25),1,(x,b,T)=>{if(x===0)return .5*(b+T);{const M=$i((n.y+b/Nt)/o);return(zs(.5*($i((n.y+T/Nt)/o)+M))*o-n.y)*Nt}})}vt(Gu,"FillExtrusionBucket",{omit:["layers","features"]}),vt(Lm,"PartMetadata");const Zp=new st({"fill-extrusion-edge-radius":new Ie(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Gv={paint:new st({"fill-extrusion-opacity":new Ie(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ye(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ie(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ie(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new dt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ye(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ye(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ie(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ie(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ie(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Zp};function jg(t,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[t*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class $c{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=bd(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const o=function(d,m,y){var x=jg(256*d,256*(m=Math.pow(2,y)-m-1),y),b=jg(256*(d+1),256*(m+1),y);return x[0]+","+x[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),u=function(d,m,y){let x,b="";for(let T=d;T>0;T--)x=1<<T-1,b+=(m&x?1:0)+(y&x?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Um{constructor(e,n){this.wrap=e,this.canonical=n,this.key=bd(e,n.z,n.z,n.x,n.y)}}class Dr{constructor(e,n,o,u,d){this.overscaledZ=e,this.wrap=n,this.canonical=new $c(o,+u,+d),this.key=n===0&&e===o?this.canonical.key:bd(n,e,o,u,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Dr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return bd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return bd(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Dr(n,this.wrap,n,o,u),new Dr(n,this.wrap,n,o+1,u),new Dr(n,this.wrap,n,o,u+1),new Dr(n,this.wrap,n,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Dr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Um(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function bd(t,e,n,o,u){const d=1<<Math.min(n,22);let m=d*(u%d)+o%d;return t&&n<22&&(m+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*m+n)+(e-n)}vt($c,"CanonicalTileID"),vt(Dr,"OverscaledTileID",{omit:["projMatrix"]});class Zc extends ke{constructor(e,n,o){super(e,n),this.z=o}}function Ad(t,e){return t.x*e.x+t.y*e.y}function qg(t,e){if(t.length===1){let n=0;const o=e[n++];let u;for(;!u||o.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const d=e[n],m=t[0],y=u.sub(o),x=d.sub(o),b=m.sub(o),T=Ad(y,y),M=Ad(y,x),B=Ad(x,x),L=Ad(b,y),F=Ad(b,x),N=T*B-M*M,H=(B*L-M*F)/N,re=(T*F-M*L)/N,ce=o.z*(1-H-re)+u.z*H+d.z*re;if(isFinite(ce))return ce}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}function Hg(t,e,n,o,u,d,m,y){const x=m*u.getElevationAt(t,e,!0,!0),b=d[0]!==0,T=b?d[1]===0?m*(d[0]/7-450):m*function(M,B,L){const F=Math.floor(B[0]/8),N=Math.floor(B[1]/8),H=10*(B[0]-8*F),re=10*(B[1]-8*N),ce=M.getElevationAt(F,N,!0,!0),ie=M.getMeterToDEM(L),ae=Math.floor(.5*(H*ie-1)),me=Math.floor(.5*(re*ie-1)),de=M.tileCoordToPixel(F,N),Fe=2*ae+1,ze=2*me+1,Ge=function(rt,Ve,At,$t,Tt){return[rt.getElevationAtPixel(Ve,At,!0),rt.getElevationAtPixel(Ve+Tt,At,!0),rt.getElevationAtPixel(Ve,At+Tt,!0),rt.getElevationAtPixel(Ve+$t,At+Tt,!0)]}(M,de.x-ae,de.y-me,Fe,ze),nt=Math.abs(Ge[0]-Ge[1]),Oe=Math.abs(Ge[2]-Ge[3]),$e=Math.abs(Ge[0]-Ge[2])+Math.abs(Ge[1]-Ge[3]),We=Math.min(.25,.5*ie*(nt+Oe)/Fe),Xe=Math.min(.25,.5*ie*$e/ze);return ce+Math.max(We*H,Xe*re)}(u,d,y):x;return{base:x+(n===0)?-1:n,top:b?Math.max(T+o,x+n+2):x+o}}const Vv=at([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:jv}=Vv,qv=at([{name:"a_packed",components:4,type:"Float32"}]),{members:Hv}=qv,$v=qp.types,Zv=Math.cos(Math.PI/180*37.5);class lo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new En,this.layoutVertexArray2=new wi,this.indexArray=new Hi,this.programConfigurations=new rs(e.layers,e.zoom),this.segments=new bi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,u){this.hasPattern=km("line",this.layers,n);const d=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:T,id:M,index:B,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,N=Ru(T,F);if(!this.layers[0]._featureFilter.filter(new oe(this.zoom),N,o))continue;const H=d?d.evaluate(N,{},o):void 0,re={id:M,properties:T.properties,type:T.type,sourceLayerIndex:L,index:B,geometry:F?N.geometry:Or(T,o,u),patterns:{},sortKey:H};m.push(re)}d&&m.sort((T,M)=>T.sortKey-M.sortKey);const{lineAtlas:y,featureIndex:x}=n,b=this.addConstantDashes(y);for(const T of m){const{geometry:M,index:B,sourceLayerIndex:L}=T;if(b&&this.addFeatureDashes(T,y),this.hasPattern){const F=zm("line",this.layers,T,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(T,M,B,o,y.positions,n.availableImages);x.insert(e[B].feature,M,B,L,this.index)}}addConstantDashes(e){let n=!1;for(const o of this.layers){const u=o.paint.get("line-dasharray").value,d=o.layout.get("line-cap").value;if(u.kind!=="constant"||d.kind!=="constant")n=!0;else{const m=d.value,y=u.value;if(!y)continue;e.addDash(y.from,m),e.addDash(y.to,m),y.other&&e.addDash(y.other,m)}}return n}addFeatureDashes(e,n){const o=this.zoom;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(d.kind==="constant"&&m.kind==="constant")continue;let y,x,b,T,M,B;if(d.kind==="constant"){const H=d.value;if(!H)continue;y=H.other||H.to,x=H.to,b=H.from}else y=d.evaluate({zoom:o-1},e),x=d.evaluate({zoom:o},e),b=d.evaluate({zoom:o+1},e);m.kind==="constant"?T=M=B=m.value:(T=m.evaluate({zoom:o-1},e),M=m.evaluate({zoom:o},e),B=m.evaluate({zoom:o+1},e)),n.addDash(y,T),n.addDash(x,M),n.addDash(b,B);const L=n.getKey(y,T),F=n.getKey(x,M),N=n.getKey(b,B);e.patterns[u.id]={min:L,mid:F,max:N}}}update(e,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,u)}addFeatures(e,n,o,u,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,o,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Hv)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,u,d,m){const y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),b=y.get("line-cap").evaluate(e,{}),T=y.get("line-miter-limit"),M=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of n)this.addLine(B,e,x,b,T,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,m,u)}addLine(e,n,o,u,d,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<e.length-1;re++)this.totalDistance+=e[re].dist(e[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=$v[n.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let b=0;for(;b<x-1&&e[b].equals(e[b+1]);)b++;if(x<(y?3:2))return;o==="bevel"&&(d=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let B,L,F,N,H;this.e1=this.e2=-1,y&&(B=e[x-2],H=e[b].sub(B)._unit()._perp());for(let re=b;re<x;re++){if(F=re===x-1?y?e[b+1]:void 0:e[re+1],F&&e[re].equals(F))continue;H&&(N=H),B&&(L=B),B=e[re],H=F?F.sub(B)._unit()._perp():N,N=N||H;let ce=N.add(H);ce.x===0&&ce.y===0||ce._unit();const ie=N.x*H.x+N.y*H.y,ae=ce.x*H.x+ce.y*H.y,me=ae!==0?1/ae:1/0,de=2*Math.sqrt(2-2*ae),Fe=ae<Zv&&L&&F,ze=N.x*H.y-N.y*H.x>0;if(Fe&&re>b){const Oe=B.dist(L);if(Oe>2*T){const $e=B.sub(B.sub(L)._mult(T/Oe)._round());this.updateDistance(L,$e),this.addCurrentVertex($e,N,0,0,M),L=$e}}const Ge=L&&F;let nt=Ge?o:y?"butt":u;if(Ge&&nt==="round"&&(me<m?nt="miter":me<=2&&(nt="fakeround")),nt==="miter"&&me>d&&(nt="bevel"),nt==="bevel"&&(me>2&&(nt="flipbevel"),me<d&&(nt="miter")),L&&this.updateDistance(L,B),nt==="miter")ce._mult(me),this.addCurrentVertex(B,ce,0,0,M);else if(nt==="flipbevel"){if(me>100)ce=H.mult(-1);else{const Oe=me*N.add(H).mag()/N.sub(H).mag();ce._perp()._mult(Oe*(ze?-1:1))}this.addCurrentVertex(B,ce,0,0,M),this.addCurrentVertex(B,ce.mult(-1),0,0,M)}else if(nt==="bevel"||nt==="fakeround"){const Oe=-Math.sqrt(me*me-1),$e=ze?Oe:0,We=ze?0:Oe;if(L&&this.addCurrentVertex(B,N,$e,We,M),nt==="fakeround"){const Xe=Math.round(180*de/Math.PI/20);for(let rt=1;rt<Xe;rt++){let Ve=rt/Xe;if(Ve!==.5){const $t=Ve-.5;Ve+=Ve*$t*(Ve-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*$t*$t+(.848013+ie*(.215638*ie-1.06021)))}const At=H.sub(N)._mult(Ve)._add(N)._unit()._mult(ze?-1:1);this.addHalfVertex(B,At.x,At.y,!1,ze,0,M)}}F&&this.addCurrentVertex(B,H,-$e,-We,M)}else if(nt==="butt")this.addCurrentVertex(B,ce,0,0,M);else if(nt==="square"){const Oe=L?1:-1;L||this.addCurrentVertex(B,ce,Oe,Oe,M),this.addCurrentVertex(B,ce,0,0,M),L&&this.addCurrentVertex(B,ce,Oe,Oe,M)}else nt==="round"&&(L&&(this.addCurrentVertex(B,N,0,0,M),this.addCurrentVertex(B,N,1,1,M,!0)),F&&(this.addCurrentVertex(B,H,-1,-1,M,!0),this.addCurrentVertex(B,H,0,0,M)));if(Fe&&re<x-1){const Oe=B.dist(F);if(Oe>2*T){const $e=B.add(F.sub(B)._mult(T/Oe)._round());this.updateDistance(B,$e),this.addCurrentVertex($e,H,0,0,M),B=$e}}}}addCurrentVertex(e,n,o,u,d,m=!1){const y=n.y*u-n.x,x=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,m,!1,o,d),this.addHalfVertex(e,y,x,m,!0,-u,d)}addHalfVertex({x:e,y:n},o,u,d,m,y,x){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),x.primitiveLength++),m?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}vt(lo,"LineBucket",{omit:["layers","patternFeatures"]});const Wv=new st({"line-cap":new ye(Ue.layout_line["line-cap"]),"line-join":new ye(Ue.layout_line["line-join"]),"line-miter-limit":new Ie(Ue.layout_line["line-miter-limit"]),"line-round-limit":new Ie(Ue.layout_line["line-round-limit"]),"line-sort-key":new ye(Ue.layout_line["line-sort-key"])});var $g={paint:new st({"line-opacity":new ye(Ue.paint_line["line-opacity"]),"line-color":new ye(Ue.paint_line["line-color"]),"line-translate":new Ie(Ue.paint_line["line-translate"]),"line-translate-anchor":new Ie(Ue.paint_line["line-translate-anchor"]),"line-width":new ye(Ue.paint_line["line-width"]),"line-gap-width":new ye(Ue.paint_line["line-gap-width"]),"line-offset":new ye(Ue.paint_line["line-offset"]),"line-blur":new ye(Ue.paint_line["line-blur"]),"line-dasharray":new dt(Ue.paint_line["line-dasharray"]),"line-pattern":new dt(Ue.paint_line["line-pattern"]),"line-gradient":new lt(Ue.paint_line["line-gradient"]),"line-trim-offset":new Ie(Ue.paint_line["line-trim-offset"])}),layout:Wv};const Jl=new class extends ye{possiblyEvaluate(t,e){return e=new oe(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,o){return e=Bt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,o)}}($g.paint.properties["line-width"].specification);function pn(t,e){return e>0?e+2*t:t}Jl.useIntegerZoom=!0;const Kv=at([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uo=at([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Di=at([{name:"a_projected_pos",components:4,type:"Float32"}],4);at([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xv=at([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Yl=at([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Zg=at([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Jv=at([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);at([{name:"triangle",components:3,type:"Uint16"}]),at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),at([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),at([{type:"Float32",name:"offsetX"}]),at([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var tr=24;const ya=128;function Nm(t,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new oe(t+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let d=0;for(;d<o.length&&o[d]<=t;)d++;d=Math.max(0,d-1);let m=d;for(;m<o.length&&o[m]<t+1;)m++;m=Math.min(o.length-1,m);const y=o[d],x=o[m];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new oe(y)),maxSize:n.evaluate(new oe(x)),interpolationType:u}}}function Wc(t,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:u}){return t.kind==="source"?o/ya:t.kind==="composite"?mn(o/ya,u/ya,n):e}function Kc(t,e){let n=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:m}=t,y=u?cn(Zo.interpolationFactor(u,e,d,m),0,1):0;t.kind==="camera"?o=mn(t.minSize,t.maxSize,y):n=y}return{uSizeT:n,uSize:o}}var el=Object.freeze({__proto__:null,getSizeData:Nm,evaluateSizeForFeature:Wc,evaluateSizeForZoom:Kc,SIZE_PACK_FACTOR:ya});function Wg(t,e,n){return t.sections.forEach(o=>{o.text=function(u,d,m){const y=d.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),ue.applyArabicShaping&&(u=ue.applyArabicShaping(u)),u}(o.text,e,n)}),t}const Ql={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function fi(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function Ei(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var Xc=Vn,Kg=function(t,e,n,o,u){var d,m,y=8*u-o-1,x=(1<<y)-1,b=x>>1,T=-7,M=n?u-1:0,B=n?-1:1,L=t[e+M];for(M+=B,d=L&(1<<-T)-1,L>>=-T,T+=y;T>0;d=256*d+t[e+M],M+=B,T-=8);for(m=d&(1<<-T)-1,d>>=-T,T+=o;T>0;m=256*m+t[e+M],M+=B,T-=8);if(d===0)d=1-b;else{if(d===x)return m?NaN:1/0*(L?-1:1);m+=Math.pow(2,o),d-=b}return(L?-1:1)*m*Math.pow(2,d-o)},Xg=function(t,e,n,o,u,d){var m,y,x,b=8*d-u-1,T=(1<<b)-1,M=T>>1,B=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=o?0:d-1,F=o?1:-1,N=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=T):(m=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-m))<1&&(m--,x*=2),(e+=m+M>=1?B/x:B*Math.pow(2,1-M))*x>=2&&(m++,x/=2),m+M>=T?(y=0,m=T):m+M>=1?(y=(e*x-1)*Math.pow(2,u),m+=M):(y=e*Math.pow(2,M-1)*Math.pow(2,u),m=0));u>=8;t[n+L]=255&y,L+=F,y/=256,u-=8);for(m=m<<u|y,b+=u;b>0;t[n+L]=255&m,L+=F,m/=256,b-=8);t[n+L-F]|=128*N};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Vn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Vn.Varint=0,Vn.Fixed64=1,Vn.Bytes=2,Vn.Fixed32=5;var Gm=4294967296,Jg=1/Gm,Yg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function va(t){return t.type===Vn.Bytes?t.readVarint()+t.pos:t.pos+1}function xa(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Wp(t,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var u=n.pos-1;u>=t;u--)n.buf[u+o]=n.buf[u]}function Yv(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Qg(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Kp(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Bo(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Jc(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Qv(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function ex(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function tx(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function nx(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Xp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Vu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function wa(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function _n(t,e,n){e.glyphs=[],t===1&&n.readMessage(ey,e)}function ey(t,e,n){if(t===3){const{id:o,bitmap:u,width:d,height:m,left:y,top:x,advance:b}=n.readMessage(as,{});e.glyphs.push({id:o,bitmap:new Qa({width:d+6,height:m+6},u),metrics:{width:d,height:m,left:y,top:x,advance:b}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function as(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}function Jp(t){let e=0,n=0;for(const m of t)e+=m.w*m.h,n=Math.max(n,m.w);t.sort((m,y)=>y.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,d=0;for(const m of t)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,d=Math.max(d,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const b=o.pop();y<o.length&&(o[y]=b)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(o.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}Vn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),u=o>>3,d=this.pos;this.type=7&o,t(u,e,this),this.pos===d&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Xp(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wa(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Xp(this.buf,this.pos)+Xp(this.buf,this.pos+4)*Gm;return this.pos+=8,t},readSFixed64:function(){var t=Xp(this.buf,this.pos)+wa(this.buf,this.pos+4)*Gm;return this.pos+=8,t},readFloat:function(){var t=Kg(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Kg(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(u,d,m){var y,x,b=m.buf;if(y=(112&(x=b[m.pos++]))>>4,x<128||(y|=(127&(x=b[m.pos++]))<<3,x<128)||(y|=(127&(x=b[m.pos++]))<<10,x<128)||(y|=(127&(x=b[m.pos++]))<<17,x<128)||(y|=(127&(x=b[m.pos++]))<<24,x<128)||(y|=(1&(x=b[m.pos++]))<<31,x<128))return xa(u,y,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Yg?function(n,o,u){return Yg.decode(n.subarray(o,u))}(this.buf,e,t):function(n,o,u){for(var d="",m=o;m<u;){var y,x,b,T=n[m],M=null,B=T>239?4:T>223?3:T>191?2:1;if(m+B>u)break;B===1?T<128&&(M=T):B===2?(192&(y=n[m+1]))==128&&(M=(31&T)<<6|63&y)<=127&&(M=null):B===3?(x=n[m+2],(192&(y=n[m+1]))==128&&(192&x)==128&&((M=(15&T)<<12|(63&y)<<6|63&x)<=2047||M>=55296&&M<=57343)&&(M=null)):B===4&&(x=n[m+2],b=n[m+3],(192&(y=n[m+1]))==128&&(192&x)==128&&(192&b)==128&&((M=(15&T)<<18|(63&y)<<12|(63&x)<<6|63&b)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,B=1):M>65535&&(M-=65536,d+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),d+=String.fromCharCode(M),m+=B}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Vn.Bytes)return t.push(this.readVarint(e));var n=va(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Vn.Bytes)return t.push(this.readSVarint());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Vn.Bytes)return t.push(this.readBoolean());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Vn.Bytes)return t.push(this.readFloat());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Vn.Bytes)return t.push(this.readDouble());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Vn.Bytes)return t.push(this.readFixed32());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Vn.Bytes)return t.push(this.readSFixed32());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Vn.Bytes)return t.push(this.readFixed64());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Vn.Bytes)return t.push(this.readSFixed64());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Vn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Vn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Vn.Fixed32)this.pos+=4;else{if(e!==Vn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Vu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Vu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Vu(this.buf,-1&t,this.pos),Vu(this.buf,Math.floor(t*Jg),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Vu(this.buf,-1&t,this.pos),Vu(this.buf,Math.floor(t*Jg),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var o,u;if(e>=0?(o=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,m,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(o,0,n),function(d,m){var y=(7&d)<<4;m.buf[m.pos++]|=y|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d)))))}(u,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,u,d){for(var m,y,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===u.length?(o[d++]=239,o[d++]=191,o[d++]=189):y=m;continue}if(m<56320){o[d++]=239,o[d++]=191,o[d++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(o[d++]=239,o[d++]=191,o[d++]=189,y=null);m<128?o[d++]=m:(m<2048?o[d++]=m>>6|192:(m<65536?o[d++]=m>>12|224:(o[d++]=m>>18|240,o[d++]=m>>12&63|128),o[d++]=m>>6&63|128),o[d++]=63&m|128)}return d}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Wp(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Xg(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Xg(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var o=this.pos-n;o>=128&&Wp(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,n){this.writeTag(t,Vn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Yv,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Qg,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Jc,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Kp,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Bo,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Qv,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ex,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,tx,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,nx,e)},writeBytesField:function(t,e){this.writeTag(t,Vn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Vn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Vn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Vn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Vn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Vn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Vn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Vn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Vn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Vn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Vm{constructor(e,{pixelRatio:n,version:o,stretchX:u,stretchY:d,content:m}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=d,this.content=m,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class jn{constructor(e,n){const o={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,o,d),this.addImages(n,u,d);const{w:m,h:y}=Jp(d),x=new ao({width:m||1,height:y||1});for(const b in e){const T=e[b],M=o[b].paddedRect;ao.copy(T.data,x,{x:0,y:0},{x:M.x+1,y:M.y+1},T.data)}for(const b in n){const T=n[b],M=u[b].paddedRect,B=M.x+1,L=M.y+1,F=T.data.width,N=T.data.height;ao.copy(T.data,x,{x:0,y:0},{x:B,y:L},T.data),ao.copy(T.data,x,{x:0,y:N-1},{x:B,y:L-1},{width:F,height:1}),ao.copy(T.data,x,{x:0,y:0},{x:B,y:L+N},{width:F,height:1}),ao.copy(T.data,x,{x:F-1,y:0},{x:B-1,y:L},{width:1,height:N}),ao.copy(T.data,x,{x:0,y:0},{x:B+F,y:L},{width:1,height:N})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(e,n,o){for(const u in e){const d=e[u],m={x:0,y:0,w:d.data.width+2,h:d.data.height+2};o.push(m),n[u]=new Vm(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,d]=e.tl;o.update(n.data,void 0,{x:u,y:d})}}vt(Vm,"ImagePosition"),vt(jn,"ImageAtlas");const Do={horizontal:1,vertical:2,horizontalOnly:3};class Yc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new Yc;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Yc;return n.imageName=e,n}}class tl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new tl;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?o.addImageSection(d):o.addTextSection(d,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,o){let u="";for(let d=0;d<n.length;d++){const m=n.charCodeAt(d+1)||null,y=n.charCodeAt(d-1)||null;u+=!o&&(m&&A(m)&&!Ql[n[d+1]]||y&&A(y)&&!Ql[n[d-1]])||!Ql[n[d]]?n[d]:Ql[n[d]]}return u}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Yp[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Yp[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new tl;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Yc.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Xn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Yc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Xn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jm(t,e,n,o,u,d,m,y,x,b,T,M,B,L,F,N){const H=tl.fromFeature(t,u);let re;M===Do.vertical&&H.verticalizePunctuation(B);const{processBidirectionalText:ce,processStyledBidirectionalText:ie}=ue;if(ce&&H.sections.length===1){re=[];const de=ce(H.toString(),qm(H,b,d,e,o,L,F));for(const Fe of de){const ze=new tl;ze.text=Fe,ze.sections=H.sections;for(let Ge=0;Ge<Fe.length;Ge++)ze.sectionIndex.push(0);re.push(ze)}}else if(ie){re=[];const de=ie(H.text,H.sectionIndex,qm(H,b,d,e,o,L,F));for(const Fe of de){const ze=new tl;ze.text=Fe[0],ze.sectionIndex=Fe[1],ze.sections=H.sections,re.push(ze)}}else re=function(de,Fe){const ze=[],Ge=de.text;let nt=0;for(const Oe of Fe)ze.push(de.substring(nt,Oe)),nt=Oe;return nt<Ge.length&&ze.push(de.substring(nt,Ge.length)),ze}(H,qm(H,b,d,e,o,L,F));const ae=[],me={positionedLines:ae,text:H.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(de,Fe,ze,Ge,nt,Oe,$e,We,Xe,rt,Ve,At){let $t=0,Tt=0,Ct=0;const mt=We==="right"?1:We==="left"?0:.5;let jt=!1;for(const un of nt){const fn=un.getSections();for(const qn of fn){if(qn.imageName)continue;const Qn=Fe[qn.fontStack];if(Qn&&(jt=Qn.ascender!==void 0&&Qn.descender!==void 0,!jt))break}if(!jt)break}let en=0;for(const un of nt){un.trim();const fn=un.getMaxScale(),qn=(fn-1)*tr,Qn={positionedGlyphs:[],lineOffset:0};de.positionedLines[en]=Qn;const Yn=Qn.positionedGlyphs;let ei=0;if(!un.length()){Tt+=Oe,++en;continue}let ii=0,mi=0;for(let Un=0;Un<un.length();Un++){const Oi=un.getSection(Un),ki=un.getSectionIndex(Un),Mn=un.getCharCode(Un);let li=Oi.scale,Zi=null,Hn=null,Ti=null,Gr=tr,gr=0;const yr=!(Xe===Do.horizontal||!Ve&&!v(Mn)||Ve&&(Yp[Mn]||(tn=Mn,hp(tn)||ku(tn)||es(tn)||Lu(tn)||c(tn))));if(Oi.imageName){const ho=Ge[Oi.imageName];if(!ho)continue;Ti=Oi.imageName,de.iconsInText=de.iconsInText||!0,Hn=ho.paddedRect;const vr=ho.displaySize;li=li*tr/At,Zi={width:vr[0],height:vr[1],left:1,top:-3,advance:yr?vr[1]:vr[0],localGlyph:!1},gr=jt?-Zi.height*li:fn*tr-17-vr[1]*li,Gr=Zi.advance;const $u=(yr?vr[0]:vr[1])*li-tr*fn;$u>0&&$u>ei&&(ei=$u)}else{const ho=ze[Oi.fontStack];if(!ho)continue;ho[Mn]&&(Hn=ho[Mn]);const vr=Fe[Oi.fontStack];if(!vr)continue;const $u=vr.glyphs[Mn];if(!$u)continue;if(Zi=$u.metrics,Gr=Mn!==8203?tr:0,jt){const ff=vr.ascender!==void 0?Math.abs(vr.ascender):0,a_=vr.descender!==void 0?Math.abs(vr.descender):0,l_=(ff+a_)*li;ii<l_&&(ii=l_,mi=(ff-a_)/2*li),gr=-ff*li}else gr=(fn-li)*tr-17}yr?(de.verticalizable=!0,Yn.push({glyph:Mn,imageName:Ti,x:$t,y:Tt+gr,vertical:yr,scale:li,localGlyph:Zi.localGlyph,fontStack:Oi.fontStack,sectionIndex:ki,metrics:Zi,rect:Hn}),$t+=Gr*li+rt):(Yn.push({glyph:Mn,imageName:Ti,x:$t,y:Tt+gr,vertical:yr,scale:li,localGlyph:Zi.localGlyph,fontStack:Oi.fontStack,sectionIndex:ki,metrics:Zi,rect:Hn}),$t+=Zi.advance*li+rt)}Yn.length!==0&&(Ct=Math.max($t-rt,Ct),jt?oy(Yn,mt,ei,mi,Oe*fn/2):oy(Yn,mt,ei,0,Oe/2)),$t=0;const _r=Oe*fn+ei;Qn.lineOffset=Math.max(ei,qn),Tt+=_r,++en}var tn;const In=Tt,{horizontalAlign:Xt,verticalAlign:ni}=Hm($e);(function(un,fn,qn,Qn,Yn,ei){const ii=(fn-qn)*Yn,mi=-ei*Qn;for(const _r of un)for(const Un of _r.positionedGlyphs)Un.x+=ii,Un.y+=mi})(de.positionedLines,mt,Xt,ni,Ct,In),de.top+=-ni*In,de.bottom=de.top+In,de.left+=-Xt*Ct,de.right=de.left+Ct,de.hasBaseline=jt}(me,e,n,o,re,m,y,x,M,b,B,N),!function(de){for(const Fe of de)if(Fe.positionedGlyphs.length!==0)return!1;return!0}(ae)&&me}const Yp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ix={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ty(t,e,n,o,u,d){if(e.imageName){const m=o[e.imageName];return m?m.displaySize[0]*e.scale*tr/d+u:0}{const m=n[e.fontStack],y=m&&m.glyphs[t];return y?y.metrics.advance*e.scale+u:0}}function ny(t,e,n,o){const u=Math.pow(t-e,2);return o?t<e?u/2:2*u:u+Math.abs(n)*n}function rx(t,e,n){let o=0;return t===10&&(o-=1e4),n&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function iy(t,e,n,o,u,d){let m=null,y=ny(e,n,u,d);for(const x of o){const b=ny(e-x.x,n,u,d)+x.badness;b<=y&&(m=x,y=b)}return{index:t,x:e,priorBreak:m,badness:y}}function ry(t){return t?ry(t.priorBreak).concat(t.index):[]}function qm(t,e,n,o,u,d,m){if(d!=="point")return[];if(!t)return[];const y=[],x=function(B,L,F,N,H,re){let ce=0;for(let ie=0;ie<B.length();ie++){const ae=B.getSection(ie);ce+=ty(B.getCharCode(ie),ae,N,H,L,re)}return ce/Math.max(1,Math.ceil(ce/F))}(t,e,n,o,u,m),b=t.text.indexOf("\u200B")>=0;let T=0;for(let B=0;B<t.length();B++){const L=t.getSection(B),F=t.getCharCode(B);if(Yp[F]||(T+=ty(F,L,o,u,e,m)),B<t.length()-1){const N=!((M=F)<11904||!(Bc(M)||Mc(M)||Ka(M)||gp(M)||fp(M)||Yh(M)||eo(M)||zu(M)||mp(M)||td(M)||ed(M)||i(M)||Ic(M)||Qh(M)||dp(M)||pp(M)||Eo(M)||Vl(M)||nd(M)||Pu(M)));(ix[F]||N||L.imageName)&&y.push(iy(B+1,T,x,y,rx(F,t.getCharCode(B+1),N&&b),!1))}}var M;return ry(iy(t.length(),T,x,y,0,!0))}function Hm(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function oy(t,e,n,o,u){if(!(e||n||o||u))return;const d=t.length-1,m=t[d],y=(m.x+m.metrics.advance*m.scale)*e;for(let x=0;x<=d;x++)t[x].x-=y,t[x].y+=n+o+u}function ox(t,e,n){const{horizontalAlign:o,verticalAlign:u}=Hm(n),d=e[0]-t.displaySize[0]*o,m=e[1]-t.displaySize[1]*u;return{image:t,top:m,bottom:m+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function sy(t,e,n,o,u,d){const m=t.image;let y;if(m.content){const H=m.content,re=m.pixelRatio||1;y=[H[0]/re,H[1]/re,m.displaySize[0]-H[2]/re,m.displaySize[1]-H[3]/re]}const x=e.left*d,b=e.right*d;let T,M,B,L;n==="width"||n==="both"?(L=u[0]+x-o[3],M=u[0]+b+o[1]):(L=u[0]+(x+b-m.displaySize[0])/2,M=L+m.displaySize[0]);const F=e.top*d,N=e.bottom*d;return n==="height"||n==="both"?(T=u[1]+F-o[0],B=u[1]+N+o[2]):(T=u[1]+(F+N-m.displaySize[1])/2,B=T+m.displaySize[1]),{image:m,top:T,right:M,bottom:B,left:L,collisionPadding:y}}class Rs extends ke{constructor(e,n,o,u,d){super(e,n),this.angle=u,this.z=o,d!==void 0&&(this.segment=d)}clone(){return new Rs(this.x,this.y,this.z,this.angle,this.segment)}}function ay(t,e,n,o,u){if(e.segment===void 0)return!0;let d=e,m=e.segment+1,y=0;for(;y>-n/2;){if(m--,m<0)return!1;y-=t[m].dist(d),d=t[m]}y+=t[m].dist(t[m+1]),m++;const x=[];let b=0;for(;y<n/2;){const T=t[m],M=t[m+1];if(!M)return!1;let B=t[m-1].angleTo(T)-T.angleTo(M);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:B}),b+=B;y-x[0].distance>o;)b-=x.shift().angleDelta;if(b>u)return!1;m++,y+=T.dist(M)}return!0}function Qp(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function ly(t,e,n){return t?.6*e*n:0}function uy(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function sx(t,e,n,o,u,d){const m=ly(n,u,d),y=uy(n,o)*d;let x=0;const b=Qp(t)/2;for(let T=0;T<t.length-1;T++){const M=t[T],B=t[T+1],L=M.dist(B);if(x+L>b){const F=(b-x)/L,N=mn(M.x,B.x,F),H=mn(M.y,B.y,F),re=new Rs(N,H,0,B.angleTo(M),T);return!m||ay(t,re,y,m,e)?re:void 0}x+=L}}function nr(t,e,n,o,u,d,m,y,x){const b=ly(o,d,m),T=uy(o,u),M=T*m,B=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-M<e/4&&(e=M+e/4),Ur(t,B?e/2*y%e:(T/2+2*d)*m*y%e,e,b,n,M,B,!1,x)}function Ur(t,e,n,o,u,d,m,y,x){const b=d/2,T=Qp(t);let M=0,B=e-n,L=[];for(let F=0;F<t.length-1;F++){const N=t[F],H=t[F+1],re=N.dist(H),ce=H.angleTo(N);for(;B+n<M+re;){B+=n;const ie=(B-M)/re,ae=mn(N.x,H.x,ie),me=mn(N.y,H.y,ie);if(ae>=0&&ae<x&&me>=0&&me<x&&B-b>=0&&B+b<=T){const de=new Rs(ae,me,0,ce,F);de._round(),o&&!ay(t,de,d,o,u)||L.push(de)}}M+=re}return y||L.length||m||(L=Ur(t,M/2,n,o,u,d,m,!0,x)),L}function cy(t,e,n,o,u){const d=[];for(let m=0;m<t.length;m++){const y=t[m];let x;for(let b=0;b<y.length-1;b++){let T=y[b],M=y[b+1];T.x<e&&M.x<e||(T.x<e?T=new ke(e,T.y+(e-T.x)/(M.x-T.x)*(M.y-T.y))._round():M.x<e&&(M=new ke(e,T.y+(e-T.x)/(M.x-T.x)*(M.y-T.y))._round()),T.y<n&&M.y<n||(T.y<n?T=new ke(T.x+(n-T.y)/(M.y-T.y)*(M.x-T.x),n)._round():M.y<n&&(M=new ke(T.x+(n-T.y)/(M.y-T.y)*(M.x-T.x),n)._round()),T.x>=o&&M.x>=o||(T.x>=o?T=new ke(o,T.y+(o-T.x)/(M.x-T.x)*(M.y-T.y))._round():M.x>=o&&(M=new ke(o,T.y+(o-T.x)/(M.x-T.x)*(M.y-T.y))._round()),T.y>=u&&M.y>=u||(T.y>=u?T=new ke(T.x+(u-T.y)/(M.y-T.y)*(M.x-T.x),u)._round():M.y>=u&&(M=new ke(T.x+(u-T.y)/(M.y-T.y)*(M.x-T.x),u)._round()),x&&T.equals(x[x.length-1])||(x=[T],d.push(x)),x.push(M)))))}}return d}vt(Rs,"Anchor");const Ed=1e20;function hy(t,e,n,o,u,d,m,y,x){for(let b=e;b<e+o;b++)$m(t,n*d+b,d,u,m,y,x);for(let b=n;b<n+u;b++)$m(t,b*d+e,1,o,m,y,x)}function $m(t,e,n,o,u,d,m){d[0]=0,m[0]=-Ed,m[1]=Ed,u[0]=t[e];for(let y=1,x=0,b=0;y<o;y++){u[y]=t[e+y*n];const T=y*y;do{const M=d[x];b=(u[y]-u[M]+T-M*M)/(y-M)/2}while(b<=m[x]&&--x>-1);x++,d[x]=y,m[x]=b,m[x+1]=Ed}for(let y=0,x=0;y<o;y++){for(;m[x+1]<y;)x++;const b=d[x],T=y-b;t[e+y*n]=u[b]+T*T}}const Zm={none:0,ideographs:1,all:2};class Qc{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const o=[];for(const u in e)for(const d of e[u])o.push({stack:u,id:d});wt(o,({stack:u,id:d},m)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=y.glyphs[d];if(x!==void 0)return void m(null,{stack:u,id:d,glyph:x});if(x=this._tinySDF(y,u,d),x)return y.glyphs[d]=x,void m(null,{stack:u,id:d,glyph:x});const b=Math.floor(d/256);if(256*b>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[b])return void m(null,{stack:u,id:d,glyph:x});let T=y.requests[b];T||(T=y.requests[b]=[],Qc.loadGlyphRange(u,b,this.url,this.requestManager,(M,B)=>{if(B){y.ascender=B.ascender,y.descender=B.descender;for(const L in B.glyphs)this._doesCharSupportLocalGlyph(+L)||(y.glyphs[+L]=B.glyphs[+L]);y.ranges[b]=!0}for(const L of T)L(M,B);delete y.requests[b]})),T.push((M,B)=>{M?m(M):B&&m(null,{stack:u,id:d,glyph:B.glyphs[d]||null})})},(u,d)=>{if(u)n(u);else if(d){const m={};for(const{stack:y,id:x,glyph:b}of d)m[y]===void 0&&(m[y]={}),m[y].glyphs===void 0&&(m[y].glyphs={}),m[y].glyphs[x]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},m[y].ascender=this.entries[y].ascender,m[y].descender=this.entries[y].descender;n(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Zm.none&&(this.localGlyphMode===Zm.all?!!this.localFontFamily:!!this.localFontFamily&&(td(e)||_p(e)||Ic(e)||Eo(e)||zu(e)))}_tinySDF(e,n,o){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(o))return;let d=e.tinySDF;if(!d){let N="400";/bold/i.test(n)?N="900":/medium/i.test(n)?N="500":/light/i.test(n)&&(N="200"),d=e.tinySDF=new Qc.TinySDF({fontFamily:u,fontWeight:N,fontSize:48,buffer:6,radius:16}),d.fontWeight=N}if(this.localGlyphs[d.fontWeight][o])return this.localGlyphs[d.fontWeight][o];const m=String.fromCharCode(o),{data:y,width:x,height:b,glyphWidth:T,glyphHeight:M,glyphLeft:B,glyphTop:L,glyphAdvance:F}=d.draw(m);return this.localGlyphs[d.fontWeight][o]={id:o,bitmap:new Qa({width:x,height:b},y),metrics:{width:T/2,height:M/2,left:B/2,top:L/2-27,advance:F/2,localGlyph:!0}}}}function dy(t,e,n,o){const u=[],d=t.image,m=d.pixelRatio,y=d.paddedRect.w-2,x=d.paddedRect.h-2,b=t.right-t.left,T=t.bottom-t.top,M=d.stretchX||[[0,y]],B=d.stretchY||[[0,x]],L=(Oe,$e)=>Oe+$e[1]-$e[0],F=M.reduce(L,0),N=B.reduce(L,0),H=y-F,re=x-N;let ce=0,ie=F,ae=0,me=N,de=0,Fe=H,ze=0,Ge=re;if(d.content&&o){const Oe=d.content;ce=Cd(M,0,Oe[0]),ae=Cd(B,0,Oe[1]),ie=Cd(M,Oe[0],Oe[2]),me=Cd(B,Oe[1],Oe[3]),de=Oe[0]-ce,ze=Oe[1]-ae,Fe=Oe[2]-Oe[0]-ie,Ge=Oe[3]-Oe[1]-me}const nt=(Oe,$e,We,Xe)=>{const rt=ef(Oe.stretch-ce,ie,b,t.left),Ve=tf(Oe.fixed-de,Fe,Oe.stretch,F),At=ef($e.stretch-ae,me,T,t.top),$t=tf($e.fixed-ze,Ge,$e.stretch,N),Tt=ef(We.stretch-ce,ie,b,t.left),Ct=tf(We.fixed-de,Fe,We.stretch,F),mt=ef(Xe.stretch-ae,me,T,t.top),jt=tf(Xe.fixed-ze,Ge,Xe.stretch,N),en=new ke(rt,At),tn=new ke(Tt,At),In=new ke(Tt,mt),Xt=new ke(rt,mt),ni=new ke(Ve/m,$t/m),un=new ke(Ct/m,jt/m),fn=e*Math.PI/180;if(fn){const Yn=Math.sin(fn),ei=Math.cos(fn),ii=[ei,-Yn,Yn,ei];en._matMult(ii),tn._matMult(ii),Xt._matMult(ii),In._matMult(ii)}const qn=Oe.stretch+Oe.fixed,Qn=$e.stretch+$e.fixed;return{tl:en,tr:tn,bl:Xt,br:In,tex:{x:d.paddedRect.x+1+qn,y:d.paddedRect.y+1+Qn,w:We.stretch+We.fixed-qn,h:Xe.stretch+Xe.fixed-Qn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ni,pixelOffsetBR:un,minFontScaleX:Fe/m/b,minFontScaleY:Ge/m/T,isSDF:n}};if(o&&(d.stretchX||d.stretchY)){const Oe=py(M,H,F),$e=py(B,re,N);for(let We=0;We<Oe.length-1;We++){const Xe=Oe[We],rt=Oe[We+1];for(let Ve=0;Ve<$e.length-1;Ve++)u.push(nt(Xe,$e[Ve],rt,$e[Ve+1]))}}else u.push(nt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Cd(t,e,n){let o=0;for(const u of t)o+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return o}function py(t,e,n){const o=[{fixed:-1,stretch:0}];for(const[u,d]of t){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(d-u)})}return o.push({fixed:e+1,stretch:n}),o}function ef(t,e,n,o){return t/e*n+o}function tf(t,e,n,o){return t-e*n/o}function fy(t,e,n,o){const u=e+t.positionedLines[o].lineOffset;return o===0?n+u/2:n+(u+(e+t.positionedLines[o-1].lineOffset))/2}Qc.loadGlyphRange=function(t,e,n,o,u){const d=256*e,m=d+255,y=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${d}-${m}`),sr.Glyphs);Go(y,(x,b)=>{if(x)u(x);else if(b){const T={},M=function(B){return new Xc(B).readFields(_n,{})}(b);for(const B of M.glyphs)T[B.id]=B;u(null,{glyphs:T,ascender:M.ascender,descender:M.descender})}})},Qc.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;const y=this.size=t+4*e,x=this._createCanvas(y),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${m} ${d} ${t}px ${u}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(t),m=Math.ceil(n),y=Math.min(this.size-this.buffer,Math.ceil(d-u)),x=Math.min(this.size-this.buffer,m+Math.ceil(o)),b=y+2*this.buffer,T=x+2*this.buffer,M=Math.max(b*T,0),B=new Uint8ClampedArray(M),L={data:B,width:b,height:T,glyphWidth:y,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||x===0)return L;const{ctx:F,buffer:N,gridInner:H,gridOuter:re}=this;F.clearRect(N,N,y,x),F.fillText(t,N,N+m);const ce=F.getImageData(N,N,y,x);re.fill(Ed,0,M),H.fill(0,0,M);for(let ie=0;ie<x;ie++)for(let ae=0;ae<y;ae++){const me=ce.data[4*(ie*y+ae)+3]/255;if(me===0)continue;const de=(ie+N)*b+ae+N;if(me===1)re[de]=0,H[de]=Ed;else{const Fe=.5-me;re[de]=Fe>0?Fe*Fe:0,H[de]=Fe<0?Fe*Fe:0}}hy(re,0,0,b,T,b,this.f,this.v,this.z),hy(H,N,N,y,x,b,this.f,this.v,this.z);for(let ie=0;ie<M;ie++){const ae=Math.sqrt(re[ie])-Math.sqrt(H[ie]);B[ie]=Math.round(255-255*(ae/this.radius+this.cutoff))}return L}};class my{constructor(e=[],n=ax){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,u=n[e];for(;e>0;){const d=e-1>>1,m=n[d];if(o(u,m)>=0)break;n[e]=m,e=d}n[e]=u}_down(e){const{data:n,compare:o}=this,u=this.length>>1,d=n[e];for(;e<u;){let m=1+(e<<1),y=n[m];const x=m+1;if(x<this.length&&o(n[x],y)<0&&(m=x,y=n[x]),o(y,d)>=0)break;n[e]=y,e=m}n[e]=d}}function ax(t,e){return t<e?-1:t>e?1:0}function lx(t,e=1,n=!1){let o=1/0,u=1/0,d=-1/0,m=-1/0;const y=t[0];for(let L=0;L<y.length;L++){const F=y[L];(!L||F.x<o)&&(o=F.x),(!L||F.y<u)&&(u=F.y),(!L||F.x>d)&&(d=F.x),(!L||F.y>m)&&(m=F.y)}const x=Math.min(d-o,m-u);let b=x/2;const T=new my([],ux);if(x===0)return new ke(o,u);for(let L=o;L<d;L+=x)for(let F=u;F<m;F+=x)T.push(new eh(L+b,F+b,b,t));let M=function(L){let F=0,N=0,H=0;const re=L[0];for(let ce=0,ie=re.length,ae=ie-1;ce<ie;ae=ce++){const me=re[ce],de=re[ae],Fe=me.x*de.y-de.x*me.y;N+=(me.x+de.x)*Fe,H+=(me.y+de.y)*Fe,F+=3*Fe}return new eh(N/F,H/F,0,L)}(t),B=T.length;for(;T.length;){const L=T.pop();(L.d>M.d||!M.d)&&(M=L,n&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,B)),L.max-M.d<=e||(b=L.h/2,T.push(new eh(L.p.x-b,L.p.y-b,b,t)),T.push(new eh(L.p.x+b,L.p.y-b,b,t)),T.push(new eh(L.p.x-b,L.p.y+b,b,t)),T.push(new eh(L.p.x+b,L.p.y+b,b,t)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${M.d}`)),M.p}function ux(t,e){return e.max-t.max}function eh(t,e,n,o){this.p=new ke(t,e),this.h=n,this.d=function(u,d){let m=!1,y=1/0;for(let x=0;x<d.length;x++){const b=d[x];for(let T=0,M=b.length,B=M-1;T<M;B=T++){const L=b[T],F=b[B];L.y>u.y!=F.y>u.y&&u.x<(F.x-L.x)*(u.y-L.y)/(F.y-L.y)+L.x&&(m=!m),y=Math.min(y,cg(u,L,F))}}return(m?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const eu=Number.POSITIVE_INFINITY,cx=Math.sqrt(2);function _y(t,e){return e[1]!==eu?function(n,o,u){let d=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":m=u-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-u}switch(n){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,m]}(t,e[0],e[1]):function(n,o){let u=0,d=0;o<0&&(o=0);const m=o/cx;switch(n){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-o;break;case"top":d=o-7}switch(n){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,d]}(t,e[0])}function hx(t,e,n,o,u,d,m,y,x,b){t.createArrays(),t.tilePixelRatio=Nt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const T=t.layers[0].layout,M=t.layers[0]._unevaluatedLayout._values,B={};if(t.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:H}=t.textSizeData;B.compositeTextSizes=[M["text-size"].possiblyEvaluate(new oe(N),y),M["text-size"].possiblyEvaluate(new oe(H),y)]}if(t.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:H}=t.iconSizeData;B.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new oe(N),y),M["icon-size"].possiblyEvaluate(new oe(H),y)]}B.layoutTextSize=M["text-size"].possiblyEvaluate(new oe(x+1),y),B.layoutIconSize=M["icon-size"].possiblyEvaluate(new oe(x+1),y),B.textMaxSize=M["text-size"].possiblyEvaluate(new oe(18),y);const L=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",F=T.get("text-size");for(const N of t.features){const H=T.get("text-font").evaluate(N,{},y).join(","),re=F.evaluate(N,{},y),ce=B.layoutTextSize.evaluate(N,{},y),ie=(B.layoutIconSize.evaluate(N,{},y),{horizontal:{},vertical:void 0}),ae=N.text;let me,de=[0,0];if(ae){const Ge=ae.toString(),nt=T.get("text-letter-spacing").evaluate(N,{},y)*tr,Oe=T.get("text-line-height").evaluate(N,{},y)*tr,$e=p(Ge)?nt:0,We=T.get("text-anchor").evaluate(N,{},y),Xe=T.get("text-variable-anchor");if(!Xe){const Ct=T.get("text-radial-offset").evaluate(N,{},y);de=Ct?_y(We,[Ct*tr,eu]):T.get("text-offset").evaluate(N,{},y).map(mt=>mt*tr)}let rt=L?"center":T.get("text-justify").evaluate(N,{},y);const Ve=T.get("symbol-placement"),At=Ve==="point",$t=Ve==="point"?T.get("text-max-width").evaluate(N,{},y)*tr:0,Tt=Ct=>{t.allowVerticalPlacement&&a(Ge)&&(ie.vertical=jm(ae,e,n,u,H,$t,Oe,We,Ct,$e,de,Do.vertical,!0,Ve,ce,re))};if(!L&&Xe){const Ct=rt==="auto"?Xe.map(jt=>Wm(jt)):[rt];let mt=!1;for(let jt=0;jt<Ct.length;jt++){const en=Ct[jt];if(!ie.horizontal[en])if(mt)ie.horizontal[en]=ie.horizontal[0];else{const tn=jm(ae,e,n,u,H,$t,Oe,"center",en,$e,de,Do.horizontal,!1,Ve,ce,re);tn&&(ie.horizontal[en]=tn,mt=tn.positionedLines.length===1)}}Tt("left")}else{if(rt==="auto"&&(rt=Wm(We)),At||T.get("text-writing-mode").indexOf("horizontal")>=0||!a(Ge)){const Ct=jm(ae,e,n,u,H,$t,Oe,We,rt,$e,de,Do.horizontal,!1,Ve,ce,re);Ct&&(ie.horizontal[rt]=Ct)}Tt(Ve==="point"?"left":rt)}}let Fe=!1;if(N.icon&&N.icon.name){const Ge=o[N.icon.name];Ge&&(me=ox(u[N.icon.name],T.get("icon-offset").evaluate(N,{},y),T.get("icon-anchor").evaluate(N,{},y)),Fe=Ge.sdf,t.sdfIcons===void 0?t.sdfIcons=Ge.sdf:t.sdfIcons!==Ge.sdf&&Xn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ge.pixelRatio!==t.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const ze=gy(ie.horizontal)||ie.vertical;t.iconsInText||(t.iconsInText=!!ze&&ze.iconsInText),(ze||me)&&dx(t,N,ie,me,o,B,ce,0,de,Fe,m,y,b)}d&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)}function Wm(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dx(t,e,n,o,u,d,m,y,x,b,T,M,B){let L=d.textMaxSize.evaluate(e,{},M);L===void 0&&(L=m);const F=t.layers[0].layout,N=F.get("icon-offset").evaluate(e,{},M),H=gy(n.horizontal)||n.vertical,re=B.name==="globe",ce=m/24,ie=t.tilePixelRatio*L/24,ae=($e=t.overscaling,t.zoom>18&&$e>2&&($e>>=1),Math.max(Nt/(512*$e),1)*F.get("symbol-spacing")),me=F.get("text-padding")*t.tilePixelRatio,de=F.get("icon-padding")*t.tilePixelRatio,Fe=zt(F.get("text-max-angle")),ze=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Ge=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",nt=F.get("symbol-placement"),Oe=ae/2;var $e;const We=F.get("icon-text-fit");let Xe;o&&We!=="none"&&(t.allowVerticalPlacement&&n.vertical&&(Xe=sy(o,n.vertical,We,F.get("icon-text-fit-padding"),N,ce)),H&&(o=sy(o,H,We,F.get("icon-text-fit-padding"),N,ce)));const rt=(Ve,At,$t)=>{if(At.x<0||At.x>=Nt||At.y<0||At.y>=Nt)return;let Tt=null;if(re){const{x:Ct,y:mt,z:jt}=B.projectTilePoint(At.x,At.y,$t);Tt={anchor:new Rs(Ct,mt,jt,0,void 0),up:B.upVector($t,At.x,At.y)}}(function(Ct,mt,jt,en,tn,In,Xt,ni,un,fn,qn,Qn,Yn,ei,ii,mi,_r,Un,Oi,ki,Mn,li,Zi,Hn,Ti){const Gr=Ct.addToLineVertexArray(mt,en);let gr,yr,ho,vr,$u,ff,a_,l_=0,Eb=0,Cb=0,Tb=0,Lx=-1,Fx=-1;const ru={};let Sb=zc.exports("");const zd=jt?jt.anchor:mt;let Rx=0,Ox=0;if(un._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Rx,Ox]=un.layout.get("text-offset").evaluate(Mn,{},Ti).map(us=>us*tr):(Rx=un.layout.get("text-radial-offset").evaluate(Mn,{},Ti)*tr,Ox=eu),Ct.allowVerticalPlacement&&tn.vertical){const us=tn.vertical;if(ii)ff=Xm(us),ni&&(a_=Xm(ni));else{const cs=un.layout.get("text-rotate").evaluate(Mn,{},Ti)+90;ho=nf(fn,zd,mt,qn,Qn,Yn,us,ei,cs,mi),ni&&(vr=nf(fn,zd,mt,qn,Qn,Yn,ni,Un,cs))}}if(In){const us=un.layout.get("icon-rotate").evaluate(Mn,{},Ti),cs=un.layout.get("icon-text-fit")!=="none",u_=dy(In,us,Zi,cs),Nx=ni?dy(ni,us,Zi,cs):void 0;yr=nf(fn,zd,mt,qn,Qn,Yn,In,Un,us),l_=4*u_.length;const Ib=Ct.iconSizeData;let Pd=null;Ib.kind==="source"?(Pd=[ya*un.layout.get("icon-size").evaluate(Mn,{},Ti)],Pd[0]>nl&&Xn(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ib.kind==="composite"&&(Pd=[ya*li.compositeIconSizes[0].evaluate(Mn,{},Ti),ya*li.compositeIconSizes[1].evaluate(Mn,{},Ti)],(Pd[0]>nl||Pd[1]>nl)&&Xn(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,u_,Pd,ki,Oi,Mn,!1,jt,mt,Gr.lineStartIndex,Gr.lineLength,-1,Hn,Ti),Lx=Ct.icon.placedSymbolArray.length-1,Nx&&(Eb=4*Nx.length,Ct.addSymbols(Ct.icon,Nx,Pd,ki,Oi,Mn,Do.vertical,jt,mt,Gr.lineStartIndex,Gr.lineLength,-1,Hn,Ti),Fx=Ct.icon.placedSymbolArray.length-1)}for(const us in tn.horizontal){const cs=tn.horizontal[us];gr||(Sb=zc.exports(cs.text),ii?$u=Xm(cs):gr=nf(fn,zd,mt,qn,Qn,Yn,cs,ei,un.layout.get("text-rotate").evaluate(Mn,{},Ti),mi));const u_=cs.positionedLines.length===1;if(Cb+=Km(Ct,jt,mt,cs,Xt,un,ii,Mn,mi,Gr,tn.vertical?Do.horizontal:Do.horizontalOnly,u_?Object.keys(tn.horizontal):[us],ru,Lx,li,Hn,Ti),u_)break}tn.vertical&&(Tb+=Km(Ct,jt,mt,tn.vertical,Xt,un,ii,Mn,mi,Gr,Do.vertical,["vertical"],ru,Fx,li,Hn,Ti));let lh=-1;const Ux=(us,cs)=>us?Math.max(us,cs):cs;lh=Ux($u,lh),lh=Ux(ff,lh),lh=Ux(a_,lh);const _C=lh>-1?1:0;Ct.glyphOffsetArray.length>=nu.MAX_GLYPHS&&Xn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mn.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,Mn.sortKey),Ct.symbolInstances.emplaceBack(zd.x,zd.y,zd.z,mt.x,mt.y,ru.right>=0?ru.right:-1,ru.center>=0?ru.center:-1,ru.left>=0?ru.left:-1,ru.vertical>=0?ru.vertical:-1,Lx,Fx,Sb,gr!==void 0?gr:Ct.collisionBoxArray.length,gr!==void 0?gr+1:Ct.collisionBoxArray.length,ho!==void 0?ho:Ct.collisionBoxArray.length,ho!==void 0?ho+1:Ct.collisionBoxArray.length,yr!==void 0?yr:Ct.collisionBoxArray.length,yr!==void 0?yr+1:Ct.collisionBoxArray.length,vr||Ct.collisionBoxArray.length,vr?vr+1:Ct.collisionBoxArray.length,qn,Cb,Tb,l_,Eb,_C,0,Rx,Ox,lh)})(t,At,Tt,Ve,n,o,u,Xe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,me,ze,x,0,de,Ge,N,e,d,b,T,M)};if(nt==="line")for(const Ve of cy(e.geometry,0,0,Nt,Nt)){const At=nr(Ve,ae,Fe,n.vertical||H,o,24,ie,t.overscaling,Nt);for(const $t of At){const Tt=H;Tt&&px(t,Tt.text,Oe,$t)||rt(Ve,$t,M)}}else if(nt==="line-center"){for(const Ve of e.geometry)if(Ve.length>1){const At=sx(Ve,Fe,n.vertical||H,o,24,ie);At&&rt(Ve,At,M)}}else if(e.type==="Polygon")for(const Ve of Dm(e.geometry,0)){const At=lx(Ve,16);rt(Ve[0],new Rs(At.x,At.y,0,0,void 0),M)}else if(e.type==="LineString")for(const Ve of e.geometry)rt(Ve,new Rs(Ve[0].x,Ve[0].y,0,0,void 0),M);else if(e.type==="Point")for(const Ve of e.geometry)for(const At of Ve)rt([At],new Rs(At.x,At.y,0,0,void 0),M)}const nl=32640;function Km(t,e,n,o,u,d,m,y,x,b,T,M,B,L,F,N,H){const re=function(ae,me,de,Fe,ze,Ge,nt,Oe){const $e=[];if(me.positionedLines.length===0)return $e;const We=Fe.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,Xe=function(Tt){const Ct=Tt[0],mt=Tt[1],jt=Ct*mt;return jt>0?[Ct,-mt]:jt<0?[-Ct,mt]:Ct===0?[mt,Ct]:[mt,-Ct]}(de);let rt=Math.abs(me.top-me.bottom);for(const Tt of me.positionedLines)rt-=Tt.lineOffset;const Ve=me.positionedLines.length,At=rt/Ve;let $t=me.top-de[1];for(let Tt=0;Tt<Ve;++Tt){const Ct=me.positionedLines[Tt];$t=fy(me,At,$t,Tt);for(const mt of Ct.positionedGlyphs){if(!mt.rect)continue;const jt=mt.rect||{};let en=4,tn=!0,In=1,Xt=0;if(mt.imageName){const Hn=nt[mt.imageName];if(!Hn)continue;if(Hn.sdf){Xn("SDF images are not supported in formatted text and will be ignored.");continue}tn=!1,In=Hn.pixelRatio,en=1/In}const ni=(ze||Oe)&&mt.vertical,un=mt.metrics.advance*mt.scale/2,fn=mt.metrics,qn=mt.rect;if(qn===null)continue;Oe&&me.verticalizable&&(Xt=mt.imageName?un-mt.metrics.width*mt.scale/2:0);const Qn=ze?[mt.x+un,mt.y]:[0,0];let Yn=[0,0],ei=[0,0],ii=!1;ze||(ni?(ei=[mt.x+un+Xe[0],mt.y+Xe[1]-Xt],ii=!0):Yn=[mt.x+un+de[0],mt.y+de[1]-Xt]);const mi=qn.w*mt.scale/(In*(mt.localGlyph?2:1)),_r=qn.h*mt.scale/(In*(mt.localGlyph?2:1));let Un,Oi,ki,Mn;if(ni){const Hn=mt.y-$t,Ti=new ke(-un,un-Hn),Gr=-Math.PI/2,gr=new ke(...ei);Un=new ke(-un+Yn[0],Yn[1]),Un._rotateAround(Gr,Ti)._add(gr),Un.x+=-Hn+un,Un.y-=(fn.left-en)*mt.scale;const yr=mt.imageName?fn.advance*mt.scale:tr*mt.scale,ho=String.fromCharCode(mt.glyph);fi(ho)?Un.x+=(1-en)*mt.scale:Ei(ho)?Un.x+=yr-fn.height*mt.scale+(-en-1)*mt.scale:Un.x+=mt.imageName||fn.width+2*en===qn.w&&fn.height+2*en===qn.h?(yr-_r)/2:(yr-(fn.height+2*en)*mt.scale)/2,Oi=new ke(Un.x,Un.y-mi),ki=new ke(Un.x+_r,Un.y),Mn=new ke(Un.x+_r,Un.y-mi)}else{const Hn=(fn.left-en)*mt.scale-un+Yn[0],Ti=(-fn.top-en)*mt.scale+Yn[1],Gr=Hn+mi,gr=Ti+_r;Un=new ke(Hn,Ti),Oi=new ke(Gr,Ti),ki=new ke(Hn,gr),Mn=new ke(Gr,gr)}if(We){let Hn;Hn=ze?new ke(0,0):ii?new ke(Xe[0],Xe[1]):new ke(de[0],de[1]),Un._rotateAround(We,Hn),Oi._rotateAround(We,Hn),ki._rotateAround(We,Hn),Mn._rotateAround(We,Hn)}const li=new ke(0,0),Zi=new ke(0,0);$e.push({tl:Un,tr:Oi,bl:ki,br:Mn,tex:jt,writingMode:me.writingMode,glyphOffset:Qn,sectionIndex:mt.sectionIndex,isSDF:tn,pixelOffsetTL:li,pixelOffsetBR:Zi,minFontScaleX:0,minFontScaleY:0})}}return $e}(0,o,x,d,m,y,u,t.allowVerticalPlacement),ce=t.textSizeData;let ie=null;ce.kind==="source"?(ie=[ya*d.layout.get("text-size").evaluate(y,{},H)],ie[0]>nl&&Xn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ce.kind==="composite"&&(ie=[ya*F.compositeTextSizes[0].evaluate(y,{},H),ya*F.compositeTextSizes[1].evaluate(y,{},H)],(ie[0]>nl||ie[1]>nl)&&Xn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,re,ie,x,m,y,T,e,n,b.lineStartIndex,b.lineLength,L,N,H);for(const ae of M)B[ae]=t.text.placedSymbolArray.length-1;return 4*re.length}function gy(t){for(const e in t)return t[e];return null}function nf(t,e,n,o,u,d,m,y,x,b){let T=m.top,M=m.bottom,B=m.left,L=m.right;const F=m.collisionPadding;if(F&&(B-=F[0],T-=F[1],L+=F[2],M+=F[3]),x){const N=new ke(B,T),H=new ke(L,T),re=new ke(B,M),ce=new ke(L,M),ie=zt(x);let ae=new ke(0,0);b&&(ae=new ke(b[0],b[1])),N._rotateAround(ie,ae),H._rotateAround(ie,ae),re._rotateAround(ie,ae),ce._rotateAround(ie,ae),B=Math.min(N.x,H.x,re.x,ce.x),L=Math.max(N.x,H.x,re.x,ce.x),T=Math.min(N.y,H.y,re.y,ce.y),M=Math.max(N.y,H.y,re.y,ce.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,B,T,L,M,y,o,u,d),t.length-1}function Xm(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function px(t,e,n,o){const u=t.compareText;if(e in u){const d=u[e];for(let m=d.length-1;m>=0;m--)if(o.dist(d[m])<n)return!0}else u[e]=[];return u[e].push(o),!1}const fx=at([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yy}=fx,vy=at([{name:"a_pos_3",components:3,type:"Int16"}]);var Td=at([{name:"a_pos",type:"Int16",components:2}]);const il=Nt/Math.PI/2,Jm=2*So(1,0)*il*Math.PI,th=64,nh=[th,32,16],Os=-il,Us=il,mx=[new Br([Os,Os,Os],[Us,Us,Us]),new Br([Os,Os,Os],[0,0,Us]),new Br([0,Os,Os],[Us,0,Us]),new Br([Os,0,Os],[0,Us,Us]),new Br([0,0,Os],[Us,Us,Us])];function xy(t,e,n,o=!0){const u=Mo([],t._camera.position,t.worldSize),d=[e,n,1,1];Xl(d,d,t.pixelMatrixInverse),vg(d,d,1/d[3]);const m=Mr([],ss([],d,u)),y=t.globeMatrix,x=[y[12],y[13],y[14]],b=ss([],x,u),T=Fs(b),M=Mr([],b),B=t.worldSize/(2*Math.PI),L=os(M,m),F=Math.asin(B/T);if(F<Math.acos(L)){if(!o)return null;const nt=[],Oe=[];Mo(nt,m,T/L),Mr(Oe,ss(Oe,nt,b)),Mr(m,ga(m,b,Mo(m,Oe,Math.tan(F)*T)))}const N=[];new Em(u,m).closestPointOnSphere(x,B,N);const H=Mr([],Zr(y,0)),re=Mr([],Zr(y,1)),ce=Mr([],Zr(y,2)),ie=os(H,N),ae=os(re,N),me=os(ce,N),de=qt(Math.asin(-ae/B));let Fe=qt(Math.atan2(ie,me));Fe=t.center.lng+function(nt,Oe){const $e=(Oe-nt+180)%360-180;return $e<-180?$e+360:$e}(t.center.lng,Fe);const ze=Qi(Fe),Ge=cn(zs(de),0,1);return new Zl(ze,Ge)}class _x{constructor(e,n,o){this.a=ss([],e,o),this.b=ss([],n,o),this.center=o;const u=Mr([],this.a),d=Mr([],this.b);this.angle=Math.acos(os(u,d))}}function Ym(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(o,u,d,m){const y=Math.sin(d);return o*(Math.sin((1-m)*d)/y)+u*(Math.sin(m*d)/y)}(t.a[e],t.b[e],t.angle,cn(n,0,1))+t.center[e]}function ba(t){if(t.z<=1)return mx[t.z+2*t.y+t.x];const e=Qm(rf(t));return Br.fromPoints(e)}function ju(t,e,n){return Mo(t,t,1-n),fd(t,t,e,n)}function wy(t,e){const n=oh(e.zoom);if(n===0)return ba(t);const o=rf(t),u=Qm(o),d=Qi(o.getWest())*e.worldSize,m=Qi(o.getEast())*e.worldSize,y=zs(o.getNorth())*e.worldSize,x=zs(o.getSouth())*e.worldSize,b=[d,y,0],T=[m,y,0],M=[d,x,0],B=[m,x,0],L=kp([],e.globeMatrix);return Ai(b,b,L),Ai(T,T,L),Ai(M,M,L),Ai(B,B,L),u[0]=ju(u[0],M,n),u[1]=ju(u[1],B,n),u[2]=ju(u[2],T,n),u[3]=ju(u[3],b,n),Br.fromPoints(u)}function by(t,e,n){for(const o of t)Ai(o,o,e),Mo(o,o,n)}function gx(t,e,n){const o=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){const ze=ba(n).getCorners();return by(ze,u,o),Br.fromPoints(ze)}const d=rf(n),m=Qm(d);by(m,u,o);const y=Number.MAX_VALUE,x=[-y,-y,-y],b=[y,y,y];if(d.contains(t.center)){for(const nt of m)dd(b,b,nt),pd(x,x,nt);x[2]=0;const ze=t.point,Ge=[ze.x*o,ze.y*o,0];return dd(b,b,Ge),pd(x,x,Ge),new Br(b,x)}const T=[u[12]*o,u[13]*o,u[14]*o],M=d.getCenter(),B=cn(t.center.lat,-85.051129,fa),L=cn(M.lat,-85.051129,fa),F=Qi(t.center.lng),N=zs(B);let H=F-Qi(M.lng);const re=N-zs(L);H>.5?H-=1:H<-.5&&(H+=1);let ce=0;Math.abs(H)>Math.abs(re)?ce=H>=0?1:3:(ce=re>=0?0:2,fd(T,T,[u[4]*o,u[5]*o,u[6]*o],-Math.sin(zt(re>=0?d.getSouth():d.getNorth()))*il));const ie=m[ce],ae=m[(ce+1)%4],me=new _x(ie,ae,T),de=[Ym(me,0)||ie[0],Ym(me,1)||ie[1],Ym(me,2)||ie[2]],Fe=oh(t.zoom);if(Fe>0){const ze=function({x:nt,y:Oe,z:$e},We,Xe,rt,Ve){const At=1/(1<<$e);let $t=nt*At,Tt=$t+At,Ct=Oe*At,mt=Ct+At,jt=0;const en=($t+Tt)/2-rt;return en>.5?jt=-1:en<-.5&&(jt=1),$t=(($t+jt)*We-(rt*=We))*Xe+rt,Tt=((Tt+jt)*We-rt)*Xe+rt,Ct=(Ct*We-(Ve*=We))*Xe+Ve,mt=(mt*We-Ve)*Xe+Ve,[[$t,mt,0],[Tt,mt,0],[Tt,Ct,0],[$t,Ct,0]]}(n,e,t._pixelsPerMercatorPixel,F,N);for(let nt=0;nt<m.length;nt++)ju(m[nt],ze[nt],Fe);const Ge=ga([],ze[ce],ze[(ce+1)%4]);Mo(Ge,Ge,.5),ju(de,Ge,Fe)}for(const ze of m)dd(b,b,ze),pd(x,x,ze);return b[2]=Math.min(ie[2],ae[2]),dd(b,b,de),pd(x,x,de),new Br(b,x)}function rf({x:t,y:e,z:n}){const o=1/(1<<n),u=new vn(Io(t*o),$i((e+1)*o)),d=new vn(Io((t+1)*o),$i(e*o));return new ks(u,d)}function Qm(t){const e=zt(t.getNorth()),n=zt(t.getSouth()),o=Math.cos(e),u=Math.cos(n),d=Math.sin(e),m=Math.sin(n),y=t.getWest(),x=t.getEast();return[tu(u,m,y),tu(u,m,x),tu(o,d,x),tu(o,d,y)]}function tu(t,e,n,o=il){return n=zt(n),[t*Math.sin(n)*o,-e*o,t*Math.cos(n)*o]}function ih(t,e,n){return tu(Math.cos(zt(t)),Math.sin(zt(t)),e,n)}function rh(t,e,n,o){const u=1<<n.z,d=(t/Nt+n.x)/u;return ih($i((e/Nt+n.y)/u),Io(d),o)}function of({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Ay=new Float64Array(16);function Sd(t){const e=of(t),n=xm(Ay,[e,e,e]);return Ou(n,n,((o=[])[0]=-(u=t.min)[0],o[1]=-u[1],o[2]=-u[2],o));var o,u}function Id(t){const e=(o=t.min,(n=Ay)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=o[0],n[13]=o[1],n[14]=o[2],n[15]=1,n);var n,o;const u=1/of(t);return Kl(e,e,[u,u,u])}function Ey(t,e,n,o,u){const d=function(x){const b=Nt/(2*Math.PI);return x/(2*Math.PI)/b}(n),m=[t,e,-n/(2*Math.PI)],y=Ps(new Float64Array(16));return Ou(y,y,m),Kl(y,y,[d,d,d]),Uu(y,y,zt(-u)),Uc(y,y,zt(-o)),y}function oh(t){return gs(5,6,t)}function Cy(t,e){const n=ih(e.lat,e.lng),o=function(F){const N=ih(F._center.lat,F._center.lng);let H=Am([],Nc(0,1,0),N);const re=wm([],-F.angle,N);H=Ai(H,H,re),wm(re,-F._pitch,H);const ce=Mr([],N);return Mo(ce,ce,F.cameraToCenterDistance/F.pixelsPerMeter*Jm),Ai(ce,ce,re),ga([],N,ce)}(t);return m=(u=bm([],o,n))[0],y=u[1],x=u[2],b=(d=n)[0],T=d[1],M=d[2],L=(B=Math.sqrt(m*m+y*y+x*x)*Math.sqrt(b*b+T*T+M*M))&&os(u,d)/B,Math.acos(Math.min(Math.max(L,-1),1));var u,d,m,y,x,b,T,M,B,L}const Nr=zt(85),e_=Math.cos(Nr),yx=Math.sin(Nr);function Ty(t,e){const n=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),d=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),m=Math.sin(t._pitch)*d+u;return Math.min(1.01*m,u*(1/t._horizonShift))}function qu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),o=t.x*n,u=(t.x+1)*n,d=t.y*n,m=(t.y+1)*n,y=Io(o),x=Io(u),b=$i(d),T=$i(m),M=e.project(y,b),B=e.project(x,b),L=e.project(x,T),F=e.project(y,T);let N=Math.min(M.x,B.x,L.x,F.x),H=Math.min(M.y,B.y,L.y,F.y),re=Math.max(M.x,B.x,L.x,F.x),ce=Math.max(M.y,B.y,L.y,F.y);const ie=n/16;function ae(de,Fe,ze,Ge,nt,Oe){const $e=(ze+nt)/2,We=(Ge+Oe)/2,Xe=e.project(Io($e),$i(We)),rt=Math.max(0,N-Xe.x,H-Xe.y,Xe.x-re,Xe.y-ce);N=Math.min(N,Xe.x),re=Math.max(re,Xe.x),H=Math.min(H,Xe.y),ce=Math.max(ce,Xe.y),rt>ie&&(ae(de,Xe,ze,Ge,$e,We),ae(Xe,Fe,$e,We,nt,Oe))}ae(M,B,o,d,u,d),ae(B,L,u,d,u,m),ae(L,F,u,m,o,m),ae(F,M,o,m,o,d),N-=ie,H-=ie,re+=ie,ce+=ie;const me=1/Math.max(re-N,ce-H);return{scale:me,x:N*me,y:H*me,x2:re*me,y2:ce*me,projection:e}}const vx=Ps(new Float32Array(16));class Aa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new vn(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o=!0){return e._coordinatePoint(e.locationCoordinate(n),o)}pixelsPerMeter(e,n){return So(1,e)*n}pixelSpaceConversion(e,n,o){return 1}farthestPixelDistance(e){return Ty(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,u){const d=e.horizonLineFromTop(!1),m=new ke(n,Math.max(d,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,n,o){const u=new ke(n,o);if(e.elevation)return e.elevation.pointCoordinate(u);{const d=this.pointCoordinate(e,u.x,u.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return vx}createTileMatrix(e,n,o){let u,d,m;const y=o.canonical,x=Ps(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=qu(y,this);u=1,d=b.x+o.wrap*b.scale,m=b.y,Kl(x,x,[u/b.scale,u/b.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*o.wrap)*u,m=y.y*u;return Ou(x,x,[d,m,0]),Kl(x,x,[u/Nt,u/Nt,1]),x}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class xx extends Aa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,o]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(zt(n));this.n=(u+Math.sin(zt(o)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:o,c:u,r0:d}=this,m=zt(e-this.center[0]),y=zt(n),x=Math.sqrt(u-2*o*Math.sin(y))/o;return{x:x*Math.sin(m*o),y:x*Math.cos(m*o)-d,z:0}}unproject(e,n){const{n:o,c:u,r0:d}=this,m=d+n;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*o<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const x=zt(this.center[0])*o;y=Ni(y,-Math.PI-x,Math.PI-x);const b=cn(qt(y/o)+this.center[0],-180,180),T=Math.asin(cn((u-(e*e+m*m)*o*o)/(2*o),-1,1)),M=cn(qt(T),-85.051129,fa);return new vn(b,M)}}const Hu=1.340264,Md=-.081106,Bd=893e-6,Dd=.003796,sf=Math.sqrt(3)/2;class Sy extends Aa{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(sf*Math.sin(n)),u=o*o,d=u*u*u;return{x:.5*(e*Math.cos(o)/(sf*(Hu+3*Md*u+d*(7*Bd+9*Dd*u)))/Math.PI+.5),y:1-.5*(o*(Hu+Md*u+d*(Bd+Dd*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,u=o*o,d=u*u*u;for(let T,M,B,L=0;L<12&&(M=o*(Hu+Md*u+d*(Bd+Dd*u))-n,B=Hu+3*Md*u+d*(7*Bd+9*Dd*u),T=M/B,o=cn(o-T,-Math.PI/3,Math.PI/3),u=o*o,d=u*u*u,!(Math.abs(T)<1e-12));++L);const m=sf*e*(Hu+3*Md*u+d*(7*Bd+9*Dd*u))/Math.cos(o),y=Math.asin(Math.sin(o)/sf),x=cn(180*m/Math.PI,-180,180),b=cn(180*y/Math.PI,-85.051129,fa);return new vn(x,b)}}class wx extends Aa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const o=360*(e-.5),u=cn(360*(.5-n),-85.051129,fa);return new vn(o,u)}}const sh=Math.PI/2;function af(t){return Math.tan((sh+t)/2)}class t_ extends Aa{constructor(e){super(e),this.center=e.center||[0,30];const[n,o]=this.parallels=e.parallels||[30,30];let u=zt(n),d=zt(o);this.southernCenter=u+d<0,this.southernCenter&&(u=-u,d=-d);const m=Math.cos(u),y=af(u);this.n=u===d?Math.sin(u):Math.log(m/Math.cos(d))/Math.log(af(d)/y),this.f=m*Math.pow(af(u),this.n)/this.n}project(e,n){n=zt(n),this.southernCenter&&(n=-n),e=zt(e-this.center[0]);const o=1e-6,{n:u,f:d}=this;d>0?n<-sh+o&&(n=-sh+o):n>sh-o&&(n=sh-o);const m=d/Math.pow(af(n),u);let y=m*Math.sin(u*e),x=d-m*Math.cos(u*e);return y=.5*(y/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:y,y:this.southernCenter?x:1-x,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:o,f:u}=this,d=u-n,m=Math.sign(d),y=Math.sign(o)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*m;d*o<0&&(x-=Math.PI*Math.sign(e)*m);const b=cn(qt(x/o)+this.center[0],-180,180),T=cn(qt(2*Math.atan(Math.pow(u/y,1/o))-sh),-85.051129,fa);return new vn(b,this.southernCenter?-T:T)}}class lf extends Aa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Qi(e),y:zs(n),z:0}}unproject(e,n){const o=Io(e),u=$i(n);return new vn(o,u)}}const Iy=zt(fa);class bx extends Aa{project(e,n){const o=(n=zt(n))*n,u=o*o;return{x:.5*((e=zt(e))*(.8707-.131979*o+u*(u*(.003971*o-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+u*(.028874*o-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,u=25,d=0,m=o*o;do{m=o*o;const b=m*m;d=(o*(1.007226+m*(.015085+b*(.028874*m-.044475-.005916*b)))-n)/(1.007226+m*(.045255+b*(.259866*m-.311325-.005916*11*b))),o=cn(o-d,-Iy,Iy)}while(Math.abs(d)>1e-6&&--u>0);m=o*o;const y=cn(qt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=qt(o);return new vn(y,x)}}const My=zt(fa);class Ax extends Aa{project(e,n){n=zt(n),e=zt(e);const o=Math.cos(n),u=2/Math.PI,d=Math.acos(o*Math.cos(e/2)),m=Math.sin(d)/d,y=.5*(e*u+2*o*Math.sin(e/2)/m)||0,x=.5*(n+Math.sin(n)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,d=25;const m=1e-6;let y=0,x=0;do{const b=Math.cos(u),T=Math.sin(u),M=2*T*b,B=T*T,L=b*b,F=Math.cos(o/2),N=Math.sin(o/2),H=2*F*N,re=N*N,ce=1-L*F*F,ie=ce?1/ce:0,ae=ce?Math.acos(b*F)*Math.sqrt(1/ce):0,me=.5*(2*ae*b*N+2*o/Math.PI)-e,de=.5*(ae*T+u)-n,Fe=.5*ie*(L*re+ae*b*F*B)+1/Math.PI,ze=ie*(H*M/4-ae*T*N),Ge=.125*ie*(M*N-ae*T*L*H),nt=.5*ie*(B*F+ae*re*b)+.5,Oe=ze*Ge-nt*Fe;y=(de*ze-me*nt)/Oe,x=(me*Ge-de*Fe)/Oe,o=cn(o-y,-Math.PI,Math.PI),u=cn(u-x,-My,My)}while((Math.abs(y)>m||Math.abs(x)>m)&&--d>0);return new vn(qt(o),qt(u))}}class By extends Aa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(zt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:o,cosPhi:u}=this;return{x:zt(e)*u*o+.5,y:-Math.sin(zt(n))/u*o+.5,z:0}}unproject(e,n){const{scale:o,cosPhi:u}=this,d=-(n-.5)/o,m=cn(qt((e-.5)/o)/u,-180,180),y=Math.asin(cn(d*u,-1,1)),x=cn(qt(y),-85.051129,fa);return new vn(m,x)}}class Ex extends lf{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,n,o){const u=rh(e,n,o);return Ai(u,u,Sd(ba(o))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){const o=ih(n.lat,n.lng),u=Mr([],o),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;fd(o,o,u,So(1,0)*Nt*d);const m=Ps(new Float64Array(16));return Oc(m,e.pixelMatrix,e.globeMatrix),Ai(o,o,m),new ke(o[0],o[1])}pixelsPerMeter(e,n){return So(1,0)*n}pixelSpaceConversion(e,n,o){const u=So(1,e)*n,d=mn(So(1,45)*n,u,o);return this.pixelsPerMeter(e,n)/d}createTileMatrix(e,n,o){const u=Id(ba(o.canonical));return Oc(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:o}=e,u=Sd(ba(n));return Uc(u,u,zt(o.lng)),Uu(u,u,zt(o.lat)),Kl(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,o,u){return xy(e,n,o,!0)||new Zl(0,0)}pointCoordinate3D(e,n,o){const u=this.pointCoordinate(e,n,o,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!xy(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,d){const m=u.cameraToCenterDistance,y=u._centerAltitude*d,x=u._camera,b=u._camera.forward(),T=ga([],Mo([],b,-m),[0,0,y]),M=u.worldSize/(2*Math.PI),B=[0,0,-M],L=u.width/u.height,F=Math.tan(u.fovAboveCenter),N=Mo([],x.up(),F),H=Mo([],x.right(),F*L),re=Mr([],ga([],ga([],b,N),H)),ce=[];let ie;if(new Em(T,re).closestPointOnSphere(B,M,ce)){const ae=ga([],ce,B),me=ss([],ae,T);ie=Math.cos(u.fovAboveCenter)*Fs(me)}else{const ae=ss([],T,B),me=ss([],B,T);Mr(me,me);const de=Fs(ae)-M;ie=Math.sqrt(de*(de+2*M));const Fe=Math.acos(ie/(M+de))-Math.acos(os(b,me));ie*=Math.cos(Fe)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=oh(e.zoom);if(o>0){const u=Ty(e,So(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return mn(n,u+d*(1-Math.cos(m)),Math.pow(o,10))}return n}upVector(e,n,o){return rh(n,o,e,1)}upVectorScale(e){return{metersToTile:Jm*of(ba(e))}}}function Dy(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new lf(t);case"equirectangular":return new wx(t);case"naturalEarth":return new bx(t);case"equalEarth":return new Sy(t);case"winkelTripel":return new Ax(t);case"albers":return n?new By(t):new xx(t);case"lambertConformalConic":return n?new By(t):new t_(t);case"globe":return new Ex(t)}throw new Error(`Invalid projection name: ${t.name}`)}const Cx=qp.types,Tx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function uf(t,e,n,o,u,d,m,y,x,b,T,M,B){const L=y?Math.min(nl,Math.round(y[0])):0,F=y?Math.min(nl,Math.round(y[1])):0;t.emplaceBack(e,n,Math.round(32*o),Math.round(32*u),d,m,(L<<1)+(x?1:0),F,16*b,16*T,256*M,256*B)}function cf(t,e,n,o,u,d,m){t.emplaceBack(e,n,o,u,d,m)}function hf(t,e,n,o,u){t.emplaceBack(e,n,o,u),t.emplaceBack(e,n,o,u),t.emplaceBack(e,n,o,u),t.emplaceBack(e,n,o,u)}function Sx(t){for(const e of t.sections)if(k(e.text))return!0;return!1}class n_{constructor(e){this.layoutVertexArray=new ti,this.indexArray=new Hi,this.programConfigurations=e,this.segments=new bi,this.dynamicLayoutVertexArray=new wi,this.opacityVertexArray=new ci,this.placedSymbolArray=new im,this.globeExtVertexArray=new Cn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Di.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Tx,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,uo.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}vt(n_,"SymbolBuffers");class i_{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new bi,this.collisionVertexArray=new Bs,this.collisionVertexArrayExt=new to}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xv.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Yl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}vt(i_,"CollisionBuffers");class nu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ps([]),this.placementViewportMatrix=Ps([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nm(this.zoom,n["text-size"]),this.iconSizeData=Nm(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(m=>Do[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new n_(new rs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new n_(new rs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Xa,this.lineVertexArray=new xp,this.symbolInstances=new no}calculateGlyphDependencies(e,n,o,u,d){for(let m=0;m<e.length;m++)if(n[e.charCodeAt(m)]=!0,u&&d){const y=Ql[e.charAt(m)];y&&(n[y.charCodeAt(0)]=!0)}}populate(e,n,o,u){const d=this.layers[0],m=d.layout,y=this.projection.name==="globe",x=m.get("text-font"),b=m.get("text-field"),T=m.get("icon-image"),M=(b.value.kind!=="constant"||b.value.value instanceof ar&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),B=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=m.get("symbol-sort-key");if(this.features=[],!M&&!B)return;const F=n.iconDependencies,N=n.glyphDependencies,H=n.availableImages,re=new oe(this.zoom);for(const{feature:ce,id:ie,index:ae,sourceLayerIndex:me}of e){const de=d._featureFilter.needGeometry,Fe=Ru(ce,de);if(!d._featureFilter.filter(re,Fe,o))continue;if(de||(Fe.geometry=Or(ce,o,u)),y&&ce.type!==1&&o.z<=5){const Oe=Fe.geometry,$e=.98078528056,We=(Xe,rt)=>os(rh(Xe.x,Xe.y,o,1),rh(rt.x,rt.y,o,1))<$e;for(let Xe=0;Xe<Oe.length;Xe++)Oe[Xe]=Lc(Oe[Xe],We)}let ze,Ge;if(M){const Oe=d.getValueAndResolveTokens("text-field",Fe,o,H),$e=ar.factory(Oe);Sx($e)&&(this.hasRTLText=!0),(!this.hasRTLText||X()==="unavailable"||this.hasRTLText&&ue.isParsed())&&(ze=Wg($e,d,Fe))}if(B){const Oe=d.getValueAndResolveTokens("icon-image",Fe,o,H);Ge=Oe instanceof lr?Oe:lr.fromString(Oe)}if(!ze&&!Ge)continue;const nt=this.sortFeaturesByKey?L.evaluate(Fe,{},o):void 0;if(this.features.push({id:ie,text:ze,icon:Ge,index:ae,sourceLayerIndex:me,geometry:Fe.geometry,properties:ce.properties,type:Cx[ce.type],sortKey:nt}),Ge&&(F[Ge.name]=!0),ze){const Oe=x.evaluate(Fe,{},o).join(","),$e=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Do.vertical)>=0;for(const We of ze.sections)if(We.image)F[We.image.name]=!0;else{const Xe=a(ze.toString()),rt=We.fontStack||Oe,Ve=N[rt]=N[rt]||{};this.calculateGlyphDependencies(We.text,Ve,$e,this.allowVerticalPlacement,Xe)}}}m.get("symbol-placement")==="line"&&(this.features=function(ce){const ie={},ae={},me=[];let de=0;function Fe(Oe){me.push(ce[Oe]),de++}function ze(Oe,$e,We){const Xe=ae[Oe];return delete ae[Oe],ae[$e]=Xe,me[Xe].geometry[0].pop(),me[Xe].geometry[0]=me[Xe].geometry[0].concat(We[0]),Xe}function Ge(Oe,$e,We){const Xe=ie[$e];return delete ie[$e],ie[Oe]=Xe,me[Xe].geometry[0].shift(),me[Xe].geometry[0]=We[0].concat(me[Xe].geometry[0]),Xe}function nt(Oe,$e,We){const Xe=We?$e[0][$e[0].length-1]:$e[0][0];return`${Oe}:${Xe.x}:${Xe.y}`}for(let Oe=0;Oe<ce.length;Oe++){const $e=ce[Oe],We=$e.geometry,Xe=$e.text?$e.text.toString():null;if(!Xe){Fe(Oe);continue}const rt=nt(Xe,We),Ve=nt(Xe,We,!0);if(rt in ae&&Ve in ie&&ae[rt]!==ie[Ve]){const At=Ge(rt,Ve,We),$t=ze(rt,Ve,me[At].geometry);delete ie[rt],delete ae[Ve],ae[nt(Xe,me[$t].geometry,!0)]=$t,me[At].geometry=null}else rt in ae?ze(rt,Ve,We):Ve in ie?Ge(rt,Ve,We):(Fe(Oe),ie[rt]=de-1,ae[Ve]=de-1)}return me.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ce,ie)=>ce.sortKey-ie.sortKey)}update(e,n,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o,u),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Dy(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length,u=e.segment;if(u!==void 0){let d=e.dist(n[u+1]),m=e.dist(n[u]);const y={};for(let x=u+1;x<n.length;x++)y[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:d},x<n.length-1&&(d+=n[x+1].dist(n[x]));for(let x=u||0;x>=0;x--)y[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:m},x>0&&(m+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const b=y[x];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,u,d,m,y,x,b,T,M,B,L,F){const N=e.indexArray,H=e.layoutVertexArray,re=e.globeExtVertexArray,ce=e.segments.prepareSegment(4*n.length,H,N,this.canOverlap?m.sortKey:void 0),ie=this.glyphOffsetArray.length,ae=ce.vertexLength,me=this.allowVerticalPlacement&&y===Do.vertical?Math.PI/2:0,de=m.text&&m.text.sections;for(let ze=0;ze<n.length;ze++){const{tl:Ge,tr:nt,bl:Oe,br:$e,tex:We,pixelOffsetTL:Xe,pixelOffsetBR:rt,minFontScaleX:Ve,minFontScaleY:At,glyphOffset:$t,isSDF:Tt,sectionIndex:Ct}=n[ze],mt=ce.vertexLength,jt=$t[1];if(uf(H,b.x,b.y,Ge.x,jt+Ge.y,We.x,We.y,o,Tt,Xe.x,Xe.y,Ve,At),uf(H,b.x,b.y,nt.x,jt+nt.y,We.x+We.w,We.y,o,Tt,rt.x,Xe.y,Ve,At),uf(H,b.x,b.y,Oe.x,jt+Oe.y,We.x,We.y+We.h,o,Tt,Xe.x,rt.y,Ve,At),uf(H,b.x,b.y,$e.x,jt+$e.y,We.x+We.w,We.y+We.h,o,Tt,rt.x,rt.y,Ve,At),x){const en=x.anchor,tn=x.up;cf(re,en.x,en.y,en.z,tn[0],tn[1],tn[2]),cf(re,en.x,en.y,en.z,tn[0],tn[1],tn[2]),cf(re,en.x,en.y,en.z,tn[0],tn[1],tn[2]),cf(re,en.x,en.y,en.z,tn[0],tn[1],tn[2]),hf(e.dynamicLayoutVertexArray,en.x,en.y,en.z,me)}else hf(e.dynamicLayoutVertexArray,b.x,b.y,b.z,me);N.emplaceBack(mt,mt+1,mt+2),N.emplaceBack(mt+1,mt+2,mt+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($t[0]),ze!==n.length-1&&Ct===n[ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,m,m.index,{},L,F,de&&de[Ct])}const Fe=x?x.anchor:b;e.placedSymbolArray.emplaceBack(Fe.x,Fe.y,Fe.z,b.x,b.y,ie,this.glyphOffsetArray.length-ie,ae,T,M,b.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,B,0)}_commitLayoutVertex(e,n,o,u,d,m,y){e.emplaceBack(n,o,u,d,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,o,u,d,m,y){const x=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),b=x.vertexLength,T=y.tileAnchorX,M=y.tileAnchorY;for(let L=0;L<4;L++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,u,d,m,T,M,new ke(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,u,d,m,T,M,new ke(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,u,d,m,T,M,new ke(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,u,d,m,T,M,new ke(e.x1,e.y2)),x.vertexLength+=4;const B=o.indexArray;B.emplaceBack(b,b+1),B.emplaceBack(b+1,b+2),B.emplaceBack(b+2,b+3),B.emplaceBack(b+3,b),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,u,d,m){for(let y=u;y<d;y++){const x=o.get(y),b=this.getSymbolInstanceTextSize(e,m,n,y);this._addCollisionDebugVertices(x,b,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,n,o,u,d,m){for(let y=u;y<d;y++){const x=o.get(y),b=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._addCollisionDebugVertices(x,b,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new i_(On,Zg.members,fr),this.iconCollisionBox=new i_(On,Zg.members,fr);const o=Kc(this.iconSizeData,e),u=Kc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(u,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(o,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(o,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,n,o,u){const d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),m=Wc(this.textSizeData,e,d)/tr;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,n,o){const u=this.icon.placedSymbolArray.get(o),d=Wc(this.iconSizeData,e,u);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,n,o){e.emplaceBack(n,-o,-o),e.emplaceBack(n,o,-o),e.emplaceBack(n,o,o),e.emplaceBack(n,-o,o)}_updateTextDebugCollisionBoxes(e,n,o,u,d,m){for(let y=u;y<d;y++){const x=o.get(y),b=this.getSymbolInstanceTextSize(e,m,n,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,x.padding)}}_updateIconDebugCollisionBoxes(e,n,o,u,d,m){for(let y=u;y<d;y++){const x=o.get(y),b=this.getSymbolInstanceIconSize(e,n,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,x.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=Kc(this.iconSizeData,e),u=Kc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(u,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(o,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(o,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,u,d,m,y,x,b){const T={};for(let M=n;M<o;M++){const B=e.get(M);T.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},T.textFeatureIndex=B.featureIndex;break}for(let M=u;M<d;M++){const B=e.get(M);T.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},T.verticalTextFeatureIndex=B.featureIndex;break}for(let M=m;M<y;M++){const B=e.get(M);T.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},T.iconFeatureIndex=B.featureIndex;break}for(let M=x;M<b;M++){const B=e.get(M);T.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,padding:B.padding,projectedAnchorX:B.projectedAnchorX,projectedAnchorY:B.projectedAnchorY,projectedAnchorZ:B.projectedAnchorZ,tileAnchorX:B.tileAnchorX,tileAnchorY:B.tileAnchorY},T.verticalIconFeatureIndex=B.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),u=[],d=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(n*x.tileAnchorX+o*x.tileAnchorY)),d.push(x.featureIndex)}return m.sort((y,x)=>u[y]-u[x]||d[x]-d[y]),m}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,d,m)=>{u>=0&&m.indexOf(u)===d&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}vt(nu,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),nu.MAX_GLYPHS=65535,nu.addDynamicAttributes=hf;const Ix=new st({"symbol-placement":new Ie(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Ie(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ie(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ye(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ie(Ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ie(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ie(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ie(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ie(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new ye(Ue.layout_symbol["icon-size"]),"icon-text-fit":new Ie(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ie(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new ye(Ue.layout_symbol["icon-image"]),"icon-rotate":new ye(Ue.layout_symbol["icon-rotate"]),"icon-padding":new Ie(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Ie(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new ye(Ue.layout_symbol["icon-offset"]),"icon-anchor":new ye(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ie(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ie(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ie(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new ye(Ue.layout_symbol["text-field"]),"text-font":new ye(Ue.layout_symbol["text-font"]),"text-size":new ye(Ue.layout_symbol["text-size"]),"text-max-width":new ye(Ue.layout_symbol["text-max-width"]),"text-line-height":new ye(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new ye(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new ye(Ue.layout_symbol["text-justify"]),"text-radial-offset":new ye(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ie(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new ye(Ue.layout_symbol["text-anchor"]),"text-max-angle":new Ie(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Ie(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new ye(Ue.layout_symbol["text-rotate"]),"text-padding":new Ie(Ue.layout_symbol["text-padding"]),"text-keep-upright":new Ie(Ue.layout_symbol["text-keep-upright"]),"text-transform":new ye(Ue.layout_symbol["text-transform"]),"text-offset":new ye(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new Ie(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ie(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new Ie(Ue.layout_symbol["text-optional"])});var r_={paint:new st({"icon-opacity":new ye(Ue.paint_symbol["icon-opacity"]),"icon-color":new ye(Ue.paint_symbol["icon-color"]),"icon-halo-color":new ye(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new ye(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ye(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Ie(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ie(Ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new ye(Ue.paint_symbol["text-opacity"]),"text-color":new ye(Ue.paint_symbol["text-color"],{runtimeType:qo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ye(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new ye(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new ye(Ue.paint_symbol["text-halo-blur"]),"text-translate":new Ie(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new Ie(Ue.paint_symbol["text-translate-anchor"])}),layout:Ix};class ky{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ra,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}vt(ky,"FormatSectionOverride",{omit:["defaultValue"]});class df extends ro{constructor(e){super(e,r_)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const d of o)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,u){const d=this.layout.get(e).evaluate(n,{},o,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Ol(m.value)||!d?d:function(y,x){return x.replace(/{([^{}]+)}/g,(b,T)=>T in y?String(y[T]):"")}(n.properties,d)}createBucket(e){return new nu(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of r_.paint.overridableProperties){if(!df.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new ky(n),u=new ra(o,n.property.specification);let d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new qa("source",u):new Tu("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new qe(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&df.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),u=r_.paint.properties[n];let d=!1;const m=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ar)m(o.value.value.sections);else if(o.value.kind==="source"){const y=b=>{d||(b instanceof yu&&yi(b.value)===bl?m(b.value.sections):b instanceof kn?m(b.sections):b.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return d}getProgramConfiguration(e){return new Ya(this,e)}}var Mx={paint:new st({"background-color":new Ie(Ue.paint_background["background-color"]),"background-pattern":new ot(Ue.paint_background["background-pattern"]),"background-opacity":new Ie(Ue.paint_background["background-opacity"])})},h={paint:new st({"raster-opacity":new Ie(Ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ie(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ie(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ie(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Ie(Ue.paint_raster["raster-saturation"]),"raster-contrast":new Ie(Ue.paint_raster["raster-contrast"]),"raster-resampling":new Ie(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Ie(Ue.paint_raster["raster-fade-duration"])})};class _ extends ro{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var E={paint:new st({"sky-type":new Ie(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ie(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ie(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ie(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ie(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new lt(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ie(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ie(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ie(Ue.paint_sky["sky-opacity"])})};function z(t,e,n){const o=[0,0,1],u=bg([]);return Eg(u,u,n?-zt(t)+Math.PI:zt(t)),Ag(u,u,-zt(e)),gg(o,o,u),Mr(o,o)}const G={circle:class extends ro{constructor(t){super(t,pg)}createBucket(t){return new er(t)}queryRadius(t){const e=t;return Wl("circle-radius",this,e)+Wl("circle-stroke-width",this,e)+Bp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,o,u,d,m,y){const x=Rc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Cg(t,o,d,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,b)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Ya(this,t)}},heatmap:class extends ro{createBucket(t){return new Ig(t)}constructor(t){super(t,mv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Wl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,o,u,d,m,y){const x=this.paint.get("heatmap-radius").evaluate(e,n);return Cg(t,o,d,m,y,!0,!0,new ke(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Ya(this,t)}},hillshade:class extends ro{constructor(t){super(t,_v)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ro{constructor(t){super(t,Dv)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new Ya(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Gp(t)}queryRadius(){return Bp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,o,u,d){return!t.queryGeometry.isAboveHorizon&&ym(hg(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends ro{constructor(t){super(t,Gv)}createBucket(t){return new Gu(t)}queryRadius(){return Bp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Ya(this,t)}queryIntersectsFeature(t,e,n,o,u,d,m,y,x){const b=Rc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),M=this.paint.get("fill-extrusion-base").evaluate(e,n),B=[0,0],L=y&&d.elevation,F=d.elevation?d.elevation.exaggeration():1,N=t.tile.getBucket(this);if(L&&N instanceof Gu){const ae=N.centroidVertexArray,me=x+1;if(me<ae.length){const de=ae.get(me);B[0]=de.a_centroid_pos0,B[1]=de.a_centroid_pos1}}if(B[0]===0&&B[1]===1)return!1;d.projection.name==="globe"&&(o=wd([o],[new ke(0,0),new ke(Nt,Nt)],t.tileID.canonical).map(ae=>ae.polygon).flat());const H=L?y:null,[re,ce]=function(ae,me,de,Fe,ze,Ge,nt,Oe,$e,We,Xe){return ae.projection.name==="globe"?function(rt,Ve,At,$t,Tt,Ct,mt,jt,en,tn,In){const Xt=[],ni=[],un=rt.projection.upVectorScale(In,rt.center.lat,rt.worldSize).metersToTile,fn=[0,0,0,1],qn=[0,0,0,1],Qn=(ei,ii,mi,_r)=>{ei[0]=ii,ei[1]=mi,ei[2]=_r,ei[3]=1},Yn=Vg();At>0&&(At+=Yn),$t+=Yn;for(const ei of Ve){const ii=[],mi=[];for(const _r of ei){const Un=_r.x+Tt.x,Oi=_r.y+Tt.y,ki=rt.projection.projectTilePoint(Un,Oi,In),Mn=rt.projection.upVector(In,_r.x,_r.y);let li=At,Zi=$t;if(mt){const Hn=Hg(Un,Oi,At,$t,mt,jt,en,tn);li+=Hn.base,Zi+=Hn.top}At!==0?Qn(fn,ki.x+Mn[0]*un*li,ki.y+Mn[1]*un*li,ki.z+Mn[2]*un*li):Qn(fn,ki.x,ki.y,ki.z),Qn(qn,ki.x+Mn[0]*un*Zi,ki.y+Mn[1]*un*Zi,ki.z+Mn[2]*un*Zi),Ai(fn,fn,Ct),Ai(qn,qn,Ct),ii.push(new Zc(fn[0],fn[1],fn[2])),mi.push(new Zc(qn[0],qn[1],qn[2]))}Xt.push(ii),ni.push(mi)}return[Xt,ni]}(ae,me,de,Fe,ze,Ge,nt,Oe,$e,We,Xe):nt?function(rt,Ve,At,$t,Tt,Ct,mt,jt,en){const tn=[],In=[],Xt=[0,0,0,1];for(const ni of rt){const un=[],fn=[];for(const qn of ni){const Qn=qn.x+$t.x,Yn=qn.y+$t.y,ei=Hg(Qn,Yn,Ve,At,Ct,mt,jt,en);Xt[0]=Qn,Xt[1]=Yn,Xt[2]=ei.base,Xt[3]=1,Xl(Xt,Xt,Tt),Xt[3]=Math.max(Xt[3],1e-5);const ii=new Zc(Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]);Xt[0]=Qn,Xt[1]=Yn,Xt[2]=ei.top,Xt[3]=1,Xl(Xt,Xt,Tt),Xt[3]=Math.max(Xt[3],1e-5);const mi=new Zc(Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]);un.push(ii),fn.push(mi)}tn.push(un),In.push(fn)}return[tn,In]}(me,de,Fe,ze,Ge,nt,Oe,$e,We):function(rt,Ve,At,$t,Tt){const Ct=[],mt=[],jt=Tt[8]*Ve,en=Tt[9]*Ve,tn=Tt[10]*Ve,In=Tt[11]*Ve,Xt=Tt[8]*At,ni=Tt[9]*At,un=Tt[10]*At,fn=Tt[11]*At;for(const qn of rt){const Qn=[],Yn=[];for(const ei of qn){const ii=ei.x+$t.x,mi=ei.y+$t.y,_r=Tt[0]*ii+Tt[4]*mi+Tt[12],Un=Tt[1]*ii+Tt[5]*mi+Tt[13],Oi=Tt[2]*ii+Tt[6]*mi+Tt[14],ki=Tt[3]*ii+Tt[7]*mi+Tt[15],Mn=_r+jt,li=Un+en,Zi=Oi+tn,Hn=Math.max(ki+In,1e-5),Ti=_r+Xt,Gr=Un+ni,gr=Oi+un,yr=Math.max(ki+fn,1e-5);Qn.push(new Zc(Mn/Hn,li/Hn,Zi/Hn)),Yn.push(new Zc(Ti/yr,Gr/yr,gr/yr))}Ct.push(Qn),mt.push(Yn)}return[Ct,mt]}(me,de,Fe,ze,Ge)}(d,o,M,T,b,m,H,B,F,d.center.lat,t.tileID.canonical),ie=t.queryGeometry;return function(ae,me,de){let Fe=1/0;ym(de,me)&&(Fe=qg(de,me[0]));for(let ze=0;ze<me.length;ze++){const Ge=me[ze],nt=ae[ze];for(let Oe=0;Oe<Ge.length-1;Oe++){const $e=Ge[Oe],We=[$e,Ge[Oe+1],nt[Oe+1],nt[Oe],$e];ug(de,We)&&(Fe=Math.min(Fe,qg(de,We)))}}return Fe!==1/0&&Fe}(re,ce,ie.isPointQuery()?ie.screenBounds:ie.screenGeometry)}},line:class extends ro{constructor(t){super(t,$g),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Va,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Jl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new lo(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Ya(this,t)}queryRadius(t){const e=t,n=pn(Wl("line-width",this,e),Wl("line-gap-width",this,e)),o=Wl("line-offset",this,e);return n/2+Math.abs(o)+Bp(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,o,u,d){if(t.queryGeometry.isAboveHorizon)return!1;const m=hg(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*pn(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(o=function(b,T){const M=[],B=new ke(0,0);for(let L=0;L<b.length;L++){const F=b[L],N=[];for(let H=0;H<F.length;H++){const re=F[H-1],ce=F[H],ie=F[H+1],ae=H===0?B:ce.sub(re)._unit()._perp(),me=H===F.length-1?B:ie.sub(ce)._unit()._perp(),de=ae._add(me)._unit();de._mult(1/(de.x*me.x+de.y*me.y)),N.push(de._mult(T)._add(ce))}M.push(N)}return M}(o,x*t.pixelToTileUnitsFactor)),function(b,T,M){for(let B=0;B<T.length;B++){const L=T[B];if(b.length>=3){for(let F=0;F<L.length;F++)if(Bi(b,L[F]))return!0}if(lv(b,L,M))return!0}return!1}(m,o,y)}isTileClipped(){return!0}},symbol:df,background:class extends ro{constructor(t){super(t,Mx)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ro{constructor(t){super(t,h)}getProgramIds(){return["raster"]}},sky:class extends ro{constructor(t){super(t,E),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Sm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),u=!o,d=t.style.light,m=d.properties.get("position");return u&&d.properties.get("anchor")==="viewport"&&Xn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?z(m.azimuthal,90-m.polar,e):z(o[0],90-o[1],e)}const n=this.paint.get("sky-gradient-center");return z(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class Y{constructor(e,n,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,o){const{width:u,height:d}=e,{context:m}=this,{gl:y}=m,{HTMLImageElement:x,HTMLCanvasElement:b,HTMLVideoElement:T,ImageData:M,ImageBitmap:B}=q;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),o||this.size&&this.size[0]===u&&this.size[1]===d){const{x:L,y:F}=o||{x:0,y:0};e instanceof x||e instanceof b||e instanceof T||e instanceof M||B&&e instanceof B?y.texSubImage2D(y.TEXTURE_2D,0,L,F,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,L,F,u,d,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[u,d],e instanceof x||e instanceof b||e instanceof T||e instanceof M||B&&e instanceof B?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,u,d,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,n){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class he{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ve{constructor(){this.tasks={},this.taskQueue=[],Ri(["process"],this),this.invoker=new he(this.process),this.nextId=0}add(e,n){const o=this.nextId++,u=function({type:d,isSymbolTile:m,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||m?d!=="parseTile"||m?d==="parseTile"&&m?300-y:d==="maybePrepare"&&m?400-y:500:200-y:100-y}(n);if(u===0){or();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:n,priority:u,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){or();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const d=this.tasks[this.taskQueue[u]];d.priority<n&&(n=d.priority,e=u)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class Me{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Qe=["tile","layer","source","sourceLayer","state"];class et{constructor(e,n,o,u,d){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=u,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const n of Qe)this[n]!==void 0&&(e[n]=this[n]);return e}}const tt=32,xt=33,kt=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,o=0,u=0,d=0,m=0,y=0;for(1&e?u=d=m=tt:n=o=y=tt;(e>>=1)>1;){const b=n+u>>1,T=o+d>>1;1&e?(u=n,d=o,n=m,o=y):(n=u,o=d,u=m,d=y),m=b,y=T}const x=4*t;kt[x+0]=n,kt[x+1]=o,kt[x+2]=u,kt[x+3]=d}const Vt=new Uint16Array(2178),ln=new Uint8Array(1089),Kt=new Uint16Array(1089);function wn(t){return t===0?-.03125:t===32?.03125:0}var Sn=at([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const co={type:2,extent:Nt,loadGeometry:()=>[[new ke(0,0),new ke(8193,0),new ke(8193,8193),new ke(0,8193),new ke(0,0)]]};class mr{constructor(e,n,o,u,d){this.tileID=e,this.uid=oi(),this.uses=0,this.tileSize=n,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<An.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=qu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){const m={};if(!d)return m;for(const y of u){const x=y.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(b=>x.filter(T=>T.id===b)[0]));for(const b of x)m[b.id]=y}}return m}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof nu){if(this.hasSymbolBuckets=!0,!o)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof nu&&d.hasRTLText){this.hasRTLText=!0,ue.isLoading()||ue.isLoaded()||X()!=="deferred"||le();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new kc}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const u=this.buckets[o];u.uploadPending()&&u.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Y(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Y(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Y(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,o,u,d,m,y,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:m,params:d,tileTransform:this.tileTransform},e,n,o):{}}querySourceFeatures(e,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const u=o.loadVTLayers(),d=n?n.sourceLayer:"",m=u._geojsonTileLayer||u[d];if(!m)return;const y=Ac(n&&n.filter),{z:x,x:b,y:T}=this.tileID.canonical,M={z:x,x:b,y:T};for(let B=0;B<m.length;B++){const L=m.feature(B);if(y.needGeometry){const H=Ru(L,!0);if(!y.filter(new oe(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!y.filter(new oe(this.tileID.overscaledZ),L))continue;const F=o.getId(L,d),N=new et(L,x,b,T,F);N.tile=M,e.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const o=cu(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let u=!1;if(this.expirationTime>o)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const d=this.expirationTime-n;d?this.expirationTime=o+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;const o=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages();for(const d in this.buckets){if(!n.style.hasLayer(d))continue;const m=this.buckets[d],y=m.layers[0].sourceLayer||"_geojsonTileLayer",x=o[y],b=e[y];if(!x||!b||Object.keys(b).length===0)continue;if(m.update(b,x,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof lo||m instanceof Gp){const M=n.style._getSourceCache(m.layers[0].source);n._terrain&&n._terrain.enabled&&M&&m.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(M.id,this.tileID)}const T=n&&n.style&&n.style.getLayer(d);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<An.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=An.now()+e}setTexture(e,n){const o=n.context,u=o.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Y(o,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax))}setDependencies(e,n){const o={};for(const u of n)o[u]=!0;this.dependencies[e]=o}hasDependency(e,n){for(const o of e){const u=this.dependencies[o];if(u){for(const d of n)if(u[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const o=Or(co,this.tileID.canonical,this.tileTransform)[0],u=new Yt,d=new Dc;for(let m=0;m<o.length;m++){const{x:y,y:x}=o[m];u.emplaceBack(y,x),d.emplaceBack(m)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(u,Td.members),this._tileDebugSegments=bi.simpleSegment(0,0,u.length,d.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const o=Or(co,this.tileID.canonical,this.tileTransform)[0];let u,d;if(this.isRaster){const m=function(y,x){const b=qu(y,x),T=Math.pow(2,y.z);for(let H=0;H<xt;H++)for(let re=0;re<xt;re++){const ce=Io((y.x+(re+wn(re))/tt)/T),ie=$i((y.y+(H+wn(H))/tt)/T),ae=x.project(ce,ie),me=H*xt+re;Vt[2*me+0]=Math.round((ae.x*b.scale-b.x)*Nt),Vt[2*me+1]=Math.round((ae.y*b.scale-b.y)*Nt)}ln.fill(0),Kt.fill(0);for(let H=2045;H>=0;H--){const re=4*H,ce=kt[re+0],ie=kt[re+1],ae=kt[re+2],me=kt[re+3],de=ce+ae>>1,Fe=ie+me>>1,ze=de+Fe-ie,Ge=Fe+ce-de,nt=ie*xt+ce,Oe=me*xt+ae,$e=Fe*xt+de,We=Math.hypot((Vt[2*nt+0]+Vt[2*Oe+0])/2-Vt[2*$e+0],(Vt[2*nt+1]+Vt[2*Oe+1])/2-Vt[2*$e+1])>=16;if(ln[$e]=ln[$e]||(We?1:0),H<1022){const Xe=(ie+Ge>>1)*xt+(ce+ze>>1),rt=(me+Ge>>1)*xt+(ae+ze>>1);ln[$e]=ln[$e]||ln[Xe]||ln[rt]}}const M=new Ln,B=new Hi;let L=0;function F(H,re){const ce=re*xt+H;return Kt[ce]===0&&(M.emplaceBack(Vt[2*ce+0],Vt[2*ce+1],H*Nt/tt,re*Nt/tt),Kt[ce]=++L),Kt[ce]-1}function N(H,re,ce,ie,ae,me){const de=H+ce>>1,Fe=re+ie>>1;if(Math.abs(H-ae)+Math.abs(re-me)>1&&ln[Fe*xt+de])N(ae,me,H,re,de,Fe),N(ce,ie,ae,me,de,Fe);else{const ze=F(H,re),Ge=F(ce,ie),nt=F(ae,me);B.emplaceBack(ze,Ge,nt)}}return N(0,0,tt,tt,tt,0),N(tt,tt,0,0,0,tt),{vertices:M,indices:B}}(this.tileID.canonical,n);u=m.vertices,d=m.indices}else{u=new Ln,d=new Hi;for(const{x:y,y:x}of o)u.emplaceBack(y,x,0,0);const m=md.exports(u.int16,void 0,4);for(let y=0;y<m.length;y+=3)d.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Sn.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=bi.simpleSegment(0,0,u.length,d.length)}_makeGlobeTileDebugBuffers(e,n){const o=n.projection;if(!o||o.name!=="globe"||n.freezeTileCoverage)return;const u=this.tileID.canonical,d=Sd(wy(u,n)),m=oh(n.zoom);let y;m>0&&(y=kp(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,n,d,y,m),this._makeGlobeTileDebugTextBuffer(e,u,n,d,y,m)}_globePoint(e,n,o,u,d,m,y){let x=rh(e,n,o);if(m){const b=1<<o.z,T=Qi(u.center.lng),M=zs(u.center.lat),B=(o.x+.5)/b-T;let L=0;B>.5?L=-1:B<-.5&&(L=1);let F=(e/Nt+o.x)/b+L,N=(n/Nt+o.y)/b;F=(F-T)*u._pixelsPerMercatorPixel+T,N=(N-M)*u._pixelsPerMercatorPixel+M;const H=[F*u.worldSize,N*u.worldSize,0];Ai(H,H,m),x=ju(x,H,y)}return Ai(x,x,d)}_makeGlobeTileDebugBorderBuffer(e,n,o,u,d,m){const y=new Yt,x=new Dc,b=new Dn,T=(B,L,F,N,H)=>{const re=(F-B)/(H-1),ce=(N-L)/(H-1),ie=y.length;for(let ae=0;ae<H;ae++){const me=B+ae*re,de=L+ae*ce;y.emplaceBack(me,de);const Fe=this._globePoint(me,de,n,o,u,d,m);b.emplaceBack(Fe[0],Fe[1],Fe[2]),x.emplaceBack(ie+ae)}},M=Nt;T(0,0,M,0,16),T(M,0,M,M,16),T(M,M,0,M,16),T(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(y,Td.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,vy.members),this._tileDebugSegments=bi.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugTextBuffer(e,n,o,u,d,m){const y=new Yt,x=new Hi,b=new Dn,T=25;x.reserve(32),y.reserve(T),b.reserve(T);const M=(B,L)=>T*B+L;for(let B=0;B<T;B++){const L=2048*B;for(let F=0;F<T;F++){const N=2048*F;y.emplaceBack(N,L);const H=this._globePoint(N,L,n,o,u,d,m);b.emplaceBack(H[0],H[1],H[2])}}for(let B=0;B<4;B++)for(let L=0;L<4;L++){const F=M(B,L),N=M(B,L+1),H=M(B+1,L),re=M(B+1,L+1);x.emplaceBack(F,N,H),x.emplaceBack(H,N,re)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(y,Td.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(b,vy.members),this._tileDebugTextSegments=bi.simpleSegment(0,0,T,32)}}class ko{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){const u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Bt(this.stateChanges[e][u],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const d in this.state[e][u])o[d]||(this.deletedStates[e][u][d]=null)}else for(const d in o)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;const u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(o in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][o]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){const o=String(n),u=Bt({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][n];if(d===null)return{};for(const m in d)delete u[m]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const o={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),Bt(this.state[u][m],this.stateChanges[u][m]),d[m]=this.state[u][m];o[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const m in this.state[u])d[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(this.deletedStates[u][m]===null)this.state[u][m]={};else for(const y of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][y];d[m]=this.state[u][m]}o[u]=o[u]||{},Bt(o[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const u in e)e[u].setFeatureState(o,n)}}class Ci{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function ls(t,e,n,o){let u=0,d=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(o[m])<1e-15){if(n[m]<t[m]||n[m]>e[m])return null}else{const y=1/o[m];let x=(t[m]-n[m])*y,b=(e[m]-n[m])*y;if(x>b){const T=x;x=b,b=T}if(x>u&&(u=x),b<d&&(d=b),u>d)return null}return u}function Ea(t,e,n,o,u,d,m,y,x,b,T){const M=o-t,B=u-e,L=d-n,F=m-t,N=y-e,H=x-n,re=T[1]*H-T[2]*N,ce=T[2]*F-T[0]*H,ie=T[0]*N-T[1]*F,ae=M*re+B*ce+L*ie;if(Math.abs(ae)<1e-15)return null;const me=1/ae,de=b[0]-t,Fe=b[1]-e,ze=b[2]-n,Ge=(de*re+Fe*ce+ze*ie)*me;if(Ge<0||Ge>1)return null;const nt=Fe*L-ze*B,Oe=ze*M-de*L,$e=de*B-Fe*M,We=(T[0]*nt+T[1]*Oe+T[2]*$e)*me;return We<0||Ge+We>1?null:(F*nt+N*Oe+H*$e)*me}function o_(t,e,n){return(t-e)/(n-e)}function db(t,e,n,o,u,d,m,y,x){const b=1<<n,T=d-o,M=m-u,B=(t+1)/b*T+o,L=(e+0)/b*M+u,F=(e+1)/b*M+u;y[0]=(t+0)/b*T+o,y[1]=L,x[0]=B,x[1]=F}class pb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(d){const m=Math.ceil(Math.log2(d.dim/8)),y=[];let x=Math.ceil(Math.pow(2,m));const b=1/x,T=(L,F,N,H,re)=>{const ce=H?1:0,ie=(L+1)*N-ce,ae=F*N,me=(F+1)*N-ce;re[0]=L*N,re[1]=ae,re[2]=ie,re[3]=me};let M=new Ci(x);const B=[];for(let L=0;L<x*x;L++){T(L%x,Math.floor(L/x),b,!1,B);const F=ah(B[0],B[1],d),N=ah(B[2],B[1],d),H=ah(B[2],B[3],d),re=ah(B[0],B[3],d);M.minimums.push(Math.min(F,N,H,re)),M.maximums.push(Math.max(F,N,H,re)),M.leaves.push(1)}for(y.push(M),x/=2;x>=1;x/=2){const L=y[y.length-1];M=new Ci(x);for(let F=0;F<x*x;F++){T(F%x,Math.floor(F/x),2,!0,B);const N=L.getElevation(B[0],B[1]),H=L.getElevation(B[2],B[1]),re=L.getElevation(B[2],B[3]),ce=L.getElevation(B[0],B[3]),ie=L.isLeaf(B[0],B[1]),ae=L.isLeaf(B[2],B[1]),me=L.isLeaf(B[2],B[3]),de=L.isLeaf(B[0],B[3]),Fe=Math.min(N.min,H.min,re.min,ce.min),ze=Math.max(N.max,H.max,re.max,ce.max),Ge=ie&&ae&&me&&de;M.maximums.push(ze),M.minimums.push(Fe),M.leaves.push(ze-Fe<=5&&Ge?1:0)}y.push(M)}return y}(this.dem),o=n.length-1,u=n[o];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,u,d,m,y=1){return ls([e,n,-100],[o,u,this.maximums[0]*y],d,m)}raycast(e,n,o,u,d,m,y=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,n,o,u,d,m,y);if(x==null)return null;const b=[],T=[],M=[],B=[],L=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:F,t:N,nodex:H,nodey:re,depth:ce}=L.pop();if(this.leaves[F]){db(H,re,ce,e,n,o,u,M,B);const ae=1<<ce,me=(H+0)/ae,de=(H+1)/ae,Fe=(re+0)/ae,ze=(re+1)/ae,Ge=ah(me,Fe,this.dem)*y,nt=ah(de,Fe,this.dem)*y,Oe=ah(de,ze,this.dem)*y,$e=ah(me,ze,this.dem)*y,We=Ea(M[0],M[1],Ge,B[0],M[1],nt,B[0],B[1],Oe,d,m),Xe=Ea(B[0],B[1],Oe,M[0],B[1],$e,M[0],M[1],Ge,d,m),rt=Math.min(We!==null?We:Number.MAX_VALUE,Xe!==null?Xe:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const Ve=fd([],d,m,N);if(fb(Ge,nt,$e,Oe,o_(Ve[0],M[0],B[0]),o_(Ve[1],M[1],B[1]))>=Ve[2])return N}continue}let ie=0;for(let ae=0;ae<this._siblingOffset.length;ae++){db((H<<1)+this._siblingOffset[ae][0],(re<<1)+this._siblingOffset[ae][1],ce+1,e,n,o,u,M,B),M[2]=-100,B[2]=this.maximums[this.childOffsets[F]+ae]*y;const me=ls(M,B,d,m);if(me!=null){const de=me;b[ae]=de;let Fe=!1;for(let ze=0;ze<ie&&!Fe;ze++)de>=b[T[ze]]&&(T.splice(ze,0,ae),Fe=!0);Fe||(T[ie]=ae),ie++}}for(let ae=0;ae<ie;ae++){const me=T[ae];L.push({idx:this.childOffsets[F]+me,t:b[me],nodex:(H<<1)+this._siblingOffset[me][0],nodey:(re<<1)+this._siblingOffset[me][1],depth:ce+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,u,d){if(e[u].isLeaf(n,o)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const m=u-1,y=e[m];let x=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){const M=2*n+this._siblingOffset[T][0],B=2*o+this._siblingOffset[T][1],L=y.getElevation(M,B),F=y.isLeaf(M,B),N=this._addNode(L.min,L.max,F);F&&(x|=1<<T),b||(b=N)}for(let T=0;T<this._siblingOffset.length;T++)x&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*o+this._siblingOffset[T][1],m,b+T)}}function fb(t,e,n,o,u,d){return mn(mn(t,n,d),mn(e,o,d),u)}function ah(t,e,n){const o=n.dim,u=cn(t*o-.5,0,o-1),d=cn(e*o-.5,0,o-1),m=Math.floor(u),y=Math.floor(d),x=Math.min(m+1,o-1),b=Math.min(y+1,o-1);return fb(n.get(m,y),n.get(x,y),n.get(m,b),n.get(x,b),u-m,d-y)}const mb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class zy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,u=!1,d=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return Xn(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const m=this.dim=n.height-2,y=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=o||"mapbox",this.borderReady=u,!u){for(let x=0;x<m;x++)y[this._idx(-1,x)]=y[this._idx(0,x)],y[this._idx(m,x)]=y[this._idx(m-1,x)],y[this._idx(x,-1)]=y[this._idx(x,0)],y[this._idx(x,m)]=y[this._idx(x,m-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(m,-1)]=y[this._idx(m-1,0)],y[this._idx(-1,m)]=y[this._idx(0,m-1)],y[this._idx(m,m)]=y[this._idx(m-1,m-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new pb(this)}get(e,n,o=!1){o&&(e=cn(e,-1,this.dim),n=cn(n,-1,this.dim));const u=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return mb[e]}get unpackVector(){return mb[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,o){return(256*e*256+256*n+o)/10-1e4}_unpackTerrarium(e,n,o){return 256*e+n+o/256-32768}static pack(e,n){const o=[0,0,0,0],u=zy.getUnpackVector(n);let d=Math.floor((e+u[3])/u[2]);return o[2]=d%256,d=Math.floor(d/256),o[1]=d%256,d=Math.floor(d/256),o[0]=d,o}getPixels(){return new ao({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,d=n*this.dim+this.dim,m=o*this.dim,y=o*this.dim+this.dim;switch(n){case-1:u=d-1;break;case 1:d=u+1}switch(o){case-1:m=y-1;break;case 1:y=m+1}const x=-n*this.dim,b=-o*this.dim;for(let T=m;T<y;T++)for(let M=u;M<d;M++){const B=4*this._idx(M,T),L=4*this._idx(M+x,T+b);this.pixels[B+0]=e.pixels[L+0],this.pixels[B+1]=e.pixels[L+1],this.pixels[B+2]=e.pixels[L+2],this.pixels[B+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}vt(zy,"DEMData"),vt(pb,"DemMinMaxQuadTree",{omit:["dem"]});class pC{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:n,timeout:void 0};if(o!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},o)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const o=e.wrapped().key,u=n===void 0?0:this.data[o].indexOf(n),d=this.data[o][u];return this.data[o].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(d.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const o in this.data)for(const u of this.data[o])e(u.value)||n.push(u);for(const o of n)this.remove(o.value.tileID,o)}}class pf{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}pf.ReadOnly=!1,pf.ReadWrite=!0,pf.disabled=new pf(519,pf.ReadOnly,[0,1]);const Bx=7680;class Dx{constructor(e,n,o,u,d,m){this.test=e,this.ref=n,this.mask=o,this.fail=u,this.depthFail=d,this.pass=m}}Dx.disabled=new Dx({func:519,mask:0},0,0,Bx,Bx,Bx);class iu{constructor(e,n,o){this.blendFunction=e,this.blendColor=n,this.mask=o}}iu.Replace=[1,0],iu.disabled=new iu(iu.Replace,ai.transparent,[!1,!1,!1,!1]),iu.unblended=new iu(iu.Replace,ai.transparent,[!0,!0,!0,!0]),iu.alphaBlended=new iu([1,771],ai.transparent,[!0,!0,!0,!0]);const kx=1029,zx=2305;class rl{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}rl.disabled=new rl(!1,kx,zx),rl.backCCW=new rl(!0,kx,zx),rl.backCW=new rl(!0,kx,2304),rl.frontCW=new rl(!0,1028,2304),rl.frontCCW=new rl(!0,1028,zx);class kd extends xs{constructor(e,n,o){super(),this.id=e,this._onlySymbols=o,n.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new pC(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new ko,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Jt(this._tiles).map(e=>e.tileID).sort(_b).map(e=>e.key)}getRenderableIds(e){const n=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&n.push(this._tiles[o]);return e?n.sort((o,u)=>{const d=o.tileID,m=u.tileID,y=new ke(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),x=new ke(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-m.overscaledZ||x.y-y.y||x.x-y.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(_b).map(o=>o.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,e,n)))}_tileLoaded(e,n,o,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new Js(u,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=An.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Tn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const d=n[u];if(e.neighboringTiles&&e.neighboringTiles[d]){const m=this.getTileByID(d);o(e,m),o(m,e)}}function o(u,d){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=d.tileID.canonical.x-u.tileID.canonical.x;const y=d.tileID.canonical.y-u.tileID.canonical.y,x=Math.pow(2,u.tileID.canonical.z),b=d.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,m,y),u.neighboringTiles&&u.neighboringTiles[b]&&(u.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,u){for(const d in this._tiles){let m=this._tiles[d];if(u[d]||!m.hasData()||m.tileID.overscaledZ<=n||m.tileID.overscaledZ>o)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>n+1;){const b=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[b.key],m&&m.hasData()&&(y=b)}let x=y;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){u[y.key]=y;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){const u=e.scaledTo(o),d=this._getLoadedTile(u);if(d)return d}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const o=Math.ceil(e.width/n)+1,u=Math.ceil(e.height/n)+1,d=Math.floor(o*u*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const o={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),o[d.tileID.key]=d}this._tiles=o;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,n,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let u;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Dr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[];const d=this._updateRetainedTiles(u);if(gb(this._source.type)&&u.length!==0){const y={},x={},b=Object.keys(d);for(const M of b){const B=d[M],L=this._tiles[M];if(!L||L.fadeEndTime&&L.fadeEndTime<=An.now())continue;const F=this.findLoadedParent(B,Math.max(B.overscaledZ-kd.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),y[F.tileID.key]=F.tileID),x[M]=B}const T=u[u.length-1].overscaledZ;for(const M in this._tiles){const B=this._tiles[M];if(d[M]||!B.hasData())continue;let L=B.tileID;for(;L.overscaledZ>T;){L=L.scaledTo(L.overscaledZ-1);const F=this._tiles[L.key];if(F&&F.hasData()&&x[L.key]){d[M]=B.tileID;break}}}for(const M in y)d[M]||(this._coveredTiles[M]=!0,d[M]=y[M])}for(const y in d)this._tiles[y].clearFadeHold();const m=function(y,x){const b=[];for(const T in y)T in x||b.push(T);return b}(this._tiles,d);for(const y of m){const x=this._tiles[y];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const o={},u=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),d=e[0].overscaledZ,m=Math.max(d-kd.maxOverzooming,this._source.minzoom),y=Math.max(d+kd.maxUnderzooming,this._source.minzoom),x={};for(const b of e){const T=this._addTile(b);n[b.key]=b,T.hasData()||u<this._source.maxzoom&&(x[b.key]=b)}this._retainLoadedChildren(x,u,y,n);for(const b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const B=b.children(this._source.maxzoom)[0],L=this.getTile(B);if(L&&L.hasData()){n[B.key]=B;continue}}else{const B=b.children(this._source.maxzoom);if(n[B[0].key]&&n[B[1].key]&&n[B[2].key]&&n[B[3].key])continue}let M=T.wasRequested();for(let B=b.overscaledZ-1;B>=m;--B){const L=b.scaledTo(B);if(o[L.key]||(o[L.key]=!0,T=this.getTile(L),!T&&M&&(T=this._addTile(L)),T&&(n[L.key]=L,M=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let o,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){o=this._loadedParentTiles[u.key];break}n.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(o=this._getLoadedTile(d),o)break;u=d}for(const d of n)this._loadedParentTiles[d]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const o=Boolean(n);if(!o){const u=this.map?this.map.painter:null;n=new mr(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,o||this._source.fire(new Tn("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,o){const u=[],d=this.transform;if(!d)return u;const m=d.projection.name==="globe",y=Qi(d.center.lng);for(const x in this._tiles){const b=this._tiles[x];if(o&&b.clearQueryDebugViz(),b.holdingForFade())continue;let T;if(m){const M=b.tileID.canonical;if(M.z===0){const B=[Math.abs(cn(y,...s_(M,-1))-y),Math.abs(cn(y,...s_(M,1))-y)];T=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(cn(y,...s_(M,-1))-y),Math.abs(cn(y,...s_(M,0))-y),Math.abs(cn(y,...s_(M,1))-y)];T=[B.indexOf(Math.min(...B))-1]}}else T=[0];for(const M of T){const B=e.containsTile(b,d,n,M);B&&u.push(B)}}return u}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of n)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(gb(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=An.now())return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){const u=this._tiles[e];u&&u.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(const o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}_preloadTiles(e,n){const o=new Map,u=Array.isArray(e)?e:[e],d=this.map.painter.terrain,m=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const y of u){const x=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const b of x)o.set(b.key,b);this.usedForTerrain&&y.updateElevation(!1)}wt(Array.from(o.values()),(y,x)=>{const b=new mr(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),x(T,b)})},n)}}function _b(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function gb(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function s_(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}kd.maxOverzooming=10,kd.maxUnderzooming=3;class Py{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){const u=o||e.findDEMTileFor(n);if(!u||!u.dem)return;const d=u.dem,m=u.tileID,y=1<<n.canonical.z-m.canonical.z;return new Py(u,u.tileSize/Nt/y,[(n.canonical.x/y-m.canonical.x)*d.dim,(n.canonical.y/y-m.canonical.y)*d.dim])}tileCoordToPixel(e,n){const o=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(o);return new ke(u,d)}getElevationAt(e,n,o,u){const d=e*this._scale+this._offset[0],m=n*this._scale+this._offset[1],y=Math.floor(d),x=Math.floor(m),b=this._dem;return u=!!u,o?mn(mn(b.get(y,x,u),b.get(y,x+1,u),m-x),mn(b.get(y+1,x,u),b.get(y+1,x+1,u),m-x),d-y):b.get(y,x,u)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*So(1,e)*this._dem.stride}}class yb{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Gl(Nt,16,0),this.featureIndexArray=new id,this.promoteId=n}insert(e,n,o,u,d,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,d,m);const x=this.grid;for(let b=0;b<n.length;b++){const T=n[b],M=[1/0,1/0,-1/0,-1/0];for(let B=0;B<T.length;B++){const L=T[B];M[0]=Math.min(M[0],L.x),M[1]=Math.min(M[1],L.y),M[2]=Math.max(M[2],L.x),M[3]=Math.max(M[3],L.y)}M[0]<Nt&&M[1]<Nt&&M[2]>=0&&M[3]>=0&&x.insert(y,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Pm(new Xc(this.rawTileData)).layers,this.sourceLayerCoder=new Me(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,o,u){this.loadVTLayers();const d=e.params||{},m=Ac(d.filter),y=e.tileResult,x=e.transform,b=y.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(F,N,H,re)=>Mp(y.bufferedTilespaceGeometry,F,N,H,re));T.sort(fC);let M=null;x.elevation&&T.length>0&&(M=Py.create(x.elevation,this.tileID));const B={};let L;for(let F=0;F<T.length;F++){const N=T[F];if(N===L)continue;L=N;const H=this.featureIndexArray.get(N);let re=null;this.loadMatchingFeature(B,H,m,d.layers,d.availableImages,n,o,u,(ce,ie,ae,me=0)=>(re||(re=Or(ce,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(y,ce,ae,re,this.z,e.transform,e.pixelPosMatrix,M,me)))}return B}loadMatchingFeature(e,n,o,u,d,m,y,x,b){const{featureIndex:T,bucketIndex:M,sourceLayerIndex:B,layoutVertexArrayOffset:L}=n,F=this.bucketLayerIDs[M];if(u&&!function(ce,ie){for(let ae=0;ae<ce.length;ae++)if(ie.indexOf(ce[ae])>=0)return!0;return!1}(u,F))return;const N=this.sourceLayerCoder.decode(B),H=this.vtLayers[N].feature(T);if(o.needGeometry){const ce=Ru(H,!0);if(!o.filter(new oe(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!o.filter(new oe(this.tileID.overscaledZ),H))return;const re=this.getId(H,N);for(let ce=0;ce<F.length;ce++){const ie=F[ce];if(u&&u.indexOf(ie)<0)continue;const ae=m[ie];if(!ae)continue;let me={};re!==void 0&&x&&(me=x.getState(ae.sourceLayer||"_geojsonTileLayer",re));const de=Bt({},y[ie]);de.paint=vb(de.paint,ae.paint,H,me,d),de.layout=vb(de.layout,ae.layout,H,me,d);const Fe=!b||b(H,ae,me,L);if(!Fe)continue;const ze=new et(H,this.z,this.x,this.y,re);ze.layer=de;let Ge=e[ie];Ge===void 0&&(Ge=e[ie]=[]),Ge.push({featureIndex:T,feature:ze,intersectionZ:Fe})}}lookupSymbolFeatures(e,n,o,u,d,m,y,x){const b={};this.loadVTLayers();const T=Ac(d);for(const M of e)this.loadMatchingFeature(b,{bucketIndex:o,sourceLayerIndex:u,featureIndex:M,layoutVertexArrayOffset:0},T,m,y,x,n);return b}loadFeature(e){const{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(o),d=this.vtFeatures[u];if(d[n])return d[n];const m=this.vtLayers[u].feature(n);return d[n]=m,m}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];u!=null&&(o=e.properties[u]),typeof o=="boolean"&&(o=Number(o))}return o}}function vb(t,e,n,o,u){return Hr(t,(d,m)=>{const y=e instanceof He?e.get(m):null;return y&&y.evaluate?y.evaluate(n,o,u):y})}function fC(t,e){return e-t}vt(yb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class xb{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Qa({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const o=this.getKey(e,n);return this.positions[o]}trim(){const e=this.width,n=this.height=Fi(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){const u=[];let d=e.length%2==1?-e[e.length-1]*o:0,m=e[0]*o,y=!0;u.push({left:d,right:m,isDash:y,zeroLength:e[0]===0});let x=e[0];for(let b=1;b<e.length;b++){y=!y;const T=e[b];d=x*o,x+=T,m=x*o,u.push({left:d,right:m,isDash:y,zeroLength:T===0})}return u}addRoundDash(e,n,o){const u=n/2;for(let d=-o;d<=o;d++){const m=this.width*(this.nextRow+o+d);let y=0,x=e[y];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++y]);const T=Math.abs(b-x.left),M=Math.abs(b-x.right),B=Math.min(T,M);let L;const F=d/o*(u+1);if(x.isDash){const N=u-Math.abs(F);L=Math.sqrt(B*B+N*N)}else L=u-Math.sqrt(B*B+F*F);this.image.data[m+b]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){const b=e[x],T=e[x+1];b.zeroLength?e.splice(x,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(x,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const d=this.width*this.nextRow;let m=0,y=e[m];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++m]);const b=Math.abs(x-y.left),T=Math.abs(x-y.right),M=Math.min(b,T);this.image.data[d+x]=Math.max(0,Math.min(255,(y.isDash?M:-M)+n+128))}}addDash(e,n){const o=this.getKey(e,n);if(this.positions[o])return this.positions[o];const u=n==="round",d=u?7:0,m=2*d+1;if(this.nextRow+m>this.height)return Xn("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let T=0;T<e.length;T++)e[T]<0&&(Xn("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),y+=e[T];if(y!==0){const T=this.width/y,M=this.getDashRanges(e,this.width,T);u?this.addRoundDash(M,T,d):this.addRegularDash(M,n==="square"?.5*T:0)}const x=this.nextRow+d;this.nextRow+=m;const b={tl:[x,d],br:[y,0]};return this.positions[o]=b,b}}vt(xb,"LineAtlas");class wb{constructor(e){const n={},o=[];for(const y in e){const x=e[y],b=n[y]={};for(const T in x.glyphs){const M=x.glyphs[+T];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const B=M.metrics.localGlyph?2:1,L={x:0,y:0,w:M.bitmap.width+2*B,h:M.bitmap.height+2*B};o.push(L),b[T]=L}}const{w:u,h:d}=Jp(o),m=new Qa({width:u||1,height:d||1});for(const y in e){const x=e[y];for(const b in x.glyphs){const T=x.glyphs[+b];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const M=n[y][b],B=T.metrics.localGlyph?2:1;Qa.copy(T.bitmap,m,{x:0,y:0},{x:M.x+B,y:M.y+B},T.bitmap)}}this.image=m,this.positions=n}}vt(wb,"GlyphAtlas");class mC{constructor(e){this.tileID=new Dr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=qu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,o,u,d){this.status="parsing",this.data=e,this.collisionBoxArray=new kc;const m=new Me(Object.keys(e.layers).sort()),y=new yb(this.tileID,this.promoteId);y.bucketLayerIDs=[];const x={},b=new xb(256,256),T={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:o},M=n.familiesBySource[this.source];for(const me in M){const de=e.layers[me];if(!de)continue;let Fe=!1,ze=!1;for(const Oe of M[me])Oe[0].type==="symbol"?Fe=!0:ze=!0;if(this.isSymbolTile===!0&&!Fe||this.isSymbolTile===!1&&!ze)continue;de.version===1&&Xn(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ge=m.encode(me),nt=[];for(let Oe=0;Oe<de.length;Oe++){const $e=de.feature(Oe),We=y.getId($e,me);nt.push({feature:$e,id:We,index:Oe,sourceLayerIndex:Ge})}for(const Oe of M[me]){const $e=Oe[0];this.isSymbolTile!==void 0&&$e.type==="symbol"!==this.isSymbolTile||$e.minzoom&&this.zoom<Math.floor($e.minzoom)||$e.maxzoom&&this.zoom>=$e.maxzoom||$e.visibility!=="none"&&(Px(Oe,this.zoom,o),(x[$e.id]=$e.createBucket({index:y.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ge,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:o})).populate(nt,T,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(Oe.map(We=>We.id)))}}let B,L,F,N;b.trim();const H={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},re=Hr(T.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(re).length?u.send("getGlyphs",{uid:this.uid,stacks:re},(me,de)=>{B||(B=me,L=de,ae.call(this))},void 0,!1,H):L={};const ce=Object.keys(T.iconDependencies);ce.length?u.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"icons"},(me,de)=>{B||(B=me,F=de,ae.call(this))},void 0,!1,H):F={};const ie=Object.keys(T.patternDependencies);function ae(){if(B)return d(B);if(L&&F&&N){const me=new wb(L),de=new jn(F,N);for(const Fe in x){const ze=x[Fe];ze instanceof nu?(Px(ze.layers,this.zoom,o),hx(ze,L,me.positions,F,de.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection)):ze.hasPattern&&(ze instanceof lo||ze instanceof Gp||ze instanceof Gu)&&(Px(ze.layers,this.zoom,o),ze.addFeatures(T,this.tileID.canonical,de.patternPositions,o,this.tileTransform))}this.status="done",d(null,{buckets:Jt(x).filter(Fe=>!Fe.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:b,imageAtlas:de,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?me.positions:null})}}ie.length?u.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(me,de)=>{B||(B=me,N=de,ae.call(this))},void 0,!1,H):N={},ae.call(this)}}function Px(t,e,n){const o=new oe(e);for(const u of t)u.recalculate(o,n)}class bb{constructor(e){this.entries={},this.scheduler=e}request(e,n,o,u){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[m,y]=d.result;return this.scheduler?this.scheduler.add(()=>{u(m,y)},n):u(m,y),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=o((m,y)=>{d.result=[m,y];for(const x of d.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,y)},n):x(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==u),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function Ab(t,e,n){const o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const d=Go(t.request,(m,y,x,b)=>{m?u(m):y&&u(null,{vectorTile:n?void 0:new Pm(new Xc(y)),rawData:y,cacheControl:x,expires:b})});return()=>{d.cancel(),u()}},e)}s.ARRAY_TYPE=oo,s.AUTH_ERR_MSG=gl,s.Aabb=Br,s.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Ri(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=or()?t:q,this.scheduler=new ve}send(t,e,n,o,u=!1,d){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=d,this.callbacks[m]=n);const y=ka(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:t,hasCallback:!!n,targetMapId:o,mustQueue:u,sourceMapId:this.mapId,data:Du(e,y)},y),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[n];delete this.cancelCallbacks[n],o&&o.cancel()}else if(e.mustQueue||or()){const o=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),o&&o.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if(e.type==="<response>"){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(ua(e.error)):n(null,ua(e.data)))}else{const n=ka(this.globalScope)?void 0:[],o=e.hasCallback?(d,m)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:d?Du(d):null,data:Du(m,n)},n)}:d=>{},u=ua(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,o);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],u.source)[d[1]](u,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=$c,s.Color=ai,s.ColorMode=iu,s.CullFaceMode=rl,s.DEMData=zy,s.DataConstantProperty=Ie,s.DedupedRequest=bb,s.DepthMode=pf,s.EXTENT=Nt,s.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,o=1<<n,u=Math.floor(t.x),d=Math.floor((t.x-u)*o),m=Math.floor(t.y*o),y=this.findDEMTileFor(new Dr(n,u,n,d,m));return!(!y||!y.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||t.y<0||t.y>1)return e;const u=o.getSource().maxzoom,d=1<<u,m=Math.floor(t.x),y=t.x-m,x=new Dr(u,m,u,Math.floor(y*d),Math.floor(t.y*d)),b=this.findDEMTileFor(x);if(!b||!b.dem)return e;const T=b.dem,M=1<<b.tileID.canonical.z,B=(y*M-b.tileID.canonical.x)*T.dim,L=(t.y*M-b.tileID.canonical.y)*T.dim,F=Math.floor(B),N=Math.floor(L);return(n?this.exaggeration():1)*mn(mn(T.get(F,N),T.get(F,N+1),L-N),mn(T.get(F+1,N),T.get(F+1,N+1),L-N),B-F)}getAtTileOffset(t,e,n){const o=1<<t.canonical.z;return this.getAtPointOrZero(new Zl(t.wrap+(t.canonical.x+e/Nt)/o,(t.canonical.y+n/Nt)/o))}getAtTileOffsetFunc(t,e,n,o){return u=>{const d=this.getAtTileOffset(t,u.x,u.y),m=o.upVector(t.canonical,u.x,u.y);return Mo(m,m,d*o.upVectorScale(t.canonical,e,n).metersToTile),m}}getForTilePoints(t,e,n,o){if(this.isUsingMockSource())return!1;const u=Py.create(this,t,o);return!!u&&(e.forEach(d=>{d[2]=this.exaggeration()*u.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,o=e.tileID,u=1<<t.canonical.z-o.canonical.z;let d=t.canonical.x/u-o.canonical.x,m=t.canonical.y/u-o.canonical.y,y=0;for(let x=0;x<t.canonical.z-o.canonical.z&&!n.leaves[y];x++){d*=2,m*=2;const b=2*Math.floor(m)+Math.floor(d);y=n.childOffsets[y]+b,d%=1,m%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Js,s.EvaluationParameters=oe,s.Event=Tn,s.Evented=xs,s.FillExtrusionBucket=Gu,s.Frustum=Cm,s.FrustumCorners=so,s.GLOBE_METERS_TO_ECEF=Jm,s.GLOBE_RADIUS=il,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new Yt,n=new Hi,o=65;for(let u=0;u<o;u++)for(let d=0;d<o;d++)e.emplaceBack(d,u);this._gridSegments=[];for(let u=0,d=0;u<nh.length;u++){const m=nh[u];for(let x=0;x<m;x++)for(let b=0;b<64;b++){const T=x*o+b;n.emplaceBack(T+1,T,T+o),n.emplaceBack(T+o,T+o+1,T+1)}const y=64*m*2;this._gridSegments.push(bi.simpleSegment(0,d,(m+1)*o,y)),d+=y}this._gridBuffer=t.createVertexBuffer(e,Td.members),this._gridIndexBuffer=t.createIndexBuffer(n,!0)}_createPoles(t){const e=new Hi;for(let u=0;u<=th;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new ns,o=new ns;this._poleSegments=[];for(let u=0,d=0;u<5;u++){const m=360/(1<<u);n.emplaceBack(0,-il,0,.5,0),o.emplaceBack(0,-il,0,.5,1);for(let y=0;y<=th;y++){const x=y/th,b=mn(0,m,x),[T,M,B]=tu(e_,yx,b,il);n.emplaceBack(T,M,B,x,0),o.emplaceBack(T,M,B,x,1)}this._poleSegments.push(bi.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,yy,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,yy,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new fr,o=th,u=o+1;this._wireframeSegments=[];for(let d=0,m=0;d<nh.length;d++){const y=nh[d];for(let b=0;b<y;b++)for(let T=0;T<o;T++){const M=b*u+T;n.emplaceBack(M,M+1),n.emplaceBack(M,M+u),n.emplaceBack(M,M+u+1)}const x=y*o*3;this._wireframeSegments.push(bi.simpleSegment(0,m,(y+1)*u,x)),m+=x}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=Qc,s.ImagePosition=Vm,s.LivePerformanceUtils=Ke,s.LngLat=vn,s.LngLatBounds=ks,s.LocalGlyphMode=Zm,s.MAX_MERCATOR_LATITUDE=fa,s.MercatorCoordinate=Zl,s.ONE_EM=tr,s.OverscaledTileID=Dr,s.PerformanceMarkers=Be,s.Properties=st,s.RGBAImage=ao,s.Ray=Em,s.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ge,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Kr(t))return t;const n=Er(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Kr(t))return t;const n=Er(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,o){if(!Kr(t))return t;const u=Er(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),o&&u.params.push(`worldview=${o}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,o){const u=Er(t);return Kr(t)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||o)):(u.path+=`${e}${n}`,Xs(u))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Kr(t))return t;const o=Er(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&o.authority!=="raster"&&n===512?"@2x":""}${Le.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${Pe.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${Pe.TILE_URL_VERSION}${o.path}`);const u=this._customAccessToken||function(d){for(const m of d){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(o.params)||Pe.ACCESS_TOKEN;return Pe.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,u)}canonicalizeTileURL(t,e){const n=Er(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${Pe.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${Pe.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(d=>!d.match(/^access_token=/))),u.length&&(o+=`?${u.join("&")}`),o}canonicalizeTileset(t,e){const n=!!e&&Kr(e),o=[];for(const u of t.tiles||[])La(u)?o.push(this.canonicalizeTileURL(u,n)):o.push(u);return o}_makeAPIURL(t,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=Er(Pe.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!Pe.REQUIRE_ACCESS_TOKEN)return Xs(t);if(e=e||Pe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Xs(t)}},s.ResourceType=sr,s.SegmentVector=bi,s.SourceCache=kd,s.StencilMode=Dx,s.StructArrayLayout1ui2=Dc,s.StructArrayLayout2f1f2i16=Ir,s.StructArrayLayout2i4=Yt,s.StructArrayLayout2ui4=fr,s.StructArrayLayout3f12=to,s.StructArrayLayout3ui6=Hi,s.StructArrayLayout4i8=Ln,s.StructArrayLayout5f20=ns,s.Texture=Y,s.Tile=mr,s.Transitionable=Re,s.Uniform1f=Ep,s.Uniform1i=class extends ha{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},s.Uniform2f=class extends ha{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},s.Uniform3f=class extends ha{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},s.Uniform4f=pm,s.UniformColor=fm,s.UniformMatrix2f=class extends ha{constructor(t){super(t),this.current=ov}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let o=0;o<4;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}},s.UniformMatrix3f=class extends ha{constructor(t){super(t),this.current=da}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},s.UniformMatrix4f=class extends ha{constructor(t){super(t),this.current=io}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let o=1;o<16;o++)if(n[o]!==this.current[o]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},s.UnwrappedTileID=Um,s.ValidationError=gt,s.VectorTileFeature=qp,s.VectorTileWorkerSource=class extends xs{constructor(t,e,n,o,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=u||Ab,this.loading={},this.loaded={},this.deduped=new bb(t.scheduler),this.isSpriteLoaded=o,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,o=t&&t.request,u=o&&o.collectResourceTiming,d=this.loading[n]=new mC(t);d.abort=this.loadVectorData(t,(m,y)=>{const x=!this.loading[n];if(delete this.loading[n],x||m||!y)return d.status="done",x||(this.loaded[n]=d),e(m);const b=y.rawData,T={};y.expires&&(T.expires=y.expires),y.cacheControl&&(T.cacheControl=y.cacheControl),d.vectorTile=y.vectorTile||new Pm(new Xc(b));const M=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,L)=>{if(B||!L)return e(B);const F={};if(u){const N=Ft(o);N.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(N)))}e(null,Bt({rawTileData:b.slice(0)},L,T,F))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[n]=d})}reloadTile(t,e){const n=this.loaded,o=t.uid,u=this;if(n&&n[o]){const d=n[o];d.showCollisionBoxes=t.showCollisionBoxes,d.enableTerrain=!!t.enableTerrain,d.projection=t.projection,d.tileTransform=qu(t.tileID.canonical,t.projection);const m=(y,x)=>{const b=d.reloadCallback;b&&(delete d.reloadCallback,d.parse(d.vectorTile,u.layerIndex,this.availableImages,u.actor,b)),e(y,x)};d.status==="parsing"?d.reloadCallback=m:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(t,e){const n=t.uid,o=this.loading[n];o&&(o.abort&&o.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,o=t.uid;n&&n[o]&&delete n[o],e()}},s.WritingMode=Do,s.ZoomHistory=cp,s.add=ga,s.addDynamicAttributes=hf,s.adjoint=function(t,e){var n=e[0],o=e[1],u=e[2],d=e[3],m=e[4],y=e[5],x=e[6],b=e[7],T=e[8];return t[0]=m*T-y*b,t[1]=u*b-o*T,t[2]=o*y-u*m,t[3]=y*x-d*T,t[4]=n*T-u*x,t[5]=u*d-n*y,t[6]=d*b-m*x,t[7]=o*x-n*b,t[8]=n*m-o*d,t},s.asyncAll=wt,s.bezier=go,s.bindAll=Ri,s.boundsAttributes=Sn,s.bufferConvexPolygon=function(t,e){const n=[];for(let o=0;o<t.length;o++){const u=Ni(o-1,-1,t.length-1),d=Ni(o+1,-1,t.length-1),m=t[o],y=t[d],x=t[u].sub(m).unit(),b=y.sub(m).unit(),T=b.angleWithSep(x.x,x.y),M=x.add(b).unit().mult(-1*e/Math.sin(T/2));n.push(m.add(M))}return n},s.cacheEntryPossiblyAdded=function(t){$s++,$s>vs&&(t.getActor().send("enforceCacheSizeLimit",pl),$s=0)},s.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:o}=t.point,u=Ey(n,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Oc(u,u,Id(ba(e)))},s.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:o,lat:u}=t._center;return Ey(e,n,t.worldSize,o,u)},s.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/So(1,t.center.lat),o=Ps(new Float64Array(16));return Ou(o,o,[t.point.x,t.point.y,0]),Kl(o,o,[n,n,e]),Float32Array.from(o)},s.circumferenceAtLatitude=Tp,s.clamp=cn,s.clearTileCache=function(t){if(!fl())return;const e=q.caches.delete(Ar);t&&e.catch(t).then(()=>t())},s.clipLine=cy,s.clone=function(t){var e=new oo(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},s.clone$1=Pr,s.collisionCircleLayout=Jv,s.config=Pe,s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.create=function(){var t=new oo(16);return oo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},s.create$1=fg,s.createExpression=oa,s.createLayout=at,s.createStyleLayer=function(t){return t.type==="custom"?new _(t):new G[t.type](t)},s.cross=Am,s.degToRad=zt,s.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},s.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},s.dot=os,s.earthRadius=ld,s.ease=_s,s.easeCubicInOut=Oo,s.ecefToLatLng=function([t,e,n]){const o=Math.hypot(t,e,n),u=Math.atan2(t,n),d=.5*Math.PI-Math.acos(-e/o);return new vn(qt(u),qt(d))},s.emitValidationErrors=Ms,s.endsWith=Gi,s.enforceCacheSizeLimit=function(t){Wr(),Ii&&Ii.then(e=>{e.keys().then(n=>{for(let o=0;o<n.length-t;o++)e.delete(n[o])})})},s.evaluateSizeForFeature=Wc,s.evaluateSizeForZoom=Kc,s.evaluateVariableOffset=_y,s.evented=te,s.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},s.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},s.exported=An,s.exported$1=Le,s.extend=Bt,s.extend$1=Vo,s.fillExtrusionHeightLift=Vg,s.filterObject=ys,s.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},s.fromQuat=function(t,e){var n=e[0],o=e[1],u=e[2],d=e[3],m=n+n,y=o+o,x=u+u,b=n*m,T=o*m,M=o*y,B=u*m,L=u*y,F=u*x,N=d*m,H=d*y,re=d*x;return t[0]=1-M-F,t[1]=T+re,t[2]=B-H,t[3]=0,t[4]=T-re,t[5]=1-b-F,t[6]=L+N,t[7]=0,t[8]=B+H,t[9]=L-N,t[10]=1-b-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},s.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.fromScaling=xm,s.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return rr[e]},s.getAABBPointSquareDist=function(t,e,n){let o=0;for(let u=0;u<2;++u){const d=n?n[u]:0;t[u]>d&&(o+=(t[u]-d)*(t[u]-d)),e[u]<d&&(o+=(d-e[u])*(d-e[u]))}return o},s.getAnchorAlignment=Hm,s.getAnchorJustification=Wm,s.getBounds=function(t){let e=1/0,n=1/0,o=-1/0,u=-1/0;for(const d of t)e=Math.min(e,d.x),n=Math.min(n,d.y),o=Math.max(o,d.x),u=Math.max(u,d.y);return{min:new ke(e,n),max:new ke(o,u)}},s.getColumn=Zr,s.getGridMatrix=function(t,e,n,o){const u=e.getNorth(),d=e.getSouth(),m=e.getWest(),y=e.getEast(),x=1<<t.z,b=y-m,T=u-d,M=b/th,B=-T/nh[n],L=[0,M,0,B,0,0,u,m,0];if(t.z>0){const F=180/o;mg(L,L,[F/b+1,0,0,0,F/T+1,0,-.5*F/M,.5*F/B,1])}return L[2]=x,L[5]=t.x,L[8]=t.y,L},s.getImage=_l,s.getJSON=function(t,e){return No(Bt(t,{type:"json"}),e)},s.getLatitudinalLod=function(t){const e=80.051129;t=cn(t,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(zt(t))),3);return Math.round(n*(nh.length-1))},s.getMapSessionAPI=Ae,s.getPerformanceMeasurement=Ft,s.getProjection=Dy,s.getRTLTextPluginStatus=X,s.getReferrer=Zs,s.getTilePoint=function(t,{x:e,y:n},o=0){return new ke(((e-o)*t.scale-t.x)*Nt,(n*t.scale-t.y)*Nt)},s.getTileVec3=function(t,e,n=0){return Nc(((e.x-n)*t.scale-t.x)*Nt,(e.y*t.scale-t.y)*Nt,lg(e.z,e.y))},s.getVideo=function(t,e){const n=q.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<t.length;o++){const u=q.document.createElement("source");Pa(t[o])||(n.crossOrigin="Anonymous"),u.src=t[o],n.appendChild(u)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=Ps(new Float64Array(16));return Oc(n,t.pixelMatrix,t.globeMatrix),Ai(e,e,n),new ke(e[0],e[1])},s.globeDenormalizeECEF=Id,s.globeECEFOrigin=function(t,e){const n=[0,0,0];return Ai(n,n,Sd(ba(e.canonical))),Ai(n,n,t),n},s.globeNormalizeECEF=Sd,s.globePixelsToTileUnits=function(t,e){return Nt/(512*Math.pow(2,t))*of(ba(e))},s.globePoleMatrixForTile=function(t,e,n){const o=Ps(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return Uc(o,n.globeMatrix,u),Float32Array.from(o)},s.globeTileBounds=ba,s.globeTiltAtLngLat=Cy,s.globeToMercatorTransition=oh,s.globeUseCustomAntiAliasing=function(t,e,n){const o=oh(n.zoom),u=t.style.map._antialias,d=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!u&&!m&&d},s.identity=Ps,s.identity$1=bg,s.invert=kp,s.isFullscreen=function(){return!!q.document.fullscreenElement||!!q.document.webkitFullscreenElement},s.isLngLatBehindGlobe=function(t,e){return Cy(t,e)>Math.PI/2*1.01},s.isMapAuthenticated=function(t){return _e.has(t)},s.isMapboxURL=Kr,s.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!ka(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=$i,s.latLngToECEF=ih,s.len=hv,s.length=Fs,s.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},s.lngFromMercatorX=Io,s.loadVectorTile=Ab,s.makeRequest=No,s.mapValue=function(t,e,n,o,u){return cn((t-e)/(n-e)*(u-o)+o,o,u)},s.mercatorScale=ma,s.mercatorXfromLng=Qi,s.mercatorYfromLat=zs,s.mercatorZfromAltitude=So,s.mul=zp,s.mul$1=yg,s.multiply=Oc,s.multiply$1=mg,s.multiply$2=_g,s.nextPowerOfTwo=Fi,s.normalize=Mr,s.normalize$1=dv,s.normalize$2=xg,s.number=mn,s.ortho=function(t,e,n,o,u,d,m){var y=1/(e-n),x=1/(o-u),b=1/(d-m);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*b,t[11]=0,t[12]=(e+n)*y,t[13]=(u+o)*x,t[14]=(m+d)*b,t[15]=1,t},s.pbf=Xc,s.perspective=function(t,e,n,o,u){var d,m=1/Math.tan(e/2);return t[0]=m/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+o)*(d=1/(o-u)),t[14]=2*u*o*d):(t[10]=-1,t[14]=-2*o),t},s.pick=function(t,e){const n={};for(let o=0;o<e.length;o++){const u=e[o];u in t&&(n[u]=t[u])}return n},s.plugin=ue,s.pointGeometry=ke,s.polygonContainsPoint=Bi,s.polygonIntersectsBox=Mp,s.polygonIntersectsPolygon=ug,s.polygonizeBounds=function(t,e,n=0,o=!0){const u=new ke(n,n),d=t.sub(u),m=e.add(u),y=[d,new ke(m.x,d.y),m,new ke(d.x,m.y)];return o&&y.push(d.clone()),y},s.posAttributes=Td,s.postMapLoadEvent=ee,s.postPerformanceEvent=fe,s.postTurnstileEvent=R,s.potpack=Jp,s.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.radToDeg=qt,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(t){return t({pluginStatus:K,pluginURL:Q}),te.on("pluginStateChange",t),t},s.removeAuthState=function(t){_e.delete(t)},s.renderColorRamp=Sm,s.resample=Sp,s.rotateX=Uu,s.rotateX$1=Ag,s.rotateY=Uc,s.rotateY$1=Eg,s.rotateZ=function(t,e,n){var o=Math.sin(n),u=Math.cos(n),d=e[0],m=e[1],y=e[2],x=e[3],b=e[4],T=e[5],M=e[6],B=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*u+b*o,t[1]=m*u+T*o,t[2]=y*u+M*o,t[3]=x*u+B*o,t[4]=b*u-d*o,t[5]=T*u-m*o,t[6]=M*u-y*o,t[7]=B*u-x*o,t},s.rotateZ$1=function(t,e,n){n*=.5;var o=e[0],u=e[1],d=e[2],m=e[3],y=Math.sin(n),x=Math.cos(n);return t[0]=o*x+u*y,t[1]=u*x-o*y,t[2]=d*x+m*y,t[3]=m*x-d*y,t},s.scale=Kl,s.scale$1=vg,s.scale$2=Mo,s.scaleAndAdd=fd,s.set=function(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t},s.setCacheLimits=function(t,e){pl=t,vs=e},s.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},s.setRTLTextPlugin=function(t,e,n=!1){if(K===P||K===U||K===j)throw new Error("setRTLTextPlugin cannot be called multiple times.");Q=An.resolveURL(t),K=P,J=e,$(),n||le()},s.smoothstep=gs,s.spec=Ue,s.squaredLength=function(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o},s.storeAuthState=function(t,e){e?_e.add(t):_e.delete(t)},s.sub=ss,s.subtract=bm,s.symbolSize=el,s.tileAABB=function(t,e,n,o,u,d,m,y,x){if(x.name==="globe")return gx(t,e,new $c(n,o,u));const b=qu({z:n,x:o,y:u},x);return new Br([(d+b.x/b.scale)*e,e*(b.y/b.scale),m],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),y])},s.tileCornersToBounds=rf,s.tileTransform=qu,s.transformMat3=function(t,e,n){var o=e[0],u=e[1],d=e[2];return t[0]=o*n[0]+u*n[3]+d*n[6],t[1]=o*n[1]+u*n[4]+d*n[7],t[2]=o*n[2]+u*n[5]+d*n[8],t},s.transformMat4=Ai,s.transformMat4$1=Xl,s.transformQuat=gg,s.transitionTileAABBinECEF=wy,s.translate=Ou,s.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},s.triggerPluginCompletionEvent=Z,s.uniqueId=oi,s.updateGlobeVertexNormal=function(t,e,n,o,u){const d=5*e+2;t.float32[d+0]=n,t.float32[d+1]=o,t.float32[d+2]=u},s.validateCustomStyleLayer=function(t){const e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=t=>Is(Ts(t)),s.validateFog=t=>Is(W(t)),s.validateLayer=t=>Is(Jh(t)),s.validateLight=t=>Is(Ss(t)),s.validateSource=t=>Is(Wa(t)),s.validateStyle=yn,s.validateTerrain=t=>Is(Tc(t)),s.values=Jt,s.vectorTile=Vp,s.version=be,s.warnOnce=Xn,s.window=q,s.wrap=Ni}),D(["./shared"],function(s){function q(ne){if(typeof ne=="number"||typeof ne=="boolean"||typeof ne=="string"||ne==null)return JSON.stringify(ne);if(Array.isArray(ne)){let V="[";for(const ee of ne)V+=`${q(ee)},`;return`${V}]`}let R="{";for(const V of Object.keys(ne).sort())R+=`${V}:${q(ne[V])},`;return`${R}}`}function be(ne){let R="";for(const V of s.refProperties)R+=`/${q(ne[V])}`;return R}class je{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,V){for(const se of R)this._layerConfigs[se.id]=se,(this._layers[se.id]=s.createStyleLayer(se)).compileFilter(),this.keyCache[se.id]&&delete this.keyCache[se.id];for(const se of V)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const ee=function(se,fe){const Ee={};for(let _e=0;_e<se.length;_e++){const Be=fe&&fe[se[_e].id]||be(se[_e]);fe&&(fe[se[_e].id]=Be);let Ke=Ee[Be];Ke||(Ke=Ee[Be]=[]),Ke.push(se[_e])}const Ae=[];for(const _e in Ee)Ae.push(Ee[_e]);return Ae}(s.values(this._layerConfigs),this.keyCache);for(const se of ee){const fe=se.map(_t=>this._layers[_t.id]),Ee=fe[0];if(Ee.visibility==="none")continue;const Ae=Ee.source||"";let _e=this.familiesBySource[Ae];_e||(_e=this.familiesBySource[Ae]={});const Be=Ee.sourceLayer||"_geojsonTileLayer";let Ke=_e[Be];Ke||(Ke=_e[Be]=[]),Ke.push(fe)}}}class Pe{loadTile(R,V){const{uid:ee,encoding:se,rawImageData:fe,padding:Ee,buildQuadTree:Ae}=R,_e=s.window.ImageBitmap&&fe instanceof s.window.ImageBitmap?this.getImageData(fe,Ee):fe;V(null,new s.DEMData(ee,_e,se,Ee<1,Ae))}getImageData(R,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const ee=this.offscreenCanvasContext.getImageData(-V,-V,R.width+2*V,R.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ee}}var Le=function ne(R,V){var ee,se=R&&R.type;if(se==="FeatureCollection")for(ee=0;ee<R.features.length;ee++)ne(R.features[ee],V);else if(se==="GeometryCollection")for(ee=0;ee<R.geometries.length;ee++)ne(R.geometries[ee],V);else if(se==="Feature")ne(R.geometry,V);else if(se==="Polygon")ct(R.coordinates,V);else if(se==="MultiPolygon")for(ee=0;ee<R.coordinates.length;ee++)ct(R.coordinates[ee],V);return R};function ct(ne,R){if(ne.length!==0){ht(ne[0],R);for(var V=1;V<ne.length;V++)ht(ne[V],!R)}}function ht(ne,R){for(var V=0,ee=0,se=0,fe=ne.length,Ee=fe-1;se<fe;Ee=se++){var Ae=(ne[se][0]-ne[Ee][0])*(ne[Ee][1]+ne[se][1]),_e=V+Ae;ee+=Math.abs(V)>=Math.abs(Ae)?V-_e+Ae:Ae-_e+V,V=_e}V+ee>=0!=!!R&&ne.reverse()}const yt=s.VectorTileFeature.prototype.toGeoJSON;class hn{constructor(R){this._feature=R,this.extent=s.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const V of this._feature.geometry)R.push([new s.pointGeometry(V[0],V[1])]);return R}{const R=[];for(const V of this._feature.geometry){const ee=[];for(const se of V)ee.push(new s.pointGeometry(se[0],se[1]));R.push(ee)}return R}}toGeoJSON(R,V,ee){return yt.call(this,R,V,ee)}}class Te{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=R.length,this._features=R}feature(R){return new hn(this._features[R])}}var ge={exports:{}},Se=s.pointGeometry,it=s.vectorTile.VectorTileFeature,ke=ut;function ut(ne,R){this.options=R||{},this.features=ne,this.length=ne.length}function bt(ne,R){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=R||4096}ut.prototype.feature=function(ne){return new bt(this.features[ne],this.options.extent)},bt.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var R=0;R<ne.length;R++){for(var V=ne[R],ee=[],se=0;se<V.length;se++)ee.push(new Se(V[se][0],V[se][1]));this.geometry.push(ee)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,R=1/0,V=-1/0,ee=1/0,se=-1/0,fe=0;fe<ne.length;fe++)for(var Ee=ne[fe],Ae=0;Ae<Ee.length;Ae++){var _e=Ee[Ae];R=Math.min(R,_e.x),V=Math.max(V,_e.x),ee=Math.min(ee,_e.y),se=Math.max(se,_e.y)}return[R,ee,V,se]},bt.prototype.toGeoJSON=it.prototype.toGeoJSON;var Pt=s.pbf,zt=ke;function qt(ne){var R=new Pt;return function(V,ee){for(var se in V.layers)ee.writeMessage(3,rr,V.layers[se])}(ne,R),R.finish()}function rr(ne,R){var V;R.writeVarintField(15,ne.version||1),R.writeStringField(1,ne.name||""),R.writeVarintField(5,ne.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<ne.length;V++)ee.feature=ne.feature(V),R.writeMessage(2,Oo,ee);var se=ee.keys;for(V=0;V<se.length;V++)R.writeStringField(3,se[V]);var fe=ee.values;for(V=0;V<fe.length;V++)R.writeMessage(4,Ni,fe[V])}function Oo(ne,R){var V=ne.feature;V.id!==void 0&&R.writeVarintField(1,V.id),R.writeMessage(2,go,ne),R.writeVarintField(3,V.type),R.writeMessage(4,gs,V)}function go(ne,R){var V=ne.feature,ee=ne.keys,se=ne.values,fe=ne.keycache,Ee=ne.valuecache;for(var Ae in V.properties){var _e=V.properties[Ae],Be=fe[Ae];if(_e!==null){Be===void 0&&(ee.push(Ae),fe[Ae]=Be=ee.length-1),R.writeVarint(Be);var Ke=typeof _e;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(_e=JSON.stringify(_e));var _t=Ke+":"+_e,Je=Ee[_t];Je===void 0&&(se.push(_e),Ee[_t]=Je=se.length-1),R.writeVarint(Je)}}}function _s(ne,R){return(R<<3)+(7&ne)}function cn(ne){return ne<<1^ne>>31}function gs(ne,R){for(var V=ne.loadGeometry(),ee=ne.type,se=0,fe=0,Ee=V.length,Ae=0;Ae<Ee;Ae++){var _e=V[Ae],Be=1;ee===1&&(Be=_e.length),R.writeVarint(_s(1,Be));for(var Ke=ee===3?_e.length-1:_e.length,_t=0;_t<Ke;_t++){_t===1&&ee!==1&&R.writeVarint(_s(2,Ke-1));var Je=_e[_t].x-se,Ft=_e[_t].y-fe;R.writeVarint(cn(Je)),R.writeVarint(cn(Ft)),se+=Je,fe+=Ft}ee===3&&R.writeVarint(_s(7,1))}}function Ni(ne,R){var V=typeof ne;V==="string"?R.writeStringField(1,ne):V==="boolean"?R.writeBooleanField(7,ne):V==="number"&&(ne%1!=0?R.writeDoubleField(3,ne):ne<0?R.writeSVarintField(6,ne):R.writeVarintField(5,ne))}function wt(ne,R,V,ee,se,fe){if(se-ee<=V)return;const Ee=ee+se>>1;Jt(ne,R,Ee,ee,se,fe%2),wt(ne,R,V,ee,Ee-1,fe+1),wt(ne,R,V,Ee+1,se,fe+1)}function Jt(ne,R,V,ee,se,fe){for(;se>ee;){if(se-ee>600){const Be=se-ee+1,Ke=V-ee+1,_t=Math.log(Be),Je=.5*Math.exp(2*_t/3),Ft=.5*Math.sqrt(_t*Je*(Be-Je)/Be)*(Ke-Be/2<0?-1:1);Jt(ne,R,V,Math.max(ee,Math.floor(V-Ke*Je/Be+Ft)),Math.min(se,Math.floor(V+(Be-Ke)*Je/Be+Ft)),fe)}const Ee=R[2*V+fe];let Ae=ee,_e=se;for(Bt(ne,R,ee,V),R[2*se+fe]>Ee&&Bt(ne,R,ee,se);Ae<_e;){for(Bt(ne,R,Ae,_e),Ae++,_e--;R[2*Ae+fe]<Ee;)Ae++;for(;R[2*_e+fe]>Ee;)_e--}R[2*ee+fe]===Ee?Bt(ne,R,ee,_e):(_e++,Bt(ne,R,_e,se)),_e<=V&&(ee=_e+1),V<=_e&&(se=_e-1)}}function Bt(ne,R,V,ee){gn(ne,V,ee),gn(R,2*V,2*ee),gn(R,2*V+1,2*ee+1)}function gn(ne,R,V){const ee=ne[R];ne[R]=ne[V],ne[V]=ee}function oi(ne,R,V,ee){const se=ne-V,fe=R-ee;return se*se+fe*fe}ge.exports=qt,ge.exports.fromVectorTileJs=qt,ge.exports.fromGeojsonVt=function(ne,R){R=R||{};var V={};for(var ee in ne)V[ee]=new zt(ne[ee].features,R),V[ee].name=ee,V[ee].version=R.version,V[ee].extent=R.extent;return qt({layers:V})},ge.exports.GeoJSONWrapper=zt;const br=ne=>ne[0],Fi=ne=>ne[1];class Ki{constructor(R,V=br,ee=Fi,se=64,fe=Float64Array){this.nodeSize=se,this.points=R;const Ee=R.length<65536?Uint16Array:Uint32Array,Ae=this.ids=new Ee(R.length),_e=this.coords=new fe(2*R.length);for(let Be=0;Be<R.length;Be++)Ae[Be]=Be,_e[2*Be]=V(R[Be]),_e[2*Be+1]=ee(R[Be]);wt(Ae,_e,se,0,Ae.length-1,0)}range(R,V,ee,se){return function(fe,Ee,Ae,_e,Be,Ke,_t){const Je=[0,fe.length-1,0],Ft=[];let Dt,Mt;for(;Je.length;){const Gt=Je.pop(),sn=Je.pop(),An=Je.pop();if(sn-An<=_t){for(let Tn=An;Tn<=sn;Tn++)Dt=Ee[2*Tn],Mt=Ee[2*Tn+1],Dt>=Ae&&Dt<=Be&&Mt>=_e&&Mt<=Ke&&Ft.push(fe[Tn]);continue}const Rt=Math.floor((An+sn)/2);Dt=Ee[2*Rt],Mt=Ee[2*Rt+1],Dt>=Ae&&Dt<=Be&&Mt>=_e&&Mt<=Ke&&Ft.push(fe[Rt]);const Pn=(Gt+1)%2;(Gt===0?Ae<=Dt:_e<=Mt)&&(Je.push(An),Je.push(Rt-1),Je.push(Pn)),(Gt===0?Be>=Dt:Ke>=Mt)&&(Je.push(Rt+1),Je.push(sn),Je.push(Pn))}return Ft}(this.ids,this.coords,R,V,ee,se,this.nodeSize)}within(R,V,ee){return function(se,fe,Ee,Ae,_e,Be){const Ke=[0,se.length-1,0],_t=[],Je=_e*_e;for(;Ke.length;){const Ft=Ke.pop(),Dt=Ke.pop(),Mt=Ke.pop();if(Dt-Mt<=Be){for(let Pn=Mt;Pn<=Dt;Pn++)oi(fe[2*Pn],fe[2*Pn+1],Ee,Ae)<=Je&&_t.push(se[Pn]);continue}const Gt=Math.floor((Mt+Dt)/2),sn=fe[2*Gt],An=fe[2*Gt+1];oi(sn,An,Ee,Ae)<=Je&&_t.push(se[Gt]);const Rt=(Ft+1)%2;(Ft===0?Ee-_e<=sn:Ae-_e<=An)&&(Ke.push(Mt),Ke.push(Gt-1),Ke.push(Rt)),(Ft===0?Ee+_e>=sn:Ae+_e>=An)&&(Ke.push(Gt+1),Ke.push(Dt),Ke.push(Rt))}return _t}(this.ids,this.coords,R,V,ee,this.nodeSize)}}const Ri={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},Gi=Math.fround||(Hr=new Float32Array(1),ne=>(Hr[0]=+ne,Hr[0]));var Hr;class ys{constructor(R){this.options=Vi(Object.create(Ri),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:V,minZoom:ee,maxZoom:se,nodeSize:fe}=this.options;V&&console.time("total time");const Ee=`prepare ${R.length} points`;V&&console.time(Ee),this.points=R;let Ae=[];for(let _e=0;_e<R.length;_e++)R[_e].geometry&&Ae.push(Da(R[_e],_e));this.trees[se+1]=new Ki(Ae,ka,hu,fe,Float32Array),V&&console.timeEnd(Ee);for(let _e=se;_e>=ee;_e--){const Be=+Date.now();Ae=this._cluster(Ae,_e),this.trees[_e]=new Ki(Ae,ka,hu,fe,Float32Array),V&&console.log("z%d: %d clusters in %dms",_e,Ae.length,+Date.now()-Be)}return V&&console.timeEnd("total time"),this}getClusters(R,V){let ee=((R[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,R[1]));let fe=R[2]===180?180:((R[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)ee=-180,fe=180;else if(ee>fe){const Ke=this.getClusters([ee,se,180,Ee],V),_t=this.getClusters([-180,se,fe,Ee],V);return Ke.concat(_t)}const Ae=this.trees[this._limitZoom(V)],_e=Ae.range(Qt(ee),or(Ee),Qt(fe),or(se)),Be=[];for(const Ke of _e){const _t=Ae.points[Ke];Be.push(_t.numPoints?Xn(_t):this.points[_t.index])}return Be}getChildren(R){const V=this._getOriginId(R),ee=this._getOriginZoom(R),se="No cluster with the specified id.",fe=this.trees[ee];if(!fe)throw new Error(se);const Ee=fe.points[V];if(!Ee)throw new Error(se);const Ae=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),_e=fe.within(Ee.x,Ee.y,Ae),Be=[];for(const Ke of _e){const _t=fe.points[Ke];_t.parentId===R&&Be.push(_t.numPoints?Xn(_t):this.points[_t.index])}if(Be.length===0)throw new Error(se);return Be}getLeaves(R,V,ee){const se=[];return this._appendLeaves(se,R,V=V||10,ee=ee||0,0),se}getTile(R,V,ee){const se=this.trees[this._limitZoom(R)],fe=Math.pow(2,R),{extent:Ee,radius:Ae}=this.options,_e=Ae/Ee,Be=(ee-_e)/fe,Ke=(ee+1+_e)/fe,_t={features:[]};return this._addTileFeatures(se.range((V-_e)/fe,Be,(V+1+_e)/fe,Ke),se.points,V,ee,fe,_t),V===0&&this._addTileFeatures(se.range(1-_e/fe,Be,1,Ke),se.points,fe,ee,fe,_t),V===fe-1&&this._addTileFeatures(se.range(0,Be,_e/fe,Ke),se.points,-1,ee,fe,_t),_t.features.length?_t:null}getClusterExpansionZoom(R){let V=this._getOriginZoom(R)-1;for(;V<=this.options.maxZoom;){const ee=this.getChildren(R);if(V++,ee.length!==1)break;R=ee[0].properties.cluster_id}return V}_appendLeaves(R,V,ee,se,fe){const Ee=this.getChildren(V);for(const Ae of Ee){const _e=Ae.properties;if(_e&&_e.cluster?fe+_e.point_count<=se?fe+=_e.point_count:fe=this._appendLeaves(R,_e.cluster_id,ee,se,fe):fe<se?fe++:R.push(Ae),R.length===ee)break}return fe}_addTileFeatures(R,V,ee,se,fe,Ee){for(const Ae of R){const _e=V[Ae],Be=_e.numPoints;let Ke,_t,Je;if(Be)Ke=$r(_e),_t=_e.x,Je=_e.y;else{const Mt=this.points[_e.index];Ke=Mt.properties,_t=Qt(Mt.geometry.coordinates[0]),Je=or(Mt.geometry.coordinates[1])}const Ft={type:1,geometry:[[Math.round(this.options.extent*(_t*fe-ee)),Math.round(this.options.extent*(Je*fe-se))]],tags:Ke};let Dt;Be?Dt=_e.id:this.options.generateId?Dt=_e.index:this.points[_e.index].id&&(Dt=this.points[_e.index].id),Dt!==void 0&&(Ft.id=Dt),Ee.features.push(Ft)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,V){const ee=[],{radius:se,extent:fe,reduce:Ee,minPoints:Ae}=this.options,_e=se/(fe*Math.pow(2,V));for(let Be=0;Be<R.length;Be++){const Ke=R[Be];if(Ke.zoom<=V)continue;Ke.zoom=V;const _t=this.trees[V+1],Je=_t.within(Ke.x,Ke.y,_e),Ft=Ke.numPoints||1;let Dt=Ft;for(const Mt of Je){const Gt=_t.points[Mt];Gt.zoom>V&&(Dt+=Gt.numPoints||1)}if(Dt>Ft&&Dt>=Ae){let Mt=Ke.x*Ft,Gt=Ke.y*Ft,sn=Ee&&Ft>1?this._map(Ke,!0):null;const An=(Be<<5)+(V+1)+this.points.length;for(const Rt of Je){const Pn=_t.points[Rt];if(Pn.zoom<=V)continue;Pn.zoom=V;const Tn=Pn.numPoints||1;Mt+=Pn.x*Tn,Gt+=Pn.y*Tn,Pn.parentId=An,Ee&&(sn||(sn=this._map(Ke,!0)),Ee(sn,this._map(Pn)))}Ke.parentId=An,ee.push(Pr(Mt/Dt,Gt/Dt,An,Dt,sn))}else if(ee.push(Ke),Dt>1)for(const Mt of Je){const Gt=_t.points[Mt];Gt.zoom<=V||(Gt.zoom=V,ee.push(Gt))}}return ee}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,V){if(R.numPoints)return V?Vi({},R.properties):R.properties;const ee=this.points[R.index].properties,se=this.options.map(ee);return V&&se===ee?Vi({},se):se}}function Pr(ne,R,V,ee,se){return{x:Gi(ne),y:Gi(R),zoom:1/0,id:V,parentId:-1,numPoints:ee,properties:se}}function Da(ne,R){const[V,ee]=ne.geometry.coordinates;return{x:Gi(Qt(V)),y:Gi(or(ee)),zoom:1/0,index:R,parentId:-1}}function Xn(ne){return{type:"Feature",id:ne.id,properties:$r(ne),geometry:{type:"Point",coordinates:[(R=ne.x,360*(R-.5)),cu(ne.y)]}};var R}function $r(ne){const R=ne.numPoints,V=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return Vi(Vi({},ne.properties),{cluster:!0,cluster_id:ne.id,point_count:R,point_count_abbreviated:V})}function Qt(ne){return ne/360+.5}function or(ne){const R=Math.sin(ne*Math.PI/180),V=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return V<0?0:V>1?1:V}function cu(ne){const R=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function Vi(ne,R){for(const V in R)ne[V]=R[V];return ne}function ka(ne){return ne.x}function hu(ne){return ne.y}function Zr(ne,R,V,ee){for(var se,fe=ee,Ee=V-R>>1,Ae=V-R,_e=ne[R],Be=ne[R+1],Ke=ne[V],_t=ne[V+1],Je=R+3;Je<V;Je+=3){var Ft=Ar(ne[Je],ne[Je+1],_e,Be,Ke,_t);if(Ft>fe)se=Je,fe=Ft;else if(Ft===fe){var Dt=Math.abs(Je-Ee);Dt<Ae&&(se=Je,Ae=Dt)}}fe>ee&&(se-R>3&&Zr(ne,R,se,ee),ne[se+2]=fe,V-se>3&&Zr(ne,se,V,ee))}function Ar(ne,R,V,ee,se,fe){var Ee=se-V,Ae=fe-ee;if(Ee!==0||Ae!==0){var _e=((ne-V)*Ee+(R-ee)*Ae)/(Ee*Ee+Ae*Ae);_e>1?(V=se,ee=fe):_e>0&&(V+=Ee*_e,ee+=Ae*_e)}return(Ee=ne-V)*Ee+(Ae=R-ee)*Ae}function Ii(ne,R,V,ee){var se={id:ne===void 0?null:ne,type:R,geometry:V,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(fe){var Ee=fe.geometry,Ae=fe.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")yo(fe,Ee);else if(Ae==="Polygon"||Ae==="MultiLineString")for(var _e=0;_e<Ee.length;_e++)yo(fe,Ee[_e]);else if(Ae==="MultiPolygon")for(_e=0;_e<Ee.length;_e++)for(var Be=0;Be<Ee[_e].length;Be++)yo(fe,Ee[_e][Be])}(se),se}function yo(ne,R){for(var V=0;V<R.length;V+=3)ne.minX=Math.min(ne.minX,R[V]),ne.minY=Math.min(ne.minY,R[V+1]),ne.maxX=Math.max(ne.maxX,R[V]),ne.maxY=Math.max(ne.maxY,R[V+1])}function pl(ne,R,V,ee){if(R.geometry){var se=R.geometry.coordinates,fe=R.geometry.type,Ee=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Ae=[],_e=R.id;if(V.promoteId?_e=R.properties[V.promoteId]:V.generateId&&(_e=ee||0),fe==="Point")vs(se,Ae);else if(fe==="MultiPoint")for(var Be=0;Be<se.length;Be++)vs(se[Be],Ae);else if(fe==="LineString")fl(se,Ae,Ee,!1);else if(fe==="MultiLineString"){if(V.lineMetrics){for(Be=0;Be<se.length;Be++)fl(se[Be],Ae=[],Ee,!1),ne.push(Ii(_e,"LineString",Ae,R.properties));return}Wr(se,Ae,Ee,!1)}else if(fe==="Polygon")Wr(se,Ae,Ee,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(Be=0;Be<R.geometry.geometries.length;Be++)pl(ne,{id:_e,geometry:R.geometry.geometries[Be],properties:R.properties},V,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Be=0;Be<se.length;Be++){var Ke=[];Wr(se[Be],Ke,Ee,!0),Ae.push(Ke)}}ne.push(Ii(_e,fe,Ae,R.properties))}}function vs(ne,R){R.push(Uo(ne[0])),R.push($s(ne[1])),R.push(0)}function fl(ne,R,V,ee){for(var se,fe,Ee=0,Ae=0;Ae<ne.length;Ae++){var _e=Uo(ne[Ae][0]),Be=$s(ne[Ae][1]);R.push(_e),R.push(Be),R.push(0),Ae>0&&(Ee+=ee?(se*Be-_e*fe)/2:Math.sqrt(Math.pow(_e-se,2)+Math.pow(Be-fe,2))),se=_e,fe=Be}var Ke=R.length-3;R[2]=1,Zr(R,0,Ke,V),R[Ke+2]=1,R.size=Math.abs(Ee),R.start=0,R.end=R.size}function Wr(ne,R,V,ee){for(var se=0;se<ne.length;se++){var fe=[];fl(ne[se],fe,V,ee),R.push(fe)}}function Uo(ne){return ne/360+.5}function $s(ne){var R=Math.sin(ne*Math.PI/180),V=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return V<0?0:V>1?1:V}function sr(ne,R,V,ee,se,fe,Ee,Ae){if(ee/=R,fe>=(V/=R)&&Ee<ee)return ne;if(Ee<V||fe>=ee)return null;for(var _e=[],Be=0;Be<ne.length;Be++){var Ke=ne[Be],_t=Ke.geometry,Je=Ke.type,Ft=se===0?Ke.minX:Ke.minY,Dt=se===0?Ke.maxX:Ke.maxY;if(Ft>=V&&Dt<ee)_e.push(Ke);else if(!(Dt<V||Ft>=ee)){var Mt=[];if(Je==="Point"||Je==="MultiPoint")za(_t,Mt,V,ee,se);else if(Je==="LineString")Zs(_t,Mt,V,ee,se,!1,Ae.lineMetrics);else if(Je==="MultiLineString")Go(_t,Mt,V,ee,se,!1);else if(Je==="Polygon")Go(_t,Mt,V,ee,se,!0);else if(Je==="MultiPolygon")for(var Gt=0;Gt<_t.length;Gt++){var sn=[];Go(_t[Gt],sn,V,ee,se,!0),sn.length&&Mt.push(sn)}if(Mt.length){if(Ae.lineMetrics&&Je==="LineString"){for(Gt=0;Gt<Mt.length;Gt++)_e.push(Ii(Ke.id,Je,Mt[Gt],Ke.tags));continue}Je!=="LineString"&&Je!=="MultiLineString"||(Mt.length===1?(Je="LineString",Mt=Mt[0]):Je="MultiLineString"),Je!=="Point"&&Je!=="MultiPoint"||(Je=Mt.length===3?"Point":"MultiPoint"),_e.push(Ii(Ke.id,Je,Mt,Ke.tags))}}}return _e.length?_e:null}function za(ne,R,V,ee,se){for(var fe=0;fe<ne.length;fe+=3){var Ee=ne[fe+se];Ee>=V&&Ee<=ee&&(R.push(ne[fe]),R.push(ne[fe+1]),R.push(ne[fe+2]))}}function Zs(ne,R,V,ee,se,fe,Ee){for(var Ae,_e,Be=No(ne),Ke=se===0?ml:Ws,_t=ne.start,Je=0;Je<ne.length-3;Je+=3){var Ft=ne[Je],Dt=ne[Je+1],Mt=ne[Je+2],Gt=ne[Je+3],sn=ne[Je+4],An=se===0?Ft:Dt,Rt=se===0?Gt:sn,Pn=!1;Ee&&(Ae=Math.sqrt(Math.pow(Ft-Gt,2)+Math.pow(Dt-sn,2))),An<V?Rt>V&&(_e=Ke(Be,Ft,Dt,Gt,sn,V),Ee&&(Be.start=_t+Ae*_e)):An>ee?Rt<ee&&(_e=Ke(Be,Ft,Dt,Gt,sn,ee),Ee&&(Be.start=_t+Ae*_e)):Pa(Be,Ft,Dt,Mt),Rt<V&&An>=V&&(_e=Ke(Be,Ft,Dt,Gt,sn,V),Pn=!0),Rt>ee&&An<=ee&&(_e=Ke(Be,Ft,Dt,Gt,sn,ee),Pn=!0),!fe&&Pn&&(Ee&&(Be.end=_t+Ae*_e),R.push(Be),Be=No(ne)),Ee&&(_t+=Ae)}var Tn=ne.length-3;Ft=ne[Tn],Dt=ne[Tn+1],Mt=ne[Tn+2],(An=se===0?Ft:Dt)>=V&&An<=ee&&Pa(Be,Ft,Dt,Mt),Tn=Be.length-3,fe&&Tn>=3&&(Be[Tn]!==Be[0]||Be[Tn+1]!==Be[1])&&Pa(Be,Be[0],Be[1],Be[2]),Be.length&&R.push(Be)}function No(ne){var R=[];return R.size=ne.size,R.start=ne.start,R.end=ne.end,R}function Go(ne,R,V,ee,se,fe){for(var Ee=0;Ee<ne.length;Ee++)Zs(ne[Ee],R,V,ee,se,fe,!1)}function Pa(ne,R,V,ee){ne.push(R),ne.push(V),ne.push(ee)}function ml(ne,R,V,ee,se,fe){var Ee=(fe-R)/(ee-R);return ne.push(fe),ne.push(V+(se-V)*Ee),ne.push(1),Ee}function Ws(ne,R,V,ee,se,fe){var Ee=(fe-V)/(se-V);return ne.push(R+(ee-R)*Ee),ne.push(fe),ne.push(1),Ee}function Ks(ne,R){for(var V=[],ee=0;ee<ne.length;ee++){var se,fe=ne[ee],Ee=fe.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")se=_l(fe.geometry,R);else if(Ee==="MultiLineString"||Ee==="Polygon"){se=[];for(var Ae=0;Ae<fe.geometry.length;Ae++)se.push(_l(fe.geometry[Ae],R))}else if(Ee==="MultiPolygon")for(se=[],Ae=0;Ae<fe.geometry.length;Ae++){for(var _e=[],Be=0;Be<fe.geometry[Ae].length;Be++)_e.push(_l(fe.geometry[Ae][Be],R));se.push(_e)}V.push(Ii(fe.id,Ee,se,fe.tags))}return V}function _l(ne,R){var V=[];V.size=ne.size,ne.start!==void 0&&(V.start=ne.start,V.end=ne.end);for(var ee=0;ee<ne.length;ee+=3)V.push(ne[ee]+R,ne[ee+1],ne[ee+2]);return V}function gl(ne,R){if(ne.transformed)return ne;var V,ee,se,fe=1<<ne.z,Ee=ne.x,Ae=ne.y;for(V=0;V<ne.features.length;V++){var _e=ne.features[V],Be=_e.geometry,Ke=_e.type;if(_e.geometry=[],Ke===1)for(ee=0;ee<Be.length;ee+=2)_e.geometry.push(Kr(Be[ee],Be[ee+1],R,fe,Ee,Ae));else for(ee=0;ee<Be.length;ee++){var _t=[];for(se=0;se<Be[ee].length;se+=2)_t.push(Kr(Be[ee][se],Be[ee][se+1],R,fe,Ee,Ae));_e.geometry.push(_t)}}return ne.transformed=!0,ne}function Kr(ne,R,V,ee,se,fe){return[Math.round(V*(ne*ee-se)),Math.round(V*(R*ee-fe))]}function La(ne,R,V,ee,se){for(var fe=R===se.maxZoom?0:se.tolerance/((1<<R)*se.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:ee,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ae=0;Ae<ne.length;Ae++){Ee.numFeatures++,ic(Ee,ne[Ae],fe,se);var _e=ne[Ae].minX,Be=ne[Ae].minY,Ke=ne[Ae].maxX,_t=ne[Ae].maxY;_e<Ee.minX&&(Ee.minX=_e),Be<Ee.minY&&(Ee.minY=Be),Ke>Ee.maxX&&(Ee.maxX=Ke),_t>Ee.maxY&&(Ee.maxY=_t)}return Ee}function ic(ne,R,V,ee){var se=R.geometry,fe=R.type,Ee=[];if(fe==="Point"||fe==="MultiPoint")for(var Ae=0;Ae<se.length;Ae+=3)Ee.push(se[Ae]),Ee.push(se[Ae+1]),ne.numPoints++,ne.numSimplified++;else if(fe==="LineString")yl(Ee,se,ne,V,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(Ae=0;Ae<se.length;Ae++)yl(Ee,se[Ae],ne,V,fe==="Polygon",Ae===0);else if(fe==="MultiPolygon")for(var _e=0;_e<se.length;_e++){var Be=se[_e];for(Ae=0;Ae<Be.length;Ae++)yl(Ee,Be[Ae],ne,V,!0,Ae===0)}if(Ee.length){var Ke=R.tags||null;if(fe==="LineString"&&ee.lineMetrics){for(var _t in Ke={},R.tags)Ke[_t]=R.tags[_t];Ke.mapbox_clip_start=se.start/se.size,Ke.mapbox_clip_end=se.end/se.size}var Je={geometry:Ee,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Ke};R.id!==null&&(Je.id=R.id),ne.features.push(Je)}}function yl(ne,R,V,ee,se,fe){var Ee=ee*ee;if(ee>0&&R.size<(se?Ee:ee))V.numPoints+=R.length/3;else{for(var Ae=[],_e=0;_e<R.length;_e+=3)(ee===0||R[_e+2]>Ee)&&(V.numSimplified++,Ae.push(R[_e]),Ae.push(R[_e+1])),V.numPoints++;se&&function(Be,Ke){for(var _t=0,Je=0,Ft=Be.length,Dt=Ft-2;Je<Ft;Dt=Je,Je+=2)_t+=(Be[Je]-Be[Dt])*(Be[Je+1]+Be[Dt+1]);if(_t>0===Ke)for(Je=0,Ft=Be.length;Je<Ft/2;Je+=2){var Mt=Be[Je],Gt=Be[Je+1];Be[Je]=Be[Ft-2-Je],Be[Je+1]=Be[Ft-1-Je],Be[Ft-2-Je]=Mt,Be[Ft-1-Je]=Gt}}(Ae,fe),ne.push(Ae)}}function vl(ne,R){var V=(R=this.options=function(se,fe){for(var Ee in fe)se[Ee]=fe[Ee];return se}(Object.create(this.options),R)).debug;if(V&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(se,fe){var Ee=[];if(se.type==="FeatureCollection")for(var Ae=0;Ae<se.features.length;Ae++)pl(Ee,se.features[Ae],fe,Ae);else pl(Ee,se.type==="Feature"?se:{geometry:se},fe);return Ee}(ne,R);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(se,fe){var Ee=fe.buffer/fe.extent,Ae=se,_e=sr(se,1,-1-Ee,Ee,0,-1,2,fe),Be=sr(se,1,1-Ee,2+Ee,0,-1,2,fe);return(_e||Be)&&(Ae=sr(se,1,-Ee,1+Ee,0,-1,2,fe)||[],_e&&(Ae=Ks(_e,1).concat(Ae)),Be&&(Ae=Ae.concat(Ks(Be,-1)))),Ae}(ee,R),ee.length&&this.splitTile(ee,0,0,0),V&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Er(ne,R,V){return 32*((1<<ne)*V+R)+ne}function Xs(ne,R){const V=ne.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const ee=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!ee)return R(null,null);const se=new Te(ee.features);let fe=ge.exports(se);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),R(null,{vectorTile:se,rawData:fe.buffer})}vl.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vl.prototype.splitTile=function(ne,R,V,ee,se,fe,Ee){for(var Ae=[ne,R,V,ee],_e=this.options,Be=_e.debug;Ae.length;){ee=Ae.pop(),V=Ae.pop(),R=Ae.pop(),ne=Ae.pop();var Ke=1<<R,_t=Er(R,V,ee),Je=this.tiles[_t];if(!Je&&(Be>1&&console.time("creation"),Je=this.tiles[_t]=La(ne,R,V,ee,_e),this.tileCoords.push({z:R,x:V,y:ee}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,V,ee,Je.numFeatures,Je.numPoints,Je.numSimplified),console.timeEnd("creation"));var Ft="z"+R;this.stats[Ft]=(this.stats[Ft]||0)+1,this.total++}if(Je.source=ne,se){if(R===_e.maxZoom||R===se)continue;var Dt=1<<se-R;if(V!==Math.floor(fe/Dt)||ee!==Math.floor(Ee/Dt))continue}else if(R===_e.indexMaxZoom||Je.numPoints<=_e.indexMaxPoints)continue;if(Je.source=null,ne.length!==0){Be>1&&console.time("clipping");var Mt,Gt,sn,An,Rt,Pn,Tn=.5*_e.buffer/_e.extent,Js=.5-Tn,xs=.5+Tn,Ue=1+Tn;Mt=Gt=sn=An=null,Rt=sr(ne,Ke,V-Tn,V+xs,0,Je.minX,Je.maxX,_e),Pn=sr(ne,Ke,V+Js,V+Ue,0,Je.minX,Je.maxX,_e),ne=null,Rt&&(Mt=sr(Rt,Ke,ee-Tn,ee+xs,1,Je.minY,Je.maxY,_e),Gt=sr(Rt,Ke,ee+Js,ee+Ue,1,Je.minY,Je.maxY,_e),Rt=null),Pn&&(sn=sr(Pn,Ke,ee-Tn,ee+xs,1,Je.minY,Je.maxY,_e),An=sr(Pn,Ke,ee+Js,ee+Ue,1,Je.minY,Je.maxY,_e),Pn=null),Be>1&&console.timeEnd("clipping"),Ae.push(Mt||[],R+1,2*V,2*ee),Ae.push(Gt||[],R+1,2*V,2*ee+1),Ae.push(sn||[],R+1,2*V+1,2*ee),Ae.push(An||[],R+1,2*V+1,2*ee+1)}}},vl.prototype.getTile=function(ne,R,V){var ee=this.options,se=ee.extent,fe=ee.debug;if(ne<0||ne>24)return null;var Ee=1<<ne,Ae=Er(ne,R=(R%Ee+Ee)%Ee,V);if(this.tiles[Ae])return gl(this.tiles[Ae],se);fe>1&&console.log("drilling down to z%d-%d-%d",ne,R,V);for(var _e,Be=ne,Ke=R,_t=V;!_e&&Be>0;)Be--,Ke=Math.floor(Ke/2),_t=Math.floor(_t/2),_e=this.tiles[Er(Be,Ke,_t)];return _e&&_e.source?(fe>1&&console.log("found parent tile z%d-%d-%d",Be,Ke,_t),fe>1&&console.time("drilling down"),this.splitTile(_e.source,Be,Ke,_t,ne,R,V),fe>1&&console.timeEnd("drilling down"),this.tiles[Ae]?gl(this.tiles[Ae],se):null):null};class du extends s.VectorTileWorkerSource{constructor(R,V,ee,se,fe){super(R,V,ee,se,Xs),fe&&(this.loadGeoJSON=fe)}loadData(R,V){const ee=R&&R.request,se=ee&&ee.collectResourceTiming;this.loadGeoJSON(R,(fe,Ee)=>{if(fe||!Ee)return V(fe);if(typeof Ee!="object")return V(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{Le(Ee,!0);try{if(R.filter){const _e=s.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));Ee={type:"FeatureCollection",features:Ee.features.filter(Ke=>_e.value.evaluate({zoom:0},Ke))}}this._geoJSONIndex=R.cluster?new ys(function({superclusterOptions:_e,clusterProperties:Be}){if(!Be||!_e)return _e;const Ke={},_t={},Je={accumulated:null,zoom:0},Ft={properties:null},Dt=Object.keys(Be);for(const Mt of Dt){const[Gt,sn]=Be[Mt],An=s.createExpression(sn),Rt=s.createExpression(typeof Gt=="string"?[Gt,["accumulated"],["get",Mt]]:Gt);Ke[Mt]=An.value,_t[Mt]=Rt.value}return _e.map=Mt=>{Ft.properties=Mt;const Gt={};for(const sn of Dt)Gt[sn]=Ke[sn].evaluate(Je,Ft);return Gt},_e.reduce=(Mt,Gt)=>{Ft.properties=Gt;for(const sn of Dt)Je.accumulated=Mt[sn],Mt[sn]=_t[sn].evaluate(Je,Ft)},_e}(R)).load(Ee.features):function(_e,Be){return new vl(_e,Be)}(Ee,R.geojsonVtOptions)}catch(_e){return V(_e)}this.loaded={};const Ae={};if(se){const _e=s.getPerformanceMeasurement(ee);_e&&(Ae.resourceTiming={},Ae.resourceTiming[R.source]=JSON.parse(JSON.stringify(_e)))}V(null,Ae)}})}reloadTile(R,V){const ee=this.loaded;return ee&&ee[R.uid]?super.reloadTile(R,V):this.loadTile(R,V)}loadGeoJSON(R,V){if(R.request)s.getJSON(R.request,V);else{if(typeof R.data!="string")return V(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(R.data))}catch{return V(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(R,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(ee){V(ee)}}getClusterChildren(R,V){try{V(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(ee){V(ee)}}getClusterLeaves(R,V){try{V(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(ee){V(ee)}}}class Fa{constructor(R){this.self=R,this.actor=new s.Actor(R,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:du},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,ee)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=ee},this.self.registerRTLTextPlugin=V=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=V.applyArabicShaping,s.plugin.processBidirectionalText=V.processBidirectionalText,s.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(R,V,ee){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R],ee()}checkIfReady(R,V,ee){ee()}setReferrer(R,V){this.referrer=V}spriteLoaded(R,V){this.isSpriteLoaded[R]=V;for(const ee in this.workerSources[R]){const se=this.workerSources[R][ee];for(const fe in se)se[fe]instanceof s.VectorTileWorkerSource&&(se[fe].isSpriteLoaded=V,se[fe].fire(new s.Event("isSpriteLoaded")))}}setImages(R,V,ee){this.availableImages[R]=V;for(const se in this.workerSources[R]){const fe=this.workerSources[R][se];for(const Ee in fe)fe[Ee].availableImages=V}ee()}enableTerrain(R,V,ee){this.terrain=V,ee()}setProjection(R,V){this.projections[R]=s.getProjection(V)}setLayers(R,V,ee){this.getLayerIndex(R).replace(V),ee()}updateLayers(R,V,ee){this.getLayerIndex(R).update(V.layers,V.removedIds),ee()}loadTile(R,V,ee){const se=this.enableTerrain?s.extend({enableTerrain:this.terrain},V):V;se.projection=this.projections[R]||this.defaultProjection,this.getWorkerSource(R,V.type,V.source).loadTile(se,ee)}loadDEMTile(R,V,ee){const se=this.enableTerrain?s.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(R,V.source).loadTile(se,ee)}reloadTile(R,V,ee){const se=this.enableTerrain?s.extend({enableTerrain:this.terrain},V):V;se.projection=this.projections[R]||this.defaultProjection,this.getWorkerSource(R,V.type,V.source).reloadTile(se,ee)}abortTile(R,V,ee){this.getWorkerSource(R,V.type,V.source).abortTile(V,ee)}removeTile(R,V,ee){this.getWorkerSource(R,V.type,V.source).removeTile(V,ee)}removeSource(R,V,ee){if(!this.workerSources[R]||!this.workerSources[R][V.type]||!this.workerSources[R][V.type][V.source])return;const se=this.workerSources[R][V.type][V.source];delete this.workerSources[R][V.type][V.source],se.removeSource!==void 0?se.removeSource(V,ee):ee()}loadWorkerSource(R,V,ee){try{this.self.importScripts(V.url),ee()}catch(se){ee(se.toString())}}syncRTLPluginState(R,V,ee){try{s.plugin.setState(V);const se=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&se!=null){this.self.importScripts(se);const fe=s.plugin.isParsed();ee(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),fe)}}catch(se){ee(se.toString())}}getAvailableImages(R){let V=this.availableImages[R];return V||(V=[]),V}getLayerIndex(R){let V=this.layerIndexes[R];return V||(V=this.layerIndexes[R]=new je),V}getWorkerSource(R,V,ee){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][V]||(this.workerSources[R][V]={}),!this.workerSources[R][V][ee]){const se={send:(fe,Ee,Ae,_e,Be,Ke)=>{this.actor.send(fe,Ee,Ae,R,Be,Ke)},scheduler:this.actor.scheduler};this.workerSources[R][V][ee]=new this.workerSourceTypes[V](se,this.getLayerIndex(R),this.getAvailableImages(R),this.isSpriteLoaded[R])}return this.workerSources[R][V][ee]}getDEMWorkerSource(R,V){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][V]||(this.demWorkerSources[R][V]=new Pe),this.demWorkerSources[R][V]}enforceCacheSizeLimit(R,V){s.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(R,V,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Fa(self)),Fa}),D(["./shared"],function(s){function q(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(!q(c[a],i[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const a in c)if(!q(c[a],i[a]))return!1;return!0}return c===i}var be=je;function je(c){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,g,v=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(v);try{g=new Worker(A),p=!0}catch{p=!1}return g&&g.terminate(),URL.revokeObjectURL(A),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var g=p.getContext("2d");if(!g)return!1;var v=g.getImageData(0,0,1,1);return v&&v.width===p.width}()?(Pe[a=i&&i.failIfMajorPerformanceCaveat]===void 0&&(Pe[a]=function(p){var g,v=function(A){var S=document.createElement("canvas"),I=Object.create(je.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=A,S.getContext("webgl",I)||S.getContext("experimental-webgl",I)}(p);if(!v)return!1;try{g=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!g||v.isContextLost())&&(v.shaderSource(g,"void main() {}"),v.compileShader(g),v.getShaderParameter(g,v.COMPILE_STATUS)===!0)}(a)),Pe[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(c)}var Pe={};function Le(c,i,a){const p=s.window.document.createElement(c);return i!==void 0&&(p.className=i),a&&a.appendChild(p),p}function ct(c,i,a){const p=s.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const g of Object.keys(i))p.setAttributeNS(null,g,i[g]);return a&&a.appendChild(p),p}je.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ht=s.window.document&&s.window.document.documentElement.style,yt=ht&&ht.userSelect!==void 0?"userSelect":"WebkitUserSelect";let hn;function Te(){ht&&yt&&(hn=ht[yt],ht[yt]="none")}function ge(){ht&&yt&&(ht[yt]=hn)}function Se(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",Se,!0)}function it(){s.window.addEventListener("click",Se,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Se,!0)},0)}function ke(c,i){const a=c.getBoundingClientRect();return Pt(c,a,i)}function ut(c,i){const a=c.getBoundingClientRect(),p=[];for(let g=0;g<i.length;g++)p.push(Pt(c,a,i[g]));return p}function bt(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function Pt(c,i,a){const p=c.offsetWidth===i.width?1:c.offsetWidth/i.width;return new s.pointGeometry((a.clientX-i.left)*p,(a.clientY-i.top)*p)}function zt(c,i){var a=i[0],p=i[1],g=i[2],v=i[3],A=a*v-g*p;return A?(c[0]=v*(A=1/A),c[1]=-p*A,c[2]=-g*A,c[3]=a*A,c):null}function qt(c){const{userImage:i}=c;return!!(i&&i.render&&i.render())&&(c.data.replace(new Uint8Array(i.data.buffer)),!0)}class rr extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:a,callback:p}of this.requestors)this._notify(a,p);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,a){this._validate(i,a)&&(this.images[i]=a)}_validate(i,a){let p=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,a){if(!i)return!0;let p=0;for(const g of i){if(g[0]<p||g[1]<g[0]||a<g[1])return!1;p=g[1]}return!0}_validateContent(i,a){return!(i&&(i.length!==4||i[0]<0||a.data.width<i[0]||i[1]<0||a.data.height<i[1]||i[2]<0||a.data.width<i[2]||i[3]<0||a.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,a){a.version=this.images[i].version+1,this.images[i]=a,this.updatedImages[i]=!0}removeImage(i){const a=this.images[i];delete this.images[i],delete this.patterns[i],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,a){let p=!0;if(!this.isLoaded())for(const g of i)this.images[g]||(p=!1);this.isLoaded()||p?this._notify(i,a):this.requestors.push({ids:i,callback:a})}_notify(i,a){const p={};for(const g of i){this.images[g]||this.fire(new s.Event("styleimagemissing",{id:g}));const v=this.images[g];v?p[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:s.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,p)}getPixelSize(){const{width:i,height:a}=this.atlasImage;return{width:i,height:a}}getPattern(i){const a=this.patterns[i],p=this.getImage(i);if(!p)return null;if(a&&a.position.version===p.version)return a.position;if(a)a.position.version=p.version;else{const g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new s.ImagePosition(g,p);this.patterns[i]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const a=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(i,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const v in this.patterns)i.push(this.patterns[v].bin);const{w:a,h:p}=s.potpack(i),g=this.atlasImage;g.resize({width:a||1,height:p||1});for(const v in this.patterns){const{bin:A}=this.patterns[v],S=A.x+1,I=A.y+1,k=this.images[v].data,P=k.width,U=k.height;s.RGBAImage.copy(k,g,{x:0,y:0},{x:S,y:I},{width:P,height:U}),s.RGBAImage.copy(k,g,{x:0,y:U-1},{x:S,y:I-1},{width:P,height:1}),s.RGBAImage.copy(k,g,{x:0,y:0},{x:S,y:I+U},{width:P,height:1}),s.RGBAImage.copy(k,g,{x:P-1,y:0},{x:S-1,y:I},{width:1,height:U}),s.RGBAImage.copy(k,g,{x:0,y:0},{x:S+P,y:I},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const a of i){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const p=this.images[a];qt(p)&&this.updateImage(a,p)}}}const Oo=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(c,i){return function([a,p,g]){const v=s.degToRad(p+90),A=s.degToRad(g);return{x:a*Math.cos(v)*Math.sin(A),y:a*Math.sin(v)*Math.sin(A),z:a*Math.cos(A),azimuthal:p,polar:g}}(c.expression.evaluate(i))}interpolate(c,i,a){return{x:s.number(c.x,i.x,a),y:s.number(c.y,i.y,a),z:s.number(c.z,i.z,a),azimuthal:s.number(c.azimuthal,i.azimuthal,a),polar:s.number(c.polar,i.polar,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),go="-transition";class _s extends s.Evented{constructor(i){super(),this._transitionable=new s.Transitionable(Oo),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a={}){if(!this._validate(s.validateLight,i,a))for(const p in i){const g=i[p];s.endsWith(p,go)?this._transitionable.setTransition(p.slice(0,-go.length),g):this._transitionable.setValue(p,g)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,p){return(!p||p.validate!==!1)&&s.emitValidationErrors(this,i.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const cn=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),gs="-transition";class Ni extends s.Evented{constructor(i,a){super(),this._transitionable=new s.Transitionable(cn),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(i){for(const a in i){const p=i[a];s.endsWith(a,gs)?this._transitionable.setTransition(a.slice(0,-gs.length),p):this._transitionable.setValue(a,p)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function wt(c,i,a,p){const g=s.smoothstep(45,65,a),[v,A]=Jt(c,p),S=s.length(i);let I=1-Math.min(1,Math.exp((S-v)/(A-v)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*g*c.alpha}function Jt(c,i){const a=.5/Math.tan(.5*i);return[c.range[0]+a,c.range[1]+a]}const Bt=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),gn="-transition";class oi extends s.Evented{constructor(i,a){super(),this._transitionable=new s.Transitionable(Bt),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const i=this._transform,a=i.projection.name==="globe",p=s.globeToMercatorTransition(i.zoom),g=this.properties.get("range"),v=[.5,3];return{range:a?[s.number(v[0],g[0],p),s.number(v[1],g[1],p)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,a={}){if(!this._validate(s.validateFog,i,a)){for(const p of Object.keys(s.spec.fog))i&&i[p]===void 0&&(i[p]=s.spec.fog[p].default);for(const p in i){const g=i[p];s.endsWith(p,gn)?this._transitionable.setTransition(p.slice(0,-gn.length),g):this._transitionable.setValue(p,g)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,i))*a.a}getOpacityAtLatLng(i,a){return this._transform.projection.supportsFog?function(p,g,v){const A=s.MercatorCoordinate.fromLngLat(g),S=v.elevation?v.elevation.getAtPointOrZero(A):0,I=[A.x,A.y,S];return s.transformMat4(I,I,v.mercatorFogMatrix),wt(p,I,v.pitch,v._fov)}(this.state,i,a):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Jt(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,p){return(!p||p.validate!==!1)&&s.emitValidationErrors(this,i.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class br{constructor(i,a){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const p=this.workerPool.acquire(this.id);for(let g=0;g<p.length;g++){const v=new br.Actor(p[g],a,this.id);v.name=`Worker ${g}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,p){s.asyncAll(this.actors,(g,v)=>{g.send(i,a,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Fi(c,i,a){return i*(s.EXTENT/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}br.Actor=s.Actor;class Ki{constructor(i,a,p,g){this.screenBounds=i,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(i,a){let p,g;if(i instanceof s.pointGeometry||typeof i[0]=="number"){const v=s.pointGeometry.convert(i);p=[v],g=a.isPointAboveHorizon(v)}else{const v=s.pointGeometry.convert(i[0]),A=s.pointGeometry.convert(i[1]);p=[v,A],g=s.polygonizeBounds(v,A).every(S=>a.isPointAboveHorizon(S))}return new Ki(p,a.getCameraPoint(),g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],g=s.polygonizeBounds(a,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<p.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),s.bufferConvexPolygon(g,i)}bufferedCameraGeometryGlobe(i){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],g=s.polygonizeBounds(a,p,i),v=this.cameraPoint.clone();switch(3*((v.y>a.y)+(v.y>p.y))+((v.x>a.x)+(v.x>p.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(i,a,p,g=0){const v=i.queryPadding/a._pixelsPerMercatorPixel+1,A=p?this._bufferedCameraMercator(v,a):this._bufferedScreenMercator(v,a);let S=i.tileID.wrap+(A.unwrapped?g:0);const I=A.polygon.map(Z=>s.getTilePoint(i.tileTransform,Z,S));if(!s.polygonIntersectsBox(I,0,0,s.EXTENT,s.EXTENT))return;S=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const k=this.screenGeometryMercator.polygon.map(Z=>s.getTileVec3(i.tileTransform,Z,S)),P=k.map(Z=>new s.pointGeometry(Z[0],Z[1])),U=a.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),j=s.getTileVec3(i.tileTransform,U,S),J=k.map(Z=>{const $=s.sub(Z,Z,j);return s.normalize($,$),new s.Ray(j,$)}),K=Fi(i,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:J,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(Q=s.getBounds(I),Q.min.x=s.clamp(Q.min.x,0,s.EXTENT),Q.min.y=s.clamp(Q.min.y,0,s.EXTENT),Q.max.x=s.clamp(Q.max.x,0,s.EXTENT),Q.max.y=s.clamp(Q.max.y,0,s.EXTENT),Q),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:K};var Q}_bufferedScreenMercator(i,a){const p=Hr(i);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),a):{polygon:this.bufferedScreenGeometry(i).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=g,g}}_bufferedCameraMercator(i,a){const p=Hr(i);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),a):{polygon:this.bufferedCameraGeometry(i).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=g,g}}_projectAndResample(i,a){const p=function(v,A){const S=s.multiply([],A.pixelMatrix,A.globeMatrix),I=[0,-s.GLOBE_RADIUS,0,1],k=[0,s.GLOBE_RADIUS,0,1],P=[0,0,0,1];s.transformMat4$1(I,I,S),s.transformMat4$1(k,k,S),s.transformMat4$1(P,P,S);const U=new s.pointGeometry(I[0]/I[3],I[1]/I[3]),j=new s.pointGeometry(k[0]/k[3],k[1]/k[3]),J=s.polygonContainsPoint(v,U)&&I[3]<P[3],K=s.polygonContainsPoint(v,j)&&k[3]<P[3];if(!J&&!K)return null;const Q=function(pe,we,Re){for(let De=1;De<pe.length;De++){const Ye=Gi(we.pointCoordinate3D(pe[De-1]).x),xe=Gi(we.pointCoordinate3D(pe[De]).x);if(Re<0){if(Ye<xe)return{idx:De,t:-Ye/(xe-1-Ye)}}else if(xe<Ye)return{idx:De,t:(1-Ye)/(xe+1-Ye)}}return null}(v,A,J?-1:1);if(!Q)return null;const{idx:Z,t:$}=Q;let te=Z>1?Ri(v.slice(0,Z),A):[],X=Z<v.length?Ri(v.slice(Z),A):[];te=te.map(pe=>new s.pointGeometry(Gi(pe.x),pe.y)),X=X.map(pe=>new s.pointGeometry(Gi(pe.x),pe.y));const le=[...te];le.length===0&&le.push(X[X.length-1]);const ue=s.number(le[le.length-1].y,(X.length===0?te[0]:X[0]).y,$);let oe;return oe=J?[new s.pointGeometry(0,ue),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,ue)]:[new s.pointGeometry(1,ue),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,ue)],le.push(...oe),X.length===0?le.push(te[0]):le.push(...X),{polygon:le.map(pe=>new s.MercatorCoordinate(pe.x,pe.y)),unwrapped:!1}}(i,a);if(p)return p;const g=function(v,A){let S=!1,I=-1/0,k=0;for(let U=0;U<v.length-1;U++)v[U].x>I&&(I=v[U].x,k=U);for(let U=0;U<v.length-1;U++){const j=(k+U)%(v.length-1),J=v[j],K=v[j+1];Math.abs(J.x-K.x)>.5&&(J.x<K.x?(J.x+=1,j===0&&(v[v.length-1].x+=1)):(K.x+=1,j+1===v.length-1&&(v[0].x+=1)),S=!0)}const P=s.mercatorXfromLng(A.center.lng);return S&&P<Math.abs(P-1)&&v.forEach(U=>{U.x-=1}),{polygon:v,unwrapped:S}}(Ri(i,a).map(v=>new s.pointGeometry(Gi(v.x),v.y)),a);return{polygon:g.polygon.map(v=>new s.MercatorCoordinate(v.x,v.y)),unwrapped:g.unwrapped}}}function Ri(c,i){return s.resample(c,a=>{const p=i.pointCoordinate3D(a);a.x=p.x,a.y=p.y},1/256)}function Gi(c){return c<0?1+c%1:c%1}function Hr(c){return 100*c|0}function ys(c,i,a,p,g){const v=function(A,S){if(A)return g(A);if(S){c.url&&S.tiles&&c.tiles&&delete c.tiles;const I=s.pick(s.extend(S,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(I.vectorLayers=S.vector_layers,I.vectorLayerIds=I.vectorLayers.map(k=>k.id)),I.tiles=i.canonicalizeTileset(I,c.url),g(null,I)}};return c.url?s.getJSON(i.transformRequest(i.normalizeSourceURL(c.url,null,a,p),s.ResourceType.Source),v):s.exported.frame(()=>v(null,c))}class Pr{constructor(i,a,p){this.bounds=s.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const a=Math.pow(2,i.z),p=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),g=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),v=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),A=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return i.x>=p&&i.x<v&&i.y>=g&&i.y<A}}class Da{constructor(i,a,p){this.context=i;const g=i.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $r{constructor(i,a,p,g){this.length=a.length,this.attributes=p,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.context=i;const v=i.gl;this.buffer=v.createBuffer(),i.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let p=0;p<this.attributes.length;p++){const g=a.attributes[this.attributes[p].name];g!==void 0&&i.enableVertexAttribArray(g)}}setVertexAttribPointers(i,a,p){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],A=a.attributes[v.name];A!==void 0&&i.vertexAttribPointer(A,v.components,i[Xn[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class or extends Qt{getDefault(){return s.Color.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class cu extends Qt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Vi extends Qt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class ka extends Qt{getDefault(){return[!0,!0,!0,!0]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class hu extends Qt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Zr extends Qt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Ar extends Qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Ii extends Qt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class yo extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class pl extends Qt{getDefault(){return[0,1]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class vs extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class fl extends Qt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Wr extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class Uo extends Qt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class $s extends Qt{getDefault(){return s.Color.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class sr extends Qt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class za extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class Zs extends Qt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class No extends Qt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Go extends Qt{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Pa extends Qt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class ml extends Qt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ws extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ks extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class _l extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class gl extends Qt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Kr extends Qt{getDefault(){return null}set(i){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class La extends Qt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class ic extends Qt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class yl extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class vl extends Qt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Er extends Qt{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class Xs extends Er{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class du extends Er{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Fa extends du{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ne{constructor(i,a,p,g){this.context=i,this.width=a,this.height=p;const v=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Xs(i,v),g&&(this.depthAttachment=new du(i,v))}destroy(){const i=this.context.gl,a=this.colorAttachment.get();if(a&&i.deleteTexture(a),this.depthAttachment){const p=this.depthAttachment.get();p&&i.deleteRenderbuffer(p)}i.deleteFramebuffer(this.framebuffer)}}class R{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new or(this),this.clearDepth=new cu(this),this.clearStencil=new Vi(this),this.colorMask=new ka(this),this.depthMask=new hu(this),this.stencilMask=new Zr(this),this.stencilFunc=new Ar(this),this.stencilOp=new Ii(this),this.stencilTest=new yo(this),this.depthRange=new pl(this),this.depthTest=new vs(this),this.depthFunc=new fl(this),this.blend=new Wr(this),this.blendFunc=new Uo(this),this.blendColor=new $s(this),this.blendEquation=new sr(this),this.cullFace=new za(this),this.cullFaceSide=new Zs(this),this.frontFace=new No(this),this.program=new Go(this),this.activeTexture=new Pa(this),this.viewport=new ml(this),this.bindFramebuffer=new Ws(this),this.bindRenderbuffer=new Ks(this),this.bindTexture=new _l(this),this.bindVertexBuffer=new gl(this),this.bindElementBuffer=new Kr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new La(this),this.pixelStoreUnpack=new ic(this),this.pixelStoreUnpackPremultiplyAlpha=new yl(this),this.pixelStoreUnpackFlipY=new vl(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a){return new Da(this,i,a)}createVertexBuffer(i,a,p){return new $r(this,i,a,p)}createRenderbuffer(i,a,p){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,i,a,p),this.bindRenderbuffer.set(null),v}createFramebuffer(i,a,p){return new ne(this,i,a,p)}clear({color:i,depth:a,stencil:p}){const g=this.gl;let v=0;i&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),p!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),g.clear(v)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){q(i.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class V extends s.Evented{constructor(i,a,p,g){super(),this.id=i,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ys(this._options,this.map._requestManager,null,null,(i,a)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new s.ErrorEvent(i)):a&&(s.extend(this,a),a.bounds&&(this.tileBounds=new Pr(a.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(a.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,a){const p=s.exported.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);i.request=s.getImage(this.map._requestManager.transformRequest(g,s.ResourceType.Tile),(v,A,S,I)=>(delete i.request,i.aborted?(i.state="unloaded",a(null)):v?(i.state="errored",a(v)):A?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:I}),i.setTexture(A,this.map.painter),i.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(i,a,p){i.setTexture(a,p)}static unloadTileData(i,a){i.texture&&a.saveTileTexture(i.texture)}abortTile(i,a){i.request&&(i.request.cancel(),delete i.request),a()}unloadTile(i,a){i.texture&&this.map.painter.saveTileTexture(i.texture),a()}hasTransition(){return!1}}let ee;function se(c,i,a,p,g,v,A,S){const I=[c,a,g,i,p,v,1,1,1],k=[A,S,1],P=s.adjoint([],I),[U,j,J]=s.transformMat3(k,k,s.transpose(P,P));return s.multiply$1(I,[U,0,0,0,j,0,0,0,J],I)}class fe extends s.Evented{constructor(i,a,p,g){super(),this.id=i,this.dispatcher=p,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=a,this._dirty=!1}load(i,a){this._loaded=a||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(p,g)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new s.ErrorEvent(p));else if(g){const{HTMLImageElement:v}=s.window;this.image=g instanceof v?s.exported.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const a=i.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let g=1/0,v=1/0,A=-1/0,S=-1/0;for(const U of p)g=Math.min(g,U.x),v=Math.min(v,U.y),A=Math.max(A,U.x),S=Math.max(S,U.y);const I=Math.max(A-g,S-v),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),P=Math.pow(2,k);return new s.CanonicalTileID(k,Math.floor((g+A)/2*P),Math.floor((v+S)/2*P))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const I in this.tiles){const k=this.tiles[I];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const a=s.tileTransform(this.tileID,this.map.transform.projection),[p,g,v,A]=this.coordinates.map(I=>{const k=a.projection.project(I[0],I[1]);return s.getTilePoint(a,k)._round()});this.perspectiveTransform=function(I,k,P,U,j,J,K,Q,Z,$){const te=se(0,0,I,0,0,k,I,k),X=se(P,U,j,J,K,Q,Z,$);return s.multiply$1(X,s.adjoint(te,te),X),[X[6]/X[8]*I/s.EXTENT,X[7]/X[8]*k/s.EXTENT]}(this.width,this.height,p.x,p.y,g.x,g.y,A.x,A.y,v.x,v.y);const S=this._boundsArray=new s.StructArrayLayout4i8;S.emplaceBack(p.x,p.y,0,0),S.emplaceBack(g.x,g.y,s.EXTENT,0),S.emplaceBack(A.x,A.y,0,s.EXTENT),S.emplaceBack(v.x,v.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(S,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,a=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(i,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ee={vector:class extends s.Evented{constructor(c,i,a,p){if(super(),this.id=c,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(i,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(c){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=ys(this._options,this.map._requestManager,i,a,(p,g)=>{this._tileJSONRequest=null,this._loaded=!0,p?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.ErrorEvent(p))):g&&(s.extend(this,g),g.bounds&&(this.tileBounds=new Pr(g.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(g.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(p)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const c=this.map.style._getSourceCaches(this.id);for(const i of c)i.clearTiles()})}setSourceProperty(c){c(),this.reload()}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(c,i){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(a,s.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=i:c.request=c.actor.send("reloadTile",p,g.bind(this));else if(c.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",p,g.bind(this),void 0,!0);else{const v=s.loadVectorTile.call({deduped:this._deduped},p,(A,S)=>{A||!S?g.call(this,A):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},c.actor&&c.actor.send("loadTile",p,g.bind(this),void 0,!0))},!0);c.request={cancel:v}}function g(v,A){return delete c.request,c.aborted?i(null):v&&v.status!==404?i(v):(A&&A.resourceTiming&&(c.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&c.setExpiryData(A),c.loadVectorData(A,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:V,"raster-dem":class extends V{constructor(c,i,a,p){super(c,i,a,p),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(c,i){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(g,v){g&&(c.state="errored",i(g)),v&&(c.dem=v,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",i(null))}c.request=s.getImage(this.map._requestManager.transformRequest(a,s.ResourceType.Tile),function(g,v,A,S){if(delete c.request,c.aborted)c.state="unloaded",i(null);else if(g)c.state="errored",i(g);else if(v){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:A,expires:S});const I=s.window.ImageBitmap&&v instanceof s.window.ImageBitmap&&(ee==null&&(ee=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),ee),k=1-(v.width-s.prevPowerOfTwo(v.width))/2;k<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const P=I?v:s.exported.getImageData(v,k),U={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:P,encoding:this.encoding,padding:k};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",U,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const i=c.canonical,a=Math.pow(2,i.z),p=(i.x-1+a)%a,g=i.x===0?c.wrap-1:c.wrap,v=(i.x+1+a)%a,A=i.x+1===a?c.wrap+1:c.wrap,S={};return S[new s.OverscaledTileID(c.overscaledZ,g,i.z,p,i.y).key]={backfilled:!1},S[new s.OverscaledTileID(c.overscaledZ,A,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(S[new s.OverscaledTileID(c.overscaledZ,g,i.z,p,i.y-1).key]={backfilled:!1},S[new s.OverscaledTileID(c.overscaledZ,c.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new s.OverscaledTileID(c.overscaledZ,A,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<a&&(S[new s.OverscaledTileID(c.overscaledZ,g,i.z,p,i.y+1).key]={backfilled:!1},S[new s.OverscaledTileID(c.overscaledZ,c.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new s.OverscaledTileID(c.overscaledZ,A,i.z,v,i.y+1).key]={backfilled:!1}),S}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends s.Evented{constructor(c,i,a,p){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(p),this._data=i.data,this._options=s.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const g=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*g,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*g,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:s.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*g,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},i),this}getClusterChildren(c,i){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},i),this}getClusterLeaves(c,i,a,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:i,offset:a},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=s.extend({},this.workerOptions),i=this._data;typeof i=="string"?(c.request=this.map._requestManager.transformRequest(s.exported.resolveURL(i),s.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(a,p)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new s.ErrorEvent(a));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g.resourceTiming=p.resourceTiming[this.id]),this.fire(new s.Event("data",g)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,i){const a=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(a,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,g)=>(delete c.request,c.unloadVectorData(),c.aborted?i(null):p?i(p):(c.loadVectorData(g,this.map.painter,a==="reloadTile"),i(null))),void 0,a==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends fe{constructor(c,i,a,p){super(c,i,a,p),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const i of c.urls)this.urls.push(this.map._requestManager.transformRequest(i,s.ResourceType.Source).url);s.getVideo(this.urls,(i,a)=>{this._loaded=!0,i?this.fire(new s.ErrorEvent(i)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const i=this.video.seekable;c<i.start(0)||c>i.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,i=c.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(c,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:fe,canvas:class extends fe{constructor(c,i,a,p){super(c,i,a,p),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends s.Evented{constructor(c,i,a,p){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=i,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Pr(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:i,y:a,z:p}=c.canonical;return this._implementation.hasTile({x:i,y:a,z:p})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,i){const{x:a,y:p,z:g}=c.tileID.canonical,v=new s.window.AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:a,y:p,z:g},{signal:v.signal})).then(function(A){return delete c.request,c.aborted?(c.state="unloaded",i(null)):A===void 0?(c.state="errored",i(null)):A===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",i(null)):function(S){return S instanceof s.window.ImageData||S instanceof s.window.HTMLCanvasElement||S instanceof s.window.ImageBitmap||S instanceof s.window.HTMLImageElement}(A)?(this.loadTileData(c,A),c.state="loaded",void i(null)):(c.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(A=>{A.code!==20&&(c.state="errored",i(A))}),c.request.cancel=()=>v.abort()}loadTileData(c,i){V.loadTileData(c,i,this._map.painter)}unloadTileData(c){V.unloadTileData(c,this._map.painter)}unloadTile(c,i){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:a,y:p,z:g}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:p,z:g})}i()}abortTile(c,i){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ae=function(c,i,a,p){const g=new Ee[i.type](c,i,a,p);if(g.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${g.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],g),g};function _e(c,i){const a=s.identity([]);return s.scale(a,a,[.5*c.width,.5*-c.height,1]),s.translate(a,a,[1,-1,0]),s.multiply(a,a,c.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(a)}function Be(c,i,a,p,g,v,A,S=!1){const I=c.tilesIn(p,A,S);I.sort(_t);const k=[];for(const U of I)k.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(i,a,c._state,U,g,v,_e(c.transform,U.tile.tileID),S)});const P=function(U){const j={},J={};for(const K of U){const Q=K.queryResults,Z=K.wrappedTileID,$=J[Z]=J[Z]||{};for(const te in Q){const X=Q[te],le=$[te]=$[te]||{},ue=j[te]=j[te]||[];for(const oe of X)le[oe.featureIndex]||(le[oe.featureIndex]=!0,ue.push(oe))}}return j}(k);for(const U in P)P[U].forEach(j=>{const J=j.feature,K=J.layer;K&&K.type!=="background"&&K.type!=="sky"&&(J.source=K.source,K["source-layer"]&&(J.sourceLayer=K["source-layer"]),J.state=J.id!==void 0?c.getFeatureState(K["source-layer"],J.id):{})});return P}function Ke(c,i){const a=c.getRenderableIds().map(v=>c.getTileByID(v)),p=[],g={};for(let v=0;v<a.length;v++){const A=a[v],S=A.tileID.canonical.key;g[S]||(g[S]=!0,A.querySourceFeatures(p,i))}return p}function _t(c,i){const a=c.tileID,p=i.tileID;return a.overscaledZ-p.overscaledZ||a.canonical.y-p.canonical.y||a.wrap-p.wrap||a.canonical.x-p.canonical.x}function Je(){return Fu.workerClass!=null?new Fu.workerClass:new s.window.Worker(Fu.workerUrl)}const Ft="mapboxgl_preloaded_worker_pool";class Dt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Je);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ft]}numActive(){return Object.keys(this.active).length}}let Mt;function Gt(){return Mt||(Mt=new Dt),Mt}function sn(c,i){const a={};for(const p in c)p!=="ref"&&(a[p]=c[p]);return s.refProperties.forEach(p=>{p in i&&(a[p]=i[p])}),a}function An(c){c=c.slice();const i=Object.create(null);for(let a=0;a<c.length;a++)i[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=sn(c[a],i[c[a].ref]));return c}Dt.workerCount=2;const Rt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Pn(c,i,a){a.push({command:Rt.addSource,args:[c,i[c]]})}function Tn(c,i,a){i.push({command:Rt.removeSource,args:[c]}),a[c]=!0}function Js(c,i,a,p){Tn(c,a,p),Pn(c,i,a)}function xs(c,i,a){let p;for(p in c[a])if(c[a].hasOwnProperty(p)&&p!=="data"&&!q(c[a][p],i[a][p]))return!1;for(p in i[a])if(i[a].hasOwnProperty(p)&&p!=="data"&&!q(c[a][p],i[a][p]))return!1;return!0}function Ue(c,i,a,p,g,v){let A;for(A in i=i||{},c=c||{})c.hasOwnProperty(A)&&(q(c[A],i[A])||a.push({command:v,args:[p,A,i[A],g]}));for(A in i)i.hasOwnProperty(A)&&!c.hasOwnProperty(A)&&(q(c[A],i[A])||a.push({command:v,args:[p,A,i[A],g]}))}function Vo(c){return c.id}function ui(c,i){return c[i.id]=i,c}class ws{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=s.clamp(i,0,1);let a=1,p=this._distances[a];const g=i*this.paddedLength+this.padding;for(;p<g&&a<this._distances.length;)p=this._distances[++a];const v=a-1,A=this._distances[v],S=p-A,I=S>0?(g-A)/S:0;return this.points[v].mult(1-I).add(this.points[a].mult(I))}}class Kd{constructor(i,a,p){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(a/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,p,g,v){this._forEachCell(a,p,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(i,a,p,g){this._forEachCell(a-g,p-g,a+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(p),this.circles.push(g)}_insertBoxCell(i,a,p,g,v,A){this.boxCells[v].push(A)}_insertCircleCell(i,a,p,g,v,A){this.circleCells[v].push(A)}_query(i,a,p,g,v,A){if(p<0||i>this.width||g<0||a>this.height)return!v&&[];const S=[];if(i<=0&&a<=0&&this.width<=p&&this.height<=g){if(v)return!0;for(let I=0;I<this.boxKeys.length;I++)S.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const k=this.circles[3*I],P=this.circles[3*I+1],U=this.circles[3*I+2];S.push({key:this.circleKeys[I],x1:k-U,y1:P-U,x2:k+U,y2:P+U})}return A?S.filter(A):S}return this._forEachCell(i,a,p,g,this._queryCell,S,{hitTest:v,seenUids:{box:{},circle:{}}},A),v?S.length>0:S}_queryCircle(i,a,p,g,v){const A=i-p,S=i+p,I=a-p,k=a+p;if(S<0||A>this.width||k<0||I>this.height)return!g&&[];const P=[];return this._forEachCell(A,I,S,k,this._queryCellCircle,P,{hitTest:g,circle:{x:i,y:a,radius:p},seenUids:{box:{},circle:{}}},v),g?P.length>0:P}query(i,a,p,g,v){return this._query(i,a,p,g,!1,v)}hitTest(i,a,p,g,v){return this._query(i,a,p,g,!0,v)}hitTestCircle(i,a,p,g){return this._queryCircle(i,a,p,!0,g)}_queryCell(i,a,p,g,v,A,S,I){const k=S.seenUids,P=this.boxCells[v];if(P!==null){const j=this.bboxes;for(const J of P)if(!k.box[J]){k.box[J]=!0;const K=4*J;if(i<=j[K+2]&&a<=j[K+3]&&p>=j[K+0]&&g>=j[K+1]&&(!I||I(this.boxKeys[J]))){if(S.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[J],x1:j[K],y1:j[K+1],x2:j[K+2],y2:j[K+3]})}}}const U=this.circleCells[v];if(U!==null){const j=this.circles;for(const J of U)if(!k.circle[J]){k.circle[J]=!0;const K=3*J;if(this._circleAndRectCollide(j[K],j[K+1],j[K+2],i,a,p,g)&&(!I||I(this.circleKeys[J]))){if(S.hitTest)return A.push(!0),!0;{const Q=j[K],Z=j[K+1],$=j[K+2];A.push({key:this.circleKeys[J],x1:Q-$,y1:Z-$,x2:Q+$,y2:Z+$})}}}}}_queryCellCircle(i,a,p,g,v,A,S,I){const k=S.circle,P=S.seenUids,U=this.boxCells[v];if(U!==null){const J=this.bboxes;for(const K of U)if(!P.box[K]){P.box[K]=!0;const Q=4*K;if(this._circleAndRectCollide(k.x,k.y,k.radius,J[Q+0],J[Q+1],J[Q+2],J[Q+3])&&(!I||I(this.boxKeys[K])))return A.push(!0),!0}}const j=this.circleCells[v];if(j!==null){const J=this.circles;for(const K of j)if(!P.circle[K]){P.circle[K]=!0;const Q=3*K;if(this._circlesCollide(J[Q],J[Q+1],J[Q+2],k.x,k.y,k.radius)&&(!I||I(this.circleKeys[K])))return A.push(!0),!0}}}_forEachCell(i,a,p,g,v,A,S,I){const k=this._convertToXCellCoord(i),P=this._convertToYCellCoord(a),U=this._convertToXCellCoord(p),j=this._convertToYCellCoord(g);for(let J=k;J<=U;J++)for(let K=P;K<=j;K++)if(v.call(this,i,a,p,g,this.xCellCount*K+J,A,S,I))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,p,g,v,A){const S=g-i,I=v-a,k=p+A;return k*k>S*S+I*I}_circleAndRectCollide(i,a,p,g,v,A,S){const I=(A-g)/2,k=Math.abs(i-(g+I));if(k>I+p)return!1;const P=(S-v)/2,U=Math.abs(a-(v+P));if(U>P+p)return!1;if(k<=I||U<=P)return!0;const j=k-I,J=U-P;return j*j+J*J<=p*p}}const jo=Math.tan(85*Math.PI/180);function xl(c,i,a,p,g,v,A){const S=s.create();if(a)if(v.name==="globe"){const I=s.calculateGlobeLabelMatrix(g,i);s.multiply(S,S,I)}else{const I=zt([],A);S[0]=I[0],S[1]=I[1],S[4]=I[2],S[5]=I[3],p||s.rotateZ(S,S,g.angle)}else s.multiply(S,g.labelPlaneMatrix,c);return S}function Xd(c,i,a,p,g,v,A){const S=xl(c,i,a,p,g,v,A);return v.name==="globe"&&a||(S[2]=S[6]=S[10]=S[14]=0),S}function Ra(c,i,a,p,g,v,A){if(a){if(v.name==="globe"){const S=xl(c,i,a,p,g,v,A);return s.invert(S,S),s.multiply(S,c,S),S}{const S=s.clone(c),I=s.identity([]);return I[0]=A[0],I[1]=A[1],I[4]=A[2],I[5]=A[3],s.multiply(S,S,I),p||s.rotateZ(S,S,-g.angle),S}}return g.glCoordMatrix}function pt(c,i,a=0){const p=[c.x,c.y,a,1];a?s.transformMat4$1(p,p,i):Al(p,p,i);const g=p[3];return{point:[p[0]/g,p[1]/g,p[2]/g],signedDistanceFromCamera:g}}function nn(c,i){const a=[c[0],c[1],c[2],1];s.transformMat4$1(a,a,i);const p=a[3];return{point:[a[0]/p,a[1]/p,a[2]/p],signedDistanceFromCamera:p}}function an(c,i){return Math.min(.5+c/i*.5,1.5)}function qo(c,i){const a=c[0]/c[3],p=c[1]/c[3];return a>=-i[0]&&a<=i[0]&&p>=-i[1]&&p<=i[1]}function Oa(c,i,a,p,g,v,A,S,I,k){const P=a.transform,U=p?c.textSizeData:c.iconSizeData,j=s.evaluateSizeForZoom(U,a.transform.zoom),J=P.projection.name==="globe",K=[256/a.width*2+1,256/a.height*2+1],Q=p?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Q.clear();let Z=null;J&&(Z=p?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const $=c.lineVertexArray,te=p?c.text.placedSymbolArray:c.icon.placedSymbolArray,X=a.transform.width/a.transform.height;let le=!1;for(let ue=0;ue<te.length;ue++){const oe=te.get(ue);if(oe.writingMode!==s.WritingMode.vertical||le||ue!==0&&te.get(ue-1).writingMode===s.WritingMode.horizontal||(le=!0),(oe.hidden||oe.writingMode===s.WritingMode.vertical)&&!le){Xr(oe.numGlyphs,Q);continue}le=!1;const pe=new s.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),we=I?I(pe):[0,0,0],Re=P.projection.projectTilePoint(pe.x,pe.y,k.canonical),De=[Re.x+we[0],Re.y+we[1],Re.z+we[2]],Ye=[...De,1];if(s.transformMat4$1(Ye,Ye,i),!qo(Ye,K)){Xr(oe.numGlyphs,Q);continue}const xe=an(a.transform.cameraToCenterDistance,Ye[3]),qe=s.evaluateSizeForFeature(U,j,oe),He=A?qe/xe:qe*xe,Ie=pt(new s.pointGeometry(De[0],De[1]),g,De[2]);if(Ie.signedDistanceFromCamera<=0){Xr(oe.numGlyphs,Q);continue}let ye={};const dt=A?null:I,ot=bl(oe,He,!1,S,i,g,v,c.glyphOffsetArray,$,Q,Z,Ie.point,pe,ye,X,dt,P.projection,k,A);le=ot.useVertical,dt&&ot.needsFlipping&&(ye={}),(ot.notEnoughRoom||le||ot.needsFlipping&&bl(oe,He,!0,S,i,g,v,c.glyphOffsetArray,$,Q,Z,Ie.point,pe,ye,X,dt,P.projection,k,A).notEnoughRoom)&&Xr(oe.numGlyphs,Q)}p?(c.text.dynamicLayoutVertexBuffer.updateData(Q),Z&&c.text.globeExtVertexBuffer.updateData(Z)):(c.icon.dynamicLayoutVertexBuffer.updateData(Q),Z&&c.icon.globeExtVertexBuffer.updateData(Z))}function rn(c,i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q){const Z=S.glyphStartIndex+S.numGlyphs,$=S.lineStartIndex,te=S.lineStartIndex+S.lineLength,X=i.getoffsetX(S.glyphStartIndex),le=i.getoffsetX(Z-1),ue=Nn(c*X,a,p,g,v,A,S.segment,$,te,I,k,P,U,j,!0,J,K,Q);if(!ue)return null;const oe=Nn(c*le,a,p,g,v,A,S.segment,$,te,I,k,P,U,j,!0,J,K,Q);return oe?{first:ue,last:oe}:null}function wl(c,i,a,p){return c.writingMode===s.WritingMode.horizontal&&Math.abs(a.y-i.y)>Math.abs(a.x-i.x)*p?{useVertical:!0}:c.writingMode===s.WritingMode.vertical?i.y<a.y?{needsFlipping:!0}:null:c.flipState!==0&&function(g,v,A){const S=(v.x-g.x)*A;return S===0||Math.abs((v.y-g.y)/S)>jo}(i,a,p)?c.flipState===1?{needsFlipping:!0}:null:i.x>a.x?{needsFlipping:!0}:null}function bl(c,i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q,Z,$,te){const X=i/24,le=c.lineOffsetX*X,ue=c.lineOffsetY*X;let oe=[];if(c.numGlyphs>1){const pe=c.glyphStartIndex+c.numGlyphs,we=c.lineStartIndex,Re=c.lineStartIndex+c.lineLength,De=rn(X,S,le,ue,a,U,j,c,I,v,J,Q,!1,Z,$,te);if(!De)return{notEnoughRoom:!0};const Ye=nn(De.first.point,A).point,xe=nn(De.last.point,A).point,qe=new s.pointGeometry(Ye[0],Ye[1]),He=new s.pointGeometry(xe[0],xe[1]);if(p&&!a){const Ie=wl(c,qe,He,K);if(c.flipState=Ie&&Ie.needsFlipping?1:2,Ie)return Ie}oe=[De.first];for(let Ie=c.glyphStartIndex+1;Ie<pe-1;Ie++){const ye=Nn(X*S.getoffsetX(Ie),le,ue,a,U,j,c.segment,we,Re,I,v,J,Q,!1,!1,Z,$,te);if(!ye)return{notEnoughRoom:!0};oe.push(ye)}oe.push(De.last)}else{if(p&&!a){const we=pt(j,g).point,Re=c.lineStartIndex+c.segment+1,De=new s.pointGeometry(I.getx(Re),I.gety(Re)),Ye=pt(De,g),xe=Ye.signedDistanceFromCamera>0?Ye.point:Cr(j,De,we,1,g,void 0,Z,$.canonical),qe=wl(c,new s.pointGeometry(we[0],we[1]),new s.pointGeometry(xe[0],xe[1]),K);if(c.flipState=qe&&qe.needsFlipping?1:2,qe)return qe}const pe=Nn(X*S.getoffsetX(c.glyphStartIndex),le,ue,a,U,j,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,I,v,J,Q,!1,!1,Z,$,te);if(!pe)return{notEnoughRoom:!0};oe=[pe]}if(P)for(const pe of oe)s.updateGlobeVertexNormal(P,k.length+0,pe.up[0],pe.up[1],pe.up[2]),s.updateGlobeVertexNormal(P,k.length+1,pe.up[0],pe.up[1],pe.up[2]),s.updateGlobeVertexNormal(P,k.length+2,pe.up[0],pe.up[1],pe.up[2]),s.updateGlobeVertexNormal(P,k.length+3,pe.up[0],pe.up[1],pe.up[2]),s.addDynamicAttributes(k,pe.point[0],pe.point[1],pe.point[2],pe.angle);else for(const pe of oe)s.addDynamicAttributes(k,pe.point[0],pe.point[1],pe.point[2],pe.angle);return{}}function Ua(c,i,a,p,g){const v=p.projectTilePoint(c.x,c.y,i);if(!g)return pt(v,a,v.z);const A=g(c);return pt(new s.pointGeometry(v.x+A[0],v.y+A[1]),a,v.z+A[2])}function Cr(c,i,a,p,g,v,A,S){const I=Ua(c.add(c.sub(i)._unit()),S,g,A,v).point,k=s.sub([],a,I);return s.scaleAndAdd([],a,k,p/s.length(k))}function Nn(c,i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q,Z,$){const te=p?c-i:c+i;let X=te>0?1:-1,le=0;p&&(X*=-1,le=Math.PI),X<0&&(le+=Math.PI);let ue=X>0?S+A:S+A+1,oe=g,pe=g,we=0,Re=0;const De=Math.abs(te),Ye=[],xe=[];let qe=v;const He=()=>{const at=ue-X;return we===0?v:new s.pointGeometry(k.getx(at),k.gety(at))},Ie=()=>{const at=He();return Cr(at,qe||at,pe,De-we+1,P,j,Q,Z.canonical)};for(;we+Re<=De;){if(ue+=X,ue<S||ue>=I)return null;if(pe=oe,Ye.push(oe),J&&xe.push(qe||He()),oe=U[ue],oe===void 0){qe=new s.pointGeometry(k.getx(ue),k.gety(ue));const at=Ua(qe,Z.canonical,P,Q,j);oe=at.signedDistanceFromCamera>0?U[ue]=at.point:Ie()}else qe=null;we+=Re,Re=s.distance(pe,oe)}qe=qe||new s.pointGeometry(k.getx(ue),k.gety(ue));const ye=He();K&&j&&(U[ue]=oe=U[ue]===void 0?oe:Ie(),Re=s.distance(pe,oe));const dt=(De-we)/Re,ot=qe.sub(ye).mult(dt)._add(ye),lt=s.sub([],oe,pe),st=s.scaleAndAdd([],pe,lt,dt);let Et=[0,0,1],Ut=lt[0],Lt=lt[1];if($&&(Et=Q.upVector(Z.canonical,ot.x,ot.y),Et[0]!==0||Et[1]!==0||Et[2]!==1)){const at=[1,0,0],Zt=[0,1,0];at[0]=Et[2],at[1]=0,at[2]=-Et[0],s.cross(Zt,Et,at),s.normalize(at,at),s.normalize(Zt,Zt),Ut=s.dot(lt,at),Lt=s.dot(lt,Zt)}if(a){const at=s.cross([],Et,lt);s.normalize(at,at),s.scaleAndAdd(st,st,at,a*X)}const St=le+Math.atan2(Lt,Ut);return Ye.push(st),J&&xe.push(ot),{point:st,angle:St,path:Ye,tilePath:xe,up:Et}}const Jf=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Xr(c,i){for(let a=0;a<c;a++){const p=i.length;i.resize(p+4),i.float32.set(Jf,4*p)}}function Al(c,i,a){const p=i[0],g=i[1];return c[0]=a[0]*p+a[4]*g+a[12],c[1]=a[1]*p+a[5]*g+a[13],c[3]=a[3]*p+a[7]*g+a[15],c}const Xi=100;class Ys{constructor(i,a,p=new Kd(i.width+200,i.height+200,25),g=new Kd(i.width+200,i.height+200,25)){this.transform=i,this.grid=p,this.ignoredGrid=g,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Xi,this.screenBottomBoundary=i.height+Xi,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=a}placeCollisionBox(i,a,p,g,v,A,S,I){let k=p.projectedAnchorX,P=p.projectedAnchorY,U=p.projectedAnchorZ;const j=p.elevation,J=p.tileID;if(j&&J){const ue=i.getProjection().upVector(J.canonical,p.tileAnchorX,p.tileAnchorY),oe=i.getProjection().upVectorScale(J.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=ue[0]*j*oe,P+=ue[1]*j*oe,U+=ue[2]*j*oe}const K=this.projectAndGetPerspectiveRatio(S,[k,P,U],p.tileID,i.projection.name==="globe"||!!j||this.transform.pitch>0,i.getProjection()),Q=A*K.perspectiveRatio,Z=(p.x1*a+g.x-p.padding)*Q+K.point.x,$=(p.y1*a+g.y-p.padding)*Q+K.point.y,te=(p.x2*a+g.x+p.padding)*Q+K.point.x,X=(p.y2*a+g.y+p.padding)*Q+K.point.y,le=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(Z,$,te,X)||!v&&this.grid.hitTest(Z,$,te,X,I)||le?{box:[],offscreen:!1,occluded:K.occluded}:{box:[Z,$,te,X],offscreen:this.isOffscreen(Z,$,te,X),occluded:!1}}placeCollisionCircles(i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q){const Z=[],$=this.transform.elevation,te=$?$.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,i.getProjection()):ye=>[0,0,0],X=new s.pointGeometry(p.tileAnchorX,p.tileAnchorY),le=i.getProjection().projectTilePoint(p.tileAnchorX,p.tileAnchorY,Q.canonical),ue=te(X),oe=[le.x+ue[0],le.y+ue[1],le.z+ue[2]],pe=i.projection.name==="globe",we=this.projectAndGetPerspectiveRatio(S,[oe[0],oe[1],oe[2]],Q,pe||!!$||this.transform.pitch>0,i.getProjection()),{perspectiveRatio:Re}=we,De=(U?A/Re:A*Re)/s.ONE_EM,Ye=pt(new s.pointGeometry(oe[0],oe[1]),I,oe[2]).point,xe=we.signedDistanceFromCamera>0?rn(De,v,p.lineOffsetX*De,p.lineOffsetY*De,!1,Ye,X,p,g,I,{},$&&!U?te:null,U&&!!$,i.getProjection(),Q,U):null;let qe=!1,He=!1,Ie=!0;if(xe&&!we.occluded){const ye=.5*J*Re+K,dt=new s.pointGeometry(-100,-100),ot=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),lt=new ws,st=xe.first,Et=xe.last;let Ut=[];for(let at=st.path.length-1;at>=1;at--)Ut.push(st.path[at]);for(let at=1;at<Et.path.length;at++)Ut.push(Et.path[at]);const Lt=2.5*ye;if(k){const at=Ut.map($&&!pe?(Zt,Yt)=>{const Dn=te(Yt<st.path.length-1?st.tilePath[st.path.length-1-Yt]:Et.tilePath[Yt-st.path.length+2]);return Zt[2]=Dn[2],nn(Zt,k)}:Zt=>nn(Zt,k));Ut=at.some(Zt=>Zt.signedDistanceFromCamera<=0)?[]:at.map(Zt=>Zt.point)}let St=[];if(Ut.length>0){const at=Ut.map(En=>new s.pointGeometry(En[0],En[1]));let Zt=1/0,Yt=-1/0,Dn=1/0,Ln=-1/0;for(let En=0;En<at.length;En++)Zt=Math.min(Zt,at[En].x),Dn=Math.min(Dn,at[En].y),Yt=Math.max(Yt,at[En].x),Ln=Math.max(Ln,at[En].y);St=Zt>=dt.x&&Yt<=ot.x&&Dn>=dt.y&&Ln<=ot.y?[at]:Yt<dt.x||Zt>ot.x||Ln<dt.y||Dn>ot.y?[]:s.clipLine([at],dt.x,dt.y,ot.x,ot.y)}for(const at of St){lt.reset(at,.25*ye);let Zt=0;Zt=lt.length<=.5*ye?1:Math.ceil(lt.paddedLength/Lt)+1;for(let Yt=0;Yt<Zt;Yt++){const Dn=Yt/Math.max(Zt-1,1),Ln=lt.lerp(Dn),En=Ln.x+Xi,wi=Ln.y+Xi;Z.push(En,wi,ye,0);const Ji=En-ye,Co=wi-ye,Fn=En+ye,ti=wi+ye;if(Ie=Ie&&this.isOffscreen(Ji,Co,Fn,ti),He=He||this.isInsideGrid(Ji,Co,Fn,ti),!a&&this.grid.hitTestCircle(En,wi,ye,j)&&(qe=!0,!P))return{circles:[],offscreen:!1,collisionDetected:qe,occluded:!1}}}}return{circles:!P&&qe||!He?[]:Z,offscreen:Ie,collisionDetected:qe,occluded:we.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let p=1/0,g=1/0,v=-1/0,A=-1/0;for(const P of i){const U=new s.pointGeometry(P.x+Xi,P.y+Xi);p=Math.min(p,U.x),g=Math.min(g,U.y),v=Math.max(v,U.x),A=Math.max(A,U.y),a.push(U)}const S=this.grid.query(p,g,v,A).concat(this.ignoredGrid.query(p,g,v,A)),I={},k={};for(const P of S){const U=P.key;if(I[U.bucketInstanceId]===void 0&&(I[U.bucketInstanceId]={}),I[U.bucketInstanceId][U.featureIndex])continue;const j=[new s.pointGeometry(P.x1,P.y1),new s.pointGeometry(P.x2,P.y1),new s.pointGeometry(P.x2,P.y2),new s.pointGeometry(P.x1,P.y2)];s.polygonIntersectsPolygon(a,j)&&(I[U.bucketInstanceId][U.featureIndex]=!0,k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]=[]),k[U.bucketInstanceId].push(U.featureIndex))}return k}insertCollisionBox(i,a,p,g,v){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,p,g,v){const A=a?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:g,collisionGroupID:v};for(let I=0;I<i.length;I+=4)A.insertCircle(S,i[I],i[I+1],i[I+2])}projectAndGetPerspectiveRatio(i,a,p,g,v){const A=[a[0],a[1],a[2],1];let S=!1;if(a[2]||this.transform.pitch>0){s.transformMat4$1(A,A,i);const I=v.name==="globe";this.fogState&&p&&!I&&(S=function(k,P,U,j,J,K){const Q=K.calculateFogTileMatrix(J),Z=[P,U,j];return s.transformMat4(Z,Z,Q),wt(k,Z,K.pitch,K._fov)}(this.fogState,a[0],a[1],a[2],p.toUnwrapped(),this.transform)>.9)}else Al(A,A,i);return{point:new s.pointGeometry((A[0]/A[3]+1)/2*this.transform.width+Xi,(-A[1]/A[3]+1)/2*this.transform.height+Xi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/A[3]*.5,1.5),signedDistanceFromCamera:A[3],occluded:g&&A[2]>A[3]||S}}isOffscreen(i,a,p,g){return p<Xi||i>=this.screenRightBoundary||g<Xi||a>this.screenBottomBoundary}isInsideGrid(i,a,p,g){return p>=0&&i<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const i=s.identity([]);return s.translate(i,i,[-100,-100,0]),i}}function pu(c,i,a){const p=i.createTileMatrix(c,c.worldSize,a.toUnwrapped());return s.multiply(new Float32Array(16),c.projMatrix,p)}function fu(c,i,a){if(i.projection.name===a.projection.name)return c.projMatrix;const p=a.clone();return p.setProjection(i.projection),pu(p,i.getProjection(),c)}function mu(c,i,a){return i.name===a.projection.name?c.projMatrix:pu(a,i,c)}class El{constructor(i,a,p,g){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):g&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Qs{constructor(i,a,p,g,v,A=!1){this.text=new El(i?i.text:null,a,p,v),this.icon=new El(i?i.icon:null,a,g,v),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ji{constructor(i,a,p,g=!1){this.text=i,this.icon=a,this.skipFade=p,this.clipped=g}}class ai{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Mh{constructor(i,a,p,g,v){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=v}}class Bh{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:p=>p.collisionGroupID===a}}return this.collisionGroups[i]}}function ar(c,i,a,p,g){const{horizontalAlign:v,verticalAlign:A}=s.getAnchorAlignment(c),S=-(v-.5)*i,I=-(A-.5)*a,k=s.evaluateVariableOffset(c,p);return new s.pointGeometry(S+k[0]*g,I+k[1]*g)}function lr(c,i,a,p,g){const v=new s.pointGeometry(c,i);return a&&v._rotate(p?g:-g),v}class Jd{constructor(i,a,p,g,v){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Ys(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Bh(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,a,p,g){const v=p.getBucket(a),A=p.latestFeatureIndex;if(!v||!A||a.id!==v.layerIds[0])return;const S=v.layers[0].layout,I=p.collisionBoxArray,k=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),P=p.tileSize/s.EXTENT,U=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);const j=(J=p.tileID,K=v.getProjection(),Q=this.transform,K.name===this.projection?Q.calculateProjMatrix(J.toUnwrapped()):pu(Q,K,J));var J,K,Q;const Z=S.get("text-pitch-alignment")==="map",$=S.get("text-rotation-alignment")==="map";a.compileFilter();const te=a.dynamicFilter(),X=a.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(p),ue=Xd(j,p.tileID.canonical,Z,$,this.transform,v.getProjection(),le);let oe=null;if(Z){const Re=Ra(j,p.tileID.canonical,Z,$,this.transform,v.getProjection(),le);oe=s.multiply([],this.transform.labelPlaneMatrix,Re)}let pe=null;te&&p.latestFeatureIndex&&(pe={unwrappedTileID:U,dynamicFilter:te,dynamicFilterNeedsFeature:X,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Mh(v.bucketInstanceId,A,v.sourceLayerIndex,v.index,p.tileID);const we={bucket:v,layout:S,posMatrix:j,textLabelPlaneMatrix:ue,labelToScreenMatrix:oe,clippingData:pe,scale:k,textPixelRatio:P,holdingForFade:p.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const Re of v.sortKeyRanges){const{sortKey:De,symbolInstanceStart:Ye,symbolInstanceEnd:xe}=Re;i.push({sortKey:De,symbolInstanceStart:Ye,symbolInstanceEnd:xe,parameters:we})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:we})}attemptAnchorPlacement(i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q,Z,$,te){const X=[j.textOffset0,j.textOffset1],le=ar(i,p,g,X,v),ue=this.collisionIndex.placeCollisionBox(K,v,a,lr(le.x,le.y,A,S,this.transform.angle),U,I,k,P.predicate);if(Z){const oe=K.getSymbolInstanceIconSize(te,this.transform.zoom,j.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,oe,Z,lr(le.x,le.y,A,S,this.transform.angle),U,I,k,P.predicate).box.length===0)return}if(ue.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:X,width:p,height:g,anchor:i,textScale:v,prevAnchor:oe},this.markUsedJustification(K,i,j,Q),K.allowVerticalPlacement&&(this.markUsedOrientation(K,Q,j),this.placedOrientations[j.crossTileID]=Q),{shift:le,placedGlyphBoxes:ue}}}placeLayerBucketPart(i,a,p,g){const{bucket:v,layout:A,posMatrix:S,textLabelPlaneMatrix:I,labelToScreenMatrix:k,clippingData:P,textPixelRatio:U,holdingForFade:j,collisionBoxArray:J,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:Q,collisionGroup:Z}=i.parameters,$=A.get("text-optional"),te=A.get("icon-optional"),X=A.get("text-allow-overlap"),le=A.get("icon-allow-overlap"),ue=A.get("text-rotation-alignment")==="map",oe=A.get("text-pitch-alignment")==="map",pe=A.get("icon-text-fit")!=="none",we=A.get("symbol-z-order")==="viewport-y";this.transform.setProjection(v.projection);let Re=X&&(le||!v.hasIconData()||te),De=le&&(X||!v.hasTextData()||$);!v.collisionArrays&&J&&v.deserializeCollisionBoxes(J),p&&g&&v.updateCollisionDebugBuffers(this.transform.zoom,J);const Ye=(xe,qe,He)=>{if(P){const Fn={zoom:this.transform.zoom,pitch:this.transform.pitch};let ti=null;if(P.dynamicFilterNeedsFeature){const Cn=this.retainedQueryData[v.bucketInstanceId];ti=P.featureIndex.loadFeature({featureIndex:xe.featureIndex,bucketIndex:Cn.bucketIndex,sourceLayerIndex:Cn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(Fn,ti,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new s.pointGeometry(xe.tileAnchorX,xe.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[xe.crossTileID]=new ji(!1,!1,!1,!0),void(a[xe.crossTileID]=!0)}if(a[xe.crossTileID])return;if(j)return void(this.placements[xe.crossTileID]=new ji(!1,!1,!1));let Ie=!1,ye=!1,dt=!0,ot=!1,lt=!1,st=null,Et={box:null,offscreen:null,occluded:null},Ut={box:null,offscreen:null,occluded:null},Lt=null,St=null,at=null,Zt=0,Yt=0,Dn=0;He.textFeatureIndex?Zt=He.textFeatureIndex:xe.useRuntimeCollisionCircles&&(Zt=xe.featureIndex),He.verticalTextFeatureIndex&&(Yt=He.verticalTextFeatureIndex);const Ln=Fn=>{Fn.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||Fn.elevation)&&(Fn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,Fn.tileAnchorX,Fn.tileAnchorY):0)},En=He.textBox;if(En){Ln(En);const Fn=Cn=>{let ci=s.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Cn&&this.prevPlacement){const Yi=this.prevPlacement.placedOrientations[xe.crossTileID];Yi&&(this.placedOrientations[xe.crossTileID]=Yi,ci=Yi,this.markUsedOrientation(v,ci,xe))}return ci},ti=(Cn,ci)=>{if(v.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&He.verticalTextBox){for(const Yi of v.writingModes)if(Yi===s.WritingMode.vertical?(Et=ci(),Ut=Et):Et=Cn(),Et&&Et.box&&Et.box.length)break}else Et=Cn()};if(A.get("text-variable-anchor")){let Cn=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[xe.crossTileID]){const On=this.prevPlacement.variableOffsets[xe.crossTileID];Cn.indexOf(On.anchor)>0&&(Cn=Cn.filter(Ir=>Ir!==On.anchor),Cn.unshift(On.anchor))}const ci=(On,Ir,Bs)=>{const to=v.getSymbolInstanceTextSize(K,xe,this.transform.zoom,qe),Hi=(On.x2-On.x1)*to+2*On.padding,jl=(On.y2-On.y1)*to+2*On.padding,ts=pe&&!le?Ir:null;ts&&Ln(ts);let Ht={box:[],offscreen:!1,occluded:!1};const ns=X?2*Cn.length:Cn.length;for(let ca=0;ca<ns;++ca){const fr=this.attemptAnchorPlacement(Cn[ca%Cn.length],On,Hi,jl,to,ue,oe,U,S,Z,ca>=Cn.length,xe,qe,v,Bs,ts,K,Q);if(fr&&(Ht=fr.placedGlyphBoxes,Ht&&Ht.box&&Ht.box.length)){Ie=!0,st=fr.shift;break}}return Ht};ti(()=>ci(En,He.iconBox,s.WritingMode.horizontal),()=>{const On=He.verticalTextBox;return On&&Ln(On),v.allowVerticalPlacement&&!(Et&&Et.box&&Et.box.length)&&xe.numVerticalGlyphVertices>0&&On?ci(On,He.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Et&&(Ie=Et.box,dt=Et.offscreen,ot=Et.occluded);const Yi=Fn(Et&&Et.box);if(!Ie&&this.prevPlacement){const On=this.prevPlacement.variableOffsets[xe.crossTileID];On&&(this.variableOffsets[xe.crossTileID]=On,this.markUsedJustification(v,On.anchor,xe,Yi))}}else{const Cn=(ci,Yi)=>{const On=v.getSymbolInstanceTextSize(K,xe,this.transform.zoom,qe),Ir=this.collisionIndex.placeCollisionBox(v,On,ci,new s.pointGeometry(0,0),X,U,S,Z.predicate);return Ir&&Ir.box&&Ir.box.length&&(this.markUsedOrientation(v,Yi,xe),this.placedOrientations[xe.crossTileID]=Yi),Ir};ti(()=>Cn(En,s.WritingMode.horizontal),()=>{const ci=He.verticalTextBox;return v.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&ci?(Ln(ci),Cn(ci,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Fn(Et&&Et.box&&Et.box.length)}}if(Lt=Et,Ie=Lt&&Lt.box&&Lt.box.length>0,dt=Lt&&Lt.offscreen,ot=Lt&&Lt.occluded,xe.useRuntimeCollisionCircles){const Fn=v.text.placedSymbolArray.get(xe.centerJustifiedTextSymbolIndex>=0?xe.centerJustifiedTextSymbolIndex:xe.verticalPlacedTextSymbolIndex),ti=s.evaluateSizeForFeature(v.textSizeData,K,Fn),Cn=A.get("text-padding");St=this.collisionIndex.placeCollisionCircles(v,X,Fn,v.lineVertexArray,v.glyphOffsetArray,ti,S,I,k,p,oe,Z.predicate,xe.collisionCircleDiameter*ti/s.ONE_EM,Cn,this.retainedQueryData[v.bucketInstanceId].tileID),Ie=X||St.circles.length>0&&!St.collisionDetected,dt=dt&&St.offscreen,ot=St.occluded}if(He.iconFeatureIndex&&(Dn=He.iconFeatureIndex),He.iconBox){const Fn=ti=>{Ln(ti);const Cn=pe&&st?lr(st.x,st.y,ue,oe,this.transform.angle):new s.pointGeometry(0,0),ci=v.getSymbolInstanceIconSize(Q,this.transform.zoom,xe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,ci,ti,Cn,le,U,S,Z.predicate)};Ut&&Ut.box&&Ut.box.length&&He.verticalIconBox?(at=Fn(He.verticalIconBox),ye=at.box.length>0):(at=Fn(He.iconBox),ye=at.box.length>0),dt=dt&&at.offscreen,lt=at.occluded}const wi=$||xe.numHorizontalGlyphVertices===0&&xe.numVerticalGlyphVertices===0,Ji=te||xe.numIconVertices===0;if(wi||Ji?Ji?wi||(ye=ye&&Ie):Ie=ye&&Ie:ye=Ie=ye&&Ie,Ie&&Lt&&Lt.box&&this.collisionIndex.insertCollisionBox(Lt.box,A.get("text-ignore-placement"),v.bucketInstanceId,Ut&&Ut.box&&Yt?Yt:Zt,Z.ID),ye&&at&&this.collisionIndex.insertCollisionBox(at.box,A.get("icon-ignore-placement"),v.bucketInstanceId,Dn,Z.ID),St&&(Ie&&this.collisionIndex.insertCollisionCircles(St.circles,A.get("text-ignore-placement"),v.bucketInstanceId,Zt,Z.ID),p)){const Fn=v.bucketInstanceId;let ti=this.collisionCircleArrays[Fn];ti===void 0&&(ti=this.collisionCircleArrays[Fn]=new ai);for(let Cn=0;Cn<St.circles.length;Cn+=4)ti.circles.push(St.circles[Cn+0]),ti.circles.push(St.circles[Cn+1]),ti.circles.push(St.circles[Cn+2]),ti.circles.push(St.collisionDetected?1:0)}const Co=v.projection.name!=="globe";Re=Re&&(Co||!ot),De=De&&(Co||!lt),this.placements[xe.crossTileID]=new ji(Ie||Re,ye||De,dt||v.justReloaded),a[xe.crossTileID]=!0};if(we){const xe=v.getSortedSymbolIndexes(this.transform.angle);for(let qe=xe.length-1;qe>=0;--qe){const He=xe[qe];Ye(v.symbolInstances.get(He),He,v.collisionArrays[He])}}else for(let xe=i.symbolInstanceStart;xe<i.symbolInstanceEnd;xe++)Ye(v.symbolInstances.get(xe),xe,v.collisionArrays[xe]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[v.bucketInstanceId];s.invert(xe.invProjMatrix,S),xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(i,a,p,g){let v;v=g===s.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(a)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of A)S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=v>=0&&S!==v?0:p.crossTileID)}markUsedOrientation(i,a,p){const g=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,v=a===s.WritingMode.vertical?a:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex].filter(S=>S!==-1);for(const S of A)i.text.placedSymbolArray.get(S).placedOrientation=g;p.verticalPlacedTextSymbolIndex!==-1&&(i.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let p=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(i):1,v=a?a.opacities:{},A=a?a.variableOffsets:{},S=a?a.placedOrientations:{};for(const I in this.placements){const k=this.placements[I],P=v[I];P?(this.opacities[I]=new Qs(P,g,k.text,k.icon,null,k.clipped),p=p||k.text!==P.text.placed||k.icon!==P.icon.placed):(this.opacities[I]=new Qs(null,g,k.text,k.icon,k.skipFade,k.clipped),p=p||k.text||k.icon)}for(const I in v){const k=v[I];if(!this.opacities[I]){const P=new Qs(k,g,!1,!1);P.isHidden()||(this.opacities[I]=P,p=p||k.text.placed||k.icon.placed)}}for(const I in A)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=A[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a){const p={};for(const g of a){const v=g.getBucket(i);v&&g.latestFeatureIndex&&i.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,g.collisionBoxArray)}}updateBucketOpacities(i,a,p){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const g=i.layers[0].layout,v=!!i.layers[0].dynamicFilter(),A=new Qs(null,0,!1,!1,!0),S=g.get("text-allow-overlap"),I=g.get("icon-allow-overlap"),k=g.get("text-variable-anchor"),P=g.get("text-rotation-alignment")==="map",U=g.get("text-pitch-alignment")==="map",j=g.get("icon-text-fit")!=="none",J=new Qs(null,0,S&&(I||!i.hasIconData()||g.get("icon-optional")),I&&(S||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&p&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(p);const K=(Z,$,te)=>{for(let X=0;X<$/4;X++)Z.opacityVertexArray.emplaceBack(te)};let Q=0;for(let Z=0;Z<i.symbolInstances.length;Z++){const $=i.symbolInstances.get(Z),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:X,crossTileID:le}=$;let ue=this.opacities[le];a[le]?ue=A:ue||(ue=J,this.opacities[le]=ue),a[le]=!0;const oe=te>0||X>0,pe=$.numIconVertices>0,we=this.placedOrientations[$.crossTileID],Re=we===s.WritingMode.vertical,De=we===s.WritingMode.horizontal||we===s.WritingMode.horizontalOnly;if(!oe&&!pe||ue.isHidden()||Q++,oe){const Ye=Ho(ue.text);K(i.text,te,Re?kn:Ye),K(i.text,X,De?kn:Ye);const xe=ue.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(Ie=>{Ie>=0&&(i.text.placedSymbolArray.get(Ie).hidden=xe||Re?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=xe||De?1:0);const qe=this.variableOffsets[$.crossTileID];qe&&this.markUsedJustification(i,qe.anchor,$,we);const He=this.placedOrientations[$.crossTileID];He&&(this.markUsedJustification(i,"left",$,He),this.markUsedOrientation(i,He,$))}if(pe){const Ye=Ho(ue.icon);$.placedIconSymbolIndex>=0&&(K(i.icon,$.numIconVertices,Re?kn:Ye),i.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=ue.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(K(i.icon,$.numVerticalIconVertices,De?kn:Ye),i.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=ue.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ye=i.collisionArrays[Z];if(Ye){let xe=new s.pointGeometry(0,0),qe=!0;if(Ye.textBox||Ye.verticalTextBox){if(k){const Ie=this.variableOffsets[le];Ie?(xe=ar(Ie.anchor,Ie.width,Ie.height,Ie.textOffset,Ie.textScale),P&&xe._rotate(U?this.transform.angle:-this.transform.angle)):qe=!1}v&&(qe=!ue.clipped),Ye.textBox&&Na(i.textCollisionBox.collisionVertexArray,ue.text.placed,!qe||Re,xe.x,xe.y),Ye.verticalTextBox&&Na(i.textCollisionBox.collisionVertexArray,ue.text.placed,!qe||De,xe.x,xe.y)}const He=qe&&Boolean(!De&&Ye.verticalIconBox);Ye.iconBox&&Na(i.iconCollisionBox.collisionVertexArray,ue.icon.placed,He,j?xe.x:0,j?xe.y:0),Ye.verticalIconBox&&Na(i.iconCollisionBox.collisionVertexArray,ue.icon.placed,!He,j?xe.x:0,j?xe.y:0)}}}if(i.fullyClipped=Q===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Z.invProjMatrix,i.placementViewportMatrix=Z.viewportMatrix,i.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){const p=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Na(c,i,a,p,g){c.emplaceBack(i?1:0,a?1:0,p||0,g||0),c.emplaceBack(i?1:0,a?1:0,p||0,g||0),c.emplaceBack(i?1:0,a?1:0,p||0,g||0),c.emplaceBack(i?1:0,a?1:0,p||0,g||0)}const yi=Math.pow(2,25),_u=Math.pow(2,24),gu=Math.pow(2,17),yu=Math.pow(2,16),qi=Math.pow(2,9),Dh=Math.pow(2,8),kh=Math.pow(2,1);function Ho(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const i=c.placed?1:0,a=Math.floor(127*c.opacity);return a*yi+i*_u+a*gu+i*yu+a*qi+i*Dh+a*kh+i}const kn=0;class Gn{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,a,p,g,v){const A=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(A,g,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<A.length;){const S=A[this._currentPartIndex];if(a.placeLayerBucketPart(S,this._seenCrossTileIDs,p,S.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Yf{constructor(i,a,p,g,v,A,S,I){this.placement=new Jd(i,v,A,S,I),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(i,a,p){const g=s.exported.now(),v=()=>{const A=s.exported.now()-g;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=a[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=S)&&(!A.maxzoom||A.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Gn(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const zh=512/s.EXTENT/2;class Cl{constructor(i,a,p){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let g=0;g<a.length;g++){const v=a.get(g),A=v.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,i)})}}getScaledCoordinates(i,a){const p=zh/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*s.EXTENT+i.tileAnchorX)*p),y:Math.floor((a.canonical.y*s.EXTENT+i.tileAnchorY)*p)}}findMatches(i,a,p){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let v=0;v<i.length;v++){const A=i.get(v);if(A.crossTileID)continue;const S=this.indexedSymbolInstances[A.key];if(!S)continue;const I=this.getScaledCoordinates(A,a);for(const k of S)if(Math.abs(k.coord.x-I.x)<=g&&Math.abs(k.coord.y-I.y)<=g&&!p[k.crossTileID]){p[k.crossTileID]=!0,A.crossTileID=k.crossTileID;break}}}}class Qf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const a=Math.round((i-this.lng)/360);if(a!==0)for(const p in this.indexes){const g=this.indexes[p],v={};for(const A in g){const S=g[A];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+a),v[S.tileID.key]=S}this.indexes[p]=v}this.lng=i}addBucket(i,a,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const g=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const A=this.indexes[v];if(Number(v)>i.overscaledZ)for(const S in A){const I=A[S];I.tileID.isChildOf(i)&&I.findMatches(a.symbolInstances,i,g)}else{const S=A[i.scaledTo(Number(v)).key];S&&S.findMatches(a.symbolInstances,i,g)}}for(let v=0;v<a.symbolInstances.length;v++){const A=a.symbolInstances.get(v);A.crossTileID||(A.crossTileID=p.generate(),g[A.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Cl(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(const p in a.indexedSymbolInstances)for(const g of a.indexedSymbolInstances[p])delete this.usedCrossTileIDs[i][g.crossTileID]}removeStaleBuckets(i){let a=!1;for(const p in this.indexes){const g=this.indexes[p];for(const v in g)i[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[v]),delete g[v],a=!0)}return a}}class Ga{constructor(){this.layerIndexes={},this.crossTileIDs=new Qf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,p,g){let v=this.layerIndexes[i.id];v===void 0&&(v=this.layerIndexes[i.id]=new Yd);let A=!1;const S={};g.name!=="globe"&&v.handleWrapJump(p);for(const I of a){const k=I.getBucket(i);k&&i.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(I.tileID,k,this.crossTileIDs)&&(A=!0),S[k.bucketInstanceId]=!0)}return v.removeStaleBuckets(S)&&(A=!0),A}pruneUnusedLayers(i){const a={};i.forEach(p=>{a[p]=!0});for(const p in this.layerIndexes)a[p]||delete this.layerIndexes[p]}}const Jr=(c,i)=>s.emitValidationErrors(c,i&&i.filter(a=>a.identifier!=="source.canvas")),rc=s.pick(Rt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),si=s.pick(Rt,["setCenter","setZoom","setBearing","setPitch"]),vu={version:8,layers:[],sources:{}},$o={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class vo extends s.Evented{constructor(i,a={}){super(),this.map=i,this.dispatcher=new br(Gt(),this),this.imageManager=new rr,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(i._requestManager,a.localFontFamily?s.LocalGlyphMode.all:a.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.crossTileSymbolIndex=new Ga,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const p=this;this._rtlTextPluginCallback=vo.registerForPluginStateChange(g=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,A)=>{if(s.triggerPluginCompletionEvent(v),A&&A.every(S=>S))for(const S in p._sourceCaches){const I=p._sourceCaches[S],k=I.getSource().type;k!=="vector"&&k!=="geojson"||I.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const v=this.getSource(g.sourceId);if(v&&v.vectorLayerIds)for(const A in this._layers){const S=this._layers[A];S.source===v.id&&this._validateLayer(S)}})}loadURL(i,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const p=typeof a.validate=="boolean"?a.validate:!s.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,a.accessToken);const g=this.map._requestManager.transformRequest(i,s.ResourceType.Style);this._request=s.getJSON(g,(v,A)=>{this._request=null,v?this.fire(new s.ErrorEvent(v)):A&&this._load(A,p)})}loadJSON(i,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(i,a.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(vu,!1)}_updateLayerCount(i,a){const p=a?1:-1;i.is3D()&&(this._num3DLayers+=p),i.type==="circle"&&(this._numCircleLayers+=p),i.type==="symbol"&&(this._numSymbolLayers+=p)}_load(i,a){if(a&&Jr(this,s.validateStyle(i)))return;this._loaded=!0,this.stylesheet=s.clone$1(i),this._updateMapProjection();for(const g in i.sources)this.addSource(g,i.sources[g],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const p=An(this.stylesheet.layers);this._order=p.map(g=>g.id),this._layers={},this._serializedLayers={};for(let g of p)g=s.createStyleLayer(g),g.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=g,this._serializedLayers[g.id]=g.serialize(),this._updateLayerCount(g,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _s(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(a,p,g){let v,A,S;const I=s.exported.devicePixelRatio>1?"@2x":"";let k=s.getJSON(p.transformRequest(p.normalizeSpriteURL(a,I,".json"),s.ResourceType.SpriteJSON),(j,J)=>{k=null,S||(S=j,v=J,U())}),P=s.getImage(p.transformRequest(p.normalizeSpriteURL(a,I,".png"),s.ResourceType.SpriteImage),(j,J)=>{P=null,S||(S=j,A=J,U())});function U(){if(S)g(S);else if(v&&A){const j=s.exported.getImageData(A),J={};for(const K in v){const{width:Q,height:Z,x:$,y:te,sdf:X,pixelRatio:le,stretchX:ue,stretchY:oe,content:pe}=v[K],we=new s.RGBAImage({width:Q,height:Z});s.RGBAImage.copy(j,we,{x:$,y:te},{x:0,y:0},{width:Q,height:Z}),J[K]={data:we,pixelRatio:le,sdf:X,stretchX:ue,stretchY:oe,content:pe}}g(null,J)}}return{cancel(){k&&(k.cancel(),k=null),P&&(P.cancel(),P=null)}}}(i,this.map._requestManager,(a,p)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(p)for(const g in p)this.imageManager.addImage(g,p[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(i){const a=this.getSource(i.source);if(!a)return;const p=i.sourceLayer;p&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${a.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const a=[];for(const p of i){const g=this._layers[p];g.type!=="custom"&&a.push(g.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&$o[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const a=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const A in this._updatedSources){const S=this._updatedSources[A];S==="reload"?this._reloadSource(A):S==="clear"&&this._clearSource(A)}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const p={};for(const g in this._sourceCaches){const v=this._sourceCaches[g];p[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];if(v.recalculate(i,this._availableImages),!v.isHidden(i.zoom)){const S=this._getLayerSourceCache(v);S&&(S.used=!0)}const A=this.map.painter;if(A){const S=v.getProgramIds();if(!S)continue;const I=v.getProgramConfiguration(i.zoom);for(const k of S)A.useProgram(k,I)}}for(const g in p){const v=this._sourceCaches[g];p[g]!==v.used&&v.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Jr(this,s.validateStyle(i)))return!1;(i=s.clone$1(i)).layers=An(i.layers);const a=function(g,v){if(!g)return[{command:Rt.setStyle,args:[v]}];let A=[];try{if(!q(g.version,v.version))return[{command:Rt.setStyle,args:[v]}];q(g.center,v.center)||A.push({command:Rt.setCenter,args:[v.center]}),q(g.zoom,v.zoom)||A.push({command:Rt.setZoom,args:[v.zoom]}),q(g.bearing,v.bearing)||A.push({command:Rt.setBearing,args:[v.bearing]}),q(g.pitch,v.pitch)||A.push({command:Rt.setPitch,args:[v.pitch]}),q(g.sprite,v.sprite)||A.push({command:Rt.setSprite,args:[v.sprite]}),q(g.glyphs,v.glyphs)||A.push({command:Rt.setGlyphs,args:[v.glyphs]}),q(g.transition,v.transition)||A.push({command:Rt.setTransition,args:[v.transition]}),q(g.light,v.light)||A.push({command:Rt.setLight,args:[v.light]}),q(g.fog,v.fog)||A.push({command:Rt.setFog,args:[v.fog]}),q(g.projection,v.projection)||A.push({command:Rt.setProjection,args:[v.projection]});const S={},I=[];(function(U,j,J,K){let Q;for(Q in j=j||{},U=U||{})U.hasOwnProperty(Q)&&(j.hasOwnProperty(Q)||Tn(Q,J,K));for(Q in j)j.hasOwnProperty(Q)&&(U.hasOwnProperty(Q)?q(U[Q],j[Q])||(U[Q].type==="geojson"&&j[Q].type==="geojson"&&xs(U,j,Q)?J.push({command:Rt.setGeoJSONSourceData,args:[Q,j[Q].data]}):Js(Q,j,J,K)):Pn(Q,j,J))})(g.sources,v.sources,I,S);const k=[];g.layers&&g.layers.forEach(U=>{U.source&&S[U.source]?A.push({command:Rt.removeLayer,args:[U.id]}):k.push(U)});let P=g.terrain;P&&S[P.source]&&(A.push({command:Rt.setTerrain,args:[void 0]}),P=void 0),A=A.concat(I),q(P,v.terrain)||A.push({command:Rt.setTerrain,args:[v.terrain]}),function(U,j,J){j=j||[];const K=(U=U||[]).map(Vo),Q=j.map(Vo),Z=U.reduce(ui,{}),$=j.reduce(ui,{}),te=K.slice(),X=Object.create(null);let le,ue,oe,pe,we,Re,De;for(le=0,ue=0;le<K.length;le++)oe=K[le],$.hasOwnProperty(oe)?ue++:(J.push({command:Rt.removeLayer,args:[oe]}),te.splice(te.indexOf(oe,ue),1));for(le=0,ue=0;le<Q.length;le++)oe=Q[Q.length-1-le],te[te.length-1-le]!==oe&&(Z.hasOwnProperty(oe)?(J.push({command:Rt.removeLayer,args:[oe]}),te.splice(te.lastIndexOf(oe,te.length-ue),1)):ue++,Re=te[te.length-le],J.push({command:Rt.addLayer,args:[$[oe],Re]}),te.splice(te.length-le,0,oe),X[oe]=!0);for(le=0;le<Q.length;le++)if(oe=Q[le],pe=Z[oe],we=$[oe],!X[oe]&&!q(pe,we))if(q(pe.source,we.source)&&q(pe["source-layer"],we["source-layer"])&&q(pe.type,we.type)){for(De in Ue(pe.layout,we.layout,J,oe,null,Rt.setLayoutProperty),Ue(pe.paint,we.paint,J,oe,null,Rt.setPaintProperty),q(pe.filter,we.filter)||J.push({command:Rt.setFilter,args:[oe,we.filter]}),q(pe.minzoom,we.minzoom)&&q(pe.maxzoom,we.maxzoom)||J.push({command:Rt.setLayerZoomRange,args:[oe,we.minzoom,we.maxzoom]}),pe)pe.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Ue(pe[De],we[De],J,oe,De.slice(6),Rt.setPaintProperty):q(pe[De],we[De])||J.push({command:Rt.setLayerProperty,args:[oe,De,we[De]]}));for(De in we)we.hasOwnProperty(De)&&!pe.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Ue(pe[De],we[De],J,oe,De.slice(6),Rt.setPaintProperty):q(pe[De],we[De])||J.push({command:Rt.setLayerProperty,args:[oe,De,we[De]]}))}else J.push({command:Rt.removeLayer,args:[oe]}),Re=te[te.lastIndexOf(oe)+1],J.push({command:Rt.addLayer,args:[we,Re]})}(k,v.layers,A)}catch(S){console.warn("Unable to compute style diff:",S),A=[{command:Rt.setStyle,args:[v]}]}return A}(this.serialize(),i).filter(g=>!(g.command in si));if(a.length===0)return!1;const p=a.filter(g=>!(g.command in rc));if(p.length>0)throw new Error(`Unimplemented: ${p.map(g=>g.command).join(", ")}.`);return a.forEach(g=>{g.command!=="setTransition"&&g.command!=="setProjection"&&this[g.command].apply(this,g.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,a){return this.getImage(i)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,a),this._afterImageUpdated(i),this)}updateImage(i,a){this.imageManager.updateImage(i,a)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,a,p={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateSource,`sources.${i}`,a,null,p))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=Ae(i,a,this.dispatcher,this);g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:g.serialize(),sourceId:i}));const v=A=>{const S=(A?"symbol:":"other:")+i,I=this._sourceCaches[S]=new s.SourceCache(S,g,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[i]=I,I.style=this,I.onAdd(this.map)};v(!1),a.type!=="vector"&&a.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const a=this.getSource(i);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===i)return this.fire(new s.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new s.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(i);for(const g of p)delete this._sourceCaches[g.id],delete this._updatedSources[g.id],g.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,a){this._checkLoaded(),this.getSource(i).setData(a),this._changed=!0}getSource(i){const a=this._getSourceCache(i);return a&&a.getSource()}_getSources(){const i=[];for(const a in this._otherSourceCaches){const p=this._getSourceCache(a);p&&i.push(p.getSource())}return i}addLayer(i,a,p={}){this._checkLoaded();const g=i.id;if(this.getLayer(g))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(i.type==="custom"){if(Jr(this,s.validateCustomStyleLayer(i)))return;v=s.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(g,i.source),i=s.clone$1(i),i=s.extend(i,{source:g})),this._validate(s.validateLayer,`layers.${g}`,i,{arrayIndex:-1},p))return;v=s.createStyleLayer(i),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const A=a?this._order.indexOf(a):this._order.length;if(a&&A===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(A,0,g),this._layerOrderChanged=!0,this._layers[g]=v;const S=this._getLayerSourceCache(v);if(this._removedLayers[g]&&v.source&&S&&v.type!=="custom"){const I=this._removedLayers[g];delete this._removedLayers[g],I.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",S.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,a){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===a)return;const p=this._order.indexOf(i);this._order.splice(p,1);const g=a?this._order.indexOf(a):this._order.length;a&&g===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(g,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const a=this._layers[i];if(!a)return void this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=a,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const a in this._layers)if(this._layers[a].type===i)return!0;return!1}setLayerZoomRange(i,a,p){this._checkLoaded();const g=this.getLayer(i);g?g.minzoom===a&&g.maxzoom===p||(a!=null&&(g.minzoom=a),p!=null&&(g.maxzoom=p),this._updateLayer(g)):this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,a,p={}){this._checkLoaded();const g=this.getLayer(i);if(g){if(!q(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(s.validateFilter,`layers.${g.id}.filter`,a,{layerType:g.type},p)||(g.filter=s.clone$1(a),this._updateLayer(g)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const a=this.getLayer(i);return a&&s.clone$1(a.filter)}setLayoutProperty(i,a,p,g={}){this._checkLoaded();const v=this.getLayer(i);v?q(v.getLayoutProperty(a),p)||(v.setLayoutProperty(a,p,g),this._updateLayer(v)):this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,a){const p=this.getLayer(i);if(p)return p.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,a,p,g={}){this._checkLoaded();const v=this.getLayer(i);v?q(v.getPaintProperty(a),p)||(v.setPaintProperty(a,p,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,a){const p=this.getLayer(i);return p&&p.getPaintProperty(a)}setFeatureState(i,a){this._checkLoaded();const p=i.source,g=i.sourceLayer,v=this.getSource(p);if(!v)return void this.fire(new s.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const A=v.type;if(A==="geojson"&&g)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!g)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(p);for(const I of S)I.setFeatureState(g,i.id,a)}removeFeatureState(i,a){this._checkLoaded();const p=i.source,g=this.getSource(p);if(!g)return void this.fire(new s.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=g.type,A=v==="vector"?i.sourceLayer:void 0;if(v==="vector"&&!A)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(p);for(const I of S)I.removeFeatureState(A,i.id,a)}getFeatureState(i){this._checkLoaded();const a=i.source,p=i.sourceLayer,g=this.getSource(a);if(g){if(g.type!=="vector"||p)return i.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(p,i.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const a in this._sourceCaches){const p=this._sourceCaches[a].getSource();i[p.id]||(i[p.id]=p.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const a=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",a.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const a=A=>this._layers[A].type==="fill-extrusion",p={},g=[];for(let A=this._order.length-1;A>=0;A--){const S=this._order[A];if(a(S)){p[S]=A;for(const I of i){const k=I[S];if(k)for(const P of k)g.push(P)}}}g.sort((A,S)=>S.intersectionZ-A.intersectionZ);const v=[];for(let A=this._order.length-1;A>=0;A--){const S=this._order[A];if(a(S))for(let I=g.length-1;I>=0;I--){const k=g[I].feature;if(p[k.layer.id]<A)break;v.push(k),g.pop()}else for(const I of i){const k=I[S];if(k)for(const P of k)v.push(P.feature)}}return v}queryRenderedFeatures(i,a,p){a&&a.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const g={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of a.layers){const k=this._layers[I];if(!k)return this.fire(new s.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];g[k.source]=!0}}const v=[];a.availableImages=this._availableImages;const A=a&&a.layers?a.layers.some(I=>{const k=this.getLayer(I);return k&&k.is3D()}):this.has3DLayers(),S=Ki.createFromScreenPoints(i,p);for(const I in this._sourceCaches){const k=this._sourceCaches[I].getSource().id;a.layers&&!g[k]||v.push(Be(this._sourceCaches[I],this._layers,this._serializedLayers,S,a,p,A,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(I,k,P,U,j,J,K){const Q={},Z=J.queryRenderedSymbols(U),$=[];for(const te of Object.keys(Z).map(Number))$.push(K[te]);$.sort(_t);for(const te of $){const X=te.featureIndex.lookupSymbolFeatures(Z[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,j.filter,j.layers,j.availableImages,I);for(const le in X){const ue=Q[le]=Q[le]||[],oe=X[le];oe.sort((pe,we)=>{const Re=te.featureSortOrder;if(Re){const De=Re.indexOf(pe.featureIndex);return Re.indexOf(we.featureIndex)-De}return we.featureIndex-pe.featureIndex});for(const pe of oe)ue.push(pe)}}for(const te in Q)Q[te].forEach(X=>{const le=X.feature,ue=P(I[te]).getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ue});return Q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,a){a&&a.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const p=this._getSourceCaches(i);let g=[];for(const v of p)g=g.concat(Ke(v,a));return g}addSourceType(i,a,p){return vo.getSourceType(i)?p(new Error(`A source type called "${i}" already exists.`)):(vo.setSourceType(i,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:a.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(i,a={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const A in i)if(!q(i[A],p[A])){g=!0;break}if(!g)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,a),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,a=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof i.source=="object"){const p="terrain-dem-src";this.addSource(p,i.source),i=s.clone$1(i),i=s.extend(i,{source:p})}if(this._validate(s.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(i,a);else{const p=this.terrain,g=p.get();for(const v of Object.keys(s.spec.terrain))!i.hasOwnProperty(v)&&s.spec.terrain[v].default&&(i[v]=s.spec.terrain[v].default);for(const v in i)if(!q(i[v],g[v])){p.set(i),this.stylesheet.terrain=i;const A=this._setTransitionParameters({duration:0});p.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const a=this.fog=new oi(i,this.map.transform);this.stylesheet.fog=i;const p=this._setTransitionParameters({duration:0});a.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,p=a.get();Object.keys(i).length===0&&a.set(i);for(const g in i)if(!q(i[g],p[g])){a.set(i),this.stylesheet.fog=i;const v=this._setTransitionParameters({duration:0});a.updateTransitions(v);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:s.exported.now(),transition:s.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(p=>this.isLayerDraped(this._layers[p])),a=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...a)}_createTerrain(i,a){const p=this.terrain=new Ni(i,a);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const g=this._setTransitionParameters({duration:0});p.updateTransitions(g)}_force3DLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="symbol"&&this._updateLayer(a)}}_validate(i,a,p,g,v={}){return(!v||v.validate!==!1)&&Jr(this,i.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:p,styleSpec:s.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const a=this._getSourceCaches(i);for(const p of a)p.clearTiles()}_reloadSource(i){const a=this._getSourceCaches(i);for(const p of a)p.resume(),p.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const a in this._sourceCaches)this._sourceCaches[a].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const a=this._sourceCaches[i];a.resume(),a.reload()}}_updatePlacement(i,a,p,g,v=!1){let A=!1,S=!1;const I={};for(const k of this._order){const P=this._layers[k];if(P.type!=="symbol")continue;if(!I[P.source]){const j=this._getLayerSourceCache(P);if(!j)continue;I[P.source]=j.getRenderableIds(!0).map(J=>j.getTileByID(J)).sort((J,K)=>K.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(K.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(P,I[P.source],i.center.lng,i.projection);A=A||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),i.zoom))&&(this.pauseablePlacement=new Yf(i,this._order,v,a,p,g,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),S=!0),A&&this.pauseablePlacement.placement.setStale()),S||A)for(const k of this._order){const P=this._layers[k];P.type==="symbol"&&this.placement.updateLayerOpacities(P,I[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,a,p){this.imageManager.getImages(a.icons,p),this._updateTilesForChangedImages();const g=v=>{v&&v.setDependencies(a.tileID.key,a.type,a.icons)};g(this._otherSourceCaches[a.source]),g(this._symbolSourceCaches[a.source])}getGlyphs(i,a,p){this.glyphManager.getGlyphs(a.stacks,p)}getResource(i,a,p){return s.makeRequest(a,p)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const a=[];return this._otherSourceCaches[i]&&a.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&a.push(this._symbolSourceCaches[i]),a}_isSourceCacheLoaded(i){const a=this._getSourceCaches(i);return a.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):a.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}vo.getSourceType=function(c){return Ee[c]},vo.setSourceType=function(c,i){Ee[c]=i},vo.registerForPluginStateChange=s.registerForPluginStateChange;var oc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,ur="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ph=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,sc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Lh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let ac={},lc={};const ea=[];xo(oc,ea),xo(Ph,ea),xo(sc,ea),xo(Lh,ea),ac=dn("",Ph),lc=dn(Lh,sc);const cr=dn(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Fh=oc,hr=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Rh={background:dn(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:dn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:dn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:dn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:dn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:dn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:dn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:dn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:dn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:dn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:dn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:dn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:dn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:dn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:dn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:dn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:dn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:dn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:dn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:dn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:dn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:dn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:dn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:dn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ur),skyboxGradient:dn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ur),skyboxCapture:dn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:dn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:dn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function xo(c,i){const a=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of a)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=p.split(" ");for(const v of g)i.includes(v)||i.push(v)}}function dn(c,i){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),g={},v=[...ea];return xo(c,v),xo(i,v),{fragmentSource:c=c.replace(a,(A,S,I,k,P)=>(g[P]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${P}
varying ${I} ${k} ${P};
#else
uniform ${I} ${k} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${I} ${k} ${P} = u_${P};
#endif
`)),vertexSource:i=i.replace(a,(A,S,I,k,P)=>{const U=k==="float"?"vec2":"vec4",j=P.match(/color/)?"color":U;return g[P]?S==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
attribute ${I} ${U} a_${P};
varying ${I} ${k} ${P};
#else
uniform ${I} ${k} u_${P};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${I} ${k} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${j}(a_${P}, u_${P}_t);
#else
    ${I} ${k} ${P} = u_${P};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
attribute ${I} ${U} a_${P};
#else
uniform ${I} ${k} u_${P};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${I} ${k} ${P} = a_${P};
#else
    ${I} ${k} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${I} ${k} ${P} = unpack_mix_${j}(a_${P}, u_${P}_t);
#else
    ${I} ${k} ${P} = u_${P};
#endif
`}),staticAttributes:p,usedDefines:v}}class ta{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,a,p,g,v,A,S){this.context=i;let I=this.boundPaintVertexBuffers.length!==g.length;for(let P=0;!I&&P<g.length;P++)this.boundPaintVertexBuffers[P]!==g[P]&&(I=!0);let k=this.boundDynamicVertexBuffers.length!==S.length;for(let P=0;!k&&P<S.length;P++)this.boundDynamicVertexBuffers[P]!==S[P]&&(k=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==p||I||k||this.boundIndexBuffer!==v||this.boundVertexOffset!==A)this.freshBind(a,p,g,v,A,S);else{i.bindVertexArrayOES.set(this.vao);for(const P of S)P&&P.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(i,a,p,g,v,A){let S;const I=i.numAttributes,k=this.context,P=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=A;else{S=k.currentNumAttributes||0;for(let U=I;U<S;U++)P.disableVertexAttribArray(U)}a.enableAttributes(P,i),a.bind(),a.setVertexAttribPointers(P,i,v);for(const U of p)U.enableAttributes(P,i),U.bind(),U.setVertexAttribPointers(P,i,v);for(const U of A)U&&(U.enableAttributes(P,i),U.bind(),U.setVertexAttribPointers(P,i,v));g&&g.bind(),k.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Tl(c,i){const a=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new s.MercatorCoordinate(0,p/a).toLngLat().lat,new s.MercatorCoordinate(0,(p+1)/a).toLngLat().lat]}function Jn(c,i,a,p,g,v,A){const S=c.context,I=S.gl,k=a.fbo;if(!k)return;c.prepareDrawTile();const P=c.useProgram("hillshade");S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get());const U=((Q,Z,$,te)=>{const X=$.paint.get("hillshade-shadow-color"),le=$.paint.get("hillshade-highlight-color"),ue=$.paint.get("hillshade-accent-color");let oe=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=Q.transform.angle);const pe=!Q.options.moving;return{u_matrix:te||Q.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),pe),u_image:0,u_latrange:Tl(0,Z.tileID),u_light:[$.paint.get("hillshade-exaggeration"),oe],u_shadow:X,u_highlight:le,u_accent:ue}})(c,a,p,c.terrain?i.projMatrix:null);c.prepareDrawProgram(S,P,i.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:J,tileBoundsSegments:K}=c.getTileBoundsBuffers(a);P.draw(S,I.TRIANGLES,g,v,A,s.CullFaceMode.disabled,U,p.id,j,J,K)}function wo(c,i,a){if(!i.needsDEMTextureUpload)return;const p=c.context,g=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||c.getTileTexture(a.stride);const v=a.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new s.Texture(p,v,g.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function uc(c,i,a,p,g,v){const A=c.context,S=A.gl;if(!i.dem)return;const I=i.dem;if(A.activeTexture.set(S.TEXTURE1),wo(c,i,I),!i.demTexture)return;i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const k=I.dim;A.activeTexture.set(S.TEXTURE0);let P=i.fbo;if(!P){const K=new s.Texture(A,{width:k,height:k,data:null},S.RGBA);K.bind(S.LINEAR,S.CLAMP_TO_EDGE),P=i.fbo=A.createFramebuffer(k,k,!0),P.colorAttachment.set(K.texture)}A.bindFramebuffer.set(P.framebuffer),A.viewport.set([0,0,k,k]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:j,tileBoundsSegments:J}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(A,S.TRIANGLES,p,g,v,s.CullFaceMode.disabled,((K,Q)=>{const Z=Q.stride,$=s.create();return s.ortho($,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate($,$,[0,-s.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[Z,Z],u_zoom:K.overscaledZ,u_unpack:Q.unpackVector}})(i.tileID,I),a.id,U,j,J),i.needsHillshadePrepare=!1}const cc=c=>({u_matrix:new s.UniformMatrix4f(c),u_image0:new s.Uniform1i(c),u_skirt_height:new s.Uniform1f(c)}),xu=(c,i)=>({u_matrix:c,u_image0:0,u_skirt_height:i}),hc=(c,i,a,p,g,v,A,S,I,k,P,U,j,J)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:A,u_frustum_tr:S,u_frustum_br:I,u_frustum_bl:k,u_globe_pos:P,u_globe_radius:U,u_viewport:j,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9)});function wu(c,i){return c!=null&&i!=null&&!(!c.hasData()||!i.hasData())&&c.demTexture!=null&&i.demTexture!=null&&c.tileID.key!==i.tileID.key}const na=new class{constructor(){this.operations={}}newMorphing(c,i,a,p,g){if(c in this.operations){const v=this.operations[c];v.to.tileID.key!==a.tileID.key&&(v.queued=a)}else this.operations[c]={startTime:p,phase:0,duration:g,from:i,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const i=this.operations[c];return{from:i.from,to:i.to,phase:i.phase}}update(c){for(const i in this.operations){const a=this.operations[i];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[i];break}}}_nextOp(c,i){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=i,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Va={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function mn(c,i){const a=1<<c.z;return!i&&(c.x===0||c.x===a-1)||c.y===0||c.y===a-1}const bo=c=>({u_matrix:c});function Oh(c,i,a,p,g){if(g>0){const v=s.exported.now(),A=(v-c.timeAdded)/g,S=i?(v-i.timeAdded)/g:-1,I=a.getSource(),k=p.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),P=!i||Math.abs(i.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),U=P&&c.refreshedUponExpiration?1:s.clamp(P?A:1-S,0,1);return c.refreshedUponExpiration&&A>=1&&(c.refreshedUponExpiration=!1),i?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Uh extends s.SourceCache{constructor(i){const a={type:"raster-dem",maxzoom:i.transform.maxZoom},p=new br(Gt(),null),g=Ae("mock-dem",a,p,i.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,a){i.state="loaded",a(null)}}class Nh extends s.SourceCache{constructor(i){const a=Ae("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new br(Gt(),null),i.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,a,p){if(i.freezeTileCoverage)return;this.transform=i;const g=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,A)=>{if(v[A.key]="",!this._tiles[A.key]){const S=new s.Tile(A,this._source.tileSize*A.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[A.key]=S}return v},{});for(const v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){const a=this.proxyCachedFBO[i];if(a!==void 0){const p=Object.values(a);this.renderCachePool.push(...p),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sl extends s.OverscaledTileID{constructor(i,a,p){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=a,this.projMatrix=p}}class dc extends s.Elevation{constructor(i,a){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,g,v]=function(I){const k=new s.StructArrayLayout4i8,P=new s.StructArrayLayout3ui6,U=131;k.reserve(17161),P.reserve(33800);const j=s.EXTENT/128,J=s.EXTENT+j/2,K=J+j;for(let Z=-j;Z<K;Z+=j)for(let $=-j;$<K;$+=j){const te=$<0||$>J||Z<0||Z>J?24575:0,X=s.clamp(Math.round($),0,s.EXTENT),le=s.clamp(Math.round(Z),0,s.EXTENT);k.emplaceBack(X+te,le,X,le)}const Q=(Z,$)=>{const te=$*U+Z;P.emplaceBack(te+1,te,te+U),P.emplaceBack(te+U,te+U+1,te+1)};for(let Z=1;Z<129;Z++)for(let $=1;$<129;$++)Q($,Z);return[0,129].forEach(Z=>{for(let $=0;$<130;$++)Q($,Z),Q(Z,$)}),[k,P,32768]}(),A=i.context;this.gridBuffer=A.createVertexBuffer(p,s.boundsAttributes.members),this.gridIndexBuffer=A.createIndexBuffer(g),this.gridSegments=s.SegmentVector.simpleSegment(0,0,p.length,g.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nh(a.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const S=A.gl;this._overlapStencilMode=new s.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Uh(a.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,a,p){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const g=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(g.get("source")),this._exaggeration=g.get("exaggeration");const v=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const A=this.getScaledDemTileSize();this.sourceCache.update(a,A,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),a.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map(I=>{const k=a.getTileByID(I).tileID;return k.projMatrix=p.calculateProjMatrix(k.toUnwrapped()),k});(function(I,k){const P=k.transform.pointCoordinate(k.transform.getCameraPoint()),U=new s.pointGeometry(P.x,P.y);I.sort((j,J)=>{if(J.overscaledZ-j.overscaledZ)return J.overscaledZ-j.overscaledZ;const K=new s.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),Q=new s.pointGeometry(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),Z=U.mult(1<<j.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(K)-Z.distSqr(Q)})})(g,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},g.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const A=this._style._sourceCaches;for(const I in A){const k=A[I];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,i[I],v),k.usedForTerrain))continue;const P=i[I];k.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[a.id]=g.map(I=>new Sl(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const S={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const k=this.terrainTileForTile[I.key];if(!k)continue;const P=k.tileID.key;P in S||(this._visibleDemTiles.push(k),S[P]=P)}}_assignTerrainTiles(i){this._initializing||i.forEach(a=>{if(this.terrainTileForTile[a.key])return;const p=this._findTileCoveringTileID(a,this.sourceCache);p&&(this.terrainTileForTile[a.key]=p)})}_prepareDEMTextures(){const i=this.painter.context,a=i.gl;for(const p in this.terrainTileForTile){const g=this.terrainTileForTile[p],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(i.activeTexture.set(a.TEXTURE1),wo(this.painter,g,v))}}_prepareDemTileUniforms(i,a,p,g){if(!a||a.demTexture==null)return!1;const v=i.tileID.canonical,A=Math.pow(2,a.tileID.canonical.z-v.z),S=g||"";return p[`u_dem_tl${S}`]=[v.x*A%1,v.y*A%1],p[`u_dem_scale${S}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,a=i.gl;if(!this._emptyDepthBufferTexture){const p=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(i,p,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const a=this._visibleDemTiles.reduce((p,g)=>{if(!g.dem)return p;const v=g.dem.tree.minimums[0];return v>0&&i++,p+v},0);return i?a/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,a=i.gl;i.activeTexture.set(a.TEXTURE2);const p=this._getLoadedAreaMinimum(),g=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new s.Texture(i,g,a.RGBA,{premultiply:!1}),v}setupElevationDraw(i,a,p){const g=this.painter.context,v=g.gl,A=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;A.u_dem_size=this.sourceCache.getSource().tileSize,A.u_exaggeration=this.exaggeration();let I=null,k=null,P=1;if(p&&p.morphing&&this._useVertexMorphing){const U=p.morphing.srcDemTile,j=p.morphing.dstDemTile;P=p.morphing.phase,U&&j&&(this._prepareDemTileUniforms(i,U,A,"_prev")&&(k=U),this._prepareDemTileUniforms(i,j,A)&&(I=j))}if(k&&I?(g.activeTexture.set(v.TEXTURE2),I.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),g.activeTexture.set(v.TEXTURE4),k.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),A.u_dem_lerp=P):(I=this.terrainTileForTile[i.tileID.key],g.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(i,I,A)?I.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),g.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&I){const U=(1<<I.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=U}if(p&&p.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),a.setTerrainUniformValues(g,A),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,i.tileID.canonical,p&&p.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,U)}}globeUniformValues(i,a,p){const g=i.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,s.EXTENT,0),u_tile_br_up:g.upVector(a,s.EXTENT,s.EXTENT),u_tile_bl_up:g.upVector(a,0,s.EXTENT),u_tile_up_scale:p?s.GLOBE_METERS_TO_ECEF:g.upVectorScale(a,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const a=this.painter,p=this.painter.context;i.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,A,S,I){if(g.transform.projection.name==="globe")(function(k,P,U,j,J){const K=k.context,Q=K.gl;let Z,$;const te=k.options.showTerrainWireframe?2:0,X=k.transform,le=s.globeUseCustomAntiAliasing(k,K,X),ue=(Ie,ye)=>{if($===Ie)return;const dt=[Va[Ie],"PROJECTION_GLOBE_VIEW"];le&&dt.push("CUSTOM_ANTIALIASING"),ye&&dt.push(Va[te]),Z=k.useProgram("globeRaster",null,dt),$=Ie},oe=k.colorModeForRenderPass(),pe=new s.DepthMode(Q.LEQUAL,s.DepthMode.ReadWrite,k.depthRangeFor3D);na.update(J);const we=s.calculateGlobeMercatorMatrix(X),Re=[s.mercatorXfromLng(X.center.lng),s.mercatorYfromLat(X.center.lat)],De=te?[!1,!0]:[!1],Ye=k.globeSharedBuffers,xe=[X.width*s.exported.devicePixelRatio,X.height*s.exported.devicePixelRatio],qe=Float32Array.from(X.globeMatrix),He={useDenormalizedUpVectorScale:!0};if(De.forEach(Ie=>{$=-1;const ye=Ie?Q.LINES:Q.TRIANGLES;for(const dt of j){const ot=U.getTile(dt),lt=s.StencilMode.disabled,st=P.prevTerrainTileForTile[dt.key],Et=P.terrainTileForTile[dt.key];wu(st,Et)&&na.newMorphing(dt.key,st,Et,J,250),K.activeTexture.set(Q.TEXTURE0),ot.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const Ut=na.getMorphValuesForProxy(dt.key),Lt=Ut?1:0;Ut&&s.extend$1(He,{morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:s.easeCubicInOut(Ut.phase)}});const St=s.tileCornersToBounds(dt.canonical),at=s.getLatitudinalLod(St.getCenter().lat),Zt=s.getGridMatrix(dt.canonical,St,at,X.worldSize/X._pixelsPerMercatorPixel),Yt=s.globeNormalizeECEF(s.globeTileBounds(dt.canonical)),Dn=hc(X.projMatrix,qe,we,Yt,s.globeToMercatorTransition(X.zoom),Re,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,xe,Zt);if(ue(Lt,Ie),P.setupElevationDraw(ot,Z,He),k.prepareDrawProgram(K,Z,dt.toUnwrapped()),Ye){const[Ln,En,wi]=Ie?Ye.getWirefameBuffers(k.context,at):Ye.getGridBuffers(at);Z.draw(K,ye,pe,lt,oe,s.CullFaceMode.backCCW,Dn,"globe_raster",Ln,En,wi)}}}),Ye){const Ie=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];le&&Ie.push("CUSTOM_ANTIALIASING"),Z=k.useProgram("globeRaster",null,Ie);for(const ye of j){const{x:dt,y:ot,z:lt}=ye.canonical,st=ot===0,Et=ot===(1<<lt)-1,[Ut,Lt,St,at]=Ye.getPoleBuffers(lt);if(at&&(st||Et)){const Zt=U.getTile(ye);K.activeTexture.set(Q.TEXTURE0),Zt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Yt=s.globePoleMatrixForTile(lt,dt,X);const Dn=s.globeNormalizeECEF(s.globeTileBounds(ye.canonical)),Ln=(En,wi)=>En.draw(K,Q.TRIANGLES,pe,s.StencilMode.disabled,oe,s.CullFaceMode.disabled,hc(X.projMatrix,Yt,Yt,Dn,0,Re,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,xe),"globe_pole_raster",wi,St,at);P.setupElevationDraw(Zt,Z,He),k.prepareDrawProgram(K,Z,ye.toUnwrapped()),st&&Ln(Z,Ut),Et&&(Yt=s.scale(s.create(),Yt,[1,-1,1]),Ln(Z,Lt))}}}})(g,v,A,S,I);else{const k=g.context,P=k.gl;let U,j;const J=g.options.showTerrainWireframe?2:0,K=(X,le)=>{if(j===X)return;const ue=[Va[X]];le&&ue.push(Va[J]),U=g.useProgram("terrainRaster",null,ue),j=X},Q=g.colorModeForRenderPass(),Z=new s.DepthMode(P.LEQUAL,s.DepthMode.ReadWrite,g.depthRangeFor3D);na.update(I);const $=g.transform,te=6*Math.pow(1.5,22-$.zoom)*v.exaggeration();(J?[!1,!0]:[!1]).forEach(X=>{j=-1;const le=X?P.LINES:P.TRIANGLES,[ue,oe]=X?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const pe of S){const we=A.getTile(pe),Re=s.StencilMode.disabled,De=v.prevTerrainTileForTile[pe.key],Ye=v.terrainTileForTile[pe.key];wu(De,Ye)&&na.newMorphing(pe.key,De,Ye,I,250),k.activeTexture.set(P.TEXTURE0),we.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const xe=na.getMorphValuesForProxy(pe.key),qe=xe?1:0;let He;xe&&(He={morphing:{srcDemTile:xe.from,dstDemTile:xe.to,phase:s.easeCubicInOut(xe.phase)}});const Ie=xu(pe.projMatrix,mn(pe.canonical,$.renderWorldCopies)?te/10:te);K(qe,X),v.setupElevationDraw(we,U,He),g.prepareDrawProgram(k,U,pe.toUnwrapped()),U.draw(k,le,Z,Re,Q,s.CullFaceMode.backCCW,Ie,"terrain_raster",v.gridBuffer,ue,oe)}})}}(a,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const a=this.painter,p=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],A=this._drapedRenderBatches.shift(),S=[],I=a.style.order;let k=0;for(const P of v){const U=g.getTileByID(P.proxyTileKey),j=g.proxyCachedFBO[P.key]?g.proxyCachedFBO[P.key][i]:void 0,J=j!==void 0?g.renderCache[j]:this.pool[k++],K=j!==void 0;if(U.texture=J.tex,K&&!J.dirty){S.push(U.tileID);continue}let Q;p.bindFramebuffer.set(J.fb.framebuffer),this.renderedToTile=!1,J.dirty&&(p.clear({color:s.Color.transparent,stencil:0}),J.dirty=!1);for(let Z=A.start;Z<=A.end;++Z){const $=a.style._layers[I[Z]];if($.isHidden(a.transform.zoom))continue;const te=a.style._getLayerSourceCache($),X=te?this.proxyToSource[P.key][te.id]:[P];if(!X)continue;const le=X;p.viewport.set([0,0,J.fb.width,J.fb.height]),Q!==(te?te.id:null)&&(this._setupStencil(J,X,$,te),Q=te?te.id:null),a.renderLayer(a,te,$,le)}this.renderedToTile?(J.dirty=!0,S.push(U.tileID)):K||--k,k===5&&(k=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),A.end+1}postRender(){}renderCacheEfficiency(i){const a=i.order.length;if(a===0)return{efficiency:100};let p,g=0,v=0,A=!1;for(let S=0;S<a;++S){const I=i._layers[i.order[S]];this._style.isLayerDraped(I)?(A&&++g,++v):A||(A=!0,p=I.id)}return v===0?{efficiency:100}:{efficiency:100*(1-g/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{i=Math.min(i,a.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,a,p){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const A=v.tileID,S=1<<A.overscaledZ,{x:I,y:k}=A.canonical,P=I/S,U=(I+1)/S,j=k/S,J=(k+1)/S;return{minx:P,miny:j,maxx:U,maxy:J,t:v.dem.tree.raycastRoot(P,j,U,J,i,a,p),tile:v}});g.sort((v,A)=>(v.t!==null?v.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const v of g){if(v.t==null)return null;const A=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,a,p);if(A!=null)return A}return null}_createFBO(){const i=this.painter.context,a=i.gl,p=this.drapeBufferSize;i.activeTexture.set(a.TEXTURE0);const g=new s.Texture(i,{width:p[0],height:p[1],data:null},a.RGBA);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const v=i.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(g.texture),v.depthAttachment=new Fa(i,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const a=this._style._layers[i],p=a.isHidden(this.painter.transform.zoom),g=a.getCrossfadeParameters(),v=!!g&&g.t!==1,A=a.hasTransition();return a.type!=="custom"&&!p&&(v||A)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof V){i=!0;break}if(i)for(let a=0;a<this._style.order.length;++a){const p=this._style._layers[this._style.order[a]],g=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if(p.type!=="raster"||g||!v)continue;const A=p.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const I=this.proxyToSource[S.key][v.id];if(I)for(const k of I){const P=Oh(v.getTile(k),v.findLoadedParent(k,0),v,this.painter.transform,A);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(v.id,k)}}}}_setupDrapedRenderBatches(){const i=this._style.order,a=i.length;if(a===0)return;const p=[];let g,v=0,A=this._style._layers[i[v]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++v<a;)A=this._style._layers[i[v]];for(;v<a;++v){const S=this._style._layers[i[v]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?g===void 0&&(g=v):g!==void 0&&(p.push({start:g,end:v-1}),g=void 0))}g!==void 0&&p.push({start:g,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(i){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const A=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let S=0;S<A.length;++S){const I=Object.values(A[S]);a.renderCachePool.push(...I)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,g=this._tilesDirty;for(let A=p.length-1;A>=0;A--){const S=p[A];if(a.getTileByID(S.key),a.proxyCachedFBO[S.key]!==void 0){const I=i[S.key],k=this.proxyToSource[S.key];let P=0;for(const U in k){const j=k[U],J=I[U];if(!J||J.length!==j.length||j.some((K,Q)=>K!==J[Q]||g[U]&&g[U].hasOwnProperty(K.key))){P=-1;break}++P}for(const U in a.proxyCachedFBO[S.key])a.renderCache[a.proxyCachedFBO[S.key][U]].dirty=P<0||P!==Object.values(I).length}}const v=[...this._drapedRenderBatches];v.sort((A,S)=>S.end-S.start-(A.end-A.start));for(const A of v)for(const S of p){if(a.proxyCachedFBO[S.key])continue;let I=a.renderCachePool.pop();I===void 0&&a.renderCache.length<50&&(I=a.renderCache.length,a.renderCache.push(this._createFBO())),I!==void 0&&(a.proxyCachedFBO[S.key]={},a.proxyCachedFBO[S.key][A.start]=I,a.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(i,a,p,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,A=v.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let S;if(p.isTileClipped())S=a.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(i,a){const p=this.painter,g=this.painter.context,v=g.gl;p._tileClippingMaskIDs={},g.setColorMode(s.ColorMode.disabled),g.setDepthMode(s.DepthMode.disabled);const A=p.useProgram("clippingMask");for(const S of i){const I=p._tileClippingMaskIDs[S.key]=--a;A.draw(g,v.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:v.ALWAYS,mask:0},I,255,v.KEEP,v.KEEP,v.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,bo(S.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(i){const a=this.painter.transform;if(i.x<0||i.x>a.width||i.y<0||i.y>a.height)return null;const p=[i.x,i.y,1,1];s.transformMat4$1(p,p,a.pixelMatrixInverse),s.scale$1(p,p,1/p[3]),p[0]/=a.worldSize,p[1]/=a.worldSize;const g=a._camera.position,v=s.mercatorZfromAltitude(1,a.center.lat),A=[g[0],g[1],g[2]/v,0],S=s.subtract([],p.slice(0,3),A);s.normalize(S,S);const I=this.raycast(A,S,this._exaggeration);return I!==null&&I?(s.scaleAndAdd(A,A,S,I),A[3]=A[2],A[2]*=v,A):null}drawDepth(){const i=this.painter,a=i.context,p=this.proxySourceCache,g=Math.ceil(i.width),v=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=a.gl,S=a.createFramebuffer(g,v,!0);a.activeTexture.set(A.TEXTURE0);const I=new s.Texture(a,{width:g,height:v,data:null},A.RGBA);I.bind(A.NEAREST,A.CLAMP_TO_EDGE),S.colorAttachment.set(I.texture);const k=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,g,v);S.depthAttachment.set(k),this._depthFBO=S,this._depthTexture=I}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,g,v]),function(A,S,I,k){if(A.transform.projection.name==="globe")return;const P=A.context,U=P.gl;P.clear({depth:1});const j=A.useProgram("terrainDepth"),J=new s.DepthMode(U.LESS,s.DepthMode.ReadWrite,A.depthRangeFor3D);for(const K of k){const Q=I.getTile(K),Z=xu(K.projMatrix,0);S.setupElevationDraw(Q,j),j.draw(P,U.TRIANGLES,J,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,Z,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,a,p){if(i.getSource()instanceof fe)return this._setupProxiedCoordsForImageSource(i,a,p);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const g=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let S=0;S<v.length;S++){const I=v[S],k=this._findTileCoveringTileID(I,i);if(k){const P=this._createProxiedId(I,k,p[I.key]&&p[I.key][i.id]);g.push(P),this.proxyToSource[I.key][i.id]=[P]}}let A=!1;for(let S=0;S<a.length;S++){const I=i.getTile(a[S]);if(!I||!I.hasData())continue;const k=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==I.tileID.canonical.z){const P=this.proxyToSource[k.tileID.key][i.id],U=this._createProxiedId(k.tileID,I,p[k.tileID.key]&&p[k.tileID.key][i.id]);P?P.splice(P.length-1,0,U):this.proxyToSource[k.tileID.key][i.id]=[U],g.push(U),A=!0}}this._sourceTilesOverlap[i.id]=A}_setupProxiedCoordsForImageSource(i,a,p){if(!i.getSource().loaded())return;const g=this.proxiedCoords[i.id]=[],v=this.proxyCoords,A=i.getSource(),S=new s.pointGeometry(A.tileID.x,A.tileID.y)._div(1<<A.tileID.z),I=A.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((P,U)=>(P.min.x=Math.min(P.min.x,U.x-S.x),P.min.y=Math.min(P.min.y,U.y-S.y),P.max.x=Math.max(P.max.x,U.x-S.x),P.max.y=Math.max(P.max.y,U.y-S.y),P),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(P,U)=>{const j=P.wrap+P.canonical.x/(1<<P.canonical.z),J=P.canonical.y/(1<<P.canonical.z),K=s.EXTENT/(1<<P.canonical.z),Q=U.wrap+U.canonical.x/(1<<U.canonical.z),Z=U.canonical.y/(1<<U.canonical.z);return j+K<Q+I.min.x||j>Q+I.max.x||J+K<Z+I.min.y||J>Z+I.max.y};for(let P=0;P<v.length;P++){const U=v[P];for(let j=0;j<a.length;j++){const J=i.getTile(a[j]);if(!J||!J.hasData()||k(U,J.tileID))continue;const K=this._createProxiedId(U,J,p[U.key]&&p[U.key][i.id]),Q=this.proxyToSource[U.key][i.id];Q?Q.push(K):this.proxyToSource[U.key][i.id]=[K],g.push(K)}}}_createProxiedId(i,a,p){let g=this.orthoMatrix;if(p){const v=p.find(A=>A.key===a.tileID.key);if(v)return v}if(a.tileID.key!==i.key){const v=i.canonical.z-a.tileID.canonical.z;let A,S,I;g=s.create();const k=a.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(A=s.EXTENT>>v,S=A*((a.tileID.canonical.x<<v)-i.canonical.x+k),I=A*((a.tileID.canonical.y<<v)-i.canonical.y)):(A=s.EXTENT<<-v,S=s.EXTENT*(a.tileID.canonical.x-(i.canonical.x+k<<-v)),I=s.EXTENT*(a.tileID.canonical.y-(i.canonical.y<<-v))),s.ortho(g,0,A,0,A,0,1),s.translate(g,g,[S,I,0])}return new Sl(a.tileID,i.key,g)}_findTileCoveringTileID(i,a){let p=a.getTile(i);if(p&&p.hasData())return p;const g=this._findCoveringTileCache[a.id],v=g[i.key];if(p=v?a.getTileByID(v):null,p&&p.hasData()||v===null)return p;let A=p?p.tileID:i,S=A.overscaledZ;const I=a.getSource().minzoom,k=[];if(!v){const U=a.getSource().maxzoom;if(i.canonical.z>=U){const j=i.canonical.z-U;a.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,a.transform.tileZoom),A=new s.OverscaledTileID(S,i.wrap,U,i.canonical.x>>j,i.canonical.y>>j)):j!==0&&(S=U,A=new s.OverscaledTileID(S,i.wrap,U,i.canonical.x>>j,i.canonical.y>>j))}A.key!==i.key&&(k.push(A.key),p=a.getTile(A))}const P=U=>{k.forEach(j=>{g[j]=U}),k.length=0};for(S-=1;S>=I&&(!p||!p.hasData());S--){p&&P(p.tileID.key);const U=A.calculateScaledKey(S);if(p=a.getTileByID(U),p&&p.hasData())break;const j=g[U];if(j===null)break;j===void 0?k.push(U):p=a.getTileByID(j)}return P(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,a){let p=this._tilesDirty[i];p||(p=this._tilesDirty[i]={}),p[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(a){let p=0;const g=new s.StructArrayLayout2ui4,v=131;for(let A=1;A<129;A++){for(let S=1;S<129;S++)p=A*v+S,g.emplaceBack(p,p+1),g.emplaceBack(p,p+v),g.emplaceBack(p+1,p+v),A===128&&g.emplaceBack(p+v,p+v+1);g.emplaceBack(p+1,p+1+v)}return g}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Gh{static cacheKey(i,a,p,g){let v=`${a}${g?g.cacheKey:""}`;for(const A of p)i.usedDefines.includes(A)&&(v+=`/${A}`);return v}constructor(i,a,p,g,v,A){const S=i.gl;this.program=S.createProgram();const I=function(Z){const $=[];for(let te=0;te<Z.length;te++){if(Z[te]===null)continue;const X=Z[te].split(" ");$.push(X.pop())}return $}(p.staticAttributes),k=g?g.getBinderAttributes():[],P=I.concat(k);let U=g?g.defines():[];U=U.concat(A.map(Z=>`#define ${Z}`));const j=U.concat(i.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(hr):hr,hr,Fh,cr.fragmentSource,lc.fragmentSource,p.fragmentSource).join(`
`),J=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Fh,cr.vertexSource,lc.vertexSource,ac.vertexSource,p.vertexSource).join(`
`),K=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(K,j),S.compileShader(K),S.attachShader(this.program,K);const Q=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Q,J),S.compileShader(Q),S.attachShader(this.program,Q),this.attributes={},this.numAttributes=P.length;for(let Z=0;Z<this.numAttributes;Z++)P[Z]&&(S.bindAttribLocation(this.program,Z,P[Z]),this.attributes[P[Z]]=Z);S.linkProgram(this.program),S.deleteShader(Q),S.deleteShader(K),this.fixedUniforms=v(i),this.binderUniforms=g?g.getUniforms(i):[],A.includes("TERRAIN")&&(this.terrainUniforms=(Z=>({u_dem:new s.Uniform1i(Z),u_dem_prev:new s.Uniform1i(Z),u_dem_unpack:new s.Uniform4f(Z),u_dem_tl:new s.Uniform2f(Z),u_dem_scale:new s.Uniform1f(Z),u_dem_tl_prev:new s.Uniform2f(Z),u_dem_scale_prev:new s.Uniform1f(Z),u_dem_size:new s.Uniform1f(Z),u_dem_lerp:new s.Uniform1f(Z),u_exaggeration:new s.Uniform1f(Z),u_depth:new s.Uniform1i(Z),u_depth_size_inv:new s.Uniform2f(Z),u_meter_to_dem:new s.Uniform1f(Z),u_label_plane_matrix_inv:new s.UniformMatrix4f(Z)}))(i)),A.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new s.Uniform3f(Z),u_tile_tr_up:new s.Uniform3f(Z),u_tile_br_up:new s.Uniform3f(Z),u_tile_bl_up:new s.Uniform3f(Z),u_tile_up_scale:new s.Uniform1f(Z)}))(i)),A.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new s.UniformMatrix4f(Z),u_fog_range:new s.Uniform2f(Z),u_fog_color:new s.Uniform4f(Z),u_fog_horizon_blend:new s.Uniform1f(Z),u_fog_temporal_offset:new s.Uniform1f(Z),u_frustum_tl:new s.Uniform3f(Z),u_frustum_tr:new s.Uniform3f(Z),u_frustum_br:new s.Uniform3f(Z),u_frustum_bl:new s.Uniform3f(Z),u_globe_pos:new s.Uniform3f(Z),u_globe_radius:new s.Uniform1f(Z),u_globe_transition:new s.Uniform1f(Z),u_is_globe:new s.Uniform1i(Z),u_viewport:new s.Uniform2f(Z)}))(i))}}setTerrainUniformValues(i,a){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in a)p[g]&&p[g].set(this.program,g,a[g])}}setGlobeUniformValues(i,a){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in a)p[g]&&p[g].set(this.program,g,a[g])}}setFogUniformValues(i,a){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in a)p[g].set(this.program,g,a[g])}}draw(i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q){const Z=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(p),i.setStencilMode(g),i.setColorMode(v),i.setCullFace(A);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,S[te]);K&&K.setUniforms(this.program,i,this.binderUniforms,j,{zoom:J});const $={[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[a];for(const te of U.get()){const X=te.vaos||(te.vaos={});(X[I]||(X[I]=new ta)).bind(i,this,k,K?K.getPaintVertexBuffers():[],P,te.vertexOffset,Q||[]),Z.drawElements(a,te.primitiveLength*$,Z.UNSIGNED_SHORT,te.primitiveOffset*$*2)}}}function Qd(c,i,a){const p=1/Fi(a,1,i.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,i.transform.tileZoom)/g,A=v*(a.tileID.canonical.x+a.tileID.wrap*g),S=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[p,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[A>>16,S>>16],u_pixel_coord_lower:[65535&A,65535&S]}}const bu=s.create(),Il=(c,i,a,p,g,v,A,S,I,k,P)=>{const U=i.style.light,j=U.properties.get("position"),J=[j.x,j.y,j.z],K=s.create$1();U.properties.get("anchor")==="viewport"&&(s.fromRotation(K,-i.transform.angle),s.transformMat3(J,J,K));const Q=U.properties.get("color"),Z=i.transform,$={u_matrix:c,u_lightpos:J,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+a,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:v};return Z.projection.name==="globe"&&($.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],$.u_zoom_transition=I,$.u_inv_rot_matrix=P,$.u_merc_center=k,$.u_up_dir=Z.projection.upVector(new s.CanonicalTileID(0,0,0),k[0]*s.EXTENT,k[1]*s.EXTENT),$.u_height_lift=S),$},Vh=(c,i,a,p,g,v,A,S,I,k,P,U,j)=>{const J=Il(c,i,a,p,g,v,A,k,P,U,j),K={u_height_factor:-Math.pow(2,A.overscaledZ)/I.tileSize/8};return s.extend(J,Qd(S,i,I),K)},Au=c=>({u_matrix:c}),dr=(c,i,a,p)=>s.extend(Au(c),Qd(a,i,p)),pc=(c,i)=>({u_matrix:c,u_world:i}),Eu=(c,i,a,p,g)=>s.extend(dr(c,i,a,p),{u_world:g}),Ml=s.create(),Bl=(c,i,a,p,g,v)=>{const A=c.transform,S=A.projection.name==="globe";let I;if(v.paint.get("circle-pitch-alignment")==="map")if(S){const P=s.globePixelsToTileUnits(A.zoom,i.canonical)*A._pixelsPerMercatorPixel;I=Float32Array.from([P,0,0,P])}else I=A.calculatePixelsToTileUnitsMatrix(a);else I=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:A.cameraToCenterDistance,u_matrix:c.translatePosMatrix(i.projMatrix,a,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:Ml,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){k.u_inv_rot_matrix=p,k.u_merc_center=g,k.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(A.zoom);const P=g[0]*s.EXTENT,U=g[1]*s.EXTENT;k.u_up_dir=A.projection.upVector(new s.CanonicalTileID(0,0,0),P,U)}return k},ep=c=>{const i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},fc=(c,i,a,p)=>{const g=s.EXTENT/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:i.getCameraToCenterDistance(p),u_extrude_scale:[i.pixelsToGLUnits[0]/g,i.pixelsToGLUnits[1]/g]}},mc=(c,i,a=1)=>({u_matrix:c,u_color:i,u_overlay:0,u_overlay_scale:a}),Zo=s.create(),jh=(c,i,a,p,g,v,A)=>{const S=c.transform,I=S.projection.name==="globe",k=I?s.globePixelsToTileUnits(S.zoom,i.canonical)*S._pixelsPerMercatorPixel:Fi(a,1,v),P={u_matrix:i.projMatrix,u_extrude_scale:k,u_intensity:A,u_inv_rot_matrix:Zo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){P.u_inv_rot_matrix=p,P.u_merc_center=g,P.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],P.u_zoom_transition=s.globeToMercatorTransition(S.zoom);const U=g[0]*s.EXTENT,j=g[1]*s.EXTENT;P.u_up_dir=S.projection.upVector(new s.CanonicalTileID(0,0,0),U,j)}return P},ja=(c,i,a,p,g,v,A,S)=>{const I=c.transform,k=I.calculatePixelsToTileUnitsMatrix(i),P={u_matrix:Dl(c,i,a,g),u_pixels_to_tile_units:k,u_device_pixel_ratio:A,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:S};if($h(a)){const U=Hh(i,c.transform);P.u_texsize=i.lineAtlasTexture.size,P.u_scale=[U,p.fromScale,p.toScale],P.u_mix=p.t}return P},qh=(c,i,a,p,g,v)=>{const A=c.transform,S=Hh(i,A);return{u_matrix:Dl(c,i,a,g),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:v,u_image:0,u_scale:[S,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Hh(c,i){return 1/Fi(c,1,i.tileZoom)}function Dl(c,i,a,p){return c.translatePosMatrix(p||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function $h(c){const i=c.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const Wo=(c,i,a,p,g,v)=>{return{u_matrix:c,u_tl_parent:i,u_scale_parent:a,u_fade_t:p.mix,u_opacity:p.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(S=g.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(A=g.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:_c(g.paint.get("raster-hue-rotate")),u_perspective_transform:v};var A,S};function _c(c){c*=Math.PI/180;const i=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}const Cu=s.create(),tp=(c,i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q)=>{const Z=g.transform,$={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:Z.width/Z.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:A,u_coord_matrix:S,u_is_text:+I,u_pitch_with_map:+p,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Cu,u_up_vector:[0,-1,0]};return Q.name==="globe"&&($.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],$.u_zoom_transition=U,$.u_inv_rot_matrix=J,$.u_merc_center=j,$.u_camera_forward=Z._camera.forward(),$.u_ecef_origin=s.globeECEFOrigin(Z.globeMatrix,P.toUnwrapped()),$.u_tile_matrix=Float32Array.from(Z.globeMatrix),$.u_up_vector=K),$},gc=(c,i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q,Z)=>s.extend(tp(c,i,a,p,g,v,A,S,I,k,U,j,J,K,Q,Z),{u_gamma_scale:p?g.transform.cameraToCenterDistance*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+P}),kl=(c,i,a,p,g,v,A,S,I,k,P,U,j,J,K,Q)=>s.extend(gc(c,i,a,p,g,v,A,S,!0,I,!0,P,U,j,J,K,Q),{u_texsize_icon:k,u_texture_icon:1}),Lr=(c,i,a)=>({u_matrix:c,u_opacity:i,u_color:a}),np=(c,i,a,p,g,v)=>s.extend(function(A,S,I,k){const P=I.imageManager.getPattern(A.from.toString()),U=I.imageManager.getPattern(A.to.toString()),{width:j,height:J}=I.imageManager.getPixelSize(),K=Math.pow(2,k.tileID.overscaledZ),Q=k.tileSize*Math.pow(2,I.transform.tileZoom)/K,Z=Q*(k.tileID.canonical.x+k.tileID.wrap*K),$=Q*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[j,J],u_mix:S.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Fi(k,1,I.transform.tileZoom),u_pixel_coord_upper:[Z>>16,$>>16],u_pixel_coord_lower:[65535&Z,65535&$]}}(p,v,a,g),{u_matrix:c,u_opacity:i}),yc={fillExtrusion:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_height_factor:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c)}),fill:c=>({u_matrix:new s.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),fillOutline:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),collisionBox:c=>({u_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new s.UniformMatrix4f(c),u_inv_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_viewport_size:new s.Uniform2f(c)}),debug:c=>({u_color:new s.UniformColor(c),u_matrix:new s.UniformMatrix4f(c),u_overlay:new s.Uniform1i(c),u_overlay_scale:new s.Uniform1f(c)}),clippingMask:c=>({u_matrix:new s.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new s.Uniform1f(c),u_intensity:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),heatmapTexture:c=>({u_image:new s.Uniform1i(c),u_color_ramp:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c)}),hillshade:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_latrange:new s.Uniform2f(c),u_light:new s.Uniform2f(c),u_shadow:new s.UniformColor(c),u_highlight:new s.UniformColor(c),u_accent:new s.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_dimension:new s.Uniform2f(c),u_zoom:new s.Uniform1f(c),u_unpack:new s.Uniform4f(c)}),line:c=>({u_matrix:new s.UniformMatrix4f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_units_to_pixels:new s.Uniform2f(c),u_dash_image:new s.Uniform1i(c),u_gradient_image:new s.Uniform1i(c),u_image_height:new s.Uniform1f(c),u_texsize:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_mix:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c),u_trim_offset:new s.Uniform2f(c)}),linePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_texsize:new s.Uniform2f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_units_to_pixels:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c)}),raster:c=>({u_matrix:new s.UniformMatrix4f(c),u_tl_parent:new s.Uniform2f(c),u_scale_parent:new s.Uniform1f(c),u_fade_t:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_image0:new s.Uniform1i(c),u_image1:new s.Uniform1i(c),u_brightness_low:new s.Uniform1f(c),u_brightness_high:new s.Uniform1f(c),u_saturation_factor:new s.Uniform1f(c),u_contrast_factor:new s.Uniform1f(c),u_spin_weights:new s.Uniform3f(c),u_perspective_transform:new s.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_texture:new s.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_is_halo:new s.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texsize_icon:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_texture_icon:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_is_halo:new s.Uniform1i(c)}),background:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_color:new s.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_pattern_tl_a:new s.Uniform2f(c),u_pattern_br_a:new s.Uniform2f(c),u_pattern_tl_b:new s.Uniform2f(c),u_pattern_br_b:new s.Uniform2f(c),u_texsize:new s.Uniform2f(c),u_mix:new s.Uniform1f(c),u_pattern_size_a:new s.Uniform2f(c),u_pattern_size_b:new s.Uniform2f(c),u_scale_a:new s.Uniform1f(c),u_scale_b:new s.Uniform1f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_tile_units_to_pixels:new s.Uniform1f(c)}),terrainRaster:cc,terrainDepth:cc,skybox:c=>({u_matrix:new s.UniformMatrix4f(c),u_sun_direction:new s.Uniform3f(c),u_cubemap:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new s.UniformMatrix4f(c),u_color_ramp:new s.Uniform1i(c),u_center_direction:new s.Uniform3f(c),u_radius:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new s.UniformMatrix3f(c),u_sun_direction:new s.Uniform3f(c),u_sun_intensity:new s.Uniform1f(c),u_color_tint_r:new s.Uniform4f(c),u_color_tint_m:new s.Uniform4f(c),u_luminance:new s.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new s.UniformMatrix4f(c),u_globe_matrix:new s.UniformMatrix4f(c),u_normalize_matrix:new s.UniformMatrix4f(c),u_merc_matrix:new s.UniformMatrix4f(c),u_zoom_transition:new s.Uniform1f(c),u_merc_center:new s.Uniform2f(c),u_image0:new s.Uniform1i(c),u_grid_matrix:new s.UniformMatrix3f(c),u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_globe_pos:new s.Uniform3f(c),u_globe_radius:new s.Uniform1f(c),u_viewport:new s.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_horizon:new s.Uniform1f(c),u_transition:new s.Uniform1f(c),u_fadeout_range:new s.Uniform1f(c),u_color:new s.Uniform4f(c),u_high_color:new s.Uniform4f(c),u_space_color:new s.Uniform4f(c),u_star_intensity:new s.Uniform1f(c),u_star_density:new s.Uniform1f(c),u_star_size:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c),u_horizon_angle:new s.Uniform1f(c),u_rotation_matrix:new s.UniformMatrix4f(c)})};let vc;function Zh(c,i,a,p,g,v,A){const S=c.context,I=S.gl,k=c.transform,P=c.useProgram("collisionBox"),U=[];let j=0,J=0;for(let le=0;le<p.length;le++){const ue=p[le],oe=i.getTile(ue),pe=oe.getBucket(a);if(!pe)continue;const we=fu(ue,pe,k);let Re=we;g[0]===0&&g[1]===0||(Re=c.translatePosMatrix(we,oe,g,v));const De=A?pe.textCollisionBox:pe.iconCollisionBox,Ye=pe.collisionCircleArray;if(Ye.length>0){const xe=s.create(),qe=Re;s.mul(xe,pe.placementInvProjMatrix,k.glCoordMatrix),s.mul(xe,xe,pe.placementViewportMatrix),U.push({circleArray:Ye,circleOffset:J,transform:qe,invTransform:xe,projection:pe.getProjection()}),j+=Ye.length/4,J=j}De&&(c.terrain&&c.terrain.setupElevationDraw(oe,P),P.draw(S,I.LINES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,fc(Re,k,oe,pe.getProjection()),a.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,null,k.zoom,null,[De.collisionVertexBuffer,De.collisionVertexBufferExt]))}if(!A||!U.length)return;const K=c.useProgram("collisionCircle"),Q=new s.StructArrayLayout2f1f2i16;Q.resize(4*j),Q._trim();let Z=0;for(const le of U)for(let ue=0;ue<le.circleArray.length/4;ue++){const oe=4*ue,pe=le.circleArray[oe+0],we=le.circleArray[oe+1],Re=le.circleArray[oe+2],De=le.circleArray[oe+3];Q.emplace(Z++,pe,we,Re,De,0),Q.emplace(Z++,pe,we,Re,De,1),Q.emplace(Z++,pe,we,Re,De,2),Q.emplace(Z++,pe,we,Re,De,3)}(!vc||vc.length<2*j)&&(vc=function(le){const ue=2*le,oe=new s.StructArrayLayout3ui6;oe.resize(ue),oe._trim();for(let pe=0;pe<ue;pe++){const we=6*pe;oe.uint16[we+0]=4*pe+0,oe.uint16[we+1]=4*pe+1,oe.uint16[we+2]=4*pe+2,oe.uint16[we+3]=4*pe+2,oe.uint16[we+4]=4*pe+3,oe.uint16[we+5]=4*pe+0}return oe}(j));const $=S.createIndexBuffer(vc,!0),te=S.createVertexBuffer(Q,s.collisionCircleLayout.members,!0);for(const le of U){const ue={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(X=k).getCameraToCenterDistance(le.projection),u_viewport_size:[X.width,X.height]};K.draw(S,I.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,ue,a.id,te,$,s.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,k.zoom)}var X;te.destroy(),$.destroy()}const Wh=s.create();function zl(c,i,a,p,g,v){const{horizontalAlign:A,verticalAlign:S}=s.getAnchorAlignment(c),I=-(A-.5)*i,k=-(S-.5)*a,P=s.evaluateVariableOffset(c,p);return new s.pointGeometry((I/g+P[0])*v,(k/g+P[1])*v)}function Pl(c,i,a,p,g,v,A,S,I,k,P){const U=c.text.placedSymbolArray,j=c.text.dynamicLayoutVertexArray,J=c.icon.dynamicLayoutVertexArray,K={},Q=mu(S,c.getProjection(),v),Z=v.elevation,$=c.getProjection().upVectorScale(S.canonical,v.center.lat,v.worldSize);j.clear();for(let te=0;te<U.length;te++){const X=U.get(te),le=c.allowVerticalPlacement&&!X.placedOrientation,ue=X.hidden||!X.crossTileID||le?null:p[X.crossTileID];if(ue){const oe=new s.pointGeometry(X.tileAnchorX,X.tileAnchorY),pe=c.getProjection().upVector(S.canonical,oe.x,oe.y),we=Z?Z.getAtTileOffset(S,oe.x,oe.y):0,Re=nn([X.projectedAnchorX+we*pe[0]*$.metersToTile,X.projectedAnchorY+we*pe[1]*$.metersToTile,X.projectedAnchorZ+we*pe[2]*$.metersToTile],a?Q:A),De=an(v.getCameraToCenterDistance(c.getProjection()),Re.signedDistanceFromCamera);let Ye=g.evaluateSizeForFeature(c.textSizeData,k,X)*De/s.ONE_EM;a&&(Ye*=c.tilePixelRatio/I);const{width:xe,height:qe,anchor:He,textOffset:Ie,textScale:ye}=ue,dt=zl(He,xe,qe,Ie,ye,Ye);let ot;if(a){const st=oe.add(dt),{x:Et,y:Ut,z:Lt}=c.getProjection().projectTilePoint(st.x,st.y,S.canonical);ot=nn([Et+we*pe[0]*$.metersToTile,Ut+we*pe[1]*$.metersToTile,Lt+we*pe[2]*$.metersToTile],A).point}else{const st=i?dt.rotate(-v.angle):dt;ot=[Re.point[0]+st.x,Re.point[1]+st.y,0]}const lt=c.allowVerticalPlacement&&X.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let st=0;st<X.numGlyphs;st++)s.addDynamicAttributes(j,ot[0],ot[1],ot[2],lt);P&&X.associatedIconIndex>=0&&(K[X.associatedIconIndex]={shiftedAnchor:ot,angle:lt})}else Xr(X.numGlyphs,j)}if(P){J.clear();const te=c.icon.placedSymbolArray;for(let X=0;X<te.length;X++){const le=te.get(X);if(le.hidden)Xr(le.numGlyphs,J);else{const ue=K[X];if(ue)for(let oe=0;oe<le.numGlyphs;oe++)s.addDynamicAttributes(J,ue.shiftedAnchor[0],ue.shiftedAnchor[1],ue.shiftedAnchor[2],ue.angle);else Xr(le.numGlyphs,J)}}c.icon.dynamicLayoutVertexBuffer.updateData(J)}c.text.dynamicLayoutVertexBuffer.updateData(j)}function Ce(c,i,a){return a.iconsInText&&i?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Ze(c,i,a,p,g,v,A,S,I,k,P,U){const j=c.context,J=j.gl,K=c.transform,Q=S==="map",Z=I==="map",$=Q&&a.layout.get("symbol-placement")!=="point",te=Q&&!Z&&!$,X=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let le=!1;const ue=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),oe=[s.mercatorXfromLng(K.center.lng),s.mercatorYfromLat(K.center.lat)],pe=a.layout.get("text-variable-anchor"),we=K.projection.name==="globe",Re=[],De=[0,-1,0];let Ye=De;!we&&!K.mercatorFromTransition||Q||(Ye=function(xe){const qe=xe._camera.getWorldToCamera(xe.worldSize,1),He=s.multiply([],qe,xe.globeMatrix);s.invert(He,He);const Ie=[0,0,0],ye=[0,1,0,0];return s.transformMat4$1(ye,ye,He),Ie[0]=ye[0],Ie[1]=ye[1],Ie[2]=ye[2],s.normalize(Ie,Ie),Ie}(K));for(const xe of p){const qe=i.getTile(xe),He=qe.getBucket(a);if(!He||He.projection.name==="mercator"&&we)continue;const Ie=g?He.text:He.icon;if(!Ie||He.fullyClipped||!Ie.segments.get().length)continue;const ye=Ie.programConfigurations.get(a.id),dt=g||He.sdfIcons,ot=g?He.textSizeData:He.iconSizeData,lt=Z||K.pitch!==0,st=s.evaluateSizeForZoom(ot,K.zoom);let Et,Ut,Lt,St,at=[0,0],Zt=null;if(g){if(Ut=qe.glyphAtlasTexture,Lt=J.LINEAR,Et=qe.glyphAtlasTexture.size,He.iconsInText){at=qe.imageAtlasTexture.size,Zt=qe.imageAtlasTexture;const Ht=ot.kind==="composite"||ot.kind==="camera";St=lt||c.options.rotating||c.options.zooming||Ht?J.LINEAR:J.NEAREST}}else{const Ht=a.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear;Ut=qe.imageAtlasTexture,Lt=dt||c.options.rotating||c.options.zooming||Ht||lt?J.LINEAR:J.NEAREST,Et=qe.imageAtlasTexture.size}const Yt=He.projection.name==="globe",Dn=Yt?Ye:De,Ln=Yt?s.globeToMercatorTransition(K.zoom):0,En=mu(xe,He.getProjection(),K),wi=K.calculatePixelsToTileUnitsMatrix(qe),Ji=xl(En,qe.tileID.canonical,Z,Q,K,He.getProjection(),wi),Co=c.terrain&&Z&&$?s.invert(s.create(),Ji):Wh,Fn=Ra(En,qe.tileID.canonical,Z,Q,K,He.getProjection(),wi),ti=pe&&He.hasTextData(),Cn=a.layout.get("icon-text-fit")!=="none"&&ti&&He.hasIconData();if($){const Ht=K.elevation,ns=Ht?Ht.getAtTileOffsetFunc(xe,K.center.lat,K.worldSize,He.getProjection()):fr=>[0,0,0],ca=Xd(En,qe.tileID.canonical,Z,Q,K,He.getProjection(),wi);Oa(He,En,c,g,ca,Fn,Z,k,ns,xe)}const ci=$||g&&pe||Cn,Yi=c.translatePosMatrix(En,qe,v,A),On=ci?Wh:Ji,Ir=c.translatePosMatrix(Fn,qe,v,A,!0),Bs=He.getProjection().createInversionMatrix(K,xe.canonical),to=[];c.terrainRenderModeElevated()&&Z&&to.push("PITCH_WITH_MAP_TERRAIN"),Yt&&to.push("PROJECTION_GLOBE_VIEW"),ci&&to.push("PROJECTED_POS_ON_VIEWPORT");const Hi=dt&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jl;jl=dt?He.iconsInText?kl(ot.kind,st,te,Z,c,Yi,On,Ir,Et,at,xe,Ln,oe,Bs,Dn,He.getProjection()):gc(ot.kind,st,te,Z,c,Yi,On,Ir,g,Et,!0,xe,Ln,oe,Bs,Dn,He.getProjection()):tp(ot.kind,st,te,Z,c,Yi,On,Ir,g,Et,xe,Ln,oe,Bs,Dn,He.getProjection());const ts={program:c.useProgram(Ce(dt,g,He),ye,to),buffers:Ie,uniformValues:jl,atlasTexture:Ut,atlasTextureIcon:Zt,atlasInterpolation:Lt,atlasInterpolationIcon:St,isSDF:dt,hasHalo:Hi,tile:qe,labelPlaneMatrixInv:Co};if(X&&He.canOverlap){le=!0;const Ht=Ie.segments.get();for(const ns of Ht)Re.push({segments:new s.SegmentVector([ns]),sortKey:ns.sortKey,state:ts})}else Re.push({segments:Ie.segments,sortKey:0,state:ts})}le&&Re.sort((xe,qe)=>xe.sortKey-qe.sortKey);for(const xe of Re){const qe=xe.state;if(c.terrain&&c.terrain.setupElevationDraw(qe.tile,qe.program,{useDepthForOcclusion:!we,labelPlaneMatrixInv:qe.labelPlaneMatrixInv}),j.activeTexture.set(J.TEXTURE0),qe.atlasTexture.bind(qe.atlasInterpolation,J.CLAMP_TO_EDGE),qe.atlasTextureIcon&&(j.activeTexture.set(J.TEXTURE1),qe.atlasTextureIcon&&qe.atlasTextureIcon.bind(qe.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),qe.isSDF){const He=qe.uniformValues;qe.hasHalo&&(He.u_is_halo=1,Ne(qe.buffers,xe.segments,a,c,qe.program,ue,P,U,He)),He.u_is_halo=0}Ne(qe.buffers,xe.segments,a,c,qe.program,ue,P,U,qe.uniformValues)}}function Ne(c,i,a,p,g,v,A,S,I){const k=p.context,P=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];g.draw(k,k.gl.TRIANGLES,v,A,S,s.CullFaceMode.disabled,I,a.id,c.layoutVertexBuffer,c.indexBuffer,i,a.paint,p.transform.zoom,c.programConfigurations.get(a.id),P)}function It(c,i,a,p,g,v,A){const S=c.context.gl,I=a.paint.get("fill-pattern"),k=I&&I.constantOr(1),P=a.getCrossfadeParameters();let U,j,J,K,Q;A?(j=k&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=S.LINES):(j=k?"fillPattern":"fill",U=S.TRIANGLES);for(const Z of p){const $=i.getTile(Z);if(k&&!$.patternsLoaded())continue;const te=$.getBucket(a);if(!te)continue;c.prepareDrawTile();const X=te.programConfigurations.get(a.id),le=c.useProgram(j,X);k&&(c.context.activeTexture.set(S.TEXTURE0),$.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),X.updatePaintBuffers(P));const ue=I.constantOr(null);if(ue&&$.imageAtlas){const pe=$.imageAtlas,we=pe.patternPositions[ue.to.toString()],Re=pe.patternPositions[ue.from.toString()];we&&Re&&X.setConstantPatternPositions(we,Re)}const oe=c.translatePosMatrix(Z.projMatrix,$,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(A){K=te.indexBuffer2,Q=te.segments2;const pe=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];J=j==="fillOutlinePattern"&&k?Eu(oe,c,P,$,pe):pc(oe,pe)}else K=te.indexBuffer,Q=te.segments,J=k?dr(oe,c,P,$):Au(oe);c.prepareDrawProgram(c.context,le,Z.toUnwrapped()),le.draw(c.context,U,g,c.stencilModeForClipping(Z),v,s.CullFaceMode.disabled,J,a.id,te.layoutVertexBuffer,K,Q,a.paint,c.transform.zoom,X)}}function on(c,i,a,p,g,v,A){const S=c.context,I=S.gl,k=c.transform,P=a.paint.get("fill-extrusion-pattern"),U=P.constantOr(1),j=a.getCrossfadeParameters(),J=a.paint.get("fill-extrusion-opacity"),K=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],Q=a.layout.get("fill-extrusion-edge-radius"),Z=k.projection.name==="globe"?s.fillExtrusionHeightLift():0,$=k.projection.name==="globe",te=$?s.globeToMercatorTransition(k.zoom):0,X=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],le=[];$&&(le.push("PROJECTION_GLOBE_VIEW"),c.style.terrainSetForDrapingOnly()&&le.push("TERRAIN")),K[0]>0&&le.push("FAUX_AO");for(const ue of p){const oe=i.getTile(ue),pe=oe.getBucket(a);if(!pe||pe.projection.name!==k.projection.name)continue;const we=pe.programConfigurations.get(a.id),Re=c.useProgram(U?"fillExtrusionPattern":"fillExtrusion",we,le);if(c.terrain){const ye=c.terrain;if(c.style.terrainSetForDrapingOnly())ye.setupElevationDraw(oe,Re,{useMeterToDem:!0});else{if(!pe.enableTerrain)continue;if(ye.setupElevationDraw(oe,Re,{useMeterToDem:!0}),Bn(S,i,ue,pe,a,ye),!pe.centroidVertexBuffer){const dt=Re.attributes.a_centroid_pos;dt!==void 0&&I.vertexAttrib2f(dt,0,0)}}}U&&(c.context.activeTexture.set(I.TEXTURE0),oe.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),we.updatePaintBuffers(j));const De=P.constantOr(null);if(De&&oe.imageAtlas){const ye=oe.imageAtlas,dt=ye.patternPositions[De.to.toString()],ot=ye.patternPositions[De.from.toString()];dt&&ot&&we.setConstantPatternPositions(dt,ot)}const Ye=c.translatePosMatrix(ue.projMatrix,oe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),xe=k.projection.createInversionMatrix(k,ue.canonical),qe=a.paint.get("fill-extrusion-vertical-gradient"),He=U?Vh(Ye,c,qe,J,K,Q,ue,j,oe,Z,te,X,xe):Il(Ye,c,qe,J,K,Q,ue,Z,te,X,xe);c.prepareDrawProgram(S,Re,ue.toUnwrapped());const Ie=[];c.terrain&&Ie.push(pe.centroidVertexBuffer),$&&Ie.push(pe.layoutVertexExtBuffer),Re.draw(S,S.gl.TRIANGLES,g,v,A,s.CullFaceMode.backCCW,He,a.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,a.paint,c.transform.zoom,we,Ie)}}function Bn(c,i,a,p,g,v){const A=[$=>{let te=$.canonical.x-1,X=$.wrap;return te<0&&(te=(1<<$.canonical.z)-1,X--),new s.OverscaledTileID($.overscaledZ,X,$.canonical.z,te,$.canonical.y)},$=>{let te=$.canonical.x+1,X=$.wrap;return te===1<<$.canonical.z&&(te=0,X++),new s.OverscaledTileID($.overscaledZ,X,$.canonical.z,te,$.canonical.y)},$=>new s.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,($.canonical.y===0?1<<$.canonical.z:$.canonical.y)-1),$=>new s.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y===(1<<$.canonical.z)-1?0:$.canonical.y+1)],S=$=>{const te=i.getSource().minzoom,X=ue=>{const oe=i.getTileByID(ue);if(oe&&oe.hasData())return oe.getBucket(g)},le=[0,-1,1];for(const ue of le){if($.overscaledZ+ue<te)continue;const oe=X($.calculateScaledKey($.overscaledZ+ue));if(oe)return oe}},I=[0,0,0],k=($,te)=>(I[0]=Math.min($.min.y,te.min.y),I[1]=Math.max($.max.y,te.max.y),I[2]=s.EXTENT-te.min.x>$.max.x?te.min.x-s.EXTENT:$.max.x,I),P=($,te)=>(I[0]=Math.min($.min.x,te.min.x),I[1]=Math.max($.max.x,te.max.x),I[2]=s.EXTENT-te.min.y>$.max.y?te.min.y-s.EXTENT:$.max.y,I),U=[($,te)=>k($,te),($,te)=>k(te,$),($,te)=>P($,te),($,te)=>P(te,$)],j=new s.pointGeometry(0,0);let J,K,Q;const Z=($,te,X,le,ue)=>{const oe=[[le?X:$,le?$:X,0],[le?X:te,le?te:X,0]],pe=ue<0?s.EXTENT+ue:ue,we=[le?pe:($+te)/2,le?($+te)/2:pe,0];return X===0&&ue<0||X!==0&&ue>0?v.getForTilePoints(Q,[we],!0,K):oe.push(we),v.getForTilePoints(a,oe,!0,J),Math.max(oe[0][2],oe[1][2],we[2])/v.exaggeration()};for(let $=0;$<4;$++){const te=($<2?1:5)-$,X=p.borders[$];if(X.length===0)continue;const le=Q=A[$](a),ue=S(le);if(!(ue&&ue instanceof s.FillExtrusionBucket&&ue.enableTerrain)||p.borderDoneWithNeighborZ[$]===ue.canonical.z&&ue.borderDoneWithNeighborZ[te]===p.canonical.z||(K=v.findDEMTileFor(le),!K||!K.dem))continue;if(!J){const Re=v.findDEMTileFor(a);if(!Re||!Re.dem)return;J=Re}const oe=ue.borders[te];let pe=0;const we=ue.borderDoneWithNeighborZ[te]!==p.canonical.z;if(p.canonical.z===ue.canonical.z){for(let Re=0;Re<X.length;Re++){const De=p.featuresOnBorder[X[Re]],Ye=De.borders[$];let xe;for(;pe<oe.length&&(xe=ue.featuresOnBorder[oe[pe]],!(xe.borders[te][1]>Ye[0]+3));)we&&ue.encodeCentroid(void 0,xe,!1),pe++;if(xe&&pe<oe.length){const qe=pe;let He=0;for(;!(xe.borders[te][0]>Ye[1]-3)&&(He++,++pe!==oe.length);)xe=ue.featuresOnBorder[oe[pe]];if(xe=ue.featuresOnBorder[oe[qe]],De.intersectsCount()>1||xe.intersectsCount()>1||He!==1){He!==1&&(pe=qe),p.encodeCentroid(void 0,De,!1),we&&ue.encodeCentroid(void 0,xe,!1);continue}const Ie=U[$](De,xe),ye=$%2?s.EXTENT-1:0;j.x=Z(Ie[0],Math.min(s.EXTENT-1,Ie[1]),ye,$<2,Ie[2]),j.y=0,p.encodeCentroid(j,De,!1),we&&ue.encodeCentroid(j,xe,!1)}else p.encodeCentroid(void 0,De,!1)}p.borderDoneWithNeighborZ[$]=ue.canonical.z,p.needsCentroidUpdate=!0,we&&(ue.borderDoneWithNeighborZ[te]=p.canonical.z,ue.needsCentroidUpdate=!0)}else{for(const Re of X)p.encodeCentroid(void 0,p.featuresOnBorder[Re],!1);if(we){for(const Re of oe)ue.encodeCentroid(void 0,ue.featuresOnBorder[Re],!1);ue.borderDoneWithNeighborZ[te]=p.canonical.z,ue.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[$]=ue.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(c)}const di=new s.Color(1,0,0,1),Wn=new s.Color(0,1,0,1),xc=new s.Color(0,0,1,1),ip=new s.Color(1,0,1,1),Tr=new s.Color(0,1,1,1);function Ko(c,i,a){const p=c.context,g=c.transform,v=p.gl,A=g.projection.name==="globe",S=A?["PROJECTION_GLOBE_VIEW"]:null;let I=a.projMatrix;if(A&&s.globeToMercatorTransition(g.zoom)>0){const De=s.transitionTileAABBinECEF(a.canonical,g),Ye=s.globeDenormalizeECEF(De);I=s.multiply(new Float32Array(16),g.globeMatrix,Ye),s.multiply(I,g.projMatrix,I)}const k=c.useProgram("debug",null,S),P=i.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(P,k);const U=s.DepthMode.disabled,j=s.StencilMode.disabled,J=c.colorModeForRenderPass(),K="$debug";p.activeTexture.set(v.TEXTURE0),c.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),A?P._makeGlobeTileDebugBuffers(c.context,g):P._makeDebugTileBoundsBuffers(c.context,g.projection);const Q=P._tileDebugBuffer||c.debugBuffer,Z=P._tileDebugIndexBuffer||c.debugIndexBuffer,$=P._tileDebugSegments||c.debugSegments;k.draw(p,v.LINE_STRIP,U,j,J,s.CullFaceMode.disabled,mc(I,s.Color.red),K,Q,Z,$,null,null,null,[P._globeTileDebugBorderBuffer]);const te=P.latestRawTileData,X=Math.floor((te&&te.byteLength||0)/1024),le=i.getTile(a).tileSize,ue=512/Math.min(le,512)*(a.overscaledZ/g.zoom)*.5;let oe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(oe+=` => ${a.overscaledZ}`),oe+=` ${X}kb`,function(De,Ye){De.initDebugOverlayCanvas();const xe=De.debugOverlayCanvas,qe=De.context.gl,He=De.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,xe.width,xe.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(Ye,5,5),He.strokeText(Ye,5,5),De.debugOverlayTexture.update(xe),De.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}(c,oe);const pe=P._tileDebugTextBuffer||c.debugBuffer,we=P._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Re=P._tileDebugTextSegments||c.debugSegments;k.draw(p,v.TRIANGLES,U,j,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,mc(I,s.Color.transparent,ue),K,pe,we,Re,null,null,null,[P._globeTileDebugTextBuffer])}function Ll(c,i,a,p){Yr(c,0,i+a/2,c.transform.width,a,p)}function ia(c,i,a,p){Yr(c,i-a/2,0,a,c.transform.height,p)}function Yr(c,i,a,p,g,v){const A=c.context,S=A.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*s.exported.devicePixelRatio,a*s.exported.devicePixelRatio,p*s.exported.devicePixelRatio,g*s.exported.devicePixelRatio),A.clear({color:v}),S.disable(S.SCISSOR_TEST)}const bs=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Rn}=bs;function Xo(c,i,a,p){c.emplaceBack(i,a,p)}class xn{constructor(i){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Xo(this.vertexArray,-1,-1,1),Xo(this.vertexArray,1,-1,1),Xo(this.vertexArray,-1,1,1),Xo(this.vertexArray,1,1,1),Xo(this.vertexArray,-1,-1,-1),Xo(this.vertexArray,1,-1,-1),Xo(this.vertexArray,-1,1,-1),Xo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Rn),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Qr(c,i,a,p,g,v){const A=c.gl,S=i.paint.get("sky-atmosphere-color"),I=i.paint.get("sky-atmosphere-halo-color"),k=i.paint.get("sky-atmosphere-sun-intensity"),P=((U,j,J,K,Q)=>({u_matrix_3f:U,u_sun_direction:j,u_sun_intensity:J,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),p),g,k,S,I);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),a.draw(c,A.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,P,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const em=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class rp{constructor(i){const a=new s.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const p=new s.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(a,em.members),this.indexBuffer=i.createIndexBuffer(p),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Fl={symbol:function(c,i,a,p,g){if(c.renderPass!=="translucent")return;const v=s.StencilMode.disabled,A=c.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(S,I,k,P,U,j,J){const K=I.transform,Q=U==="map",Z=j==="map";for(const $ of S){const te=P.getTile($),X=te.getBucket(k);if(!X||!X.text||!X.text.segments.get().length)continue;const le=s.evaluateSizeForZoom(X.textSizeData,K.zoom),ue=mu($,X.getProjection(),K),oe=K.calculatePixelsToTileUnitsMatrix(te),pe=xl(ue,te.tileID.canonical,Z,Q,K,X.getProjection(),oe),we=k.layout.get("icon-text-fit")!=="none"&&X.hasIconData();if(le){const Re=Math.pow(2,K.zoom-te.tileID.overscaledZ);Pl(X,Q,Z,J,s.symbolSize,K,pe,$,Re,le,we)}}}(p,c,a,i,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),a.paint.get("icon-opacity").constantOr(1)!==0&&Ze(c,i,a,p,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),v,A),a.paint.get("text-opacity").constantOr(1)!==0&&Ze(c,i,a,p,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),v,A),i.map.showCollisionBoxes&&(Zh(c,i,a,p,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Zh(c,i,a,p,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,i,a,p){if(c.renderPass!=="translucent")return;const g=a.paint.get("circle-opacity"),v=a.paint.get("circle-stroke-width"),A=a.paint.get("circle-stroke-opacity"),S=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)===0&&(v.constantOr(1)===0||A.constantOr(1)===0))return;const I=c.context,k=I.gl,P=c.transform,U=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),j=s.StencilMode.disabled,J=c.colorModeForRenderPass(),K=P.projection.name==="globe",Q=[s.mercatorXfromLng(P.center.lng),s.mercatorYfromLat(P.center.lat)],Z=[];for(let te=0;te<p.length;te++){const X=p[te],le=i.getTile(X),ue=le.getBucket(a);if(!ue||ue.projection.name!==P.projection.name)continue;const oe=ue.programConfigurations.get(a.id),pe=ep(a);K&&pe.push("PROJECTION_GLOBE_VIEW");const we=c.useProgram("circle",oe,pe),Re=ue.layoutVertexBuffer,De=ue.globeExtVertexBuffer,Ye=ue.indexBuffer,xe=P.projection.createInversionMatrix(P,X.canonical),qe={programConfiguration:oe,program:we,layoutVertexBuffer:Re,globeExtVertexBuffer:De,indexBuffer:Ye,uniformValues:Bl(c,X,le,xe,Q,a),tile:le};if(S){const He=ue.segments.get();for(const Ie of He)Z.push({segments:new s.SegmentVector([Ie]),sortKey:Ie.sortKey,state:qe})}else Z.push({segments:ue.segments,sortKey:0,state:qe})}S&&Z.sort((te,X)=>te.sortKey-X.sortKey);const $={useDepthForOcclusion:!K};for(const te of Z){const{programConfiguration:X,program:le,layoutVertexBuffer:ue,globeExtVertexBuffer:oe,indexBuffer:pe,uniformValues:we,tile:Re}=te.state,De=te.segments;c.terrain&&c.terrain.setupElevationDraw(Re,le,$),c.prepareDrawProgram(I,le,Re.tileID.toUnwrapped()),le.draw(I,k.TRIANGLES,U,j,J,s.CullFaceMode.disabled,we,a.id,ue,pe,De,a.paint,P.zoom,X,[oe])}},heatmap:function(c,i,a,p){if(a.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const g=c.context,v=g.gl,A=s.StencilMode.disabled,S=new s.ColorMode([v.ONE,v.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(J,K,Q,Z){const $=J.gl,te=K.width*Z,X=K.height*Z;J.activeTexture.set($.TEXTURE1),J.viewport.set([0,0,te,X]);let le=Q.heatmapFbo;if(!le||le&&(le.width!==te||le.height!==X)){le&&le.destroy();const ue=$.createTexture();$.bindTexture($.TEXTURE_2D,ue),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),le=Q.heatmapFbo=J.createFramebuffer(te,X,!1),function(oe,pe,we,Re,De,Ye){const xe=oe.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,De,Ye,0,xe.RGBA,oe.extRenderToTextureHalfFloat?oe.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),Re.colorAttachment.set(we)}(J,0,ue,le,te,X)}else $.bindTexture($.TEXTURE_2D,le.colorAttachment.get()),J.bindFramebuffer.set(le.framebuffer)})(g,c,a,c.transform.projection.name==="globe"?.5:.25),g.clear({color:s.Color.transparent});const I=c.transform,k=I.projection.name==="globe",P=k?["PROJECTION_GLOBE_VIEW"]:null,U=k?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,j=[s.mercatorXfromLng(I.center.lng),s.mercatorYfromLat(I.center.lat)];for(let J=0;J<p.length;J++){const K=p[J];if(i.hasRenderableParent(K))continue;const Q=i.getTile(K),Z=Q.getBucket(a);if(!Z||Z.projection.name!==I.projection.name)continue;const $=Z.programConfigurations.get(a.id),te=c.useProgram("heatmap",$,P),{zoom:X}=c.transform;c.terrain&&c.terrain.setupElevationDraw(Q,te),c.prepareDrawProgram(g,te,K.toUnwrapped());const le=I.projection.createInversionMatrix(I,K.canonical);te.draw(g,v.TRIANGLES,s.DepthMode.disabled,A,S,U,jh(c,K,Q,le,j,X,a.paint.get("heatmap-intensity")),a.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,a.paint,c.transform.zoom,$,k?[Z.globeExtVertexBuffer]:null)}g.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(g,v){const A=g.context,S=A.gl,I=v.heatmapFbo;if(!I)return;A.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get()),A.activeTexture.set(S.TEXTURE1);let k=v.colorRampTexture;k||(k=v.colorRampTexture=new s.Texture(A,v.colorRamp,S.RGBA)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(A,S.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,g.colorModeForRenderPass(),s.CullFaceMode.disabled,((P,U,j,J)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(c,a))},line:function(c,i,a,p){if(c.renderPass!=="translucent")return;const g=a.paint.get("line-opacity"),v=a.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;const A=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),S=c.colorModeForRenderPass(),I=c.terrain&&c.terrain.renderingToTexture?1:s.exported.devicePixelRatio,k=a.paint.get("line-dasharray"),P=k.constantOr(1),U=a.layout.get("line-cap"),j=a.paint.get("line-pattern"),J=j.constantOr(1),K=a.paint.get("line-gradient"),Q=a.getCrossfadeParameters(),Z=J?"linePattern":"line",$=c.context,te=$.gl,X=(ue=>{const oe=[];$h(ue)&&oe.push("RENDER_LINE_DASH"),ue.paint.get("line-gradient")&&oe.push("RENDER_LINE_GRADIENT");const pe=ue.paint.get("line-trim-offset");pe[0]===0&&pe[1]===0||oe.push("RENDER_LINE_TRIM_OFFSET");const we=ue.paint.get("line-pattern").constantOr(1),Re=ue.paint.get("line-opacity").constantOr(1)!==1;return!we&&Re&&oe.push("RENDER_LINE_ALPHA_DISCARD"),oe})(a);let le=X.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const ue of p){const oe=i.getTile(ue);if(J&&!oe.patternsLoaded())continue;const pe=oe.getBucket(a);if(!pe)continue;c.prepareDrawTile();const we=pe.programConfigurations.get(a.id),Re=c.useProgram(Z,we,X),De=j.constantOr(null);if(De&&oe.imageAtlas){const ot=oe.imageAtlas,lt=ot.patternPositions[De.to.toString()],st=ot.patternPositions[De.from.toString()];lt&&st&&we.setConstantPatternPositions(lt,st)}const Ye=k.constantOr(null),xe=U.constantOr(null);if(!J&&Ye&&xe&&oe.lineAtlas){const ot=oe.lineAtlas,lt=ot.getDash(Ye.to,xe),st=ot.getDash(Ye.from,xe);lt&&st&&we.setConstantPatternPositions(lt,st)}let[qe,He]=a.paint.get("line-trim-offset");(xe==="round"||xe==="square")&&qe!==He&&(qe===0&&(qe-=1),He===1&&(He+=1));const Ie=c.terrain?ue.projMatrix:null,ye=J?qh(c,oe,a,Q,Ie,I):ja(c,oe,a,Q,Ie,pe.lineClipsArray.length,I,[qe,He]);if(K){const ot=pe.gradients[a.id];let lt=ot.texture;if(a.gradientVersion!==ot.version){let st=256;if(a.stepInterpolant){const Et=i.getSource().maxzoom,Ut=ue.canonical.z===Et?Math.ceil(1<<c.transform.maxZoom-ue.canonical.z):1;st=s.clamp(s.nextPowerOfTwo(pe.maxLineLength/s.EXTENT*1024*Ut),256,$.maxTextureSize)}ot.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:st,image:ot.gradient||void 0,clips:pe.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new s.Texture($,ot.gradient,te.RGBA),ot.version=a.gradientVersion,lt=ot.texture}$.activeTexture.set(te.TEXTURE1),lt.bind(a.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}P&&($.activeTexture.set(te.TEXTURE0),oe.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),we.updatePaintBuffers(Q)),J&&($.activeTexture.set(te.TEXTURE0),oe.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),we.updatePaintBuffers(Q)),c.prepareDrawProgram($,Re,ue.toUnwrapped());const dt=ot=>{Re.draw($,te.TRIANGLES,A,ot,S,s.CullFaceMode.disabled,ye,a.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,a.paint,c.transform.zoom,we,[pe.layoutVertexBuffer2])};if(le){const ot=c.stencilModeForClipping(ue).ref;ot===0&&c.terrain&&$.clear({stencil:0});const lt={func:te.EQUAL,mask:255};ye.u_alpha_discard_threshold=.8,dt(new s.StencilMode(lt,ot,255,te.KEEP,te.KEEP,te.INVERT)),ye.u_alpha_discard_threshold=0,dt(new s.StencilMode(lt,ot,255,te.KEEP,te.KEEP,te.KEEP))}else dt(c.stencilModeForClipping(ue))}le&&(c.resetStencilClippingMasks(),c.terrain&&$.clear({stencil:0}))},fill:function(c,i,a,p){const g=a.paint.get("fill-color"),v=a.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const A=c.colorModeForRenderPass(),S=a.paint.get("fill-pattern"),I=c.opaquePassEnabledForLayer()&&!S.constantOr(1)&&g.constantOr(s.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===I){const k=c.depthModeForSublayer(1,c.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);It(c,i,a,p,k,A,!1)}if(c.renderPass==="translucent"&&a.paint.get("fill-antialias")){const k=c.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);It(c,i,a,p,k,A,!0)}},"fill-extrusion":function(c,i,a,p){const g=a.paint.get("fill-extrusion-opacity");if(g!==0&&c.renderPass==="translucent"){const v=new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D);if(g!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))on(c,i,a,p,v,s.StencilMode.disabled,s.ColorMode.disabled),on(c,i,a,p,v,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const A=c.colorModeForRenderPass();on(c,i,a,p,v,s.StencilMode.disabled,A)}}},hillshade:function(c,i,a,p){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const g=c.context,v=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),A=c.colorModeForRenderPass(),S=c.terrain&&c.terrain.renderingToTexture,[I,k]=c.renderPass!=="translucent"||S?[{},p]:c.stencilConfigForOverlap(p);for(const P of k){const U=i.getTile(P);if(U.needsHillshadePrepare&&c.renderPass==="offscreen")uc(c,U,a,v,s.StencilMode.disabled,A);else if(c.renderPass==="translucent"){const j=S&&c.terrain?c.terrain.stencilModeForRTTOverlap(P):I[P.overscaledZ];Jn(c,P,U,a,v,j,A)}}g.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,i,a,p,g,v){if(c.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!p.length)return;const A=c.context,S=A.gl,I=i.getSource(),k=c.useProgram("raster"),P=c.colorModeForRenderPass(),U=c.terrain&&c.terrain.renderingToTexture,[j,J]=I instanceof fe||U?[{},p]:c.stencilConfigForOverlap(p),K=J[J.length-1].overscaledZ,Q=!c.options.moving;for(const Z of J){const $=U?s.DepthMode.disabled:c.depthModeForSublayer(Z.overscaledZ-K,a.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,S.LESS),te=Z.toUnwrapped(),X=i.getTile(Z);if(U&&(!X||!X.hasData()))continue;const le=U?Z.projMatrix:c.transform.calculateProjMatrix(te,Q),ue=c.terrain&&U?c.terrain.stencilModeForRTTOverlap(Z):j[Z.overscaledZ],oe=v?0:a.paint.get("raster-fade-duration");X.registerFadeDuration(oe);const pe=i.findLoadedParent(Z,0),we=Oh(X,pe,i,c.transform,oe);let Re,De;c.terrain&&c.terrain.prepareDrawTile();const Ye=a.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;A.activeTexture.set(S.TEXTURE0),X.texture.bind(Ye,S.CLAMP_TO_EDGE),A.activeTexture.set(S.TEXTURE1),pe?(pe.texture.bind(Ye,S.CLAMP_TO_EDGE),Re=Math.pow(2,pe.tileID.overscaledZ-X.tileID.overscaledZ),De=[X.tileID.canonical.x*Re%1,X.tileID.canonical.y*Re%1]):X.texture.bind(Ye,S.CLAMP_TO_EDGE);const xe=Wo(le,De||[0,0],Re||1,we,a,I instanceof fe?I.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(A,k,te),I instanceof fe)I.boundsBuffer&&I.boundsSegments&&k.draw(A,S.TRIANGLES,$,s.StencilMode.disabled,P,s.CullFaceMode.disabled,xe,a.id,I.boundsBuffer,c.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:qe,tileBoundsIndexBuffer:He,tileBoundsSegments:Ie}=c.getTileBoundsBuffers(X);k.draw(A,S.TRIANGLES,$,ue,P,s.CullFaceMode.disabled,xe,a.id,qe,He,Ie)}}c.resetStencilClippingMasks()},background:function(c,i,a,p){const g=a.paint.get("background-color"),v=a.paint.get("background-opacity");if(v===0)return;const A=c.context,S=A.gl,I=c.transform,k=I.tileSize,P=a.paint.get("background-pattern");if(c.isPatternMissing(P))return;const U=!P&&g.a===1&&v===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==U)return;const j=s.StencilMode.disabled,J=c.depthModeForSublayer(0,U==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),K=c.colorModeForRenderPass(),Q=c.useProgram(P?"backgroundPattern":"background");let Z,$=p;$||(Z=c.getBackgroundTiles(),$=Object.values(Z).map(X=>X.tileID)),P&&(A.activeTexture.set(S.TEXTURE0),c.imageManager.bind(c.context));const te=a.getCrossfadeParameters();for(const X of $){const le=X.toUnwrapped(),ue=p?X.projMatrix:c.transform.calculateProjMatrix(le);c.prepareDrawTile();const oe=i?i.getTile(X):Z?Z[X.key]:new s.Tile(X,k,I.zoom,c),pe=P?np(ue,v,c,P,{tileID:X,tileSize:k},te):Lr(ue,v,g);c.prepareDrawProgram(A,Q,le);const{tileBoundsBuffer:we,tileBoundsIndexBuffer:Re,tileBoundsSegments:De}=c.getTileBoundsBuffers(oe);Q.draw(A,S.TRIANGLES,J,j,K,s.CullFaceMode.disabled,pe,a.id,we,Re,De)}},sky:function(c,i,a){const p=c.transform,g=p.projection.name==="mercator"||p.projection.name==="globe"?1:s.smoothstep(7,8,p.zoom),v=a.paint.get("sky-opacity")*g;if(v===0)return;const A=c.context,S=a.paint.get("sky-type"),I=new s.DepthMode(A.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),k=c.frameCounter/1e3%1;S==="atmosphere"?c.renderPass==="offscreen"?a.needsSkyboxCapture(c)&&(function(P,U,j,J){const K=P.context,Q=K.gl;let Z=U.skyboxFbo;if(!Z){Z=U.skyboxFbo=K.createFramebuffer(32,32,!1),U.skyboxGeometry=new xn(K),U.skyboxTexture=K.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,U.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let le=0;le<6;++le)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(Z.framebuffer),K.viewport.set([0,0,32,32]);const $=U.getCenter(P,!0),te=P.useProgram("skyboxCapture"),X=new Float64Array(16);s.identity(X),s.rotateY(X,X,.5*-Math.PI),Qr(K,U,te,X,$,0),s.identity(X),s.rotateY(X,X,.5*Math.PI),Qr(K,U,te,X,$,1),s.identity(X),s.rotateX(X,X,.5*-Math.PI),Qr(K,U,te,X,$,2),s.identity(X),s.rotateX(X,X,.5*Math.PI),Qr(K,U,te,X,$,3),s.identity(X),Qr(K,U,te,X,$,4),s.identity(X),s.rotateY(X,X,Math.PI),Qr(K,U,te,X,$,5),K.viewport.set([0,0,P.width,P.height])}(c,a),a.markSkyboxValid(c)):c.renderPass==="sky"&&function(P,U,j,J,K){const Q=P.context,Z=Q.gl,$=P.transform,te=P.useProgram("skybox");Q.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,U.skyboxTexture);const X=((le,ue,oe,pe,we)=>({u_matrix:le,u_sun_direction:ue,u_cubemap:0,u_opacity:pe,u_temporal_offset:we}))($.skyboxMatrix,U.getCenter(P,!1),0,J,K);P.prepareDrawProgram(Q,te),te.draw(Q,Z.TRIANGLES,j,s.StencilMode.disabled,P.colorModeForRenderPass(),s.CullFaceMode.backCW,X,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(c,a,I,v,k):S==="gradient"&&c.renderPass==="sky"&&function(P,U,j,J,K){const Q=P.context,Z=Q.gl,$=P.transform,te=P.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new xn(Q)),Q.activeTexture.set(Z.TEXTURE0);let X=U.colorRampTexture;X||(X=U.colorRampTexture=new s.Texture(Q,U.colorRamp,Z.RGBA)),X.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const le=((ue,oe,pe,we,Re)=>({u_matrix:ue,u_color_ramp:0,u_center_direction:oe,u_radius:s.degToRad(pe),u_opacity:we,u_temporal_offset:Re}))($.skyboxMatrix,U.getCenter(P,!1),U.paint.get("sky-gradient-radius"),J,K);P.prepareDrawProgram(Q,te),te.draw(Q,Z.TRIANGLES,j,s.StencilMode.disabled,P.colorModeForRenderPass(),s.CullFaceMode.backCW,le,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(c,a,I,v,k)},debug:function(c,i,a){for(let p=0;p<a.length;p++)Ko(c,i,a[p])},custom:function(c,i,a){const p=c.context,g=a.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const v=g.prerender;v&&(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),v.call(g,p.gl,c.transform.customLayerMatrix()),p.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(s.StencilMode.disabled);const v=g.renderingMode==="3d"?new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,s.DepthMode.ReadOnly);p.setDepthMode(v),g.render(p.gl,c.transform.customLayerMatrix()),p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}};class wc{constructor(i,a){this.context=new R(i),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ga,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,a){const p=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new dc(this,i));const g=this._terrain;this.transform.elevation=p?g:null,g.update(i,this.transform,a)}_updateFog(i){const a=i.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,g]=a.getFovAdjustedRange(this.transform._fov);if(p>g)return void(this.transform.fogCullDistSq=null);const v=p+.78*(g-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,a){if(this.width=i*s.exported.devicePixelRatio,this.height=a*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const i=this.context,a=new s.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(a,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const p=new s.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(s.EXTENT,0),p.emplaceBack(0,s.EXTENT),p.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=i.createVertexBuffer(p,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const g=new s.StructArrayLayout2i4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const v=new s.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(s.EXTENT,0,s.EXTENT,0),v.emplaceBack(0,s.EXTENT,0,s.EXTENT),v.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(v,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const A=new s.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(A);const S=new s.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])S.emplaceBack(k);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new s.Texture(i,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=s.create();const I=this.context.gl;this.stencilClearMode=new s.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new rp(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,a=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,a.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,bo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,a,p){if(!a||this.currentStencilSource===a.id||!i.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const I of p)if(this._tileClippingMaskIDs[I.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=a.id;const g=this.context,v=g.gl;this.nextStencilID+p.length>256&&this.clearStencil(),g.setColorMode(s.ColorMode.disabled),g.setDepthMode(s.DepthMode.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const I=a.getTile(S),k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:U,tileBoundsSegments:j}=this.getTileBoundsBuffers(I);A.draw(g,v.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,bo(S.projMatrix),"$clipping",P,U,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,a=this.context.gl;return new s.StencilMode({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const a=this.context.gl;return new s.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(i){const a=this.context.gl,p=i.sort((A,S)=>S.overscaledZ-A.overscaledZ),g=p[p.length-1].overscaledZ,v=p[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const A={};for(let S=0;S<v;S++)A[S+g]=new s.StencilMode({func:a.GEQUAL,mask:255},S+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[A,p]}return[{[g]:s.StencilMode.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([i.CONSTANT_COLOR,i.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(i,a,p){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new s.DepthMode(p||this.context.gl.LEQUAL,a,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,a){this.style=i,this.options=a,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const p=this.style.order,g=this.style._sourceCaches;for(const I in g){const k=g[I];k.used&&k.prepare(this.context)}const v={},A={},S={};for(const I in g){const k=g[I];v[I]=k.getVisibleCoordinates(),A[I]=v[I].slice().reverse(),S[I]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<p.length;I++)if(this.style._layers[p[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const I of p){const k=this.style._layers[I],P=i._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const U=P?A[P.id]:void 0;(k.type==="custom"||k.isSky()||U&&U.length)&&this.renderLayer(this,P,k,U)}if(this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[p[this.currentLayer]],k=i._getLayerSourceCache(I);if(I.isSky())continue;const P=k?A[k.id]:void 0;this._renderTileClippingMasks(I,k,P),this.renderLayer(this,k,I,P)}if(this.style.fog&&this.transform.projection.supportsFog&&function(I,k){const P=I.context,U=P.gl,j=I.transform,J=new s.DepthMode(U.LEQUAL,s.DepthMode.ReadOnly,[0,1]),K=I.useProgram("globeAtmosphere",null,j.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=s.globeToMercatorTransition(j.zoom),Z=k.properties.get("color").toArray01(),$=k.properties.get("high-color").toArray01(),te=k.properties.get("space-color").toArray01PremultipliedAlpha(),X=s.identity$1([]);s.rotateY$1(X,X,-s.degToRad(j._center.lng)),s.rotateX$1(X,X,s.degToRad(j._center.lat)),s.rotateZ$1(X,X,j.angle),s.rotateX$1(X,X,-j._pitch);const le=s.fromQuat(new Float32Array(16),X),ue=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),oe=5e-4,pe=s.mapValue(k.properties.get("horizon-blend"),0,1,oe,.25),we=s.globeUseCustomAntiAliasing(I,P,j)&&pe===oe?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,Re=I.frameCounter/1e3%1,De=s.length(j.globeCenterInViewSpace),Ye=Math.sqrt(Math.pow(De,2)-Math.pow(we,2)),xe=Math.acos(Ye/De),qe=((Ie,ye,dt,ot,lt,st,Et,Ut,Lt,St,at,Zt,Yt,Dn)=>({u_frustum_tl:Ie,u_frustum_tr:ye,u_frustum_br:dt,u_frustum_bl:ot,u_horizon:lt,u_transition:st,u_fadeout_range:Et,u_color:Ut,u_high_color:Lt,u_space_color:St,u_star_intensity:at,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Zt,u_horizon_angle:Yt,u_rotation_matrix:Dn}))(j.frustumCorners.TL,j.frustumCorners.TR,j.frustumCorners.BR,j.frustumCorners.BL,j.frustumCorners.horizon,Q,pe,Z,$,te,ue,Re,xe,le);I.prepareDrawProgram(P,K);const He=I.atmosphereBuffer;He&&K.draw(P,U.TRIANGLES,J,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,qe,"skybox",He.vertexBuffer,He.indexBuffer,He.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const I=this.style._layers[p[this.currentLayer]],k=i._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,k,I,k?A[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const I=this.style._layers[p[this.currentLayer]],k=i._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const P=k?(I.type==="symbol"?S:A)[k.id]:void 0;this._renderTileClippingMasks(I,k,k?v[k.id]:void 0),this.renderLayer(this,k,I,P),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let I=null;s.values(this.style._layers).forEach(k=>{const P=i._getLayerSourceCache(k);P&&!k.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<P.getSource().maxzoom)&&(I=P)}),I&&this.options.showTileBoundaries&&Fl.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const k=I.transform.padding;Ll(I,I.transform.height-(k.top||0),3,di),Ll(I,k.bottom||0,3,Wn),ia(I,k.left||0,3,xc),ia(I,I.transform.width-(k.right||0),3,ip);const P=I.transform.centerPoint;(function(U,j,J,K){Yr(U,j-1,J-10,2,20,K),Yr(U,j-10,J-1,20,2,K)})(I,P.x,I.transform.height-P.y,Tr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(i,a,p,g){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||g&&g.length)&&(this.id=p.id,this.gpuTimingStart(p),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(p.type)||Fl[p.type](i,a,p,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let p=this.gpuTimers[i.id];p||(p=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),p.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,a=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),i.beginQueryEXT(i.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const a={};for(const p in i){const g=i[p],v=this.context.extTimerQuery,A=v.getQueryObjectEXT(g.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(g.query),a[p]=A}return a}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let p=0;for(const g of i)p+=a.getQueryObjectEXT(g,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(g);return p}translatePosMatrix(i,a,p,g,v){if(!p[0]&&!p[1])return i;const A=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(A){const k=Math.sin(A),P=Math.cos(A);p=[p[0]*P-p[1]*k,p[0]*k+p[1]*P]}const S=[v?p[0]:Fi(a,p[0],this.transform.zoom),v?p[1]:Fi(a,p[1],this.transform.zoom),0],I=new Float32Array(16);return s.translate(I,i,S),I}saveTileTexture(i){const a=this._tileTextures[i.size[0]];a?a.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const a=this._tileTextures[i];return a&&a.length>0?a.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const a=this.imageManager.getPattern(i.from.toString()),p=this.imageManager.getPattern(i.to.toString());return!a||!p}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,p=[];return this.terrainRenderModeElevated()&&p.push("TERRAIN"),this.transform.projection.name==="globe"&&p.push("GLOBE"),a&&!i&&a.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),i&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(i,a,p){this.cache=this.cache||{};const g=p||[],v=this.currentGlobalDefines().concat(g),A=Gh.cacheKey(Rh[i],i,v,a);return this.cache[A]||(this.cache[A]=new Gh(this.context,i,Rh[i],a,yc[i],v)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,a,p){if(this.terrain&&this.terrain.renderingToTexture)return;const g=this.style.fog;if(g){const v=g.getOpacity(this.transform.pitch),A=((S,I,k,P,U,j,J,K,Q,Z,$)=>{const te=S.transform,X=I.properties.get("color").toArray01();X[3]=P;const le=S.frameCounter/1e3%1;return{u_fog_matrix:k?te.calculateFogTileMatrix(k):S.identityMat,u_fog_range:I.getFovAdjustedRange(te._fov),u_fog_color:X,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:le,u_frustum_tl:U,u_frustum_tr:j,u_frustum_br:J,u_frustum_bl:K,u_globe_pos:Q,u_globe_radius:Z,u_viewport:$,u_globe_transition:s.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,g,p,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);a.setFogUniformValues(i,A)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,a=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const g of p)a[g.key]=i[g.key]||new s.Tile(g,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class Jo{constructor(i=0,a=0,p=0,g=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=p,this.right=g}interpolate(i,a,p){return a.top!=null&&i.top!=null&&(this.top=s.number(i.top,a.top,p)),a.bottom!=null&&i.bottom!=null&&(this.bottom=s.number(i.bottom,a.bottom,p)),a.left!=null&&i.left!=null&&(this.left=s.number(i.left,a.left,p)),a.right!=null&&i.right!=null&&(this.right=s.number(i.right,a.right,p)),this}getCenter(i,a){const p=s.clamp((this.left+i-this.right)/2,0,i),g=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.pointGeometry(p,g)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Jo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Rl(c,i){const a=s.getColumn(c,3);s.fromQuat(c,i),s.setColumn(c,3,a)}function bc(c,i){const a=s.identity$1([]);return s.rotateZ$1(a,a,-i),s.rotateX$1(a,a,-c),a}function ra(c,i){const a=[c[0],c[1],0],p=[i[0],i[1],0];if(s.length(a)>=1e-15){const A=s.normalize([],a);s.scale$2(p,A,s.dot(p,A)),i[0]=p[0],i[1]=p[1]}const g=s.cross([],i,c);if(s.len(g)<1e-15)return null;const v=Math.atan2(-g[1],g[0]);return bc(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),v)}class Ol{constructor(i,a){this.position=i,this.orientation=a}get position(){return this._position}set position(i){if(i){const a=i instanceof s.MercatorCoordinate?i:new s.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(a.x=s.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(i,a){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(i)):0,g=this.position,v=s.MercatorCoordinate.fromLngLat(i,p),A=[v.x-g.x,v.y-g.y,v.z-g.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=ra(A,a)}setPitchBearing(i,a){this.orientation=bc(s.degToRad(i),s.degToRad(-a))}}class oa{constructor(i,a){this._transform=s.identity([]),this.orientation=a,this.position=i}get mercatorPosition(){const i=this.position;return new s.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=s.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var a;i&&s.setColumn(this._transform,3,[(a=i)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||s.identity$1([]),i&&Rl(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,a){this._orientation=bc(i,a),Rl(this._transform,this._orientation)}forward(){const i=s.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=s.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=s.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,a){const p=new Float64Array(16);return s.invert(p,this.getWorldToCamera(i,a)),p}getWorldToCameraPosition(i,a,p){const g=this.position;s.scale$2(g,g,-i);const v=new Float64Array(16);return s.fromScaling(v,[p,p,p]),s.translate(v,v,g),v[10]*=a,v}getWorldToCamera(i,a){const p=new Float64Array(16),g=new Float64Array(4),v=this.position;return s.conjugate(g,this._orientation),s.scale$2(v,v,-i),s.fromQuat(p,g),s.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=a,p[9]*=a,p[10]*=a,p[11]*=a,p}getCameraToClipPerspective(i,a,p,g){const v=new Float64Array(16);return s.perspective(v,i,a,p,g),v}getDistanceToElevation(i){const a=i===0?0:s.mercatorZfromAltitude(i,this.position[1]),p=this.forward();return(a-this.position[2])/p[2]}clone(){return new oa([...this.position],[...this.orientation])}}function qa(c,i){const a=As(c.projection,c.zoom,c.width,c.height),p=function(v,A,S,I,k){const P=new s.LngLat(S.lng-180*pr,S.lat),U=new s.LngLat(S.lng+180*pr,S.lat),j=v.project(P.lng,P.lat),J=v.project(U.lng,U.lat),K=-Math.atan2(J.y-j.y,J.x-j.x),Q=s.MercatorCoordinate.fromLngLat(S);Q.y=s.clamp(Q.y,-.999975,.999975);const Z=Q.toLngLat(),$=v.project(Z.lng,Z.lat),te=s.MercatorCoordinate.fromLngLat(Z);te.x+=pr;const X=te.toLngLat(),le=v.project(X.lng,X.lat),ue=gt(le.x-$.x,le.y-$.y,K),oe=s.MercatorCoordinate.fromLngLat(Z);oe.y+=pr;const pe=oe.toLngLat(),we=v.project(pe.lng,pe.lat),Re=gt(we.x-$.x,we.y-$.y,K),De=Math.abs(ue.x)/Math.abs(Re.y),Ye=s.identity([]);s.rotateZ(Ye,Ye,-K*(1-(k?0:I)));const xe=s.identity([]);return s.scale(xe,xe,[1,1-(1-De)*I,1]),xe[4]=-Re.x/Re.y*I,s.rotateZ(xe,xe,K),s.multiply(xe,Ye,xe),xe}(c.projection,0,c.center,a,i),g=Tu(c);return s.scale(p,p,[g,g,1]),p}function Tu(c){const i=c.projection,a=As(c.projection,c.zoom,c.width,c.height),p=sa(i,c.center),g=sa(i,s.LngLat.convert(i.center));return Math.pow(2,p*a+(1-a)*g)}function As(c,i,a,p,g=1/0){const v=c.range;if(!v)return 0;const A=Math.min(g,Math.max(a,p)),S=Math.log(A/1024)/Math.LN2;return s.smoothstep(v[0]+S,v[1]+S,i)}const pr=1/4e4;function sa(c,i){const a=s.clamp(i.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),p=new s.LngLat(i.lng-180*pr,a),g=new s.LngLat(i.lng+180*pr,a),v=c.project(p.lng,a),A=c.project(g.lng,a),S=s.MercatorCoordinate.fromLngLat(p),I=s.MercatorCoordinate.fromLngLat(g),k=A.x-v.x,P=A.y-v.y,U=I.x-S.x,j=I.y-S.y,J=Math.sqrt((U*U+j*j)/(k*k+P*P));return Math.log(J)/Math.LN2}function gt(c,i,a){const p=Math.cos(a),g=Math.sin(a);return{x:c*p-i*g,y:c*g+i*p}}class Fr{constructor(i,a,p,g,v,A,S){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=p==null?0:p,this._maxPitch=g==null?60:g,this.setProjection(A),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Jo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new oa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new Fr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||a)&&this._updateCameraOnTerrain(),(i||a)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const p=!q(a,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const a=i!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const a=-i*Math.PI/180;var p;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(p=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(g,v,A){var S=v[0],I=v[1],k=v[2],P=v[3],U=Math.sin(A),j=Math.cos(A);g[0]=S*j+k*U,g[1]=I*j+P*U,g[2]=S*-U+k*j,g[3]=I*-U+P*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const a=s.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=s.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const a=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let g=0,v=0;for(let A=0;A<a.length;A++){const S=new s.pointGeometry(a[A][0]*this.width,p+a[A][1]*(this.height-p)),I=i.pointCoordinate(S);if(!I)continue;const k=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);g+=I[3]*k,v+=k}return v===0?NaN:g/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),A=Math.max(g-p,v);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let p;p=i.z<this._camera.position[2]?[a.x,a.y,a.z]:[i.x,i.y,i.z];const g=s.length(s.sub([],this._camera.position,p));return s.clamp(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let a=!1;if(i.orientation&&!s.exactEquals(i.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(i.orientation)),i.position){const p=[i.position.x,i.position.y,i.position.z];s.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,a=new Ol;return a.position=new s.MercatorCoordinate(i[0],i[1],i[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(i){if(!s.length$1(i))return!1;s.normalize$1(i,i);const a=s.transformQuat([],[0,0,-1],i),p=s.transformQuat([],[0,-1,0],i);if(p[2]<0)return!1;const g=ra(a,p);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(i){const a=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;i[2]=s.clamp(i[2],g/p,g/a),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,p){this._unmodified=!1,this._edgeInsets.interpolate(i,a,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const a=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(i){const a=[new s.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.pointGeometry(0,0)),g=this.pointCoordinate(new s.pointGeometry(this.width,0)),v=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),A=this.pointCoordinate(new s.pointGeometry(0,this.height)),S=Math.floor(Math.min(p.x,g.x,v.x,A.x)),I=Math.floor(Math.max(p.x,g.x,v.x,A.x)),k=1;for(let P=S-k;P<=I+k;P++)P!==0&&a.push(new s.UnwrappedTileID(P,i))}return a}coveringTiles(i){let a=this.coveringZoomLevel(i);const p=a,g=this.elevation&&!i.isTerrainDEM,v=this.projection.name==="mercator";if(i.minzoom!==void 0&&a<i.minzoom)return[];i.maxzoom!==void 0&&a>i.maxzoom&&(a=i.maxzoom);const A=this.locationCoordinate(this.center),S=this.center.lat,I=1<<a,k=[I*A.x,I*A.y,0],P=this.projection.name==="globe",U=!P,j=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,U),J=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=I*s.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),Z=[I*J.x,I*J.y,Q*(U?1:K)],$=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,X=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=i.isTerrainDEM?-X:this._elevation?this._elevation.getMinElevationBelowMSL():0,ue=this.projection.isReprojectedInTileSpace?Tu(this):1,oe=ye=>{const ot=new s.MercatorCoordinate(ye.x+25e-6,ye.y,ye.z),lt=new s.MercatorCoordinate(ye.x,ye.y+25e-6,ye.z),st=ye.toLngLat(),Et=ot.toLngLat(),Ut=lt.toLngLat(),Lt=this.locationCoordinate(st),St=this.locationCoordinate(Et),at=this.locationCoordinate(Ut),Zt=Math.hypot(St.x-Lt.x,St.y-Lt.y),Yt=Math.hypot(at.x-Lt.x,at.y-Lt.y);return Math.sqrt(Zt*Yt)*ue/25e-6},pe=ye=>{const dt=X,ot=le;return{aabb:s.tileAABB(this,I,0,0,0,ye,ot,dt,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:dt,wrap:ye,fullyVisible:!1}},we=[];let Re=[];const De=a,Ye=i.reparseOverscaled?p:a,xe=ye=>ye*ye,qe=xe((Q-this._centerAltitude)*K),He=ye=>{if(!this._elevation||!ye.tileID||!v)return;const dt=this._elevation.getMinMaxForTile(ye.tileID),ot=ye.aabb;dt?(ot.min[2]=dt.min,ot.max[2]=dt.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(ye.shouldSplit=Ie(ye),ye.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},Ie=ye=>{if(ye.zoom<te)return!0;if(ye.zoom===De)return!1;if(ye.shouldSplit!=null)return ye.shouldSplit;const dt=ye.aabb.distanceX(Z),ot=ye.aabb.distanceY(Z);let lt=qe,st=1;if(P){lt=xe(ye.aabb.distanceZ(Z));const Lt=Math.pow(2,ye.zoom),St=s.latFromMercatorY((ye.y+1)/Lt),at=s.latFromMercatorY(ye.y/Lt),Zt=Math.min(Math.max(S,St),at),Yt=s.circumferenceAtLatitude(Zt)/s.circumferenceAtLatitude(S);if(st=Zt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Yt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&ye.zoom===De-1&&Yt>=.9)return!0}else if(g&&(lt=xe(ye.aabb.distanceZ(Z)*K)),this.projection.isReprojectedInTileSpace&&p<=5){const Lt=Math.pow(2,ye.zoom),St=oe(new s.MercatorCoordinate((ye.x+.5)/Lt,(ye.y+.5)/Lt));st=St>.85?1:St}const Et=dt*dt+ot*ot+lt,Ut=xe((1<<De-ye.zoom)*$*st*((Lt,St)=>{if(St*xe(.707)<Lt)return 1;const at=Math.sqrt(St/Lt);return at/(1.4144271570014144+(Math.pow(1.1,at-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(lt,qe),Et));return Et<Ut};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)we.push(pe(-ye)),we.push(pe(ye));for(we.push(pe(0));we.length>0;){const ye=we.pop(),dt=ye.x,ot=ye.y;let lt=ye.fullyVisible;if(!lt){const st=ye.aabb.intersects(j);if(st===0)continue;lt=st===2}if(ye.zoom!==De&&Ie(ye))for(let st=0;st<4;st++){const Et=(dt<<1)+st%2,Ut=(ot<<1)+(st>>1),Lt={aabb:v?ye.aabb.quadrant(st):s.tileAABB(this,I,ye.zoom+1,Et,Ut,ye.wrap,ye.minZ,ye.maxZ,this.projection),zoom:ye.zoom+1,x:Et,y:Ut,wrap:ye.wrap,fullyVisible:lt,tileID:void 0,shouldSplit:void 0,minZ:ye.minZ,maxZ:ye.maxZ};g&&!P&&(Lt.tileID=new s.OverscaledTileID(ye.zoom+1===De?Ye:ye.zoom+1,ye.wrap,ye.zoom+1,Et,Ut),He(Lt)),we.push(Lt)}else{const st=ye.zoom===De?Ye:ye.zoom;if(i.minzoom&&i.minzoom>st)continue;const Et=k[0]-(.5+dt+(ye.wrap<<ye.zoom))*(1<<a-ye.zoom),Ut=k[1]-.5-ot,Lt=ye.tileID?ye.tileID:new s.OverscaledTileID(st,ye.wrap,ye.zoom,dt,ot);Re.push({tileID:Lt,distanceSq:Et*Et+Ut*Ut})}}if(this.fogCullDistSq){const ye=this.fogCullDistSq,dt=this.horizonLineFromTop();Re=Re.filter(ot=>{const lt=[0,0,0,1],st=[s.EXTENT,s.EXTENT,0,1],Et=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());s.transformMat4$1(lt,lt,Et),s.transformMat4$1(st,st,Et);const Ut=s.getAABBPointSquareDist(lt,st);if(Ut===0)return!0;let Lt=!1;const St=this._elevation;if(St&&Ut>ye&&dt!==0){const at=this.calculateProjMatrix(ot.tileID.toUnwrapped());let Zt;i.isTerrainDEM||(Zt=St.getMinMaxForTile(ot.tileID)),Zt||(Zt={min:le,max:X});const Yt=s.furthestTileCorner(this.rotation),Dn=[Yt[0]*s.EXTENT,Yt[1]*s.EXTENT,Zt.max];s.transformMat4(Dn,Dn,at),Lt=(1-Dn[1])*this.height*.5<dt}return Ut<ye||Lt})}return Re.sort((ye,dt)=>ye.distanceSq-dt.distanceSq).map(ye=>ye.tileID)}resize(i,a){this.width=i,this.height=a,this.pixelsToGLUnits=[2/i,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const a=s.clamp(i.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),p=this.projection.project(i.lng,a);return new s.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,a){let p,g;const v=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;p=(a.x-v.x)/S,g=(a.y-v.y)/S}else{const S=this.pointCoordinate(a),I=this.pointCoordinate(v);p=S.x-I.x,g=S.y-I.y}const A=this.locationCoordinate(i);this.setLocation(new s.MercatorCoordinate(A.x-p,A.y-g))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,a){const p=a?s.mercatorZfromAltitude(a,i.lat):void 0,g=this.projection.project(i.lng,i.lat);return new s.MercatorCoordinate(g.x,g.y,p)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,a){const p=a!=null?a:this._centerAltitude,g=[i.x,i.y,0,1],v=[i.x,i.y,1,1];s.transformMat4$1(g,g,this.pixelMatrixInverse),s.transformMat4$1(v,v,this.pixelMatrixInverse);const A=v[3];s.scale$1(g,g,1/g[3]),s.scale$1(v,v,1/A);const S=g[2],I=v[2];return{p0:g,p1:v,t:S===I?0:(p-S)/(I-S)}}screenPointToMercatorRay(i){const a=[i.x,i.y,0,1],p=[i.x,i.y,1,1];return s.transformMat4$1(a,a,this.pixelMatrixInverse),s.transformMat4$1(p,p,this.pixelMatrixInverse),s.scale$1(a,a,1/a[3]),s.scale$1(p,p,1/p[3]),a[2]=s.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,p[2]=s.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,s.scale$1(a,a,1/this.worldSize),s.scale$1(p,p,1/this.worldSize),new s.Ray([a[0],a[1],a[2]],s.normalize([],s.sub([],p,a)))}rayIntersectionCoordinate(i){const{p0:a,p1:p,t:g}=i,v=s.mercatorZfromAltitude(a[2],this._center.lat),A=s.mercatorZfromAltitude(p[2],this._center.lat);return new s.MercatorCoordinate(s.number(a[0],p[0],g)/this.worldSize,s.number(a[1],p[1],g)/this.worldSize,s.number(v,A,g))}pointCoordinate(i,a=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,a)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let a=this.projection.pointCoordinate3D(this,i.x,i.y);if(a)return new s.MercatorCoordinate(a[0],a[1],a[2]);let p=0,g=this.horizonLineFromTop();if(i.y>g)return this.pointCoordinate(i);const v=.02*g,A=i.clone();for(let S=0;S<10&&g-p>v;S++){A.y=s.number(p,g,.66);const I=this.projection.pointCoordinate3D(this,A.x,A.y);I?(g=A.y,a=I):p=A.y}return a?new s.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}_coordinatePoint(i,a){const p=a&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,g=[i.x*this.worldSize,i.y*this.worldSize,p+i.toAltitude(),1];return s.transformMat4$1(g,g,this.pixelMatrix),g[3]>0?new s.pointGeometry(g[0]/g[3],g[1]/g[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:i,left:a}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointCoordinate3D(new s.pointGeometry(a,i)),A=this.pointCoordinate3D(new s.pointGeometry(g,i)),S=this.pointCoordinate3D(new s.pointGeometry(g,p)),I=this.pointCoordinate3D(new s.pointGeometry(a,p));let k=Math.min(v.x,I.x),P=Math.max(A.x,S.x),U=Math.min(v.y,A.y),j=Math.max(I.y,S.y);const J=Math.pow(2,-this.zoom)/16,K=($,te,X,le)=>{const ue=($+X)/2,oe=(te+le)/2,pe=new s.pointGeometry(ue,oe),we=this.pointCoordinate3D(pe),Re=Math.max(0,k-we.x,U-we.y,we.x-P,we.y-j);k=Math.min(k,we.x),P=Math.max(P,we.x),U=Math.min(U,we.y),j=Math.max(j,we.y),Re>J&&(K($,te,ue,oe),K(ue,oe,X,le))};K(a,i,g,i),K(g,i,g,p),K(g,p,a,p),K(a,p,a,i);const Q=new s.LngLat(s.lngFromMercatorX(P),s.latFromMercatorY(U)),Z=new s.LngLat(s.lngFromMercatorX(k),s.latFromMercatorY(j));return new s.LngLatBounds(Z,Q)}_getBounds(i,a){if(this.projection.name==="globe")return this._getGlobeBounds();const p=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),g=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),A=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(p,i),I=this.pointCoordinate(g,i);const k=this.pointCoordinate(v,a),P=this.pointCoordinate(A,a),U=(j,J)=>(J.y-j.y)/(J.x-j.x);return S.y>1&&I.y>=0?S=new s.MercatorCoordinate((1-P.y)/U(P,S)+P.x,1):S.y<0&&I.y<=1&&(S=new s.MercatorCoordinate(-P.y/U(P,S)+P.x,0)),I.y>1&&S.y>=0?I=new s.MercatorCoordinate((1-k.y)/U(k,I)+k.x,1):I.y<0&&S.y<=1&&(I=new s.MercatorCoordinate(-k.y/U(k,I)+k.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(S)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(k))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBounds(0,0);const a=i.visibleDemTiles.reduce((p,g)=>{if(g.dem){const v=g.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*i.exaggeration(),a.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-a*(1-this._horizonShift);return i?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,a){return this.projection.createTileMatrix(this,a,i)}calculateDistanceTileData(i){const a=i.key,p=this._distanceTileDataCache;if(p[a])return p[a];const g=i.canonical,v=1/this.height,A=this.cameraWorldSize/this.zoomScale(g.z),S=(g.x+Math.pow(2,g.z)*i.wrap)*A,I=g.y*A,k=this.point,P=this.angle,U=Math.sin(-P),j=-Math.cos(-P);return p[a]={bearing:[U,j],center:[(k.x-S)*v,(k.y-I)*v],scale:A/s.EXTENT*v},p[a]}calculateFogTileMatrix(i){const a=i.key,p=this._fogTileMatrixCache;if(p[a])return p[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSize,i);return s.multiply(g,this.worldToFogMatrix,g),p[a]=new Float32Array(g),p[a]}calculateProjMatrix(i,a=!1){const p=i.key,g=a?this._alignedProjMatrixCache:this._projMatrixCache;if(g[p])return g[p];const v=this.calculatePosMatrix(i,this.worldSize);return s.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,v),g[p]=new Float32Array(v),g[p]}calculatePixelsToTileUnitsMatrix(i){const a=i.tileID.key,p=this._pixelsToTileUnitsCache;if(p[a])return p[a];const g=function(v,A){const{scale:S}=v.tileTransform,I=S*s.EXTENT/(v.tileSize*Math.pow(2,A.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return k=new Float32Array(4),j=(P=A.inverseAdjustmentMatrix)[1],J=P[2],K=P[3],Z=(U=[I,I])[1],k[0]=P[0]*(Q=U[0]),k[1]=j*Q,k[2]=J*Z,k[3]=K*Z,k;var k,P,U,j,J,K,Q,Z}(i,this);return p[a]=g,p[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(a),g=this._camera.forward(),v=s.mercatorZfromAltitude(1,this._center.lat);p[2]/=v,g[2]/=v,s.normalize(g,g);const A=i.raycast(p,g,i.exaggeration());if(A){const S=s.scaleAndAdd([],p,g,A),I=new s.MercatorCoordinate(S[0],S[1],s.mercatorZfromAltitude(S[2],s.latFromMercatorY(S[1]))),k=(I.z+s.length([I.x-p[0],I.y-p[1],I.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(a),g=i.getAtPointOrZero(new s.MercatorCoordinate(...p)),v=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),A=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*g;if(A<v){const S=this.locationCoordinate(this._center,this._centerAltitude),I=[S.x-p[0],S.y-p[1],S.z-p[2]],k=s.length(I);I[2]-=(v-A)/this._pixelsPerMercatorPixel;const P=s.length(I);if(P===0)return;s.scale$2(I,I,k/P*this._pixelsPerMercatorPixel),this._camera.position=[S.x-I[0],S.y-I[1],S.z*this._pixelsPerMercatorPixel-I[2]],this._camera.orientation=ra(I,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const j=this.center;return j.lat=s.clamp(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(j.lng=s.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const a=this._unmodified,{x:p,y:g}=this.point;let v=0,A=p,S=g;const I=this.width/2,k=this.height/2,P=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(g-k<P&&(S=P+k),g+k>U&&(S=U-k),U-P<this.height&&(v=Math.max(v,this.height/(U-P)),S=(U+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,K=this.worldSize/2-(j+J)/2;A=(p+K+this.worldSize)%this.worldSize-K,A-I<j&&(A=j+I),A+I>J&&(A=J-I),J-j<this.width&&(v=Math.max(v,this.width/(J-j)),A=(J+j)/2)}A===p&&S===g||(this.center=this.unproject(new s.pointGeometry(A,S))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,a=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const p=As(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?a:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-i.x/this.width,v[9]=2*i.y/this.height;let A=s.mul([],v,g);if(this.projection.isReprojectedInTileSpace){const ue=this.locationCoordinate(this.center),oe=s.identity([]);s.translate(oe,oe,[ue.x*this.worldSize,ue.y*this.worldSize,0]),s.multiply(oe,oe,qa(this)),s.translate(oe,oe,[-ue.x*this.worldSize,-ue.y*this.worldSize,0]),s.multiply(A,A,oe),this.inverseAdjustmentMatrix=function(pe){const we=qa(pe,!0);return zt([],[we[0],we[1],we[4],we[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],A,[this.worldSize,this.worldSize,this.worldSize/a,1]),this.projMatrix=A,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const S=s.invert([],v);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(S,this.horizonLineFromTop(),this.height);const I=new Float32Array(16);s.identity(I),s.scale(I,I,[1,-1,1]),s.rotateX(I,I,this._pitch),s.rotateZ(I,I,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),P=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-i.x/this.width,k[9]=2*(i.y+P)/this.height,this.skyboxMatrix=s.multiply(I,k,I);const U=this.point,j=U.x,J=U.y,K=this.width%2/2,Q=this.height%2/2,Z=Math.cos(this.angle),$=Math.sin(this.angle),te=j-Math.round(j)+Z*K+$*Q,X=J-Math.round(J)+Z*Q+$*K,le=new Float64Array(A);if(s.translate(le,le,[te>.5?te-1:te,X>.5?X-1:X,0]),this.alignedProjMatrix=le,A=s.create(),s.scale(A,A,[this.width/2,-this.height/2,1]),s.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=s.create(),s.scale(A,A,[1,-1,1]),s.translate(A,A,[-1,-1,0]),s.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=s.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const ue=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(ue,ue,g),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,a=this.cameraPixelsPerMeter,p=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[i,i,a];s.scale$2(v,v,g),s.scale$2(p,p,-1),s.multiply$2(p,p,v);const A=s.create();s.translate(A,A,p),s.scale(A,A,v),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,a,g)}_computeCameraPosition(i){const a=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-i/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-p[0]*v,g.y/this.worldSize-p[1]*v,i/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],g=i[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((a-p)/g,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,a=this._camera.forward(),{pitch:p,bearing:g}=this._camera.getPitchBearing(),v=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),S=Math.max((i[2]-v)/Math.cos(p),A),I=this._zoomFromMercatorZ(S);s.scaleAndAdd(i,i,a,S),this._pitch=s.clamp(p,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(g,-Math.PI,Math.PI),this._setZoom(s.clamp(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){const a=A=>{const S=this.getCameraToCenterDistance(this.projection,A);return this.scaleZoom(S/(i*this.tileSize))};let p,g=a(this.zoom),v=Math.abs(g-a(g));for(;p!==v;)g=a(g),p=v,v=Math.abs(g-a(g));return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,a){const p=Math.min(i.x,a.x),g=Math.max(i.x,a.x),v=Math.min(i.y,a.y),A=Math.max(i.y,a.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new s.pointGeometry(p,v),new s.pointGeometry(g,A),new s.pointGeometry(p,A),new s.pointGeometry(g,v)],I=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const P of S){const U=this.pointRayIntersection(P);if(U.t<0)return!0;const j=this.rayIntersectionCoordinate(U);if(j.x<I||j.y<0||j.x>k||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,a){const p=s.length(s.sub([],this._camera.position,i)),g=this._zoomFromMercatorZ(p)+a;return p-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const i=function(a,p){const g=[a[0],a[1],a[2],1];s.transformMat4$1(g,g,p);const v=Math.max(g[3],1e-6);return[g[0]/v,g[1]/v,g[2]/v,v]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,i))}}getCameraToCenterDistance(i,a=this.zoom){const p=As(i,a,this.width,this.height,1024),g=i.pixelSpaceConversion(this.center.lat,this.worldSize,p);return .5/Math.tan(.5*this._fov)*this.height*g}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(i,i,this.globeMatrix),i}}function Kh(c,i){let a=!1,p=null;const g=()=>{p=null,a&&(c(),p=setTimeout(g,i),a=!1)};return()=>(a=!0,p||g(),p)}class Su{constructor(i){this._hashName=i&&encodeURIComponent(i),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kh(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,s.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const a=Ul(i);if(this._hashName){const p=this._hashName;let g=!1;const v=s.window.location.hash.slice(1).split("&").map(A=>{const S=A.split("=")[0];return S===p?(g=!0,`${S}=${a}`):A}).filter(A=>A);return g||v.push(`${p}=${a}`),`#${v.join("&")}`}return`#${a}`}_getCurrentHash(){const i=s.window.location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(a=p)}),(a&&a[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(p=>isNaN(p))){const p=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(a[3]||0):i.getBearing();return i.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:p,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,i)}}function Ul(c,i){const a=c.getCenter(),p=Math.round(100*c.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),A=Math.round(a.lng*v)/v,S=Math.round(a.lat*v)/v,I=c.getBearing(),k=c.getPitch();let P=i?`/${A}/${S}/${p}`:`${p}/${S}/${A}`;return(I||k)&&(P+="/"+Math.round(10*I)/10),k&&(P+=`/${Math.round(k)}`),P}const Ao={linearity:.3,easing:s.bezier(0,0,.3,1)},op=s.extend({deceleration:2500,maxSpeed:1400},Ao),Iu=s.extend({deceleration:20,maxSpeed:1400},Ao),Xh=s.extend({deceleration:1e3,maxSpeed:360},Ao),Ac=s.extend({deceleration:1e3,maxSpeed:90},Ao);class vi{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,a=s.exported.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const v=Es(a.pan.mag(),p,s.extend({},op,i||{}));g.offset=a.pan.mult(v.amount/a.pan.mag()),g.center=this._map.transform.center,xi(g,v)}if(a.zoom){const v=Es(a.zoom,p,Iu);g.zoom=this._map.transform.zoom+v.amount,xi(g,v)}if(a.bearing){const v=Es(a.bearing,p,Xh);g.bearing=this._map.transform.bearing+s.clamp(v.amount,-179,179),xi(g,v)}if(a.pitch){const v=Es(a.pitch,p,Ac);g.pitch=this._map.transform.pitch+v.amount,xi(g,v)}if(g.zoom||g.bearing){const v=a.pinchAround===void 0?a.around:a.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function xi(c,i){(!c.duration||c.duration<i.duration)&&(c.duration=i.duration,c.easing=i.easing)}function Es(c,i,a){const{maxSpeed:p,linearity:g,deceleration:v}=a,A=s.clamp(c*g/(i/1e3),-p,p),S=Math.abs(A)/(v*g);return{easing:a.easing,duration:1e3*S,amount:A*(S/2)}}class Rr extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,p,g={}){const v=ke(a.getCanvasContainer(),p),A=a.unproject(v);super(i,s.extend({point:v,lngLat:A,originalEvent:p},g)),this._defaultPrevented=!1,this.target=a}}class Mu extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,p){const g=i==="touchend"?p.changedTouches:p.touches,v=ut(a.getCanvasContainer(),g),A=v.map(I=>a.unproject(I)),S=v.reduce((I,k,P,U)=>I.add(k.div(U.length)),new s.pointGeometry(0,0));super(i,{points:v,point:S,lngLats:A,lngLat:a.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class sp extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class Nl{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new sp(i.type,this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new Rr(i.type,this._map,i))}mouseup(i){this._map.fire(new Rr(i.type,this._map,i))}preclick(i){const a=s.extend({},i);a.type="preclick",this._map.fire(new Rr(a.type,this._map,a))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Rr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Rr(i.type,this._map,i))}mouseover(i){this._map.fire(new Rr(i.type,this._map,i))}mouseout(i){this._map.fire(new Rr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Mu(i.type,this._map,i))}touchmove(i){this._map.fire(new Mu(i.type,this._map,i))}touchend(i){this._map.fire(new Mu(i.type,this._map,i))}touchcancel(i){this._map.fire(new Mu(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ha{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Rr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Rr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ec{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&(Te(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;const p=a,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(p)||!this._box&&p.dist(g)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Le("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const A=Math.min(g.x,p.x),S=Math.max(g.x,p.x),I=Math.min(g.y,p.y),k=Math.max(g.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${I}px)`,this._box.style.width=S-A+"px",this._box.style.height=k-I+"px")})}mouseupWindow(i,a){if(!this._active)return;const p=this._startPos,g=a;if(p&&i.button===0){if(this.reset(),it(),p.x!==g.x||p.y!==g.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(p,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ge(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new s.Event(i,{originalEvent:a}))}}function Cs(c,i){const a={};for(let p=0;p<c.length;p++)a[c[p].identifier]=i[p];return a}class aa{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,a,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){const v=new s.pointGeometry(0,0);for(const A of g)v._add(A);return v.div(g.length)}(a),this.touches=Cs(p,a)))}touchmove(i,a,p){if(this.aborted||!this.centroid)return;const g=Cs(p,a);for(const v in this.touches){const A=this.touches[v],S=g[v];(!S||S.dist(A)>30)&&(this.aborted=!0)}}touchend(i,a,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Ts{constructor(i){this.singleTap=new aa(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,a,p){this.singleTap.touchstart(i,a,p)}touchmove(i,a,p){this.singleTap.touchmove(i,a,p)}touchend(i,a,p){const g=this.singleTap.touchend(i,a,p);if(g){const v=i.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(g)<30;if(v&&A||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Bu{constructor(){this._zoomIn=new Ts({numTouches:1,numTaps:2}),this._zoomOut=new Ts({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,p){this._zoomIn.touchstart(i,a,p),this._zoomOut.touchstart(i,a,p)}touchmove(i,a,p){this._zoomIn.touchmove(i,a,p),this._zoomOut.touchmove(i,a,p)}touchend(i,a,p){const g=this._zoomIn.touchend(i,a,p),v=this._zoomOut.touchend(i,a,p);return g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(g)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $a={0:1,2:2};class Cc{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,a){return!1}_move(i,a){return{}}mousedown(i,a){if(this._lastPoint)return;const p=bt(i);this._correctButton(i,p)&&(this._lastPoint=a,this._eventButton=p)}mousemoveWindow(i,a){const p=this._lastPoint;if(p){if(i.preventDefault(),this._eventButton!=null&&function(g,v){const A=$a[v];return g.buttons===void 0||(g.buttons&A)!==A}(i,this._eventButton))this.reset();else if(this._moved||!(a.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(p,a)}}mouseupWindow(i){this._lastPoint&&bt(i)===this._eventButton&&(this._moved&&it(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ap extends Cc{mousedown(i,a){super.mousedown(i,a),this._lastPoint&&(this._active=!0)}_correctButton(i,a){return a===0&&!i.ctrlKey}_move(i,a){return{around:a,panDelta:a.sub(i)}}}class Jh extends Cc{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const p=.8*(a.x-i.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(i){i.preventDefault()}}class Za extends Cc{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const p=-.5*(a.y-i.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(i){i.preventDefault()}}class lp{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(i,a,p){return this._calculateTransform(i,a,p)}touchmove(i,a,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,a,p)}}touchend(i,a,p){this._calculateTransform(i,a,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,p){p.length>0&&(this._active=!0);const g=Cs(p,a),v=new s.pointGeometry(0,0),A=new s.pointGeometry(0,0);let S=0;for(const k in g){const P=g[k],U=this._touches[k];U&&(v._add(P),A._add(P.sub(U)),S++,g[k]=P)}if(this._touches=g,S<this._minTouches||!A.mag())return;const I=A.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Le("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Wa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,a,p){return{}}touchstart(i,a,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,p){const g=this._firstTwoTouches;if(!g)return;i.preventDefault();const[v,A]=g,S=Ss(p,a,v),I=Ss(p,a,A);if(!S||!I)return;const k=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],k,i)}touchend(i,a,p){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,A=Ss(p,a,g),S=Ss(p,a,v);A&&S||(this._active&&it(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ss(c,i,a){for(let p=0;p<c.length;p++)if(c[p].identifier===a)return i[p]}function Tc(c,i){return Math.log(c/i)/Math.LN2}class W extends Wa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Tc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Tc(this._distance,p),pinchAround:a}}}function la(c,i){return 180*c.angleWith(i)/Math.PI}class Mi extends Wa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a){const p=this._vector;if(this._vector=i[0].sub(i[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:la(this._vector,p),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const a=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const g=la(i,p);return Math.abs(g)<a}}function Sr(c){return Math.abs(c.y)>Math.abs(c.x)}class yn extends Wa{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Sr(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,p){const g=this._lastPoints;if(!g)return;const v=i[0].sub(g[0]),A=i[1].sub(g[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,A,p.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+A.y)/2*-.5})}gestureBeginsVertically(i,a,p){if(this._valid!==void 0)return this._valid;const g=i.mag()>=2,v=a.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=i.y>0==a.y>0;return Sr(i)&&Sr(a)&&A}}const tm={panStep:100,bearingStep:15,pitchStep:10};class nm{constructor(){const i=tm;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,p=0,g=0,v=0,A=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),A=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:S=>{const I=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Is,zoom:a?Math.round(I)+a*(i.shiftKey?2:1):I,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-A*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Is(c){return c*(2-c)}const Ms=4.000244140625;class Gl{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=i.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=s.exported.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,a!==0&&a%Ms==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ke(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Ms?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&k!==0&&(k=1/k);const P=a(),U=Math.pow(2,P),j=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(j*k))),this._type==="wheel"&&(this._startZoom=P,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,v=this._easing;let A,S=!1;if(this._type==="wheel"&&g&&v){const I=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),k=v(I);A=s.number(g,p,k),I<1?this._frameId||(this._frameId=!0):S=!0}else A=p,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:A-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=s.ease;if(this._prevEase){const p=this._prevEase,g=(s.exported.now()-p.start)/p.duration,v=p.easing(g+.01)-p.easing(g),A=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-A*A);a=s.bezier(A,S,.25,1)}return this._prevEase={start:s.exported.now(),duration:i,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Le("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Yo{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,a){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(i.shiftKey?-1:1),around:p.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vt{constructor(){this._tap=new Ts({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,a,p){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=a[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(i,a,p))}touchmove(i,a,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const g=a[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,a,p)}touchend(i,a,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(i,a,p)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class up{constructor(i,a,p){this._el=i,this._mousePan=a,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qo{constructor(i,a,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=a,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Du{constructor(i,a,p,g){this._el=i,this._touchZoom=a,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ua=c=>c.zoom||c.drag||c.pitch||c.rotate;class cp extends s.Event{}class hp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,a){const p=s.sub([],a,i);this.radius=s.length(p[2]<0?s.div([],p,this.constants):[p[0],p[1],0])}projectRay(i){s.div(i,i,this.constants),s.normalize(i,i),s.mul$1(i,i,this.constants);const a=s.scale$2([],i,this.radius);if(a[2]>0){const p=s.scale$2([],[0,0,1],s.dot(a,[0,0,1])),g=s.scale$2([],s.normalize([],[a[0],a[1],0]),this.radius),v=s.add([],a,s.scale$2([],s.sub([],s.add([],g,p),a),2));a[0]=v[0],a[1]=v[1]}return a}}function ku(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class es{constructor(i,a){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vi(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new hp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[g,v,A]of this._listeners)g.addEventListener(v,g===s.window.document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[i,a,p]of this._listeners)i.removeEventListener(a,i===s.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(i){const a=this._map,p=a.getCanvasContainer();this._add("mapEvent",new Nl(a,i));const g=a.boxZoom=new Ec(a,i);this._add("boxZoom",g);const v=new Bu,A=new Sc;a.doubleClickZoom=new Yo(A,v),this._add("tapZoom",v),this._add("clickZoom",A);const S=new vt;this._add("tapDragZoom",S);const I=a.touchPitch=new yn(a);this._add("touchPitch",I);const k=new Jh(i),P=new Za(i);a.dragRotate=new Qo(i,k,P),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const U=new ap(i),j=new lp(a,i);a.dragPan=new up(p,U,j),this._add("mousePan",U),this._add("touchPan",j,["touchZoom","touchRotate"]);const J=new Mi,K=new W;a.touchZoomRotate=new Du(p,K,J,S),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ha(a));const Q=a.scrollZoom=new Gl(a,this);this._add("scrollZoom",Q,["mousePan"]);const Z=a.keyboard=new nm;this._add("keyboard",Z);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[$]&&a[$].enable(i[$])}_add(i,a,p){this._handlers.push({handlerName:i,handler:a,allowed:p}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ua(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,a,p){for(const g in i)if(g!==p&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const a=[];for(const p of i)this._el.contains(p.target)&&a.push(p);return a}handleEvent(i,a){this._updatingCamera=!0;const p=i.type==="renderFrame",g=p?void 0:i,v={needsRenderFrame:!1},A={},S={},I=i.touches?this._getMapTouches(i.touches):void 0,k=I?ut(this._el,I):p?void 0:ke(this._el,i);for(const{handlerName:j,handler:J,allowed:K}of this._handlers){if(!J.isEnabled())continue;let Q;this._blockedByActive(S,K,j)?J.reset():J[a||i.type]&&(Q=J[a||i.type](i,k,I),this.mergeHandlerResult(v,A,Q,j,g),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||J.isActive())&&(S[j]=J)}const P={};for(const j in this._previousActiveHandlers)S[j]||(P[j]=g);this._previousActiveHandlers=S,(Object.keys(P).length||ku(v))&&(this._changes.push([v,A,P]),this._triggerRenderFrame()),(Object.keys(S).length||ku(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=v;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(i,a,p,g,v){if(!p)return;s.extend(i,p);const A={handlerName:g,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(a.zoom=A),p.panDelta!==void 0&&(a.drag=A),p.pitchDelta!==void 0&&(a.pitch=A),p.bearingDelta!==void 0&&(a.rotate=A)}_applyChanges(){const i={},a={},p={};for(const[g,v,A]of this._changes)g.panDelta&&(i.panDelta=(i.panDelta||new s.pointGeometry(0,0))._add(g.panDelta)),g.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(i.around=g.around),g.aroundCoord!==void 0&&(i.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(i.pinchAround=g.pinchAround),g.noInertia&&(i.noInertia=g.noInertia),s.extend(a,v),s.extend(p,A);this._updateMapTransform(i,a,p),this._changes=[]}_updateMapTransform(i,a,p){const g=this._map,v=g.transform,A=te=>[te.x,te.y,te.z];if((te=>{const X=this._eventsInProgress.drag;return X&&!this._handlersById[X.handlerName].isActive()})()&&!ku(i)){const te=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",te!==v.zoom&&this._map._update(!0)}if(!ku(i))return void this._fireEvents(a,p,!0);let{panDelta:S,zoomDelta:I,bearingDelta:k,pitchDelta:P,around:U,aroundCoord:j,pinchAround:J}=i;J!==void 0&&(U=J),(te=>a.drag&&!this._eventsInProgress.drag)()&&U&&(this._dragOrigin=A(v.pointCoordinate3D(U)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),U=U||g.transform.centerPoint,k&&(v.bearing+=k),P&&(v.pitch+=P),v._updateCameraState();const K=[0,0,0];if(S)if(v.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U).dir),X=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U.sub(S)).dir);K[0]=X[0]-te[0],K[1]=X[1]-te[1]}else{const te=v.pointCoordinate(U);if(v.projection.name==="globe"){S=S.rotate(-v.angle);const X=v._pixelsPerMercatorPixel/v.worldSize;K[0]=-S.x*s.mercatorScale(s.latFromMercatorY(te.y))*X,K[1]=-S.y*s.mercatorScale(v.center.lat)*X}else{const X=v.pointCoordinate(U.sub(S));te&&X&&(K[0]=X.x-te.x,K[1]=X.y-te.y)}}const Q=v.zoom,Z=[0,0,0];if(I){const te=A(j||v.pointCoordinate3D(U)),X={dir:s.normalize([],s.sub([],te,v._camera.position))};if(X.dir[2]<0){const le=v.zoomDeltaToMovement(te,I);s.scale$2(Z,X.dir,le)}}const $=s.add(K,K,Z);v._translateCameraConstrained($),I&&Math.abs(v.zoom-Q)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,p,!0)}_fireEvents(i,a,p){const g=ua(this._eventsInProgress),v=ua(i),A={};for(const P in i){const{originalEvent:U}=i[P];this._eventsInProgress[P]||(A[`${P}start`]=U),this._eventsInProgress[P]=i[P]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const P in A)this._fireEvent(P,A[P]);v&&this._fireEvent("move",v.originalEvent);for(const P in i){const{originalEvent:U}=i[P];this._fireEvent(P,U)}const S={};let I;for(const P in this._eventsInProgress){const{handlerName:U,originalEvent:j}=this._eventsInProgress[P];this._handlersById[U].isActive()||(delete this._eventsInProgress[P],I=a[U]||j,S[`${P}end`]=I)}for(const P in S)this._fireEvent(P,S[P]);const k=ua(this._eventsInProgress);if(p&&(g||v)&&!k){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;P?(U(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:I})):(this._map.fire(new s.Event("moveend",{originalEvent:I})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new s.Event(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new cp("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Yh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class dp extends s.Evented{constructor(i,a){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}panBy(i,a,p){return i=s.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,s.extend({offset:i},a),p)}panTo(i,a,p){return this.easeTo(s.extend({center:i},a),p)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,p){return this.easeTo(s.extend({zoom:i},a),p)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,p){return this.easeTo(s.extend({bearing:i},a),p)}resetNorth(i,a){return this.rotateTo(0,s.extend({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}cameraForBounds(i,a){i=s.LngLatBounds.convert(i);const p=a&&a.bearing||0,g=i.getNorthWest(),v=i.getSouthEast();return this._cameraForBounds(this.transform,g,v,p,a)}_extendCameraOptions(i){const a={top:0,bottom:0,right:0,left:0};if(typeof(i=s.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const p=i.padding;i.padding={top:p,bottom:p,right:p,left:p}}return i.padding=s.extend(a,i.padding),i}_minimumAABBFrustumDistance(i,a){const p=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return p/g>i.aspect?p/(2*Math.tan(.5*i.fovX)*i.aspect):g/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,a,p,g,v){const A=i.clone(),S=this._extendCameraOptions(v);A.bearing=g;const I=s.LngLat.convert(a),k=s.LngLat.convert(p),P=.5*(I.lat+k.lat),U=.5*(I.lng+k.lng),j=s.latLngToECEF(P,U),J=s.normalize([],j),K=s.normalize([],s.cross([],J,[0,1,0])),Q=s.cross([],K,J),Z=[K[0],K[1],K[2],0,Q[0],Q[1],Q[2],0,J[0],J[1],J[2],0,0,0,0,1],$=[j,s.latLngToECEF(I.lat,I.lng),s.latLngToECEF(k.lat,I.lng),s.latLngToECEF(k.lat,k.lng),s.latLngToECEF(I.lat,k.lng),s.latLngToECEF(P,I.lng),s.latLngToECEF(P,k.lng),s.latLngToECEF(I.lat,U),s.latLngToECEF(k.lat,U)];let te=s.Aabb.fromPoints($.map(ot=>[s.dot(K,ot),s.dot(Q,ot),s.dot(J,ot)]));const X=s.transformMat4([],te.center,Z);s.squaredLength(X)===0&&s.set(X,0,0,1),s.normalize(X,X),s.scale$2(X,X,s.GLOBE_RADIUS),A.center=s.ecefToLatLng(X);const le=A.getWorldToCameraMatrix(),ue=s.invert(new Float64Array(16),le);te=s.Aabb.applyTransform(te,s.multiply([],le,Z)),s.transformMat4(X,X,le);const oe=.5*(te.max[2]-te.min[2]),pe=this._minimumAABBFrustumDistance(A,te),we=s.scale$2([],[0,0,1],oe),Re=s.add(we,X,we),De=pe+(A.pitch===0?0:s.distance(X,Re)),Ye=A.globeCenterInViewSpace,xe=s.sub([],X,[Ye[0],Ye[1],Ye[2]]);s.normalize(xe,xe),s.scale$2(xe,xe,De);const qe=s.add([],X,xe);s.transformMat4(qe,qe,ue);const He=s.earthRadius/s.GLOBE_RADIUS,Ie=s.length(qe),ye=s.mercatorZfromAltitude(Ie*He-s.earthRadius,0),dt=Math.min(A.zoomFromMercatorZAdjusted(ye),S.maxZoom);return dt>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=dt,this._cameraForBounds(A,a,p,g,v)):{center:A.center,zoom:dt,bearing:g}}queryTerrainElevation(i,a){const p=this.transform.elevation;return p?(a=s.extend({},{exaggerated:!0},a),p.getAtPoint(s.MercatorCoordinate.fromLngLat(i),null,a.exaggerated)):null}_cameraForBounds(i,a,p,g,v){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,a,p,g,v);const A=i.clone(),S=this._extendCameraOptions(v),I=A.padding;A.bearing=g;const k=s.LngLat.convert(a),P=s.LngLat.convert(p),U=new s.LngLat(k.lng,P.lat),j=new s.LngLat(P.lng,k.lat),J=A.project(k),K=A.project(P),Q=this.queryTerrainElevation(k),Z=this.queryTerrainElevation(P),$=this.queryTerrainElevation(U),te=this.queryTerrainElevation(j),X=[[J.x,J.y,Math.min(Q||0,Z||0,$||0,te||0)],[K.x,K.y,Math.max(Q||0,Z||0,$||0,te||0)]];let le=s.Aabb.fromPoints(X);const ue=A.getWorldToCameraMatrix(),oe=s.invert(new Float64Array(16),ue);le=s.Aabb.applyTransform(le,ue);const pe=s.sub([],le.max,le.min),we=I.left||0,Re=I.right||0,De=I.bottom||0,Ye=I.top||0,{left:xe,right:qe,top:He,bottom:Ie}=S.padding,ye=.5*(we+Re),dt=.5*(Ye+De),ot=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(we+Re+xe+qe))/pe[0],(A.height-(De+Ye+Ie+He))/pe[1])),S.maxZoom),lt=A.scale/A.zoomScale(ot);le=new s.Aabb([le.min[0]-(xe+ye)*lt,le.min[1]-(Ie+dt)*lt,le.min[2]],[le.max[0]+(qe+ye)*lt,le.max[1]+(He+dt)*lt,le.max[2]]);const st=.5*pe[2],Et=this._minimumAABBFrustumDistance(A,le),Ut=[0,0,1,0];s.transformMat4$1(Ut,Ut,ue),s.normalize$2(Ut,Ut);const Lt=s.scale$2([],Ut,Et+st),St=s.add([],le.center,Lt),at=(typeof S.offset.x=="number"&&typeof S.offset.y=="number"?new s.pointGeometry(S.offset.x,S.offset.y):s.pointGeometry.convert(S.offset)).rotate(-s.degToRad(g));le.center[0]-=at.x*lt,le.center[1]+=at.y*lt,s.transformMat4(le.center,le.center,oe),s.transformMat4(St,St,oe);const Zt=[le.center[0],le.center[1],St[2]*A.pixelsPerMeter];s.scale$2(Zt,Zt,1/A.worldSize);const Yt=s.lngFromMercatorX(Zt[0]),Dn=s.latFromMercatorY(Zt[1]),Ln=Math.min(A._zoomFromMercatorZ(Zt[2]),S.maxZoom),En=new s.LngLat(Yt,Dn);return A.mercatorFromTransition&&Ln<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Ln,this._cameraForBounds(A,a,p,g,v)):{center:En,zoom:Ln,bearing:g}}fitBounds(i,a,p){const g=this.cameraForBounds(i,a);return this._fitInternal(g,a,p)}fitScreenCoordinates(i,a,p,g,v){const A=s.pointGeometry.convert(i),S=s.pointGeometry.convert(a),I=new s.pointGeometry(Math.min(A.x,S.x),Math.min(A.y,S.y)),k=new s.pointGeometry(Math.max(A.x,S.x),Math.max(A.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,S))return this;const P=this.transform.pointLocation3D(I),U=this.transform.pointLocation3D(k),j=this.transform.pointLocation3D(new s.pointGeometry(I.x,k.y)),J=this.transform.pointLocation3D(new s.pointGeometry(k.x,I.y)),K=[Math.min(P.lng,U.lng,j.lng,J.lng),Math.min(P.lat,U.lat,j.lat,J.lat)],Q=[Math.max(P.lng,U.lng,j.lng,J.lng),Math.max(P.lat,U.lat,j.lat,J.lat)],Z=this._cameraForBounds(this.transform,K,Q,p,g);return this._fitInternal(Z,g,v)}_fitInternal(i,a,p){return i?(delete(a=s.extend(i,a)).padding,a.linear?this.easeTo(a,p):this.flyTo(a,p)):this}jumpTo(i,a){this.stop();const p=i.preloadOnly?this.transform.clone():this.transform;let g=!1,v=!1,A=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(g=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=s.LngLat.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(v=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(A=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),i.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),g&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),v&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),A&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Yh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,a){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.warnOnce(Yh),this;this.stop();const g=p.zoom,v=p.pitch,A=p.bearing;p.setFreeCameraOptions(i);const S=g!==p.zoom,I=v!==p.pitch,k=A!==p.bearing;return this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),S&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),k&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),I&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)),this}easeTo(i,a){this._stop(!1,i.easeId),((i=s.extend({offset:[0,0],duration:500,easing:s.ease},i)).animate===!1||!i.essential&&s.exported.prefersReducedMotion)&&(i.duration=0);const p=this.transform,g=this.getZoom(),v=this.getBearing(),A=this.getPitch(),S=this.getPadding(),I="zoom"in i?+i.zoom:g,k="bearing"in i?this._normalizeBearing(i.bearing,v):v,P="pitch"in i?+i.pitch:A,U="padding"in i?i.padding:p.padding,j=s.pointGeometry.convert(i.offset);let J,K,Q;if(p.projection.name==="globe"){const Re=s.MercatorCoordinate.fromLngLat(p.center),De=j.rotate(-p.angle);Re.x+=De.x/p.worldSize,Re.y+=De.y/p.worldSize;const Ye=Re.toLngLat(),xe=s.LngLat.convert(i.center||Ye);this._normalizeCenter(xe),J=p.centerPoint.add(De),K=new s.pointGeometry(Re.x,Re.y).mult(p.worldSize),Q=new s.pointGeometry(s.mercatorXfromLng(xe.lng),s.mercatorYfromLat(xe.lat)).mult(p.worldSize).sub(K)}else{J=p.centerPoint.add(j);const Re=p.pointLocation(J),De=s.LngLat.convert(i.center||Re);this._normalizeCenter(De),K=p.project(Re),Q=p.project(De).sub(K)}const Z=p.zoomScale(I-g);let $,te;i.around&&($=s.LngLat.convert(i.around),te=p.locationPoint($));const X=this._zooming||I!==g,le=this._rotating||v!==k,ue=this._pitching||P!==A,oe=!p.isPaddingEqual(U),pe=Re=>De=>{if(X&&(Re.zoom=s.number(g,I,De)),le&&(Re.bearing=s.number(v,k,De)),ue&&(Re.pitch=s.number(A,P,De)),oe&&(Re.interpolatePadding(S,U,De),J=Re.centerPoint.add(j)),$)Re.setLocationAtPoint($,te);else{const Ye=Re.zoomScale(Re.zoom-g),xe=I>g?Math.min(2,Z):Math.max(.5,Z),qe=Math.pow(xe,1-De),He=Re.unproject(K.add(Q.mult(De*qe)).mult(Ye));Re.setLocationAtPoint(Re.renderWorldCopies?He.wrap():He,J)}return i.preloadOnly||this._fireMoveEvents(a),Re};if(i.preloadOnly){const Re=this._emulate(pe,i.duration,p);return this._preloadTiles(Re),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=X,this._rotating=le,this._pitching=ue,this._padding=oe,this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,we),this._ease(pe(p),Re=>{p.recenterOnTerrain(),this._afterEase(a,Re)},i),this}_prepareEase(i,a,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||p.moving||this.fire(new s.Event("movestart",i)),this._zooming&&!p.zooming&&this.fire(new s.Event("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new s.Event("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new s.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new s.Event("move",i)),this._zooming&&this.fire(new s.Event("zoom",i)),this._rotating&&this.fire(new s.Event("rotate",i)),this._pitching&&this.fire(new s.Event("pitch",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.Event("zoomend",i)),g&&this.fire(new s.Event("rotateend",i)),v&&this.fire(new s.Event("pitchend",i)),this.fire(new s.Event("moveend",i))}flyTo(i,a){if(!i.essential&&s.exported.prefersReducedMotion){const lt=s.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(lt,a)}this.stop(),i=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},i);const p=this.transform,g=this.getZoom(),v=this.getBearing(),A=this.getPitch(),S=this.getPadding(),I="zoom"in i?s.clamp(+i.zoom,p.minZoom,p.maxZoom):g,k="bearing"in i?this._normalizeBearing(i.bearing,v):v,P="pitch"in i?+i.pitch:A,U="padding"in i?i.padding:p.padding,j=p.zoomScale(I-g),J=s.pointGeometry.convert(i.offset);let K=p.centerPoint.add(J);const Q=p.pointLocation(K),Z=s.LngLat.convert(i.center||Q);this._normalizeCenter(Z);const $=p.project(Q),te=p.project(Z).sub($);let X=i.curve;const le=Math.max(p.width,p.height),ue=le/j,oe=te.mag();if("minZoom"in i){const lt=s.clamp(Math.min(i.minZoom,g,I),p.minZoom,p.maxZoom),st=le/p.zoomScale(lt-g);X=Math.sqrt(st/oe*2)}const pe=X*X;function we(lt){const st=(ue*ue-le*le+(lt?-1:1)*pe*pe*oe*oe)/(2*(lt?ue:le)*pe*oe);return Math.log(Math.sqrt(st*st+1)-st)}function Re(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function De(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const Ye=we(0);let xe=function(lt){return De(Ye)/De(Ye+X*lt)},qe=function(lt){return le*((De(Ye)*(Re(st=Ye+X*lt)/De(st))-Re(Ye))/pe)/oe;var st},He=(we(1)-Ye)/X;if(Math.abs(oe)<1e-6||!isFinite(He)){if(Math.abs(le-ue)<1e-6)return this.easeTo(i,a);const lt=ue<le?-1:1;He=Math.abs(Math.log(ue/le))/X,qe=function(){return 0},xe=function(st){return Math.exp(lt*X*st)}}i.duration="duration"in i?+i.duration:1e3*He/("screenSpeed"in i?+i.screenSpeed/X:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Ie=v!==k,ye=P!==A,dt=!p.isPaddingEqual(U),ot=lt=>st=>{const Et=st*He,Ut=1/xe(Et);lt.zoom=st===1?I:g+lt.scaleZoom(Ut),Ie&&(lt.bearing=s.number(v,k,st)),ye&&(lt.pitch=s.number(A,P,st)),dt&&(lt.interpolatePadding(S,U,st),K=lt.centerPoint.add(J));const Lt=st===1?Z:lt.unproject($.add(te.mult(qe(Et))).mult(Ut));return lt.setLocationAtPoint(lt.renderWorldCopies?Lt.wrap():Lt,K),lt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(a),lt};if(i.preloadOnly){const lt=this._emulate(ot,i.duration,p);return this._preloadTiles(lt),this}return this._zooming=!0,this._rotating=Ie,this._pitching=ye,this._padding=dt,this._prepareEase(a,!1),this._ease(ot(p),()=>this._afterEase(a),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,a)}if(!i){const p=this.handlers;p&&p.stop(!1)}return this}_ease(i,a,p){p.animate===!1||p.duration===0?(i(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,a){i=s.wrap(i,-180,180);const p=Math.abs(i-a);return Math.abs(i-360-a)<p&&(i-=360),Math.abs(i+360-a)<p&&(i+=360),i}_normalizeCenter(i){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const p=i.lng-a.center.lng;i.lng+=p>180?-360:p<-180?360:0}_emulate(i,a,p){const g=Math.ceil(15*a/1e3),v=[],A=i(p.clone());for(let S=0;S<=g;S++){const I=A(S/g);v.push(I.clone())}return v}}class Qh{constructor(i={}){this.options=i,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const a=this.options&&this.options.compact;return this._map=i,this._container=Le("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Le("button","mapboxgl-ctrl-attrib-button",this._container),Le("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Le("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,a){const p=this._map._getUIString(`AttributionControl.${a}`);i.setAttribute("aria-label",p),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(i){const p=a.reduce((g,v,A)=>(v.value&&(g+=`${v.key}=${v.value}${A<a.length-1?"&":""}`),g),"?");i.href=`${s.config.FEEDBACK_URL}/${p}#${Ul(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._sourceCaches;for(const g in a){const v=a[g];if(v.used){const A=v.getSource();A.attribution&&i.indexOf(A.attribution)<0&&i.push(A.attribution)}}i.sort((g,v)=>g.length-v.length),i=i.filter((g,v)=>{for(let A=v+1;A<i.length;A++)if(i[A].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class zu{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Le("div","mapboxgl-ctrl");const a=Le("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const a in i){const p=i[a].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Ic{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){const a=this._currentlyRunning,p=a?this._queue.concat(a):this._queue;for(const g of p)if(g.id===i)return void(g.cancelled=!0)}run(i=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const p of a)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Eo(c,i,a){if(c=new s.LngLat(c.lng,c.lat),i){const p=new s.LngLat(c.lng-360,c.lat),g=new s.LngLat(c.lng+360,c.lat),v=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),A=a.locationPoint(c).distSqr(i),S=i.x<0||i.y<0||i.x>a.width||i.y>a.height;a.locationPoint(p).distSqr(i)<A&&(S||Math.abs(p.lng-a.center.lng)<v)?c=p:a.locationPoint(g).distSqr(i)<A&&(S||Math.abs(g.lng-a.center.lng)<v)&&(c=g)}for(;Math.abs(c.lng-a.center.lng)>180;){const p=a.locationPoint(c);if(p.x>=0&&p.y>=0&&p.x<=a.width&&p.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}const Mc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bc extends s.Evented{constructor(i,a){if(super(),(i instanceof s.window.HTMLElement||a)&&(i=s.extend({element:i},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=s.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Le("div");const g=41,v=27,A=ct("svg",{display:"block",height:g*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${g}`},this._element),S=ct("radialGradient",{id:"shadowGradient"},ct("defs",{},A));ct("stop",{offset:"10%","stop-opacity":.4},S),ct("stop",{offset:"100%","stop-opacity":.05},S),ct("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),ct("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),ct("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),ct("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=s.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const p=this._element.classList;for(const g in Mc)p.remove(`mapboxgl-marker-anchor-${g}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=s.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const a=i.code,p=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(i){const a=i.originalEvent.target,p=this._element;this._popup&&(a===p||p.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,a=this._pos;if(!i||!a)return!1;const p=i.unproject(a),g=i.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const a=this._pos;if(!a||a.x<0||a.x>i.transform.width||a.y<0||a.y>i.transform.height)return void this._clearFadeTimer();const p=i.unproject(a);let g;i._showingGlobe()&&s.isLngLatBehindGlobe(i.transform,this._lngLat)?g=0:(g=1-i._queryFogOpacity(p),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${Mc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const i=this._pos,a=this._map,p=this.getPitchAlignment();if(!a||!i||p!=="map")return"";if(!a._showingGlobe()){const I=a.getPitch();return I?`rotateX(${I}deg)`:""}const g=s.radToDeg(s.globeTiltAtLngLat(a.transform,this._lngLat)),v=i.sub(s.globeCenterToScreenPoint(a.transform)),A=Math.abs(v.x)+Math.abs(v.y);if(A===0)return"";const S=g/A;return`rotateX(${-v.y*S}deg) rotateY(${v.x*S}deg)`}_calculateZTransform(){const i=this._pos,a=this._map;if(!a||!i)return"";let p=0;const g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){const v=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),A=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=s.radToDeg(Math.atan2(A.y,A.x))-90}else p=-a.getBearing();else if(g==="horizon"){const v=s.smoothstep(4,6,a.getZoom()),A=s.globeCenterToScreenPoint(a.transform);A.y+=v*a.transform.height;const S=i.sub(A),I=s.radToDeg(Math.atan2(S.y,S.x));p=(I>90?I-270:I+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(i){s.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Eo(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),i===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=s.pointGeometry.convert(i),this._update(),this}_onMove(i){const a=this._map;if(!a)return;const p=this._pointerdownPos,g=this._positionDelta;if(p&&g){if(!this._isDragging){const v=this._clickTolerance||a._clickTolerance;if(i.point.dist(p)<v)return;this._isDragging=!0}this._pos=i.point.sub(g),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(i){const a=this._map,p=this._pos;a&&p&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(p),this._pointerdownPos=i.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const a=this._map;return a&&(i?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const eo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ed(c=new s.pointGeometry(0,0),i="bottom"){if(typeof c=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(i){case"top":return new s.pointGeometry(0,c);case"top-left":return new s.pointGeometry(a,a);case"top-right":return new s.pointGeometry(-a,a);case"bottom":return new s.pointGeometry(0,-c);case"bottom-left":return new s.pointGeometry(a,-a);case"bottom-right":return new s.pointGeometry(-a,-a);case"left":return new s.pointGeometry(c,0);case"right":return new s.pointGeometry(-c,0)}return new s.pointGeometry(0,0)}return c instanceof s.pointGeometry||Array.isArray(c)?s.pointGeometry.convert(c):s.pointGeometry.convert(c[i]||[0,0])}class fp{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const a=s.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,a,p){this._start=this.getValue(a),this._end=i,this._startTime=a,this._endTime=a+p}}const mp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},td={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Pu(c){c.parentNode&&c.parentNode.removeChild(c)}const nd={showCompass:!0,showZoom:!0,visualizePitch:!1};class _p{constructor(i,a,p=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Jh({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,p&&(this.mousePitch=new Za({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(i,a){this.mouseRotate.mousedown(i,a),this.mousePitch&&this.mousePitch.mousedown(i,a),Te()}move(i,a){const p=this.map,g=this.mouseRotate.mousemoveWindow(i,a),v=g&&g.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){const A=this.mousePitch.mousemoveWindow(i,a),S=A&&A.pitchDelta;S&&p.setPitch(p.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ge(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(s.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),ke(this.element,i)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,ke(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ut(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=ut(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const gp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Lu={maxWidth:100,unit:"metric"};function Vl(c,i,a){const p=Ka(i),g=p/i,v={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[a];this._map._requestDomTask(()=>{this._container.style.width=c*g+"px",this._container.innerHTML=`${p}&nbsp;${v}`})}function Ka(c){const i=Math.pow(10,`${Math.floor(c)}`.length-1);let a=c/i;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(p){const g=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*g)/g}(a),i*a}const Fu={version:s.version,supported:be,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends dp{constructor(c){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(c=s.extend({},td,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(c.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fr(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new Ic,this._domRenderTaskQueue=new Ic,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},mp,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fp(0),this._interactionRange=[1/0,-1/0],this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=s.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new es(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new Su(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,s.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new Qh({customAttribution:c.customAttribution})),this._logoControl=new zu,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new s.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new s.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(c,i){if(i===void 0&&(i=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=c.onAdd(this);this._controls.push(c);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(a,p.firstChild):p.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(c);return i>-1&&this._controls.splice(i,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),this.fire(new s.Event("resize",c)),i&&this.fire(new s.Event("moveend",c)),this}getBounds(){return this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(s.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?s.window.navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(i=>i==="auto"?s.window.navigator.language:i):c}setLanguage(c){const i=this._parseLanguage(c);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,i=c.projection.name;let a;i==="globe"&&c.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),a=!0):i==="mercator"&&c.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,i){return this._updateProjection(c||i||{name:"mercator"})}_updateProjection(c){let i;if(i=c.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(c){return this.transform.locationPoint3D(s.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(s.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,i,a){if(c==="mouseenter"||c==="mouseover"){let p=!1;const g=A=>{const S=i.filter(k=>this.getLayer(k)),I=S.length?this.queryRenderedFeatures(A.point,{layers:S}):[];I.length?p||(p=!0,a.call(this,new Rr(c,this,A.originalEvent,{features:I}))):p=!1},v=()=>{p=!1};return{layers:new Set(i),listener:a,delegates:{mousemove:g,mouseout:v}}}if(c==="mouseleave"||c==="mouseout"){let p=!1;const g=A=>{const S=i.filter(I=>this.getLayer(I));(S.length?this.queryRenderedFeatures(A.point,{layers:S}):[]).length?p=!0:p&&(p=!1,a.call(this,new Rr(c,this,A.originalEvent)))},v=A=>{p&&(p=!1,a.call(this,new Rr(c,this,A.originalEvent)))};return{layers:new Set(i),listener:a,delegates:{mousemove:g,mouseout:v}}}{const p=g=>{const v=i.filter(S=>this.getLayer(S)),A=v.length?this.queryRenderedFeatures(g.point,{layers:v}):[];A.length&&(g.features=A,a.call(this,g),delete g.features)};return{layers:new Set(i),listener:a,delegates:{[c]:p}}}}on(c,i,a){if(a===void 0)return super.on(c,i);Array.isArray(i)||(i=[i]);const p=this._createDelegatedListener(c,i,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(p);for(const g in p.delegates)this.on(g,p.delegates[g]);return this}once(c,i,a){if(a===void 0)return super.once(c,i);Array.isArray(i)||(i=[i]);const p=this._createDelegatedListener(c,i,a);for(const g in p.delegates)this.once(g,p.delegates[g]);return this}off(c,i,a){if(a===void 0)return super.off(c,i);i=new Set(Array.isArray(i)?i:[i]);const p=(v,A)=>{if(v.size!==A.size)return!1;for(const S of v)if(!A.has(S))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[c]:void 0;return g&&(v=>{for(let A=0;A<v.length;A++){const S=v[A];if(S.listener===a&&p(S.layers,i)){for(const I in S.delegates)this.off(I,S.delegates[I]);return v.splice(A,1),this}}})(g),this}queryRenderedFeatures(c,i){return this.style?(i!==void 0||c===void 0||c instanceof s.pointGeometry||Array.isArray(c)||(i=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(c,i){return this.style.querySourceFeatures(c,i)}setStyle(c,i){return(i=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(c,i))}_getUIString(c){const i=this._locale[c];if(i==null)throw new Error(`Missing UI string '${c}'`);return i}_updateStyle(c,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new vo(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new vo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,i){if(typeof c=="string"){const a=this._requestManager.normalizeStyleURL(c),p=this._requestManager.transformRequest(a,s.ResourceType.Style);s.getJSON(p,(g,v)=>{g?this.fire(new s.ErrorEvent(g)):v&&this._updateDiff(v,i)})}else typeof c=="object"&&this._updateDiff(c,i)}_updateDiff(c,i){try{this.style.setState(c)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(c,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(c,i){return this._lazyInitEmptyStyle(),this.style.addSource(c,i),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const i in c){const a=c[i]._tiles;for(const p in a){const g=a[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(c,i,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,i,a)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,i,{pixelRatio:a=1,sdf:p=!1,stretchX:g,stretchY:v,content:A}={}){if(this._lazyInitEmptyStyle(),i instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&i instanceof s.window.ImageBitmap){const{width:S,height:I,data:k}=s.exported.getImageData(i);this.style.addImage(c,{data:new s.RGBAImage({width:S,height:I},k),pixelRatio:a,stretchX:g,stretchY:v,content:A,sdf:p,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:I}=i,k=i;this.style.addImage(c,{data:new s.RGBAImage({width:S,height:I},new Uint8Array(k.data)),pixelRatio:a,stretchX:g,stretchY:v,content:A,sdf:p,version:0,userImage:k}),k.onAdd&&k.onAdd(this,c)}}updateImage(c,i){const a=this.style.getImage(c);if(!a)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&i instanceof s.window.ImageBitmap?s.exported.getImageData(i):i,{width:g,height:v}=p;g!==void 0&&v!==void 0?g===a.data.width&&v===a.data.height?(a.data.replace(p.data,!(i instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&i instanceof s.window.ImageBitmap)),this.style.updateImage(c,a)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,i){s.getImage(this._requestManager.transformRequest(c,s.ResourceType.Image),(a,p)=>{i(a,p instanceof s.window.HTMLImageElement?s.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(c,i){return this._lazyInitEmptyStyle(),this.style.addLayer(c,i),this._update(!0)}moveLayer(c,i){return this.style.moveLayer(c,i),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,i,a){return this.style.setLayerZoomRange(c,i,a),this._update(!0)}setFilter(c,i,a={}){return this.style.setFilter(c,i,a),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,i,a,p={}){return this.style.setPaintProperty(c,i,a,p),this._update(!0)}getPaintProperty(c,i){return this.style.getPaintProperty(c,i)}setLayoutProperty(c,i,a,p={}){return this.style.setLayoutProperty(c,i,a,p),this._update(!0)}getLayoutProperty(c,i){return this.style.getLayoutProperty(c,i)}setLight(c,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(c),this.transform):0}setFeatureState(c,i){return this.style.setFeatureState(c,i),this._update()}removeFeatureState(c,i){return this.style.removeFeatureState(c,i),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let a,p,g,v=this._container;for(;v&&(!p||!g);){const A=s.window.getComputedStyle(v).transform;A&&A!=="none"&&(a=A.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(p=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),v=v.parentElement}this._containerWidth=p?Math.abs(c/p):c,this._containerHeight=g?Math.abs(i/g):i}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Le("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Le("div","mapboxgl-canvas-container",c);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=Le("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=Le("div","mapboxgl-control-container",c),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{p[g]=Le("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,i){const a=s.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(i),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${i}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const i=this._markers.indexOf(c);i!==-1&&this._markers.splice(i,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const i=this._popups.indexOf(c);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const c=s.extend({},be.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);i?(s.storeAuthState(i,!0),this.painter=new wc(i,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(i)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let i;const a=this.painter.context.extTimerQuery,p=s.exported.now();if(this.listens("gpu-timing-frame")&&(i=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let g=!1;const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,k=this.transform.pitch,P=s.exported.now();this.style.zoomHistory.update(I,P);const U=new s.EvaluationParameters(I,{now:P,fadeDuration:v,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=U.crossFadingFactor();j===1&&j===this._crossFadingFactor||(g=!0,this._crossFadingFactor=j),this.style.update(U)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||g)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const I=s.exported.now()-p;a.endQueryEXT(a.TIME_ELAPSED_EXT,i),setTimeout(()=>{const k=a.getQueryObjectEXT(i,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(i),this.fire(new s.Event("gpu-timing-frame",{cpuTime:I,gpuTime:k})),s.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(I);this.fire(new s.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(I);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(S||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(A=this._updateAverageElevation(p,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const i of this._markers)c&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!c||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(c,i=!1){const a=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((i||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let g=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=c;const A=Math.abs(p-g);if(A>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(g),a(g);this._averageElevation.easeTo(g,c,300)}else if(A>1e-4)return this._averageElevation.jumpTo(g),a(g)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===s.AUTH_ERR_MSG||c.status===401)){const i=this.painter.context.gl;s.storeAuthState(i,!1),this._logoControl instanceof zu&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const a=this.painter.context.gl,p=a.createFramebuffer();function g(v){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,v,0);const A=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,A),A}return a.bindFramebuffer(a.FRAMEBUFFER,p),this._canvasPixelComparison(g(c),i.canvasCopies.map(g),i.timeStamps)}_canvasPixelComparison(c,i,a){let p=a[1]-a[0];const g=c.length/4;for(let v=0;v<i.length;v++){const A=i[v];let S=0;for(let I=0;I<A.length;I+=4)A[I]===c[I]&&A[I+1]===c[I+1]&&A[I+2]===c[I+2]&&A[I+3]===c[I+3]&&(S+=1);p+=(a[v+2]-a[v+1])*(1-S/g)}return p}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),Pu(this._canvasContainer),Pu(this._controlContainer),Pu(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=s.exported.frame(i=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(i)}))}_preloadTiles(c){const i=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(i,(a,p)=>a._preloadTiles(c,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,c&&this._update())}_setCacheLimits(c,i){s.setCacheLimits(c,i)}get version(){return s.version}},NavigationControl:class{constructor(c){this.options=s.extend({},nd,c),this._container=Le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Le("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Le("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:i}):a.resetNorth({},{originalEvent:i}))}),this._compassIcon=Le("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const i=c.getZoom(),a=i===c.getMaxZoom(),p=i===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _p(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,i){const a=Le("button",c,this._container);return a.type="button",a.addEventListener("click",i),a}_setButtonTitle(c,i){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${i}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.Evented{constructor(c){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},gp,c),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=Le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const i=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,c(a)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(a=>i(a.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(c){const i=this._map.getMaxBounds(),a=c.coords;return!!i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",c)),this._finish()}}_updateCamera(c){const i=new s.LngLat(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,p=this._map.getBearing(),g=s.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(a),g,{geolocateSource:!0})}_updateMarker(c){if(c){const i=new s.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,i=s.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Le("button","mapboxgl-ctrl-geolocate",this._container),Le("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Le("div","mapboxgl-user-location"),this._dotElement.appendChild(Le("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Le("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Le("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qh,ScaleControl:class{constructor(c){this.options=s.extend({},Lu,c),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Vl.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,i=this._map,a=i._containerHeight/2,p=i._containerWidth/2-c/2,g=i.unproject([p,a]),v=i.unproject([p+c,a]),A=g.distanceTo(v);if(this.options.unit==="imperial"){const S=3.2808*A;S>5280?this._setScale(c,S/5280,"mile"):this._setScale(c,S,"foot")}else this.options.unit==="nautical"?this._setScale(c,A/1852,"nautical-mile"):A>=1e3?this._setScale(c,A/1e3,"kilometer"):this._setScale(c,A,"meter")}_setScale(c,i,a){const p=Ka(i),g=p/i;this._map._requestDomTask(()=>{this._container.style.width=c*g+"px",this._container.innerHTML=a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:a}).format(p):`${p}&nbsp;nm`})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=Le("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Le("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=Le("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Le("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(c){super(),this.options=s.extend(Object.create(eo),c),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=s.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(s.window.document.createTextNode(c))}setHTML(c){const i=s.window.document.createDocumentFragment(),a=s.window.document.createElement("body");let p;for(a.innerHTML=c;p=a.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Le("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(c),this.options.closeButton){const a=this._closeButton=Le("button","mapboxgl-popup-close-button",i);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let i;return this._classList.delete(c)?i=!1:(this._classList.add(c),i=!0),this._updateClassList(),i}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const i=this._map,a=this._container,p=this._pos;if(!i||!a||!p)return"bottom";const g=a.offsetWidth,v=a.offsetHeight,A=p.x<g/2,S=p.x>i.transform.width-g/2;if(p.y+c<v)return A?"top-left":S?"top-right":"top";if(p.y>i.transform.height-v){if(A)return"bottom-left";if(S)return"bottom-right"}return A?"left":S?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),c.className=i.join(" ")}_update(c){const i=this._map,a=this._content;if(!i||!this._lngLat&&!this._trackPointer||!a)return;let p=this._container;if(p||(p=this._container=Le("div","mapboxgl-popup",i.getContainer()),this._tip=Le("div","mapboxgl-popup-tip",p),p.appendChild(a)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Eo(this._lngLat,this._pos,i.transform)),!this._trackPointer||c){const g=this._pos=this._trackPointer&&c?c:i.project(this._lngLat),v=ed(this.options.offset),A=this._anchor=this._getAnchor(v.y),S=ed(this.options.offset,A),I=g.add(S).round();i._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${Mc[A]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&i._showingGlobe()){const g=s.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(pp);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Bc,Style:vo,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Ol,Evented:s.Evented,config:s.config,prewarm:function(){Gt().acquire(Ft)},clearPrewarmedResources:function(){const c=Mt;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Ft),Mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return Dt.workerCount},set workerCount(c){Dt.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){s.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Fu});var O=C;return O})})(uC);const uw=uC.exports;var cw={};for(var Yy=32;Yy<127;Yy++)cw[Yy]=String.fromCharCode(Yy);function LS(r){var l=0,f=0;return FS(r,function(w,C,D){var O=Math.round(C*1e5),s=Math.round(D*1e5);return w+=UA(OA(O-l))+UA(OA(s-f)),l=O,f=s,w})}function FS(r,l){for(var f=null,w=0,C=0,D="",O=0;O<r.length;O++)f=r[O],w=f.lat||f.x||f[0],C=f.lng||f.y||f[1],D=l(D,w,C);return D}function OA(r){return r<0?~(r<<1):r<<1}function RS(r){return(r&31|32)+63}function UA(r){for(var l="";r>=32;)l+=cw[RS(r)],r=r>>5;return l+=cw[r+63],l}var OS=LS,NA=1e5;function Ff(r){var l=[],f=0,w=0;return Ff.integers(r,function(C,D){f+=C,w+=D,l.push([f/NA,w/NA])}),l}Ff.sign=function(r){return r&1?~(r>>>1):r>>>1};Ff.integers=function(r,l){for(var f=0,w=0,C=0,D=0,O=0,s=0,q=0;q<r.length;q++)D=r.charCodeAt(q)-63,O=O|(D&31)<<s,s=s+5,D<32&&(++f&1?w=Ff.sign(O):(C=Ff.sign(O),l(w,C)),O=0,s=0);return f};var US=Ff,NS={encode:OS,decode:US};uw.accessToken="pk.eyJ1Ijoic2VhZGVlcCIsImEiOiJjbDliYW1wZzUwczJtM29xdHpzcnEyMjFpIn0.t_6sNxBfaIvu6C5XqjT5ww";class GS extends Kn.exports.PureComponent{constructor(l){super(l),this.state={lng:77.57475793027761,lat:12.97724955890747,zoom:11},this.mapContainer=Kn.exports.createRef()}componentDidMount(){const{busData:l,selectedTab:f}=this.props,{lng:w,lat:C,zoom:D}=this.state,O=new uw.Map({container:this.mapContainer.current,style:"mapbox://styles/mapbox/streets-v11",center:[w,C],zoom:D});O.on("move",()=>{this.setState({lng:O.getCenter().lng.toFixed(4),lat:O.getCenter().lat.toFixed(4),zoom:O.getZoom().toFixed(2)})}),O.on("load",()=>{l.map(s=>{const q=`route-${f}-${s.name}`;O.addSource(q,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:NS.decode(decodeURIComponent(s.route))}}}),O.addLayer({id:q,type:"line",source:q,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#aaaaaa","line-width":4}})})}),this.map=O}componentDidUpdate(l,f,w){const{location:C,selectedBus:D,selectedTab:O}=this.props,{location:s,selectedBus:q,selectedTab:be}=l;if(C&&!s){const je=document.createElement("div");je.className="location-indicator",this.locationMarker=new uw.Marker(je).setLngLat(C).addTo(this.map)}if(D!==q){if(q){const je=`route-${be}-${q}`,Pe=this.map.getLayer(je);this.map.setPaintProperty(Pe.id,"line-color","#aaaaaa")}if(D){const je=`route-${O}-${D}`,Pe=this.map.getLayer(je);this.map.moveLayer(Pe.id),this.map.setPaintProperty(Pe.id,"line-color","#038cfc")}}}render(){return Kn.exports.createElement("div",{id:"map",ref:this.mapContainer,className:"map-container"})}}var hw={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(r,l){(function(){var f,w="4.17.21",C=200,D="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",O="Expected a function",s="Invalid `variable` option passed into `_.template`",q="__lodash_hash_undefined__",be=500,je="__lodash_placeholder__",Pe=1,Le=2,ct=4,ht=1,yt=2,hn=1,Te=2,ge=4,Se=8,it=16,ke=32,ut=64,bt=128,Pt=256,zt=512,qt=30,rr="...",Oo=800,go=16,_s=1,cn=2,gs=3,Ni=1/0,wt=9007199254740991,Jt=17976931348623157e292,Bt=0/0,gn=4294967295,oi=gn-1,br=gn>>>1,Fi=[["ary",bt],["bind",hn],["bindKey",Te],["curry",Se],["curryRight",it],["flip",zt],["partial",ke],["partialRight",ut],["rearg",Pt]],Ki="[object Arguments]",Ri="[object Array]",Gi="[object AsyncFunction]",Hr="[object Boolean]",ys="[object Date]",Pr="[object DOMException]",Da="[object Error]",Xn="[object Function]",$r="[object GeneratorFunction]",Qt="[object Map]",or="[object Number]",cu="[object Null]",Vi="[object Object]",ka="[object Promise]",hu="[object Proxy]",Zr="[object RegExp]",Ar="[object Set]",Ii="[object String]",yo="[object Symbol]",pl="[object Undefined]",vs="[object WeakMap]",fl="[object WeakSet]",Wr="[object ArrayBuffer]",Uo="[object DataView]",$s="[object Float32Array]",sr="[object Float64Array]",za="[object Int8Array]",Zs="[object Int16Array]",No="[object Int32Array]",Go="[object Uint8Array]",Pa="[object Uint8ClampedArray]",ml="[object Uint16Array]",Ws="[object Uint32Array]",Ks=/\b__p \+= '';/g,_l=/\b(__p \+=) '' \+/g,gl=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Kr=/&(?:amp|lt|gt|quot|#39);/g,La=/[&<>"']/g,ic=RegExp(Kr.source),yl=RegExp(La.source),vl=/<%-([\s\S]+?)%>/g,Er=/<%([\s\S]+?)%>/g,Xs=/<%=([\s\S]+?)%>/g,du=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Fa=/^\w*$/,ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,R=/[\\^$.*+?()[\]{}|]/g,V=RegExp(R.source),ee=/^\s+/,se=/\s/,fe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ee=/\{\n\/\* \[wrapped with (.+)\] \*/,Ae=/,? & /,_e=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Be=/[()=,{}\[\]\/\s]/,Ke=/\\(\\)?/g,_t=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Je=/\w*$/,Ft=/^[-+]0x[0-9a-f]+$/i,Dt=/^0b[01]+$/i,Mt=/^\[object .+?Constructor\]$/,Gt=/^0o[0-7]+$/i,sn=/^(?:0|[1-9]\d*)$/,An=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Rt=/($^)/,Pn=/['\n\r\u2028\u2029\\]/g,Tn="\\ud800-\\udfff",Js="\\u0300-\\u036f",xs="\\ufe20-\\ufe2f",Ue="\\u20d0-\\u20ff",Vo=Js+xs+Ue,ui="\\u2700-\\u27bf",ws="a-z\\xdf-\\xf6\\xf8-\\xff",Kd="\\xac\\xb1\\xd7\\xf7",jo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",xl="\\u2000-\\u206f",Xd=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ra="A-Z\\xc0-\\xd6\\xd8-\\xde",pt="\\ufe0e\\ufe0f",nn=Kd+jo+xl+Xd,an="['\u2019]",qo="["+Tn+"]",Oa="["+nn+"]",rn="["+Vo+"]",wl="\\d+",bl="["+ui+"]",Ua="["+ws+"]",Cr="[^"+Tn+nn+wl+ui+ws+Ra+"]",Nn="\\ud83c[\\udffb-\\udfff]",Jf="(?:"+rn+"|"+Nn+")",Xr="[^"+Tn+"]",Al="(?:\\ud83c[\\udde6-\\uddff]){2}",Xi="[\\ud800-\\udbff][\\udc00-\\udfff]",Ys="["+Ra+"]",pu="\\u200d",fu="(?:"+Ua+"|"+Cr+")",mu="(?:"+Ys+"|"+Cr+")",El="(?:"+an+"(?:d|ll|m|re|s|t|ve))?",Qs="(?:"+an+"(?:D|LL|M|RE|S|T|VE))?",ji=Jf+"?",ai="["+pt+"]?",Mh="(?:"+pu+"(?:"+[Xr,Al,Xi].join("|")+")"+ai+ji+")*",Bh="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ar="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",lr=ai+ji+Mh,Jd="(?:"+[bl,Al,Xi].join("|")+")"+lr,Na="(?:"+[Xr+rn+"?",rn,Al,Xi,qo].join("|")+")",yi=RegExp(an,"g"),_u=RegExp(rn,"g"),gu=RegExp(Nn+"(?="+Nn+")|"+Na+lr,"g"),yu=RegExp([Ys+"?"+Ua+"+"+El+"(?="+[Oa,Ys,"$"].join("|")+")",mu+"+"+Qs+"(?="+[Oa,Ys+fu,"$"].join("|")+")",Ys+"?"+fu+"+"+El,Ys+"+"+Qs,ar,Bh,wl,Jd].join("|"),"g"),qi=RegExp("["+pu+Tn+Vo+pt+"]"),Dh=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,kh=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ho=-1,kn={};kn[$s]=kn[sr]=kn[za]=kn[Zs]=kn[No]=kn[Go]=kn[Pa]=kn[ml]=kn[Ws]=!0,kn[Ki]=kn[Ri]=kn[Wr]=kn[Hr]=kn[Uo]=kn[ys]=kn[Da]=kn[Xn]=kn[Qt]=kn[or]=kn[Vi]=kn[Zr]=kn[Ar]=kn[Ii]=kn[vs]=!1;var Gn={};Gn[Ki]=Gn[Ri]=Gn[Wr]=Gn[Uo]=Gn[Hr]=Gn[ys]=Gn[$s]=Gn[sr]=Gn[za]=Gn[Zs]=Gn[No]=Gn[Qt]=Gn[or]=Gn[Vi]=Gn[Zr]=Gn[Ar]=Gn[Ii]=Gn[yo]=Gn[Go]=Gn[Pa]=Gn[ml]=Gn[Ws]=!0,Gn[Da]=Gn[Xn]=Gn[vs]=!1;var Yf={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},zh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Cl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Qf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Yd=parseFloat,Ga=parseInt,Jr=typeof gf=="object"&&gf&&gf.Object===Object&&gf,rc=typeof self=="object"&&self&&self.Object===Object&&self,si=Jr||rc||Function("return this")(),vu=l&&!l.nodeType&&l,$o=vu&&!0&&r&&!r.nodeType&&r,vo=$o&&$o.exports===vu,oc=vo&&Jr.process,ur=function(){try{var Ce=$o&&$o.require&&$o.require("util").types;return Ce||oc&&oc.binding&&oc.binding("util")}catch{}}(),Ph=ur&&ur.isArrayBuffer,sc=ur&&ur.isDate,Lh=ur&&ur.isMap,ac=ur&&ur.isRegExp,lc=ur&&ur.isSet,ea=ur&&ur.isTypedArray;function cr(Ce,Ze,Ne){switch(Ne.length){case 0:return Ce.call(Ze);case 1:return Ce.call(Ze,Ne[0]);case 2:return Ce.call(Ze,Ne[0],Ne[1]);case 3:return Ce.call(Ze,Ne[0],Ne[1],Ne[2])}return Ce.apply(Ze,Ne)}function Fh(Ce,Ze,Ne,It){for(var on=-1,Bn=Ce==null?0:Ce.length;++on<Bn;){var di=Ce[on];Ze(It,di,Ne(di),Ce)}return It}function hr(Ce,Ze){for(var Ne=-1,It=Ce==null?0:Ce.length;++Ne<It&&Ze(Ce[Ne],Ne,Ce)!==!1;);return Ce}function Rh(Ce,Ze){for(var Ne=Ce==null?0:Ce.length;Ne--&&Ze(Ce[Ne],Ne,Ce)!==!1;);return Ce}function xo(Ce,Ze){for(var Ne=-1,It=Ce==null?0:Ce.length;++Ne<It;)if(!Ze(Ce[Ne],Ne,Ce))return!1;return!0}function dn(Ce,Ze){for(var Ne=-1,It=Ce==null?0:Ce.length,on=0,Bn=[];++Ne<It;){var di=Ce[Ne];Ze(di,Ne,Ce)&&(Bn[on++]=di)}return Bn}function ta(Ce,Ze){var Ne=Ce==null?0:Ce.length;return!!Ne&&bo(Ce,Ze,0)>-1}function Tl(Ce,Ze,Ne){for(var It=-1,on=Ce==null?0:Ce.length;++It<on;)if(Ne(Ze,Ce[It]))return!0;return!1}function Jn(Ce,Ze){for(var Ne=-1,It=Ce==null?0:Ce.length,on=Array(It);++Ne<It;)on[Ne]=Ze(Ce[Ne],Ne,Ce);return on}function wo(Ce,Ze){for(var Ne=-1,It=Ze.length,on=Ce.length;++Ne<It;)Ce[on+Ne]=Ze[Ne];return Ce}function uc(Ce,Ze,Ne,It){var on=-1,Bn=Ce==null?0:Ce.length;for(It&&Bn&&(Ne=Ce[++on]);++on<Bn;)Ne=Ze(Ne,Ce[on],on,Ce);return Ne}function cc(Ce,Ze,Ne,It){var on=Ce==null?0:Ce.length;for(It&&on&&(Ne=Ce[--on]);on--;)Ne=Ze(Ne,Ce[on],on,Ce);return Ne}function xu(Ce,Ze){for(var Ne=-1,It=Ce==null?0:Ce.length;++Ne<It;)if(Ze(Ce[Ne],Ne,Ce))return!0;return!1}var hc=Sl("length");function wu(Ce){return Ce.split("")}function na(Ce){return Ce.match(_e)||[]}function Va(Ce,Ze,Ne){var It;return Ne(Ce,function(on,Bn,di){if(Ze(on,Bn,di))return It=Bn,!1}),It}function mn(Ce,Ze,Ne,It){for(var on=Ce.length,Bn=Ne+(It?1:-1);It?Bn--:++Bn<on;)if(Ze(Ce[Bn],Bn,Ce))return Bn;return-1}function bo(Ce,Ze,Ne){return Ze===Ze?tp(Ce,Ze,Ne):mn(Ce,Uh,Ne)}function Oh(Ce,Ze,Ne,It){for(var on=Ne-1,Bn=Ce.length;++on<Bn;)if(It(Ce[on],Ze))return on;return-1}function Uh(Ce){return Ce!==Ce}function Nh(Ce,Ze){var Ne=Ce==null?0:Ce.length;return Ne?bu(Ce,Ze)/Ne:Bt}function Sl(Ce){return function(Ze){return Ze==null?f:Ze[Ce]}}function dc(Ce){return function(Ze){return Ce==null?f:Ce[Ze]}}function Gh(Ce,Ze,Ne,It,on){return on(Ce,function(Bn,di,Wn){Ne=It?(It=!1,Bn):Ze(Ne,Bn,di,Wn)}),Ne}function Qd(Ce,Ze){var Ne=Ce.length;for(Ce.sort(Ze);Ne--;)Ce[Ne]=Ce[Ne].value;return Ce}function bu(Ce,Ze){for(var Ne,It=-1,on=Ce.length;++It<on;){var Bn=Ze(Ce[It]);Bn!==f&&(Ne=Ne===f?Bn:Ne+Bn)}return Ne}function Il(Ce,Ze){for(var Ne=-1,It=Array(Ce);++Ne<Ce;)It[Ne]=Ze(Ne);return It}function Vh(Ce,Ze){return Jn(Ze,function(Ne){return[Ne,Ce[Ne]]})}function Au(Ce){return Ce&&Ce.slice(0,np(Ce)+1).replace(ee,"")}function dr(Ce){return function(Ze){return Ce(Ze)}}function pc(Ce,Ze){return Jn(Ze,function(Ne){return Ce[Ne]})}function Eu(Ce,Ze){return Ce.has(Ze)}function Ml(Ce,Ze){for(var Ne=-1,It=Ce.length;++Ne<It&&bo(Ze,Ce[Ne],0)>-1;);return Ne}function Bl(Ce,Ze){for(var Ne=Ce.length;Ne--&&bo(Ze,Ce[Ne],0)>-1;);return Ne}function ep(Ce,Ze){for(var Ne=Ce.length,It=0;Ne--;)Ce[Ne]===Ze&&++It;return It}var fc=dc(Yf),mc=dc(zh);function Zo(Ce){return"\\"+Qf[Ce]}function jh(Ce,Ze){return Ce==null?f:Ce[Ze]}function ja(Ce){return qi.test(Ce)}function qh(Ce){return Dh.test(Ce)}function Hh(Ce){for(var Ze,Ne=[];!(Ze=Ce.next()).done;)Ne.push(Ze.value);return Ne}function Dl(Ce){var Ze=-1,Ne=Array(Ce.size);return Ce.forEach(function(It,on){Ne[++Ze]=[on,It]}),Ne}function $h(Ce,Ze){return function(Ne){return Ce(Ze(Ne))}}function Wo(Ce,Ze){for(var Ne=-1,It=Ce.length,on=0,Bn=[];++Ne<It;){var di=Ce[Ne];(di===Ze||di===je)&&(Ce[Ne]=je,Bn[on++]=Ne)}return Bn}function _c(Ce){var Ze=-1,Ne=Array(Ce.size);return Ce.forEach(function(It){Ne[++Ze]=It}),Ne}function Cu(Ce){var Ze=-1,Ne=Array(Ce.size);return Ce.forEach(function(It){Ne[++Ze]=[It,It]}),Ne}function tp(Ce,Ze,Ne){for(var It=Ne-1,on=Ce.length;++It<on;)if(Ce[It]===Ze)return It;return-1}function gc(Ce,Ze,Ne){for(var It=Ne+1;It--;)if(Ce[It]===Ze)return It;return It}function kl(Ce){return ja(Ce)?vc(Ce):hc(Ce)}function Lr(Ce){return ja(Ce)?Zh(Ce):wu(Ce)}function np(Ce){for(var Ze=Ce.length;Ze--&&se.test(Ce.charAt(Ze)););return Ze}var yc=dc(Cl);function vc(Ce){for(var Ze=gu.lastIndex=0;gu.test(Ce);)++Ze;return Ze}function Zh(Ce){return Ce.match(gu)||[]}function Wh(Ce){return Ce.match(yu)||[]}var zl=function Ce(Ze){Ze=Ze==null?si:Pl.defaults(si.Object(),Ze,Pl.pick(si,kh));var Ne=Ze.Array,It=Ze.Date,on=Ze.Error,Bn=Ze.Function,di=Ze.Math,Wn=Ze.Object,xc=Ze.RegExp,ip=Ze.String,Tr=Ze.TypeError,Ko=Ne.prototype,Ll=Bn.prototype,ia=Wn.prototype,Yr=Ze["__core-js_shared__"],bs=Ll.toString,Rn=ia.hasOwnProperty,Xo=0,xn=function(){var h=/[^.]+$/.exec(Yr&&Yr.keys&&Yr.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),Qr=ia.toString,em=bs.call(Wn),rp=si._,Fl=xc("^"+bs.call(Rn).replace(R,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wc=vo?Ze.Buffer:f,Jo=Ze.Symbol,Rl=Ze.Uint8Array,bc=wc?wc.allocUnsafe:f,ra=$h(Wn.getPrototypeOf,Wn),Ol=Wn.create,oa=ia.propertyIsEnumerable,qa=Ko.splice,Tu=Jo?Jo.isConcatSpreadable:f,As=Jo?Jo.iterator:f,pr=Jo?Jo.toStringTag:f,sa=function(){try{var h=Or(Wn,"defineProperty");return h({},"",{}),h}catch{}}(),gt=Ze.clearTimeout!==si.clearTimeout&&Ze.clearTimeout,Fr=It&&It.now!==si.Date.now&&It.now,Kh=Ze.setTimeout!==si.setTimeout&&Ze.setTimeout,Su=di.ceil,Ul=di.floor,Ao=Wn.getOwnPropertySymbols,op=wc?wc.isBuffer:f,Iu=Ze.isFinite,Xh=Ko.join,Ac=$h(Wn.keys,Wn),vi=di.max,xi=di.min,Es=It.now,Rr=Ze.parseInt,Mu=di.random,sp=Ko.reverse,Nl=Or(Ze,"DataView"),Ha=Or(Ze,"Map"),Ec=Or(Ze,"Promise"),Cs=Or(Ze,"Set"),aa=Or(Ze,"WeakMap"),Ts=Or(Wn,"create"),Bu=aa&&new aa,$a={},Cc=Fs(Nl),ap=Fs(Ha),Jh=Fs(Ec),Za=Fs(Cs),lp=Fs(aa),Wa=Jo?Jo.prototype:f,Ss=Wa?Wa.valueOf:f,Tc=Wa?Wa.toString:f;function W(h){if(Ei(h)&&!pn(h)&&!(h instanceof yn)){if(h instanceof Sr)return h;if(Rn.call(h,"__wrapped__"))return ga(h)}return new Sr(h)}var la=function(){function h(){}return function(_){if(!fi(_))return{};if(Ol)return Ol(_);h.prototype=_;var E=new h;return h.prototype=f,E}}();function Mi(){}function Sr(h,_){this.__wrapped__=h,this.__actions__=[],this.__chain__=!!_,this.__index__=0,this.__values__=f}W.templateSettings={escape:vl,evaluate:Er,interpolate:Xs,variable:"",imports:{_:W}},W.prototype=Mi.prototype,W.prototype.constructor=W,Sr.prototype=la(Mi.prototype),Sr.prototype.constructor=Sr;function yn(h){this.__wrapped__=h,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=gn,this.__views__=[]}function tm(){var h=new yn(this.__wrapped__);return h.__actions__=io(this.__actions__),h.__dir__=this.__dir__,h.__filtered__=this.__filtered__,h.__iteratees__=io(this.__iteratees__),h.__takeCount__=this.__takeCount__,h.__views__=io(this.__views__),h}function nm(){if(this.__filtered__){var h=new yn(this);h.__dir__=-1,h.__filtered__=!0}else h=this.clone(),h.__dir__*=-1;return h}function Is(){var h=this.__wrapped__.value(),_=this.__dir__,E=pn(h),z=_<0,G=E?h.length:0,Y=ug(0,G,this.__views__),he=Y.start,ve=Y.end,Me=ve-he,Qe=z?ve:he-1,et=this.__iteratees__,tt=et.length,xt=0,kt=xi(Me,this.__takeCount__);if(!E||!z&&G==Me&&kt==Me)return sm(h,this.__actions__);var Vt=[];e:for(;Me--&&xt<kt;){Qe+=_;for(var ln=-1,Kt=h[Qe];++ln<tt;){var wn=et[ln],Sn=wn.iteratee,co=wn.type,mr=Sn(Kt);if(co==cn)Kt=mr;else if(!mr){if(co==_s)continue e;break e}}Vt[xt++]=Kt}return Vt}yn.prototype=la(Mi.prototype),yn.prototype.constructor=yn;function Ms(h){var _=-1,E=h==null?0:h.length;for(this.clear();++_<E;){var z=h[_];this.set(z[0],z[1])}}function Gl(){this.__data__=Ts?Ts(null):{},this.size=0}function Yo(h){var _=this.has(h)&&delete this.__data__[h];return this.size-=_?1:0,_}function Sc(h){var _=this.__data__;if(Ts){var E=_[h];return E===q?f:E}return Rn.call(_,h)?_[h]:f}function vt(h){var _=this.__data__;return Ts?_[h]!==f:Rn.call(_,h)}function up(h,_){var E=this.__data__;return this.size+=this.has(h)?0:1,E[h]=Ts&&_===f?q:_,this}Ms.prototype.clear=Gl,Ms.prototype.delete=Yo,Ms.prototype.get=Sc,Ms.prototype.has=vt,Ms.prototype.set=up;function Qo(h){var _=-1,E=h==null?0:h.length;for(this.clear();++_<E;){var z=h[_];this.set(z[0],z[1])}}function Du(){this.__data__=[],this.size=0}function ua(h){var _=this.__data__,E=Ka(_,h);if(E<0)return!1;var z=_.length-1;return E==z?_.pop():qa.call(_,E,1),--this.size,!0}function cp(h){var _=this.__data__,E=Ka(_,h);return E<0?f:_[E][1]}function hp(h){return Ka(this.__data__,h)>-1}function ku(h,_){var E=this.__data__,z=Ka(E,h);return z<0?(++this.size,E.push([h,_])):E[z][1]=_,this}Qo.prototype.clear=Du,Qo.prototype.delete=ua,Qo.prototype.get=cp,Qo.prototype.has=hp,Qo.prototype.set=ku;function es(h){var _=-1,E=h==null?0:h.length;for(this.clear();++_<E;){var z=h[_];this.set(z[0],z[1])}}function Yh(){this.size=0,this.__data__={hash:new Ms,map:new(Ha||Qo),string:new Ms}}function dp(h){var _=cd(this,h).delete(h);return this.size-=_?1:0,_}function Qh(h){return cd(this,h).get(h)}function zu(h){return cd(this,h).has(h)}function Ic(h,_){var E=cd(this,h),z=E.size;return E.set(h,_),this.size+=E.size==z?0:1,this}es.prototype.clear=Yh,es.prototype.delete=dp,es.prototype.get=Qh,es.prototype.has=zu,es.prototype.set=Ic;function Eo(h){var _=-1,E=h==null?0:h.length;for(this.__data__=new es;++_<E;)this.add(h[_])}function Mc(h){return this.__data__.set(h,q),this}function Bc(h){return this.__data__.has(h)}Eo.prototype.add=Eo.prototype.push=Mc,Eo.prototype.has=Bc;function eo(h){var _=this.__data__=new Qo(h);this.size=_.size}function pp(){this.__data__=new Qo,this.size=0}function ed(h){var _=this.__data__,E=_.delete(h);return this.size=_.size,E}function fp(h){return this.__data__.get(h)}function mp(h){return this.__data__.has(h)}function td(h,_){var E=this.__data__;if(E instanceof Qo){var z=E.__data__;if(!Ha||z.length<C-1)return z.push([h,_]),this.size=++E.size,this;E=this.__data__=new es(z)}return E.set(h,_),this.size=E.size,this}eo.prototype.clear=pp,eo.prototype.delete=ed,eo.prototype.get=fp,eo.prototype.has=mp,eo.prototype.set=td;function Pu(h,_){var E=pn(h),z=!E&&Jl(h),G=!E&&!z&&Yl(h),Y=!E&&!z&&!G&&Jc(h),he=E||z||G||Y,ve=he?Il(h.length,ip):[],Me=ve.length;for(var Qe in h)(_||Rn.call(h,Qe))&&!(he&&(Qe=="length"||G&&(Qe=="offset"||Qe=="parent")||Y&&(Qe=="buffer"||Qe=="byteLength"||Qe=="byteOffset")||_a(Qe,Me)))&&ve.push(Qe);return ve}function nd(h){var _=h.length;return _?h[Hi(0,_-1)]:f}function _p(h,_){return zp(io(h),g(_,0,h.length))}function gp(h){return zp(io(h))}function Lu(h,_,E){(E!==f&&!lo(h[_],E)||E===f&&!(_ in h))&&a(h,_,E)}function Vl(h,_,E){var z=h[_];(!(Rn.call(h,_)&&lo(z,E))||E===f&&!(_ in h))&&a(h,_,E)}function Ka(h,_){for(var E=h.length;E--;)if(lo(h[E][0],_))return E;return-1}function Fu(h,_,E,z){return P(h,function(G,Y,he){_(z,G,E(G),he)}),z}function c(h,_){return h&&da(_,nr(_),h)}function i(h,_){return h&&da(_,Ur(_),h)}function a(h,_,E){_=="__proto__"&&sa?sa(h,_,{configurable:!0,enumerable:!0,value:E,writable:!0}):h[_]=E}function p(h,_){for(var E=-1,z=_.length,G=Ne(z),Y=h==null;++E<z;)G[E]=Y?f:Rs(h,_[E]);return G}function g(h,_,E){return h===h&&(E!==f&&(h=h<=E?h:E),_!==f&&(h=h>=_?h:_)),h}function v(h,_,E,z,G,Y){var he,ve=_&Pe,Me=_&Le,Qe=_&ct;if(E&&(he=G?E(h,z,G,Y):E(h)),he!==f)return he;if(!fi(h))return h;var et=pn(h);if(et){if(he=lv(h),!ve)return io(h,he)}else{var tt=er(h),xt=tt==Xn||tt==$r;if(Yl(h))return cm(h,ve);if(tt==Vi||tt==Ki||xt&&!G){if(he=Me||xt?{}:Ip(h),!ve)return Me?mm(h,i(he,h)):ov(h,c(he,h))}else{if(!Gn[tt])return G?h:{};he=uv(h,tt,ve)}}Y||(Y=new eo);var kt=Y.get(h);if(kt)return kt;Y.set(h,he),Qg(h)?h.forEach(function(Kt){he.add(v(Kt,_,E,Kt,h,Y))}):Xc(h)&&h.forEach(function(Kt,wn){he.set(wn,v(Kt,_,E,wn,h,Y))});var Vt=Qe?Me?ud:Zl:Me?Ur:nr,ln=et?f:Vt(h);return hr(ln||h,function(Kt,wn){ln&&(wn=Kt,Kt=h[wn]),Vl(he,wn,v(Kt,_,E,wn,h,Y))}),he}function A(h){var _=nr(h);return function(E){return S(E,h,_)}}function S(h,_,E){var z=E.length;if(h==null)return!z;for(h=Wn(h);z--;){var G=E[z],Y=_[G],he=h[G];if(he===f&&!(G in h)||!Y(he))return!1}return!0}function I(h,_,E){if(typeof h!="function")throw new Tr(O);return Uu(function(){h.apply(f,E)},_)}function k(h,_,E,z){var G=-1,Y=ta,he=!0,ve=h.length,Me=[],Qe=_.length;if(!ve)return Me;E&&(_=Jn(_,dr(E))),z?(Y=Tl,he=!1):_.length>=C&&(Y=Eu,he=!1,_=new Eo(_));e:for(;++G<ve;){var et=h[G],tt=E==null?et:E(et);if(et=z||et!==0?et:0,he&&tt===tt){for(var xt=Qe;xt--;)if(_[xt]===tt)continue e;Me.push(et)}else Y(_,tt,z)||Me.push(et)}return Me}var P=pa(X),U=pa(le,!0);function j(h,_){var E=!0;return P(h,function(z,G,Y){return E=!!_(z,G,Y),E}),E}function J(h,_,E){for(var z=-1,G=h.length;++z<G;){var Y=h[z],he=_(Y);if(he!=null&&(ve===f?he===he&&!Bo(he):E(he,ve)))var ve=he,Me=Y}return Me}function K(h,_,E,z){var G=h.length;for(E=_n(E),E<0&&(E=-E>G?0:G+E),z=z===f||z>G?G:_n(z),z<0&&(z+=G),z=E>z?0:ey(z);E<z;)h[E++]=_;return h}function Q(h,_){var E=[];return P(h,function(z,G,Y){_(z,G,Y)&&E.push(z)}),E}function Z(h,_,E,z,G){var Y=-1,he=h.length;for(E||(E=cg),G||(G=[]);++Y<he;){var ve=h[Y];_>0&&E(ve)?_>1?Z(ve,_-1,E,z,G):wo(G,ve):z||(G[G.length]=ve)}return G}var $=is(),te=is(!0);function X(h,_){return h&&$(h,_,nr)}function le(h,_){return h&&te(h,_,nr)}function ue(h,_){return dn(_,function(E){return el(h[E])})}function oe(h,_){_=ql(_,h);for(var E=0,z=_.length;h!=null&&E<z;)h=h[Ls(_[E++])];return E&&E==z?h:f}function pe(h,_,E){var z=_(h);return pn(h)?z:wo(z,E(h))}function we(h){return h==null?h===f?pl:cu:pr&&pr in Wn(h)?Ru(h):mg(h)}function Re(h,_){return h>_}function De(h,_){return h!=null&&Rn.call(h,_)}function Ye(h,_){return h!=null&&_ in Wn(h)}function xe(h,_,E){return h>=xi(_,E)&&h<vi(_,E)}function qe(h,_,E){for(var z=E?Tl:ta,G=h[0].length,Y=h.length,he=Y,ve=Ne(Y),Me=1/0,Qe=[];he--;){var et=h[he];he&&_&&(et=Jn(et,dr(_))),Me=xi(et.length,Me),ve[he]=!E&&(_||G>=120&&et.length>=120)?new Eo(he&&et):f}et=h[0];var tt=-1,xt=ve[0];e:for(;++tt<G&&Qe.length<Me;){var kt=et[tt],Vt=_?_(kt):kt;if(kt=E||kt!==0?kt:0,!(xt?Eu(xt,Vt):z(Qe,Vt,E))){for(he=Y;--he;){var ln=ve[he];if(!(ln?Eu(ln,Vt):z(h[he],Vt,E)))continue e}xt&&xt.push(Vt),Qe.push(kt)}}return Qe}function He(h,_,E,z){return X(h,function(G,Y,he){_(z,E(G),Y,he)}),z}function Ie(h,_,E){_=ql(_,h),h=kp(h,_);var z=h==null?h:h[Ls(so(_))];return z==null?f:cr(z,h,E)}function ye(h){return Ei(h)&&we(h)==Ki}function dt(h){return Ei(h)&&we(h)==Wr}function ot(h){return Ei(h)&&we(h)==ys}function lt(h,_,E,z,G){return h===_?!0:h==null||_==null||!Ei(h)&&!Ei(_)?h!==h&&_!==_:st(h,_,E,z,lt,G)}function st(h,_,E,z,G,Y){var he=pn(h),ve=pn(_),Me=he?Ri:er(h),Qe=ve?Ri:er(_);Me=Me==Ki?Vi:Me,Qe=Qe==Ki?Vi:Qe;var et=Me==Vi,tt=Qe==Vi,xt=Me==Qe;if(xt&&Yl(h)){if(!Yl(_))return!1;he=!0,et=!1}if(xt&&!et)return Y||(Y=new eo),he||Jc(h)?$i(h,_,E,z,G,Y):lg(h,_,Me,E,z,G,Y);if(!(E&ht)){var kt=et&&Rn.call(h,"__wrapped__"),Vt=tt&&Rn.call(_,"__wrapped__");if(kt||Vt){var ln=kt?h.value():h,Kt=Vt?_.value():_;return Y||(Y=new eo),G(ln,Kt,E,z,Y)}}return xt?(Y||(Y=new eo),fa(h,_,E,z,G,Y)):!1}function Et(h){return Ei(h)&&er(h)==Qt}function Ut(h,_,E,z){var G=E.length,Y=G,he=!z;if(h==null)return!Y;for(h=Wn(h);G--;){var ve=E[G];if(he&&ve[2]?ve[1]!==h[ve[0]]:!(ve[0]in h))return!1}for(;++G<Y;){ve=E[G];var Me=ve[0],Qe=h[Me],et=ve[1];if(he&&ve[2]){if(Qe===f&&!(Me in h))return!1}else{var tt=new eo;if(z)var xt=z(Qe,et,Me,h,_,tt);if(!(xt===f?lt(et,Qe,ht|yt,z,tt):xt))return!1}}return!0}function Lt(h){if(!fi(h)||Bp(h))return!1;var _=el(h)?Fl:Mt;return _.test(Fs(h))}function St(h){return Ei(h)&&we(h)==Zr}function at(h){return Ei(h)&&er(h)==Ar}function Zt(h){return Ei(h)&&Ql(h.length)&&!!kn[we(h)]}function Yt(h){return typeof h=="function"?h:h==null?Nr:typeof h=="object"?pn(h)?Co(h[0],h[1]):Ji(h):Sy(h)}function Dn(h){if(!Rc(h))return Ac(h);var _=[];for(var E in Wn(h))Rn.call(h,E)&&E!="constructor"&&_.push(E);return _}function Ln(h){if(!fi(h))return fg(h);var _=Rc(h),E=[];for(var z in h)z=="constructor"&&(_||!Rn.call(h,z))||E.push(z);return E}function En(h,_){return h<_}function wi(h,_){var E=-1,z=uo(h)?Ne(h.length):[];return P(h,function(G,Y,he){z[++E]=_(G,Y,he)}),z}function Ji(h){var _=gm(h);return _.length==1&&_[0][2]?pg(_[0][0],_[0][1]):function(E){return E===h||Ut(E,h,_)}}function Co(h,_){return Mp(h)&&dg(_)?pg(Ls(h),_):function(E){var z=Rs(E,h);return z===f&&z===_?Qp(E,h):lt(_,z,ht|yt)}}function Fn(h,_,E,z,G){h!==_&&$(_,function(Y,he){if(G||(G=new eo),fi(Y))ti(h,_,he,E,Fn,z,G);else{var ve=z?z(Ou(h,he),Y,he+"",h,_,G):f;ve===f&&(ve=Y),Lu(h,he,ve)}},Ur)}function ti(h,_,E,z,G,Y,he){var ve=Ou(h,E),Me=Ou(_,E),Qe=he.get(Me);if(Qe){Lu(h,E,Qe);return}var et=Y?Y(ve,Me,E+"",h,_,he):f,tt=et===f;if(tt){var xt=pn(Me),kt=!xt&&Yl(Me),Vt=!xt&&!kt&&Jc(Me);et=Me,xt||kt||Vt?pn(ve)?et=ve:Di(ve)?et=io(ve):kt?(tt=!1,et=cm(Me,!0)):Vt?(tt=!1,et=rd(Me,!0)):et=[]:xa(Me)||Jl(Me)?(et=ve,Jl(ve)?et=Jp(ve):(!fi(ve)||el(ve))&&(et=Ip(Me))):tt=!1}tt&&(he.set(Me,et),G(et,Me,z,Y,he),he.delete(Me)),Lu(h,E,et)}function Cn(h,_){var E=h.length;if(!!E)return _+=_<0?E:0,_a(_,E)?h[_]:f}function ci(h,_,E){_.length?_=Jn(_,function(Y){return pn(Y)?function(he){return oe(he,Y.length===1?Y[0]:Y)}:Y}):_=[Nr];var z=-1;_=Jn(_,dr(Wt()));var G=wi(h,function(Y,he,ve){var Me=Jn(_,function(Qe){return Qe(Y)});return{criteria:Me,index:++z,value:Y}});return Qd(G,function(Y,he){return Ep(Y,he,E)})}function Yi(h,_){return On(h,_,function(E,z){return Qp(h,z)})}function On(h,_,E){for(var z=-1,G=_.length,Y={};++z<G;){var he=_[z],ve=oe(h,he);E(ve,he)&&fr(Y,ql(he,h),ve)}return Y}function Ir(h){return function(_){return oe(_,h)}}function Bs(h,_,E,z){var G=z?Oh:bo,Y=-1,he=_.length,ve=h;for(h===_&&(_=io(_)),E&&(ve=Jn(h,dr(E)));++Y<he;)for(var Me=0,Qe=_[Y],et=E?E(Qe):Qe;(Me=G(ve,et,Me,z))>-1;)ve!==h&&qa.call(ve,Me,1),qa.call(h,Me,1);return h}function to(h,_){for(var E=h?_.length:0,z=E-1;E--;){var G=_[E];if(E==z||G!==Y){var Y=G;_a(G)?qa.call(h,G,1):xp(h,G)}}return h}function Hi(h,_){return h+Ul(Mu()*(_-h+1))}function jl(h,_,E,z){for(var G=-1,Y=vi(Su((_-h)/(E||1)),0),he=Ne(Y);Y--;)he[z?Y:++G]=h,h+=E;return he}function ts(h,_){var E="";if(!h||_<1||_>wt)return E;do _%2&&(E+=h),_=Ul(_/2),_&&(h+=h);while(_);return E}function Ht(h,_){return Uc(Ps(h,_,Nr),h+"")}function ns(h){return nd(eu(h))}function ca(h,_){var E=eu(h);return zp(E,g(_,0,E.length))}function fr(h,_,E,z){if(!fi(h))return h;_=ql(_,h);for(var G=-1,Y=_.length,he=Y-1,ve=h;ve!=null&&++G<Y;){var Me=Ls(_[G]),Qe=E;if(Me==="__proto__"||Me==="constructor"||Me==="prototype")return h;if(G!=he){var et=ve[Me];Qe=z?z(et,Me,ve):f,Qe===f&&(Qe=fi(et)?et:_a(_[G+1])?[]:{})}Vl(ve,Me,Qe),ve=ve[Me]}return h}var Dc=Bu?function(h,_){return Bu.set(h,_),h}:Nr,yp=sa?function(h,_){return sa(h,"toString",{configurable:!0,enumerable:!1,value:Id(_),writable:!0})}:Nr;function ng(h){return zp(eu(h))}function To(h,_,E){var z=-1,G=h.length;_<0&&(_=-_>G?0:G+_),E=E>G?G:E,E<0&&(E+=G),G=_>E?0:E-_>>>0,_>>>=0;for(var Y=Ne(G);++z<G;)Y[z]=h[z+_];return Y}function ig(h,_){var E;return P(h,function(z,G,Y){return E=_(z,G,Y),!E}),!!E}function kc(h,_,E){var z=0,G=h==null?z:h.length;if(typeof _=="number"&&_===_&&G<=br){for(;z<G;){var Y=z+G>>>1,he=h[Y];he!==null&&!Bo(he)&&(E?he<=_:he<_)?z=Y+1:G=Y}return G}return vp(h,_,Nr,E)}function vp(h,_,E,z){var G=0,Y=h==null?0:h.length;if(Y===0)return 0;_=E(_);for(var he=_!==_,ve=_===null,Me=Bo(_),Qe=_===f;G<Y;){var et=Ul((G+Y)/2),tt=E(h[et]),xt=tt!==f,kt=tt===null,Vt=tt===tt,ln=Bo(tt);if(he)var Kt=z||Vt;else Qe?Kt=Vt&&(z||xt):ve?Kt=Vt&&xt&&(z||!kt):Me?Kt=Vt&&xt&&!kt&&(z||!ln):kt||ln?Kt=!1:Kt=z?tt<=_:tt<_;Kt?G=et+1:Y=et}return xi(Y,oi)}function im(h,_){for(var E=-1,z=h.length,G=0,Y=[];++E<z;){var he=h[E],ve=_?_(he):he;if(!E||!lo(ve,Me)){var Me=ve;Y[G++]=he===0?0:he}}return Y}function rm(h){return typeof h=="number"?h:Bo(h)?Bt:+h}function no(h){if(typeof h=="string")return h;if(pn(h))return Jn(h,no)+"";if(Bo(h))return Tc?Tc.call(h):"";var _=h+"";return _=="0"&&1/h==-Ni?"-0":_}function Xa(h,_,E){var z=-1,G=ta,Y=h.length,he=!0,ve=[],Me=ve;if(E)he=!1,G=Tl;else if(Y>=C){var Qe=_?null:ag(h);if(Qe)return _c(Qe);he=!1,G=Eu,Me=new Eo}else Me=_?[]:ve;e:for(;++z<Y;){var et=h[z],tt=_?_(et):et;if(et=E||et!==0?et:0,he&&tt===tt){for(var xt=Me.length;xt--;)if(Me[xt]===tt)continue e;_&&Me.push(tt),ve.push(et)}else G(Me,tt,E)||(Me!==ve&&Me.push(tt),ve.push(et))}return ve}function xp(h,_){return _=ql(_,h),h=kp(h,_),h==null||delete h[Ls(so(_))]}function om(h,_,E,z){return fr(h,_,E(oe(h,_)),z)}function id(h,_,E,z){for(var G=h.length,Y=z?G:-1;(z?Y--:++Y<G)&&_(h[Y],Y,h););return E?To(h,z?0:Y,z?Y+1:G):To(h,z?Y+1:0,z?G:Y)}function sm(h,_){var E=h;return E instanceof yn&&(E=E.value()),uc(_,function(z,G){return G.func.apply(G.thisArg,wo([z],G.args))},E)}function wp(h,_,E){var z=h.length;if(z<2)return z?Xa(h[0]):[];for(var G=-1,Y=Ne(z);++G<z;)for(var he=h[G],ve=-1;++ve<z;)ve!=G&&(Y[G]=k(Y[G]||he,h[ve],_,E));return Xa(Z(Y,1),_,E)}function am(h,_,E){for(var z=-1,G=h.length,Y=_.length,he={};++z<G;){var ve=z<Y?_[z]:f;E(he,h[z],ve)}return he}function bp(h){return Di(h)?h:[]}function lm(h){return typeof h=="function"?h:Nr}function ql(h,_){return pn(h)?h:Mp(h,_)?[h]:Pp(jn(h))}var zc=Ht;function Ja(h,_,E){var z=h.length;return E=E===f?z:E,!_&&E>=z?h:To(h,_,E)}var um=gt||function(h){return si.clearTimeout(h)};function cm(h,_){if(_)return h.slice();var E=h.length,z=bc?bc(E):new h.constructor(E);return h.copy(z),z}function hm(h){var _=new h.constructor(h.byteLength);return new Rl(_).set(new Rl(h)),_}function Ap(h,_){var E=_?hm(h.buffer):h.buffer;return new h.constructor(E,h.byteOffset,h.byteLength)}function rg(h){var _=new h.constructor(h.source,Je.exec(h));return _.lastIndex=h.lastIndex,_}function dm(h){return Ss?Wn(Ss.call(h)):{}}function rd(h,_){var E=_?hm(h.buffer):h.buffer;return new h.constructor(E,h.byteOffset,h.length)}function ha(h,_){if(h!==_){var E=h!==f,z=h===null,G=h===h,Y=Bo(h),he=_!==f,ve=_===null,Me=_===_,Qe=Bo(_);if(!ve&&!Qe&&!Y&&h>_||Y&&he&&Me&&!ve&&!Qe||z&&he&&Me||!E&&Me||!G)return 1;if(!z&&!Y&&!Qe&&h<_||Qe&&E&&G&&!z&&!Y||ve&&E&&G||!he&&G||!Me)return-1}return 0}function Ep(h,_,E){for(var z=-1,G=h.criteria,Y=_.criteria,he=G.length,ve=E.length;++z<he;){var Me=ha(G[z],Y[z]);if(Me){if(z>=ve)return Me;var Qe=E[z];return Me*(Qe=="desc"?-1:1)}}return h.index-_.index}function pm(h,_,E,z){for(var G=-1,Y=h.length,he=E.length,ve=-1,Me=_.length,Qe=vi(Y-he,0),et=Ne(Me+Qe),tt=!z;++ve<Me;)et[ve]=_[ve];for(;++G<he;)(tt||G<Y)&&(et[E[G]]=h[G]);for(;Qe--;)et[ve++]=h[G++];return et}function fm(h,_,E,z){for(var G=-1,Y=h.length,he=-1,ve=E.length,Me=-1,Qe=_.length,et=vi(Y-ve,0),tt=Ne(et+Qe),xt=!z;++G<et;)tt[G]=h[G];for(var kt=G;++Me<Qe;)tt[kt+Me]=_[Me];for(;++he<ve;)(xt||G<Y)&&(tt[kt+E[he]]=h[G++]);return tt}function io(h,_){var E=-1,z=h.length;for(_||(_=Ne(z));++E<z;)_[E]=h[E];return _}function da(h,_,E,z){var G=!E;E||(E={});for(var Y=-1,he=_.length;++Y<he;){var ve=_[Y],Me=z?z(E[ve],h[ve],ve,E,h):f;Me===f&&(Me=h[ve]),G?a(E,ve,Me):Vl(E,ve,Me)}return E}function ov(h,_){return da(h,Fc(h),_)}function mm(h,_){return da(h,hd(h),_)}function Hl(h,_){return function(E,z){var G=pn(E)?Fh:Fu,Y=_?_():{};return G(E,h,Wt(z,2),Y)}}function Ds(h){return Ht(function(_,E){var z=-1,G=E.length,Y=G>1?E[G-1]:f,he=G>2?E[2]:f;for(Y=h.length>3&&typeof Y=="function"?(G--,Y):f,he&&Bi(E[0],E[1],he)&&(Y=G<3?f:Y,G=1),_=Wn(_);++z<G;){var ve=E[z];ve&&h(_,ve,z,Y)}return _})}function pa(h,_){return function(E,z){if(E==null)return E;if(!uo(E))return h(E,z);for(var G=E.length,Y=_?G:-1,he=Wn(E);(_?Y--:++Y<G)&&z(he[Y],Y,he)!==!1;);return E}}function is(h){return function(_,E,z){for(var G=-1,Y=Wn(_),he=z(_),ve=he.length;ve--;){var Me=he[h?ve:++G];if(E(Y[Me],Me,Y)===!1)break}return _}}function $l(h,_,E){var z=_&hn,G=od(h);function Y(){var he=this&&this!==si&&this instanceof Y?G:h;return he.apply(z?E:this,arguments)}return Y}function Ya(h){return function(_){_=jn(_);var E=ja(_)?Lr(_):f,z=E?E[0]:_.charAt(0),G=E?Ja(E,1).join(""):_.slice(1);return z[h]()+G}}function rs(h){return function(_){return uc(ih(Km(_).replace(yi,"")),h,"")}}function od(h){return function(){var _=arguments;switch(_.length){case 0:return new h;case 1:return new h(_[0]);case 2:return new h(_[0],_[1]);case 3:return new h(_[0],_[1],_[2]);case 4:return new h(_[0],_[1],_[2],_[3]);case 5:return new h(_[0],_[1],_[2],_[3],_[4]);case 6:return new h(_[0],_[1],_[2],_[3],_[4],_[5]);case 7:return new h(_[0],_[1],_[2],_[3],_[4],_[5],_[6])}var E=la(h.prototype),z=h.apply(E,_);return fi(z)?z:E}}function sv(h,_,E){var z=od(h);function G(){for(var Y=arguments.length,he=Ne(Y),ve=Y,Me=Lc(G);ve--;)he[ve]=arguments[ve];var Qe=Y<3&&he[0]!==Me&&he[Y-1]!==Me?[]:Wo(he,Me);if(Y-=Qe.length,Y<E)return ld(h,_,sd,G.placeholder,f,he,Qe,f,f,E-Y);var et=this&&this!==si&&this instanceof G?z:h;return cr(et,this,he)}return G}function og(h){return function(_,E,z){var G=Wn(_);if(!uo(_)){var Y=Wt(E,3);_=nr(_),E=function(ve){return Y(G[ve],ve,G)}}var he=h(_,E,z);return he>-1?G[Y?_[he]:he]:f}}function sg(h){return ma(function(_){var E=_.length,z=E,G=Sr.prototype.thru;for(h&&_.reverse();z--;){var Y=_[z];if(typeof Y!="function")throw new Tr(O);if(G&&!he&&Pc(Y)=="wrapper")var he=new Sr([],!0)}for(z=he?z:E;++z<E;){Y=_[z];var ve=Pc(Y),Me=ve=="wrapper"?Sp(Y):f;Me&&Wl(Me[0])&&Me[1]==(bt|Se|ke|Pt)&&!Me[4].length&&Me[9]==1?he=he[Pc(Me[0])].apply(he,Me[3]):he=Y.length==1&&Wl(Y)?he[ve]():he.thru(Y)}return function(){var Qe=arguments,et=Qe[0];if(he&&Qe.length==1&&pn(et))return he.plant(et).value();for(var tt=0,xt=E?_[tt].apply(this,Qe):et;++tt<E;)xt=_[tt].call(this,xt);return xt}})}function sd(h,_,E,z,G,Y,he,ve,Me,Qe){var et=_&bt,tt=_&hn,xt=_&Te,kt=_&(Se|it),Vt=_&zt,ln=xt?f:od(h);function Kt(){for(var wn=arguments.length,Sn=Ne(wn),co=wn;co--;)Sn[co]=arguments[co];if(kt)var mr=Lc(Kt),ko=ep(Sn,mr);if(z&&(Sn=pm(Sn,z,G,kt)),Y&&(Sn=fm(Sn,Y,he,kt)),wn-=ko,kt&&wn<Qe){var Ci=Wo(Sn,mr);return ld(h,_,sd,Kt.placeholder,E,Sn,Ci,ve,Me,Qe-wn)}var ls=tt?E:this,Ea=xt?ls[h]:h;return wn=Sn.length,ve?Sn=Oc(Sn,ve):Vt&&wn>1&&Sn.reverse(),et&&Me<wn&&(Sn.length=Me),this&&this!==si&&this instanceof Kt&&(Ea=ln||od(Ea)),Ea.apply(ls,Sn)}return Kt}function ad(h,_){return function(E,z){return He(E,h,_(z),{})}}function ro(h,_){return function(E,z){var G;if(E===f&&z===f)return _;if(E!==f&&(G=E),z!==f){if(G===f)return z;typeof E=="string"||typeof z=="string"?(E=no(E),z=no(z)):(E=rm(E),z=rm(z)),G=h(E,z)}return G}}function _m(h){return ma(function(_){return _=Jn(_,dr(Wt())),Ht(function(E){var z=this;return h(_,function(G){return cr(G,z,E)})})})}function Cp(h,_){_=_===f?" ":no(_);var E=_.length;if(E<2)return E?ts(_,h):_;var z=ts(_,Su(h/kl(_)));return ja(_)?Ja(Lr(z),0,h).join(""):z.slice(0,h)}function bi(h,_,E,z){var G=_&hn,Y=od(h);function he(){for(var ve=-1,Me=arguments.length,Qe=-1,et=z.length,tt=Ne(et+Me),xt=this&&this!==si&&this instanceof he?Y:h;++Qe<et;)tt[Qe]=z[Qe];for(;Me--;)tt[Qe++]=arguments[++ve];return cr(xt,G?E:this,tt)}return he}function Nt(h){return function(_,E,z){return z&&typeof z!="number"&&Bi(_,E,z)&&(E=z=f),_=wa(_),E===f?(E=_,_=0):E=wa(E),z=z===f?_<E?1:-1:wa(z),jl(_,E,z,h)}}function ks(h){return function(_,E){return typeof _=="string"&&typeof E=="string"||(_=as(_),E=as(E)),h(_,E)}}function ld(h,_,E,z,G,Y,he,ve,Me,Qe){var et=_&Se,tt=et?he:f,xt=et?f:he,kt=et?Y:f,Vt=et?f:Y;_|=et?ke:ut,_&=~(et?ut:ke),_&ge||(_&=~(hn|Te));var ln=[h,_,G,kt,tt,Vt,xt,ve,Me,Qe],Kt=E.apply(f,ln);return Wl(h)&&Kl(Kt,ln),Kt.placeholder=z,xm(Kt,h,_)}function vn(h){var _=di[h];return function(E,z){if(E=as(E),z=z==null?0:xi(_n(z),292),z&&Iu(E)){var G=(jn(E)+"e").split("e"),Y=_(G[0]+"e"+(+G[1]+z));return G=(jn(Y)+"e").split("e"),+(G[0]+"e"+(+G[1]-z))}return _(E)}}var ag=Cs&&1/_c(new Cs([,-0]))[1]==Ni?function(h){return new Cs(h)}:Hu;function Tp(h){return function(_){var E=er(_);return E==Qt?Dl(_):E==Ar?Cu(_):Vh(_,h(_))}}function Qi(h,_,E,z,G,Y,he,ve){var Me=_&Te;if(!Me&&typeof h!="function")throw new Tr(O);var Qe=z?z.length:0;if(Qe||(_&=~(ke|ut),z=G=f),he=he===f?he:vi(_n(he),0),ve=ve===f?ve:_n(ve),Qe-=G?G.length:0,_&ut){var et=z,tt=G;z=G=f}var xt=Me?f:Sp(h),kt=[h,_,E,z,G,et,tt,Y,he,ve];if(xt&&oo(kt,xt),h=kt[0],_=kt[1],E=kt[2],z=kt[3],G=kt[4],ve=kt[9]=kt[9]===f?Me?0:h.length:vi(kt[9]-Qe,0),!ve&&_&(Se|it)&&(_&=~(Se|it)),!_||_==hn)var Vt=$l(h,_,E);else _==Se||_==it?Vt=sv(h,_,ve):(_==ke||_==(hn|ke))&&!G.length?Vt=bi(h,_,E,z):Vt=sd.apply(f,kt);var ln=xt?Dc:Kl;return xm(ln(Vt,kt),h,_)}function zs(h,_,E,z){return h===f||lo(h,ia[E])&&!Rn.call(z,E)?_:h}function So(h,_,E,z,G,Y){return fi(h)&&fi(_)&&(Y.set(_,h),Fn(h,_,f,So,Y),Y.delete(_)),h}function Io(h){return xa(h)?f:h}function $i(h,_,E,z,G,Y){var he=E&ht,ve=h.length,Me=_.length;if(ve!=Me&&!(he&&Me>ve))return!1;var Qe=Y.get(h),et=Y.get(_);if(Qe&&et)return Qe==_&&et==h;var tt=-1,xt=!0,kt=E&yt?new Eo:f;for(Y.set(h,_),Y.set(_,h);++tt<ve;){var Vt=h[tt],ln=_[tt];if(z)var Kt=he?z(ln,Vt,tt,_,h,Y):z(Vt,ln,tt,h,_,Y);if(Kt!==f){if(Kt)continue;xt=!1;break}if(kt){if(!xu(_,function(wn,Sn){if(!Eu(kt,Sn)&&(Vt===wn||G(Vt,wn,E,z,Y)))return kt.push(Sn)})){xt=!1;break}}else if(!(Vt===ln||G(Vt,ln,E,z,Y))){xt=!1;break}}return Y.delete(h),Y.delete(_),xt}function lg(h,_,E,z,G,Y,he){switch(E){case Uo:if(h.byteLength!=_.byteLength||h.byteOffset!=_.byteOffset)return!1;h=h.buffer,_=_.buffer;case Wr:return!(h.byteLength!=_.byteLength||!Y(new Rl(h),new Rl(_)));case Hr:case ys:case or:return lo(+h,+_);case Da:return h.name==_.name&&h.message==_.message;case Zr:case Ii:return h==_+"";case Qt:var ve=Dl;case Ar:var Me=z&ht;if(ve||(ve=_c),h.size!=_.size&&!Me)return!1;var Qe=he.get(h);if(Qe)return Qe==_;z|=yt,he.set(h,_);var et=$i(ve(h),ve(_),z,G,Y,he);return he.delete(h),et;case yo:if(Ss)return Ss.call(h)==Ss.call(_)}return!1}function fa(h,_,E,z,G,Y){var he=E&ht,ve=Zl(h),Me=ve.length,Qe=Zl(_),et=Qe.length;if(Me!=et&&!he)return!1;for(var tt=Me;tt--;){var xt=ve[tt];if(!(he?xt in _:Rn.call(_,xt)))return!1}var kt=Y.get(h),Vt=Y.get(_);if(kt&&Vt)return kt==_&&Vt==h;var ln=!0;Y.set(h,_),Y.set(_,h);for(var Kt=he;++tt<Me;){xt=ve[tt];var wn=h[xt],Sn=_[xt];if(z)var co=he?z(Sn,wn,xt,_,h,Y):z(wn,Sn,xt,h,_,Y);if(!(co===f?wn===Sn||G(wn,Sn,E,z,Y):co)){ln=!1;break}Kt||(Kt=xt=="constructor")}if(ln&&!Kt){var mr=h.constructor,ko=_.constructor;mr!=ko&&"constructor"in h&&"constructor"in _&&!(typeof mr=="function"&&mr instanceof mr&&typeof ko=="function"&&ko instanceof ko)&&(ln=!1)}return Y.delete(h),Y.delete(_),ln}function ma(h){return Uc(Ps(h,f,yg),h+"")}function Zl(h){return pe(h,nr,Fc)}function ud(h){return pe(h,Ur,hd)}var Sp=Bu?function(h){return Bu.get(h)}:Hu;function Pc(h){for(var _=h.name+"",E=$a[_],z=Rn.call($a,_)?E.length:0;z--;){var G=E[z],Y=G.func;if(Y==null||Y==h)return G.name}return _}function Lc(h){var _=Rn.call(W,"placeholder")?W:h;return _.placeholder}function Wt(){var h=W.iteratee||e_;return h=h===e_?Yt:h,arguments.length?h(arguments[0],arguments[1]):h}function cd(h,_){var E=h.__data__;return cv(_)?E[typeof _=="string"?"string":"hash"]:E.map}function gm(h){for(var _=nr(h),E=_.length;E--;){var z=_[E],G=h[z];_[E]=[z,G,dg(G)]}return _}function Or(h,_){var E=jh(h,_);return Lt(E)?E:f}function Ru(h){var _=Rn.call(h,pr),E=h[pr];try{h[pr]=f;var z=!0}catch{}var G=Qr.call(h);return z&&(_?h[pr]=E:delete h[pr]),G}var Fc=Ao?function(h){return h==null?[]:(h=Wn(h),dn(Ao(h),function(_){return oa.call(h,_)}))}:t_,hd=Ao?function(h){for(var _=[];h;)wo(_,Fc(h)),h=ra(h);return _}:t_,er=we;(Nl&&er(new Nl(new ArrayBuffer(1)))!=Uo||Ha&&er(new Ha)!=Qt||Ec&&er(Ec.resolve())!=ka||Cs&&er(new Cs)!=Ar||aa&&er(new aa)!=vs)&&(er=function(h){var _=we(h),E=_==Vi?h.constructor:f,z=E?Fs(E):"";if(z)switch(z){case Cc:return Uo;case ap:return Qt;case Jh:return ka;case Za:return Ar;case lp:return vs}return _});function ug(h,_,E){for(var z=-1,G=E.length;++z<G;){var Y=E[z],he=Y.size;switch(Y.type){case"drop":h+=he;break;case"dropRight":_-=he;break;case"take":_=xi(_,h+he);break;case"takeRight":h=vi(h,_-he);break}}return{start:h,end:_}}function av(h){var _=h.match(Ee);return _?_[1].split(Ae):[]}function ym(h,_,E){_=ql(_,h);for(var z=-1,G=_.length,Y=!1;++z<G;){var he=Ls(_[z]);if(!(Y=h!=null&&E(h,he)))break;h=h[he]}return Y||++z!=G?Y:(G=h==null?0:h.length,!!G&&Ql(G)&&_a(he,G)&&(pn(h)||Jl(h)))}function lv(h){var _=h.length,E=new h.constructor(_);return _&&typeof h[0]=="string"&&Rn.call(h,"index")&&(E.index=h.index,E.input=h.input),E}function Ip(h){return typeof h.constructor=="function"&&!Rc(h)?la(ra(h)):{}}function uv(h,_,E){var z=h.constructor;switch(_){case Wr:return hm(h);case Hr:case ys:return new z(+h);case Uo:return Ap(h,E);case $s:case sr:case za:case Zs:case No:case Go:case Pa:case ml:case Ws:return rd(h,E);case Qt:return new z;case or:case Ii:return new z(h);case Zr:return rg(h);case Ar:return new z;case yo:return dm(h)}}function vm(h,_){var E=_.length;if(!E)return h;var z=E-1;return _[z]=(E>1?"& ":"")+_[z],_=_.join(E>2?", ":" "),h.replace(fe,`{
/* [wrapped with `+_+`] */
`)}function cg(h){return pn(h)||Jl(h)||!!(Tu&&h&&h[Tu])}function _a(h,_){var E=typeof h;return _=_==null?wt:_,!!_&&(E=="number"||E!="symbol"&&sn.test(h))&&h>-1&&h%1==0&&h<_}function Bi(h,_,E){if(!fi(E))return!1;var z=typeof _;return(z=="number"?uo(E)&&_a(_,E.length):z=="string"&&_ in E)?lo(E[_],h):!1}function Mp(h,_){if(pn(h))return!1;var E=typeof h;return E=="number"||E=="symbol"||E=="boolean"||h==null||Bo(h)?!0:Fa.test(h)||!du.test(h)||_!=null&&h in Wn(_)}function cv(h){var _=typeof h;return _=="string"||_=="number"||_=="symbol"||_=="boolean"?h!=="__proto__":h===null}function Wl(h){var _=Pc(h),E=W[_];if(typeof E!="function"||!(_ in yn.prototype))return!1;if(h===E)return!0;var z=Sp(E);return!!z&&h===z[0]}function Bp(h){return!!xn&&xn in h}var hg=Yr?el:lf;function Rc(h){var _=h&&h.constructor,E=typeof _=="function"&&_.prototype||ia;return h===E}function dg(h){return h===h&&!fi(h)}function pg(h,_){return function(E){return E==null?!1:E[h]===_&&(_!==f||h in Wn(E))}}function Dp(h){var _=wd(h,function(z){return E.size===be&&E.clear(),z}),E=_.cache;return _}function oo(h,_){var E=h[1],z=_[1],G=E|z,Y=G<(hn|Te|bt),he=z==bt&&E==Se||z==bt&&E==Pt&&h[7].length<=_[8]||z==(bt|Pt)&&_[7].length<=_[8]&&E==Se;if(!(Y||he))return h;z&hn&&(h[2]=_[2],G|=E&hn?0:ge);var ve=_[3];if(ve){var Me=h[3];h[3]=Me?pm(Me,ve,_[4]):ve,h[4]=Me?Wo(h[3],je):_[4]}return ve=_[5],ve&&(Me=h[5],h[5]=Me?fm(Me,ve,_[6]):ve,h[6]=Me?Wo(h[5],je):_[6]),ve=_[7],ve&&(h[7]=ve),z&bt&&(h[8]=h[8]==null?_[8]:xi(h[8],_[8])),h[9]==null&&(h[9]=_[9]),h[0]=_[0],h[1]=G,h}function fg(h){var _=[];if(h!=null)for(var E in Wn(h))_.push(E);return _}function mg(h){return Qr.call(h)}function Ps(h,_,E){return _=vi(_===f?h.length-1:_,0),function(){for(var z=arguments,G=-1,Y=vi(z.length-_,0),he=Ne(Y);++G<Y;)he[G]=z[_+G];G=-1;for(var ve=Ne(_+1);++G<_;)ve[G]=z[G];return ve[_]=E(he),cr(h,this,ve)}}function kp(h,_){return _.length<2?h:oe(h,To(_,0,-1))}function Oc(h,_){for(var E=h.length,z=xi(_.length,E),G=io(h);z--;){var Y=_[z];h[z]=_a(Y,E)?G[Y]:f}return h}function Ou(h,_){if(!(_==="constructor"&&typeof h[_]=="function")&&_!="__proto__")return h[_]}var Kl=wm(Dc),Uu=Kh||function(h,_){return si.setTimeout(h,_)},Uc=wm(yp);function xm(h,_,E){var z=_+"";return Uc(h,vm(z,Nc(av(z),E)))}function wm(h){var _=0,E=0;return function(){var z=Es(),G=go-(z-E);if(E=z,G>0){if(++_>=Oo)return arguments[0]}else _=0;return h.apply(f,arguments)}}function zp(h,_){var E=-1,z=h.length,G=z-1;for(_=_===f?z:_;++E<_;){var Y=Hi(E,G),he=h[Y];h[Y]=h[E],h[E]=he}return h.length=_,h}var Pp=Dp(function(h){var _=[];return h.charCodeAt(0)===46&&_.push(""),h.replace(ne,function(E,z,G,Y){_.push(G?Y.replace(Ke,"$1"):z||E)}),_});function Ls(h){if(typeof h=="string"||Bo(h))return h;var _=h+"";return _=="0"&&1/h==-Ni?"-0":_}function Fs(h){if(h!=null){try{return bs.call(h)}catch{}try{return h+""}catch{}}return""}function Nc(h,_){return hr(Fi,function(E){var z="_."+E[0];_&E[1]&&!ta(h,z)&&h.push(z)}),h.sort()}function ga(h){if(h instanceof yn)return h.clone();var _=new Sr(h.__wrapped__,h.__chain__);return _.__actions__=io(h.__actions__),_.__index__=h.__index__,_.__values__=h.__values__,_}function bm(h,_,E){(E?Bi(h,_,E):_===f)?_=1:_=vi(_n(_),0);var z=h==null?0:h.length;if(!z||_<1)return[];for(var G=0,Y=0,he=Ne(Su(z/_));G<z;)he[Y++]=To(h,G,G+=_);return he}function _g(h){for(var _=-1,E=h==null?0:h.length,z=0,G=[];++_<E;){var Y=h[_];Y&&(G[z++]=Y)}return G}function dd(){var h=arguments.length;if(!h)return[];for(var _=Ne(h-1),E=arguments[0],z=h;z--;)_[z-1]=arguments[z];return wo(pn(E)?io(E):[E],Z(_,1))}var pd=Ht(function(h,_){return Di(h)?k(h,Z(_,1,Di,!0)):[]}),Mo=Ht(function(h,_){var E=so(_);return Di(E)&&(E=f),Di(h)?k(h,Z(_,1,Di,!0),Wt(E,2)):[]}),fd=Ht(function(h,_){var E=so(_);return Di(E)&&(E=f),Di(h)?k(h,Z(_,1,Di,!0),f,E):[]});function Mr(h,_,E){var z=h==null?0:h.length;return z?(_=E||_===f?1:_n(_),To(h,_<0?0:_,z)):[]}function os(h,_,E){var z=h==null?0:h.length;return z?(_=E||_===f?1:_n(_),_=z-_,To(h,0,_<0?0:_)):[]}function Am(h,_){return h&&h.length?id(h,Wt(_,3),!0,!0):[]}function Ai(h,_){return h&&h.length?id(h,Wt(_,3),!0):[]}function gg(h,_,E,z){var G=h==null?0:h.length;return G?(E&&typeof E!="number"&&Bi(h,_,E)&&(E=0,z=G),K(h,_,E,z)):[]}function Gc(h,_,E){var z=h==null?0:h.length;if(!z)return-1;var G=E==null?0:_n(E);return G<0&&(G=vi(z+G,0)),mn(h,Wt(_,3),G)}function ss(h,_,E){var z=h==null?0:h.length;if(!z)return-1;var G=z-1;return E!==f&&(G=_n(E),G=E<0?vi(z+G,0):xi(G,z-1)),mn(h,Wt(_,3),G,!0)}function yg(h){var _=h==null?0:h.length;return _?Z(h,1):[]}function hv(h){var _=h==null?0:h.length;return _?Z(h,Ni):[]}function vg(h,_){var E=h==null?0:h.length;return E?(_=_===f?1:_n(_),Z(h,_)):[]}function xg(h){for(var _=-1,E=h==null?0:h.length,z={};++_<E;){var G=h[_];z[G[0]]=G[1]}return z}function Xl(h){return h&&h.length?h[0]:f}function wg(h,_,E){var z=h==null?0:h.length;if(!z)return-1;var G=E==null?0:_n(E);return G<0&&(G=vi(z+G,0)),bo(h,_,G)}function bg(h){var _=h==null?0:h.length;return _?To(h,0,-1):[]}var Ag=Ht(function(h){var _=Jn(h,bp);return _.length&&_[0]===h[0]?qe(_):[]}),Eg=Ht(function(h){var _=so(h),E=Jn(h,bp);return _===so(E)?_=f:E.pop(),E.length&&E[0]===h[0]?qe(E,Wt(_,2)):[]}),dv=Ht(function(h){var _=so(h),E=Jn(h,bp);return _=typeof _=="function"?_:f,_&&E.pop(),E.length&&E[0]===h[0]?qe(E,f,_):[]});function Em(h,_){return h==null?"":Xh.call(h,_)}function so(h){var _=h==null?0:h.length;return _?h[_-1]:f}function Cm(h,_,E){var z=h==null?0:h.length;if(!z)return-1;var G=z;return E!==f&&(G=_n(E),G=G<0?vi(z+G,0):xi(G,z-1)),_===_?gc(h,_,G):mn(h,Uh,G,!0)}function Br(h,_){return h&&h.length?Cn(h,_n(_)):f}var Cg=Ht(Tg);function Tg(h,_){return h&&h.length&&_&&_.length?Bs(h,_):h}function Sg(h,_,E){return h&&h.length&&_&&_.length?Bs(h,_,Wt(E,2)):h}function pv(h,_,E){return h&&h.length&&_&&_.length?Bs(h,_,f,E):h}var fv=ma(function(h,_){var E=h==null?0:h.length,z=p(h,_);return to(h,Jn(_,function(G){return _a(G,E)?+G:G}).sort(ha)),z});function Ig(h,_){var E=[];if(!(h&&h.length))return E;var z=-1,G=[],Y=h.length;for(_=Wt(_,3);++z<Y;){var he=h[z];_(he,z,h)&&(E.push(he),G.push(z))}return to(h,G),E}function Lp(h){return h==null?h:sp.call(h)}function Mg(h,_,E){var z=h==null?0:h.length;return z?(E&&typeof E!="number"&&Bi(h,_,E)?(_=0,E=z):(_=_==null?0:_n(_),E=E===f?z:_n(E)),To(h,_,E)):[]}function Tm(h,_){return kc(h,_)}function Qa(h,_,E){return vp(h,_,Wt(E,2))}function ao(h,_){var E=h==null?0:h.length;if(E){var z=kc(h,_);if(z<E&&lo(h[z],_))return z}return-1}function mv(h,_){return kc(h,_,!0)}function Sm(h,_,E){return vp(h,_,Wt(E,2),!0)}function _v(h,_){var E=h==null?0:h.length;if(E){var z=kc(h,_,!0)-1;if(lo(h[z],_))return z}return-1}function gv(h){return h&&h.length?im(h):[]}function yv(h,_){return h&&h.length?im(h,Wt(_,2)):[]}function md(h){var _=h==null?0:h.length;return _?To(h,1,_):[]}function Fp(h,_,E){return h&&h.length?(_=E||_===f?1:_n(_),To(h,0,_<0?0:_)):[]}function Bg(h,_,E){var z=h==null?0:h.length;return z?(_=E||_===f?1:_n(_),_=z-_,To(h,_<0?0:_,z)):[]}function Nu(h,_){return h&&h.length?id(h,Wt(_,3),!1,!0):[]}function _d(h,_){return h&&h.length?id(h,Wt(_,3)):[]}var vv=Ht(function(h){return Xa(Z(h,1,Di,!0))}),xv=Ht(function(h){var _=so(h);return Di(_)&&(_=f),Xa(Z(h,1,Di,!0),Wt(_,2))}),wv=Ht(function(h){var _=so(h);return _=typeof _=="function"?_:f,Xa(Z(h,1,Di,!0),f,_)});function bv(h){return h&&h.length?Xa(h):[]}function Av(h,_){return h&&h.length?Xa(h,Wt(_,2)):[]}function Ev(h,_){return _=typeof _=="function"?_:f,h&&h.length?Xa(h,f,_):[]}function Im(h){if(!(h&&h.length))return[];var _=0;return h=dn(h,function(E){if(Di(E))return _=vi(E.length,_),!0}),Il(_,function(E){return Jn(h,Sl(E))})}function Rp(h,_){if(!(h&&h.length))return[];var E=Im(h);return _==null?E:Jn(E,function(z){return cr(_,f,z)})}var Cv=Ht(function(h,_){return Di(h)?k(h,_):[]}),Vc=Ht(function(h){return wp(dn(h,Di))}),Tv=Ht(function(h){var _=so(h);return Di(_)&&(_=f),wp(dn(h,Di),Wt(_,2))}),pi=Ht(function(h){var _=so(h);return _=typeof _=="function"?_:f,wp(dn(h,Di),f,_)}),Op=Ht(Im);function Dg(h,_){return am(h||[],_||[],Vl)}function Up(h,_){return am(h||[],_||[],fr)}var Np=Ht(function(h){var _=h.length,E=_>1?h[_-1]:f;return E=typeof E=="function"?(h.pop(),E):f,Rp(h,E)});function jc(h){var _=W(h);return _.__chain__=!0,_}function kg(h,_){return _(h),h}function gd(h,_){return _(h)}var yd=ma(function(h){var _=h.length,E=_?h[0]:0,z=this.__wrapped__,G=function(Y){return p(Y,h)};return _>1||this.__actions__.length||!(z instanceof yn)||!_a(E)?this.thru(G):(z=z.slice(E,+E+(_?1:0)),z.__actions__.push({func:gd,args:[G],thisArg:f}),new Sr(z,this.__chain__).thru(function(Y){return _&&!Y.length&&Y.push(f),Y}))});function Mm(){return jc(this)}function Bm(){return new Sr(this.value(),this.__chain__)}function Sv(){this.__values__===f&&(this.__values__=Vu(this.value()));var h=this.__index__>=this.__values__.length,_=h?f:this.__values__[this.__index__++];return{done:h,value:_}}function zg(){return this}function vd(h){for(var _,E=this;E instanceof Mi;){var z=ga(E);z.__index__=0,z.__values__=f,_?G.__wrapped__=z:_=z;var G=z;E=E.__wrapped__}return G.__wrapped__=h,_}function Iv(){var h=this.__wrapped__;if(h instanceof yn){var _=h;return this.__actions__.length&&(_=new yn(this)),_=_.reverse(),_.__actions__.push({func:gd,args:[Lp],thisArg:f}),new Sr(_,this.__chain__)}return this.thru(Lp)}function Dm(){return sm(this.__wrapped__,this.__actions__)}var Mv=Hl(function(h,_,E){Rn.call(h,E)?++h[E]:a(h,E,1)});function km(h,_,E){var z=pn(h)?xo:j;return E&&Bi(h,_,E)&&(_=f),z(h,Wt(_,3))}function zm(h,_){var E=pn(h)?dn:Q;return E(h,Wt(_,3))}var Gp=og(Gc),Bv=og(ss);function Dv(h,_){return Z(jp(h,_),1)}function kv(h,_){return Z(jp(h,_),Ni)}function zv(h,_,E){return E=E===f?1:_n(E),Z(jp(h,_),E)}function Pg(h,_){var E=pn(h)?hr:P;return E(h,Wt(_,3))}function Lg(h,_){var E=pn(h)?Rh:U;return E(h,Wt(_,3))}var Vp=Hl(function(h,_,E){Rn.call(h,E)?h[E].push(_):a(h,E,[_])});function Pv(h,_,E,z){h=uo(h)?h:eu(h),E=E&&!z?_n(E):0;var G=h.length;return E<0&&(E=vi(G+E,0)),Kp(h)?E<=G&&h.indexOf(_,E)>-1:!!G&&bo(h,_,E)>-1}var Fg=Ht(function(h,_,E){var z=-1,G=typeof _=="function",Y=uo(h)?Ne(h.length):[];return P(h,function(he){Y[++z]=G?cr(_,he,E):Ie(he,_,E)}),Y}),qc=Hl(function(h,_,E){a(h,E,_)});function jp(h,_){var E=pn(h)?Jn:wi;return E(h,Wt(_,3))}function Lv(h,_,E,z){return h==null?[]:(pn(_)||(_=_==null?[]:[_]),E=z?f:E,pn(E)||(E=E==null?[]:[E]),ci(h,_,E))}var Fv=Hl(function(h,_,E){h[E?0:1].push(_)},function(){return[[],[]]});function Rg(h,_,E){var z=pn(h)?uc:Gh,G=arguments.length<3;return z(h,Wt(_,4),E,G,P)}function Og(h,_,E){var z=pn(h)?cc:Gh,G=arguments.length<3;return z(h,Wt(_,4),E,G,U)}function Rv(h,_){var E=pn(h)?dn:Q;return E(h,Zp(Wt(_,3)))}function Ov(h){var _=pn(h)?nd:ns;return _(h)}function Uv(h,_,E){(E?Bi(h,_,E):_===f)?_=1:_=_n(_);var z=pn(h)?_p:ca;return z(h,_)}function Pm(h){var _=pn(h)?gp:ng;return _(h)}function qp(h){if(h==null)return 0;if(uo(h))return Kp(h)?kl(h):h.length;var _=er(h);return _==Qt||_==Ar?h.size:Dn(h).length}function Hp(h,_,E){var z=pn(h)?xu:ig;return E&&Bi(h,_,E)&&(_=f),z(h,Wt(_,3))}var Nv=Ht(function(h,_){if(h==null)return[];var E=_.length;return E>1&&Bi(h,_[0],_[1])?_=[]:E>2&&Bi(_[0],_[1],_[2])&&(_=[_[0]]),ci(h,Z(_,1),[])}),$p=Fr||function(){return si.Date.now()};function xd(h,_){if(typeof _!="function")throw new Tr(O);return h=_n(h),function(){if(--h<1)return _.apply(this,arguments)}}function Hc(h,_,E){return _=E?f:_,_=h&&_==null?h.length:_,Qi(h,bt,f,f,f,f,_)}function Lm(h,_){var E;if(typeof _!="function")throw new Tr(O);return h=_n(h),function(){return--h>0&&(E=_.apply(this,arguments)),h<=1&&(_=f),E}}var Gu=Ht(function(h,_,E){var z=hn;if(E.length){var G=Wo(E,Lc(Gu));z|=ke}return Qi(h,z,_,E,G)}),Fm=Ht(function(h,_,E){var z=hn|Te;if(E.length){var G=Wo(E,Lc(Fm));z|=ke}return Qi(_,z,h,E,G)});function Ug(h,_,E){_=E?f:_;var z=Qi(h,Se,f,f,f,f,f,_);return z.placeholder=Ug.placeholder,z}function Rm(h,_,E){_=E?f:_;var z=Qi(h,it,f,f,f,f,f,_);return z.placeholder=Rm.placeholder,z}function Om(h,_,E){var z,G,Y,he,ve,Me,Qe=0,et=!1,tt=!1,xt=!0;if(typeof h!="function")throw new Tr(O);_=as(_)||0,fi(E)&&(et=!!E.leading,tt="maxWait"in E,Y=tt?vi(as(E.maxWait)||0,_):Y,xt="trailing"in E?!!E.trailing:xt);function kt(Ci){var ls=z,Ea=G;return z=G=f,Qe=Ci,he=h.apply(Ea,ls),he}function Vt(Ci){return Qe=Ci,ve=Uu(wn,_),et?kt(Ci):he}function ln(Ci){var ls=Ci-Me,Ea=Ci-Qe,o_=_-ls;return tt?xi(o_,Y-Ea):o_}function Kt(Ci){var ls=Ci-Me,Ea=Ci-Qe;return Me===f||ls>=_||ls<0||tt&&Ea>=Y}function wn(){var Ci=$p();if(Kt(Ci))return Sn(Ci);ve=Uu(wn,ln(Ci))}function Sn(Ci){return ve=f,xt&&z?kt(Ci):(z=G=f,he)}function co(){ve!==f&&um(ve),Qe=0,z=Me=G=ve=f}function mr(){return ve===f?he:Sn($p())}function ko(){var Ci=$p(),ls=Kt(Ci);if(z=arguments,G=this,Me=Ci,ls){if(ve===f)return Vt(Me);if(tt)return um(ve),ve=Uu(wn,_),kt(Me)}return ve===f&&(ve=Uu(wn,_)),he}return ko.cancel=co,ko.flush=mr,ko}var Ng=Ht(function(h,_){return I(h,1,_)}),Gg=Ht(function(h,_,E){return I(h,as(_)||0,E)});function Vg(h){return Qi(h,zt)}function wd(h,_){if(typeof h!="function"||_!=null&&typeof _!="function")throw new Tr(O);var E=function(){var z=arguments,G=_?_.apply(this,z):z[0],Y=E.cache;if(Y.has(G))return Y.get(G);var he=h.apply(this,z);return E.cache=Y.set(G,he)||Y,he};return E.cache=new(wd.Cache||es),E}wd.Cache=es;function Zp(h){if(typeof h!="function")throw new Tr(O);return function(){var _=arguments;switch(_.length){case 0:return!h.call(this);case 1:return!h.call(this,_[0]);case 2:return!h.call(this,_[0],_[1]);case 3:return!h.call(this,_[0],_[1],_[2])}return!h.apply(this,_)}}function Gv(h){return Lm(2,h)}var jg=zc(function(h,_){_=_.length==1&&pn(_[0])?Jn(_[0],dr(Wt())):Jn(Z(_,1),dr(Wt()));var E=_.length;return Ht(function(z){for(var G=-1,Y=xi(z.length,E);++G<Y;)z[G]=_[G].call(this,z[G]);return cr(h,this,z)})}),$c=Ht(function(h,_){var E=Wo(_,Lc($c));return Qi(h,ke,f,_,E)}),Um=Ht(function(h,_){var E=Wo(_,Lc(Um));return Qi(h,ut,f,_,E)}),Dr=ma(function(h,_){return Qi(h,Pt,f,f,f,_)});function bd(h,_){if(typeof h!="function")throw new Tr(O);return _=_===f?_:_n(_),Ht(h,_)}function Zc(h,_){if(typeof h!="function")throw new Tr(O);return _=_==null?0:vi(_n(_),0),Ht(function(E){var z=E[_],G=Ja(E,0,_);return z&&wo(G,z),cr(h,this,G)})}function Ad(h,_,E){var z=!0,G=!0;if(typeof h!="function")throw new Tr(O);return fi(E)&&(z="leading"in E?!!E.leading:z,G="trailing"in E?!!E.trailing:G),Om(h,_,{leading:z,maxWait:_,trailing:G})}function qg(h){return Hc(h,1)}function Hg(h,_){return $c(lm(_),h)}function Vv(){if(!arguments.length)return[];var h=arguments[0];return pn(h)?h:[h]}function jv(h){return v(h,ct)}function qv(h,_){return _=typeof _=="function"?_:f,v(h,ct,_)}function Hv(h){return v(h,Pe|ct)}function $v(h,_){return _=typeof _=="function"?_:f,v(h,Pe|ct,_)}function Zv(h,_){return _==null||S(h,_,nr(_))}function lo(h,_){return h===_||h!==h&&_!==_}var Wv=ks(Re),$g=ks(function(h,_){return h>=_}),Jl=ye(function(){return arguments}())?ye:function(h){return Ei(h)&&Rn.call(h,"callee")&&!oa.call(h,"callee")},pn=Ne.isArray,Kv=Ph?dr(Ph):dt;function uo(h){return h!=null&&Ql(h.length)&&!el(h)}function Di(h){return Ei(h)&&uo(h)}function Xv(h){return h===!0||h===!1||Ei(h)&&we(h)==Hr}var Yl=op||lf,Zg=sc?dr(sc):ot;function Jv(h){return Ei(h)&&h.nodeType===1&&!xa(h)}function tr(h){if(h==null)return!0;if(uo(h)&&(pn(h)||typeof h=="string"||typeof h.splice=="function"||Yl(h)||Jc(h)||Jl(h)))return!h.length;var _=er(h);if(_==Qt||_==Ar)return!h.size;if(Rc(h))return!Dn(h).length;for(var E in h)if(Rn.call(h,E))return!1;return!0}function ya(h,_){return lt(h,_)}function Nm(h,_,E){E=typeof E=="function"?E:f;var z=E?E(h,_):f;return z===f?lt(h,_,f,E):!!z}function Wc(h){if(!Ei(h))return!1;var _=we(h);return _==Da||_==Pr||typeof h.message=="string"&&typeof h.name=="string"&&!xa(h)}function Kc(h){return typeof h=="number"&&Iu(h)}function el(h){if(!fi(h))return!1;var _=we(h);return _==Xn||_==$r||_==Gi||_==hu}function Wg(h){return typeof h=="number"&&h==_n(h)}function Ql(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=wt}function fi(h){var _=typeof h;return h!=null&&(_=="object"||_=="function")}function Ei(h){return h!=null&&typeof h=="object"}var Xc=Lh?dr(Lh):Et;function Kg(h,_){return h===_||Ut(h,_,gm(_))}function Xg(h,_,E){return E=typeof E=="function"?E:f,Ut(h,_,gm(_),E)}function Vn(h){return va(h)&&h!=+h}function Gm(h){if(hg(h))throw new on(D);return Lt(h)}function Jg(h){return h===null}function Yg(h){return h==null}function va(h){return typeof h=="number"||Ei(h)&&we(h)==or}function xa(h){if(!Ei(h)||we(h)!=Vi)return!1;var _=ra(h);if(_===null)return!0;var E=Rn.call(_,"constructor")&&_.constructor;return typeof E=="function"&&E instanceof E&&bs.call(E)==em}var Wp=ac?dr(ac):St;function Yv(h){return Wg(h)&&h>=-wt&&h<=wt}var Qg=lc?dr(lc):at;function Kp(h){return typeof h=="string"||!pn(h)&&Ei(h)&&we(h)==Ii}function Bo(h){return typeof h=="symbol"||Ei(h)&&we(h)==yo}var Jc=ea?dr(ea):Zt;function Qv(h){return h===f}function ex(h){return Ei(h)&&er(h)==vs}function tx(h){return Ei(h)&&we(h)==fl}var nx=ks(En),Xp=ks(function(h,_){return h<=_});function Vu(h){if(!h)return[];if(uo(h))return Kp(h)?Lr(h):io(h);if(As&&h[As])return Hh(h[As]());var _=er(h),E=_==Qt?Dl:_==Ar?_c:eu;return E(h)}function wa(h){if(!h)return h===0?h:0;if(h=as(h),h===Ni||h===-Ni){var _=h<0?-1:1;return _*Jt}return h===h?h:0}function _n(h){var _=wa(h),E=_%1;return _===_?E?_-E:_:0}function ey(h){return h?g(_n(h),0,gn):0}function as(h){if(typeof h=="number")return h;if(Bo(h))return Bt;if(fi(h)){var _=typeof h.valueOf=="function"?h.valueOf():h;h=fi(_)?_+"":_}if(typeof h!="string")return h===0?h:+h;h=Au(h);var E=Dt.test(h);return E||Gt.test(h)?Ga(h.slice(2),E?2:8):Ft.test(h)?Bt:+h}function Jp(h){return da(h,Ur(h))}function Vm(h){return h?g(_n(h),-wt,wt):h===0?h:0}function jn(h){return h==null?"":no(h)}var Do=Ds(function(h,_){if(Rc(_)||uo(_)){da(_,nr(_),h);return}for(var E in _)Rn.call(_,E)&&Vl(h,E,_[E])}),Yc=Ds(function(h,_){da(_,Ur(_),h)}),tl=Ds(function(h,_,E,z){da(_,Ur(_),h,z)}),jm=Ds(function(h,_,E,z){da(_,nr(_),h,z)}),Yp=ma(p);function ix(h,_){var E=la(h);return _==null?E:c(E,_)}var ty=Ht(function(h,_){h=Wn(h);var E=-1,z=_.length,G=z>2?_[2]:f;for(G&&Bi(_[0],_[1],G)&&(z=1);++E<z;)for(var Y=_[E],he=Ur(Y),ve=-1,Me=he.length;++ve<Me;){var Qe=he[ve],et=h[Qe];(et===f||lo(et,ia[Qe])&&!Rn.call(h,Qe))&&(h[Qe]=Y[Qe])}return h}),ny=Ht(function(h){return h.push(f,So),cr($m,f,h)});function rx(h,_){return Va(h,Wt(_,3),X)}function iy(h,_){return Va(h,Wt(_,3),le)}function ry(h,_){return h==null?h:$(h,Wt(_,3),Ur)}function qm(h,_){return h==null?h:te(h,Wt(_,3),Ur)}function Hm(h,_){return h&&X(h,Wt(_,3))}function oy(h,_){return h&&le(h,Wt(_,3))}function ox(h){return h==null?[]:ue(h,nr(h))}function sy(h){return h==null?[]:ue(h,Ur(h))}function Rs(h,_,E){var z=h==null?f:oe(h,_);return z===f?E:z}function ay(h,_){return h!=null&&ym(h,_,De)}function Qp(h,_){return h!=null&&ym(h,_,Ye)}var ly=ad(function(h,_,E){_!=null&&typeof _.toString!="function"&&(_=Qr.call(_)),h[_]=E},Id(Nr)),uy=ad(function(h,_,E){_!=null&&typeof _.toString!="function"&&(_=Qr.call(_)),Rn.call(h,_)?h[_].push(E):h[_]=[E]},Wt),sx=Ht(Ie);function nr(h){return uo(h)?Pu(h):Dn(h)}function Ur(h){return uo(h)?Pu(h,!0):Ln(h)}function cy(h,_){var E={};return _=Wt(_,3),X(h,function(z,G,Y){a(E,_(z,G,Y),z)}),E}function Ed(h,_){var E={};return _=Wt(_,3),X(h,function(z,G,Y){a(E,G,_(z,G,Y))}),E}var hy=Ds(function(h,_,E){Fn(h,_,E)}),$m=Ds(function(h,_,E,z){Fn(h,_,E,z)}),Zm=ma(function(h,_){var E={};if(h==null)return E;var z=!1;_=Jn(_,function(Y){return Y=ql(Y,h),z||(z=Y.length>1),Y}),da(h,ud(h),E),z&&(E=v(E,Pe|Le|ct,Io));for(var G=_.length;G--;)xp(E,_[G]);return E});function Qc(h,_){return Cd(h,Zp(Wt(_)))}var dy=ma(function(h,_){return h==null?{}:Yi(h,_)});function Cd(h,_){if(h==null)return{};var E=Jn(ud(h),function(z){return[z]});return _=Wt(_),On(h,E,function(z,G){return _(z,G[0])})}function py(h,_,E){_=ql(_,h);var z=-1,G=_.length;for(G||(G=1,h=f);++z<G;){var Y=h==null?f:h[Ls(_[z])];Y===f&&(z=G,Y=E),h=el(Y)?Y.call(h):Y}return h}function ef(h,_,E){return h==null?h:fr(h,_,E)}function tf(h,_,E,z){return z=typeof z=="function"?z:f,h==null?h:fr(h,_,E,z)}var fy=Tp(nr),my=Tp(Ur);function ax(h,_,E){var z=pn(h),G=z||Yl(h)||Jc(h);if(_=Wt(_,4),E==null){var Y=h&&h.constructor;G?E=z?new Y:[]:fi(h)?E=el(Y)?la(ra(h)):{}:E={}}return(G?hr:X)(h,function(he,ve,Me){return _(E,he,ve,Me)}),E}function lx(h,_){return h==null?!0:xp(h,_)}function ux(h,_,E){return h==null?h:om(h,_,lm(E))}function eh(h,_,E,z){return z=typeof z=="function"?z:f,h==null?h:om(h,_,lm(E),z)}function eu(h){return h==null?[]:pc(h,nr(h))}function cx(h){return h==null?[]:pc(h,Ur(h))}function _y(h,_,E){return E===f&&(E=_,_=f),E!==f&&(E=as(E),E=E===E?E:0),_!==f&&(_=as(_),_=_===_?_:0),g(as(h),_,E)}function hx(h,_,E){return _=wa(_),E===f?(E=_,_=0):E=wa(E),h=as(h),xe(h,_,E)}function Wm(h,_,E){if(E&&typeof E!="boolean"&&Bi(h,_,E)&&(_=E=f),E===f&&(typeof _=="boolean"?(E=_,_=f):typeof h=="boolean"&&(E=h,h=f)),h===f&&_===f?(h=0,_=1):(h=wa(h),_===f?(_=h,h=0):_=wa(_)),h>_){var z=h;h=_,_=z}if(E||h%1||_%1){var G=Mu();return xi(h+G*(_-h+Yd("1e-"+((G+"").length-1))),_)}return Hi(h,_)}var dx=rs(function(h,_,E){return _=_.toLowerCase(),h+(E?nl(_):_)});function nl(h){return tu(jn(h).toLowerCase())}function Km(h){return h=jn(h),h&&h.replace(An,fc).replace(_u,"")}function gy(h,_,E){h=jn(h),_=no(_);var z=h.length;E=E===f?z:g(_n(E),0,z);var G=E;return E-=_.length,E>=0&&h.slice(E,G)==_}function nf(h){return h=jn(h),h&&yl.test(h)?h.replace(La,mc):h}function Xm(h){return h=jn(h),h&&V.test(h)?h.replace(R,"\\$&"):h}var px=rs(function(h,_,E){return h+(E?"-":"")+_.toLowerCase()}),fx=rs(function(h,_,E){return h+(E?" ":"")+_.toLowerCase()}),yy=Ya("toLowerCase");function vy(h,_,E){h=jn(h),_=_n(_);var z=_?kl(h):0;if(!_||z>=_)return h;var G=(_-z)/2;return Cp(Ul(G),E)+h+Cp(Su(G),E)}function Td(h,_,E){h=jn(h),_=_n(_);var z=_?kl(h):0;return _&&z<_?h+Cp(_-z,E):h}function il(h,_,E){h=jn(h),_=_n(_);var z=_?kl(h):0;return _&&z<_?Cp(_-z,E)+h:h}function Jm(h,_,E){return E||_==null?_=0:_&&(_=+_),Rr(jn(h).replace(ee,""),_||0)}function th(h,_,E){return(E?Bi(h,_,E):_===f)?_=1:_=_n(_),ts(jn(h),_)}function nh(){var h=arguments,_=jn(h[0]);return h.length<3?_:_.replace(h[1],h[2])}var Os=rs(function(h,_,E){return h+(E?"_":"")+_.toLowerCase()});function Us(h,_,E){return E&&typeof E!="number"&&Bi(h,_,E)&&(_=E=f),E=E===f?gn:E>>>0,E?(h=jn(h),h&&(typeof _=="string"||_!=null&&!Wp(_))&&(_=no(_),!_&&ja(h))?Ja(Lr(h),0,E):h.split(_,E)):[]}var mx=rs(function(h,_,E){return h+(E?" ":"")+tu(_)});function xy(h,_,E){return h=jn(h),E=E==null?0:g(_n(E),0,h.length),_=no(_),h.slice(E,E+_.length)==_}function _x(h,_,E){var z=W.templateSettings;E&&Bi(h,_,E)&&(_=f),h=jn(h),_=tl({},_,z,zs);var G=tl({},_.imports,z.imports,zs),Y=nr(G),he=pc(G,Y),ve,Me,Qe=0,et=_.interpolate||Rt,tt="__p += '",xt=xc((_.escape||Rt).source+"|"+et.source+"|"+(et===Xs?_t:Rt).source+"|"+(_.evaluate||Rt).source+"|$","g"),kt="//# sourceURL="+(Rn.call(_,"sourceURL")?(_.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ho+"]")+`
`;h.replace(xt,function(Kt,wn,Sn,co,mr,ko){return Sn||(Sn=co),tt+=h.slice(Qe,ko).replace(Pn,Zo),wn&&(ve=!0,tt+=`' +
__e(`+wn+`) +
'`),mr&&(Me=!0,tt+=`';
`+mr+`;
__p += '`),Sn&&(tt+=`' +
((__t = (`+Sn+`)) == null ? '' : __t) +
'`),Qe=ko+Kt.length,Kt}),tt+=`';
`;var Vt=Rn.call(_,"variable")&&_.variable;if(!Vt)tt=`with (obj) {
`+tt+`
}
`;else if(Be.test(Vt))throw new on(s);tt=(Me?tt.replace(Ks,""):tt).replace(_l,"$1").replace(gl,"$1;"),tt="function("+(Vt||"obj")+`) {
`+(Vt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ve?", __e = _.escape":"")+(Me?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+tt+`return __p
}`;var ln=rh(function(){return Bn(Y,kt+"return "+tt).apply(f,he)});if(ln.source=tt,Wc(ln))throw ln;return ln}function Ym(h){return jn(h).toLowerCase()}function ba(h){return jn(h).toUpperCase()}function ju(h,_,E){if(h=jn(h),h&&(E||_===f))return Au(h);if(!h||!(_=no(_)))return h;var z=Lr(h),G=Lr(_),Y=Ml(z,G),he=Bl(z,G)+1;return Ja(z,Y,he).join("")}function wy(h,_,E){if(h=jn(h),h&&(E||_===f))return h.slice(0,np(h)+1);if(!h||!(_=no(_)))return h;var z=Lr(h),G=Bl(z,Lr(_))+1;return Ja(z,0,G).join("")}function by(h,_,E){if(h=jn(h),h&&(E||_===f))return h.replace(ee,"");if(!h||!(_=no(_)))return h;var z=Lr(h),G=Ml(z,Lr(_));return Ja(z,G).join("")}function gx(h,_){var E=qt,z=rr;if(fi(_)){var G="separator"in _?_.separator:G;E="length"in _?_n(_.length):E,z="omission"in _?no(_.omission):z}h=jn(h);var Y=h.length;if(ja(h)){var he=Lr(h);Y=he.length}if(E>=Y)return h;var ve=E-kl(z);if(ve<1)return z;var Me=he?Ja(he,0,ve).join(""):h.slice(0,ve);if(G===f)return Me+z;if(he&&(ve+=Me.length-ve),Wp(G)){if(h.slice(ve).search(G)){var Qe,et=Me;for(G.global||(G=xc(G.source,jn(Je.exec(G))+"g")),G.lastIndex=0;Qe=G.exec(et);)var tt=Qe.index;Me=Me.slice(0,tt===f?ve:tt)}}else if(h.indexOf(no(G),ve)!=ve){var xt=Me.lastIndexOf(G);xt>-1&&(Me=Me.slice(0,xt))}return Me+z}function rf(h){return h=jn(h),h&&ic.test(h)?h.replace(Kr,yc):h}var Qm=rs(function(h,_,E){return h+(E?" ":"")+_.toUpperCase()}),tu=Ya("toUpperCase");function ih(h,_,E){return h=jn(h),_=E?f:_,_===f?qh(h)?Wh(h):na(h):h.match(_)||[]}var rh=Ht(function(h,_){try{return cr(h,f,_)}catch(E){return Wc(E)?E:new on(E)}}),of=ma(function(h,_){return hr(_,function(E){E=Ls(E),a(h,E,Gu(h[E],h))}),h});function Ay(h){var _=h==null?0:h.length,E=Wt();return h=_?Jn(h,function(z){if(typeof z[1]!="function")throw new Tr(O);return[E(z[0]),z[1]]}):[],Ht(function(z){for(var G=-1;++G<_;){var Y=h[G];if(cr(Y[0],this,z))return cr(Y[1],this,z)}})}function Sd(h){return A(v(h,Pe))}function Id(h){return function(){return h}}function Ey(h,_){return h==null||h!==h?_:h}var oh=sg(),Cy=sg(!0);function Nr(h){return h}function e_(h){return Yt(typeof h=="function"?h:v(h,Pe))}function yx(h){return Ji(v(h,Pe))}function Ty(h,_){return Co(h,v(_,Pe))}var qu=Ht(function(h,_){return function(E){return Ie(E,h,_)}}),vx=Ht(function(h,_){return function(E){return Ie(h,E,_)}});function Aa(h,_,E){var z=nr(_),G=ue(_,z);E==null&&!(fi(_)&&(G.length||!z.length))&&(E=_,_=h,h=this,G=ue(_,nr(_)));var Y=!(fi(E)&&"chain"in E)||!!E.chain,he=el(h);return hr(G,function(ve){var Me=_[ve];h[ve]=Me,he&&(h.prototype[ve]=function(){var Qe=this.__chain__;if(Y||Qe){var et=h(this.__wrapped__),tt=et.__actions__=io(this.__actions__);return tt.push({func:Me,args:arguments,thisArg:h}),et.__chain__=Qe,et}return Me.apply(h,wo([this.value()],arguments))})}),h}function xx(){return si._===this&&(si._=rp),this}function Hu(){}function Md(h){return h=_n(h),Ht(function(_){return Cn(_,h)})}var Bd=_m(Jn),Dd=_m(xo),sf=_m(xu);function Sy(h){return Mp(h)?Sl(Ls(h)):Ir(h)}function wx(h){return function(_){return h==null?f:oe(h,_)}}var sh=Nt(),af=Nt(!0);function t_(){return[]}function lf(){return!1}function Iy(){return{}}function bx(){return""}function My(){return!0}function Ax(h,_){if(h=_n(h),h<1||h>wt)return[];var E=gn,z=xi(h,gn);_=Wt(_),h-=gn;for(var G=Il(z,_);++E<h;)_(E);return G}function By(h){return pn(h)?Jn(h,Ls):Bo(h)?[h]:io(Pp(jn(h)))}function Ex(h){var _=++Xo;return jn(h)+_}var Dy=ro(function(h,_){return h+_},0),Cx=vn("ceil"),Tx=ro(function(h,_){return h/_},1),uf=vn("floor");function cf(h){return h&&h.length?J(h,Nr,Re):f}function hf(h,_){return h&&h.length?J(h,Wt(_,2),Re):f}function Sx(h){return Nh(h,Nr)}function n_(h,_){return Nh(h,Wt(_,2))}function i_(h){return h&&h.length?J(h,Nr,En):f}function nu(h,_){return h&&h.length?J(h,Wt(_,2),En):f}var Ix=ro(function(h,_){return h*_},1),r_=vn("round"),ky=ro(function(h,_){return h-_},0);function df(h){return h&&h.length?bu(h,Nr):0}function Mx(h,_){return h&&h.length?bu(h,Wt(_,2)):0}return W.after=xd,W.ary=Hc,W.assign=Do,W.assignIn=Yc,W.assignInWith=tl,W.assignWith=jm,W.at=Yp,W.before=Lm,W.bind=Gu,W.bindAll=of,W.bindKey=Fm,W.castArray=Vv,W.chain=jc,W.chunk=bm,W.compact=_g,W.concat=dd,W.cond=Ay,W.conforms=Sd,W.constant=Id,W.countBy=Mv,W.create=ix,W.curry=Ug,W.curryRight=Rm,W.debounce=Om,W.defaults=ty,W.defaultsDeep=ny,W.defer=Ng,W.delay=Gg,W.difference=pd,W.differenceBy=Mo,W.differenceWith=fd,W.drop=Mr,W.dropRight=os,W.dropRightWhile=Am,W.dropWhile=Ai,W.fill=gg,W.filter=zm,W.flatMap=Dv,W.flatMapDeep=kv,W.flatMapDepth=zv,W.flatten=yg,W.flattenDeep=hv,W.flattenDepth=vg,W.flip=Vg,W.flow=oh,W.flowRight=Cy,W.fromPairs=xg,W.functions=ox,W.functionsIn=sy,W.groupBy=Vp,W.initial=bg,W.intersection=Ag,W.intersectionBy=Eg,W.intersectionWith=dv,W.invert=ly,W.invertBy=uy,W.invokeMap=Fg,W.iteratee=e_,W.keyBy=qc,W.keys=nr,W.keysIn=Ur,W.map=jp,W.mapKeys=cy,W.mapValues=Ed,W.matches=yx,W.matchesProperty=Ty,W.memoize=wd,W.merge=hy,W.mergeWith=$m,W.method=qu,W.methodOf=vx,W.mixin=Aa,W.negate=Zp,W.nthArg=Md,W.omit=Zm,W.omitBy=Qc,W.once=Gv,W.orderBy=Lv,W.over=Bd,W.overArgs=jg,W.overEvery=Dd,W.overSome=sf,W.partial=$c,W.partialRight=Um,W.partition=Fv,W.pick=dy,W.pickBy=Cd,W.property=Sy,W.propertyOf=wx,W.pull=Cg,W.pullAll=Tg,W.pullAllBy=Sg,W.pullAllWith=pv,W.pullAt=fv,W.range=sh,W.rangeRight=af,W.rearg=Dr,W.reject=Rv,W.remove=Ig,W.rest=bd,W.reverse=Lp,W.sampleSize=Uv,W.set=ef,W.setWith=tf,W.shuffle=Pm,W.slice=Mg,W.sortBy=Nv,W.sortedUniq=gv,W.sortedUniqBy=yv,W.split=Us,W.spread=Zc,W.tail=md,W.take=Fp,W.takeRight=Bg,W.takeRightWhile=Nu,W.takeWhile=_d,W.tap=kg,W.throttle=Ad,W.thru=gd,W.toArray=Vu,W.toPairs=fy,W.toPairsIn=my,W.toPath=By,W.toPlainObject=Jp,W.transform=ax,W.unary=qg,W.union=vv,W.unionBy=xv,W.unionWith=wv,W.uniq=bv,W.uniqBy=Av,W.uniqWith=Ev,W.unset=lx,W.unzip=Im,W.unzipWith=Rp,W.update=ux,W.updateWith=eh,W.values=eu,W.valuesIn=cx,W.without=Cv,W.words=ih,W.wrap=Hg,W.xor=Vc,W.xorBy=Tv,W.xorWith=pi,W.zip=Op,W.zipObject=Dg,W.zipObjectDeep=Up,W.zipWith=Np,W.entries=fy,W.entriesIn=my,W.extend=Yc,W.extendWith=tl,Aa(W,W),W.add=Dy,W.attempt=rh,W.camelCase=dx,W.capitalize=nl,W.ceil=Cx,W.clamp=_y,W.clone=jv,W.cloneDeep=Hv,W.cloneDeepWith=$v,W.cloneWith=qv,W.conformsTo=Zv,W.deburr=Km,W.defaultTo=Ey,W.divide=Tx,W.endsWith=gy,W.eq=lo,W.escape=nf,W.escapeRegExp=Xm,W.every=km,W.find=Gp,W.findIndex=Gc,W.findKey=rx,W.findLast=Bv,W.findLastIndex=ss,W.findLastKey=iy,W.floor=uf,W.forEach=Pg,W.forEachRight=Lg,W.forIn=ry,W.forInRight=qm,W.forOwn=Hm,W.forOwnRight=oy,W.get=Rs,W.gt=Wv,W.gte=$g,W.has=ay,W.hasIn=Qp,W.head=Xl,W.identity=Nr,W.includes=Pv,W.indexOf=wg,W.inRange=hx,W.invoke=sx,W.isArguments=Jl,W.isArray=pn,W.isArrayBuffer=Kv,W.isArrayLike=uo,W.isArrayLikeObject=Di,W.isBoolean=Xv,W.isBuffer=Yl,W.isDate=Zg,W.isElement=Jv,W.isEmpty=tr,W.isEqual=ya,W.isEqualWith=Nm,W.isError=Wc,W.isFinite=Kc,W.isFunction=el,W.isInteger=Wg,W.isLength=Ql,W.isMap=Xc,W.isMatch=Kg,W.isMatchWith=Xg,W.isNaN=Vn,W.isNative=Gm,W.isNil=Yg,W.isNull=Jg,W.isNumber=va,W.isObject=fi,W.isObjectLike=Ei,W.isPlainObject=xa,W.isRegExp=Wp,W.isSafeInteger=Yv,W.isSet=Qg,W.isString=Kp,W.isSymbol=Bo,W.isTypedArray=Jc,W.isUndefined=Qv,W.isWeakMap=ex,W.isWeakSet=tx,W.join=Em,W.kebabCase=px,W.last=so,W.lastIndexOf=Cm,W.lowerCase=fx,W.lowerFirst=yy,W.lt=nx,W.lte=Xp,W.max=cf,W.maxBy=hf,W.mean=Sx,W.meanBy=n_,W.min=i_,W.minBy=nu,W.stubArray=t_,W.stubFalse=lf,W.stubObject=Iy,W.stubString=bx,W.stubTrue=My,W.multiply=Ix,W.nth=Br,W.noConflict=xx,W.noop=Hu,W.now=$p,W.pad=vy,W.padEnd=Td,W.padStart=il,W.parseInt=Jm,W.random=Wm,W.reduce=Rg,W.reduceRight=Og,W.repeat=th,W.replace=nh,W.result=py,W.round=r_,W.runInContext=Ce,W.sample=Ov,W.size=qp,W.snakeCase=Os,W.some=Hp,W.sortedIndex=Tm,W.sortedIndexBy=Qa,W.sortedIndexOf=ao,W.sortedLastIndex=mv,W.sortedLastIndexBy=Sm,W.sortedLastIndexOf=_v,W.startCase=mx,W.startsWith=xy,W.subtract=ky,W.sum=df,W.sumBy=Mx,W.template=_x,W.times=Ax,W.toFinite=wa,W.toInteger=_n,W.toLength=ey,W.toLower=Ym,W.toNumber=as,W.toSafeInteger=Vm,W.toString=jn,W.toUpper=ba,W.trim=ju,W.trimEnd=wy,W.trimStart=by,W.truncate=gx,W.unescape=rf,W.uniqueId=Ex,W.upperCase=Qm,W.upperFirst=tu,W.each=Pg,W.eachRight=Lg,W.first=Xl,Aa(W,function(){var h={};return X(W,function(_,E){Rn.call(W.prototype,E)||(h[E]=_)}),h}(),{chain:!1}),W.VERSION=w,hr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(h){W[h].placeholder=W}),hr(["drop","take"],function(h,_){yn.prototype[h]=function(E){E=E===f?1:vi(_n(E),0);var z=this.__filtered__&&!_?new yn(this):this.clone();return z.__filtered__?z.__takeCount__=xi(E,z.__takeCount__):z.__views__.push({size:xi(E,gn),type:h+(z.__dir__<0?"Right":"")}),z},yn.prototype[h+"Right"]=function(E){return this.reverse()[h](E).reverse()}}),hr(["filter","map","takeWhile"],function(h,_){var E=_+1,z=E==_s||E==gs;yn.prototype[h]=function(G){var Y=this.clone();return Y.__iteratees__.push({iteratee:Wt(G,3),type:E}),Y.__filtered__=Y.__filtered__||z,Y}}),hr(["head","last"],function(h,_){var E="take"+(_?"Right":"");yn.prototype[h]=function(){return this[E](1).value()[0]}}),hr(["initial","tail"],function(h,_){var E="drop"+(_?"":"Right");yn.prototype[h]=function(){return this.__filtered__?new yn(this):this[E](1)}}),yn.prototype.compact=function(){return this.filter(Nr)},yn.prototype.find=function(h){return this.filter(h).head()},yn.prototype.findLast=function(h){return this.reverse().find(h)},yn.prototype.invokeMap=Ht(function(h,_){return typeof h=="function"?new yn(this):this.map(function(E){return Ie(E,h,_)})}),yn.prototype.reject=function(h){return this.filter(Zp(Wt(h)))},yn.prototype.slice=function(h,_){h=_n(h);var E=this;return E.__filtered__&&(h>0||_<0)?new yn(E):(h<0?E=E.takeRight(-h):h&&(E=E.drop(h)),_!==f&&(_=_n(_),E=_<0?E.dropRight(-_):E.take(_-h)),E)},yn.prototype.takeRightWhile=function(h){return this.reverse().takeWhile(h).reverse()},yn.prototype.toArray=function(){return this.take(gn)},X(yn.prototype,function(h,_){var E=/^(?:filter|find|map|reject)|While$/.test(_),z=/^(?:head|last)$/.test(_),G=W[z?"take"+(_=="last"?"Right":""):_],Y=z||/^find/.test(_);!G||(W.prototype[_]=function(){var he=this.__wrapped__,ve=z?[1]:arguments,Me=he instanceof yn,Qe=ve[0],et=Me||pn(he),tt=function(wn){var Sn=G.apply(W,wo([wn],ve));return z&&xt?Sn[0]:Sn};et&&E&&typeof Qe=="function"&&Qe.length!=1&&(Me=et=!1);var xt=this.__chain__,kt=!!this.__actions__.length,Vt=Y&&!xt,ln=Me&&!kt;if(!Y&&et){he=ln?he:new yn(this);var Kt=h.apply(he,ve);return Kt.__actions__.push({func:gd,args:[tt],thisArg:f}),new Sr(Kt,xt)}return Vt&&ln?h.apply(this,ve):(Kt=this.thru(tt),Vt?z?Kt.value()[0]:Kt.value():Kt)})}),hr(["pop","push","shift","sort","splice","unshift"],function(h){var _=Ko[h],E=/^(?:push|sort|unshift)$/.test(h)?"tap":"thru",z=/^(?:pop|shift)$/.test(h);W.prototype[h]=function(){var G=arguments;if(z&&!this.__chain__){var Y=this.value();return _.apply(pn(Y)?Y:[],G)}return this[E](function(he){return _.apply(pn(he)?he:[],G)})}}),X(yn.prototype,function(h,_){var E=W[_];if(E){var z=E.name+"";Rn.call($a,z)||($a[z]=[]),$a[z].push({name:_,func:E})}}),$a[sd(f,Te).name]=[{name:"wrapper",func:f}],yn.prototype.clone=tm,yn.prototype.reverse=nm,yn.prototype.value=Is,W.prototype.at=yd,W.prototype.chain=Mm,W.prototype.commit=Bm,W.prototype.next=Sv,W.prototype.plant=vd,W.prototype.reverse=Iv,W.prototype.toJSON=W.prototype.valueOf=W.prototype.value=Dm,W.prototype.first=W.prototype.head,As&&(W.prototype[As]=zg),W},Pl=zl();$o?(($o.exports=Pl)._=Pl,vu._=Pl):si._=Pl}).call(gf)})(hw,hw.exports);const VS=hw.exports;var ab={},J0={},$n={};Object.defineProperty($n,"__esModule",{value:!0});$n.areaConversion=$n.timeConversion=$n.distanceConversion=$n.altitudeKeys=$n.latitudeKeys=$n.longitudeKeys=$n.MAXLON=$n.MINLON=$n.MAXLAT=$n.MINLAT=$n.earthRadius=$n.sexagesimalPattern=void 0;var jS=/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,}))?)['′]\s*(([0-9]{1,3}(\.([0-9]{1,}))?)["″]\s*)?([NEOSW]?)$/;$n.sexagesimalPattern=jS;var qS=6378137;$n.earthRadius=qS;var HS=-90;$n.MINLAT=HS;var $S=90;$n.MAXLAT=$S;var ZS=-180;$n.MINLON=ZS;var WS=180;$n.MAXLON=WS;var KS=["lng","lon","longitude",0];$n.longitudeKeys=KS;var XS=["lat","latitude",1];$n.latitudeKeys=XS;var JS=["alt","altitude","elevation","elev",2];$n.altitudeKeys=JS;var YS={m:1,km:.001,cm:100,mm:1e3,mi:1/1609.344,sm:1/1852.216,ft:100/30.48,in:100/2.54,yd:1/.9144};$n.distanceConversion=YS;var QS={m:60,h:3600,d:86400};$n.timeConversion=QS;var dl={m2:1,km2:1e-6,ha:1e-4,a:.01,ft2:10.763911,yd2:1.19599,in2:1550.0031};$n.areaConversion=dl;dl.sqm=dl.m2;dl.sqkm=dl.km2;dl.sqft=dl.ft2;dl.sqyd=dl.yd2;dl.sqin=dl.in2;var Zf={};Object.defineProperty(Zf,"__esModule",{value:!0});Zf.default=void 0;var eI=function(l,f){return f.reduce(function(w,C){if(typeof l>"u"||l===null)throw new Error("'".concat(l,"' is no valid coordinate."));return Object.prototype.hasOwnProperty.call(l,C)&&typeof C<"u"&&typeof w>"u"?(w=C,C):w},void 0)},tI=eI;Zf.default=tI;var Q_={},Wf={};Object.defineProperty(Wf,"__esModule",{value:!0});Wf.default=void 0;var nI=function(l){var f=l.toString().trim();return isNaN(parseFloat(f))?!1:parseFloat(f)===Number(f)},iI=nI;Wf.default=iI;var Kf={};Object.defineProperty(Kf,"__esModule",{value:!0});Kf.default=void 0;var rI=$n,oI=function(l){return rI.sexagesimalPattern.test(l.toString().trim())},sI=oI;Kf.default=sI;var Xf={};Object.defineProperty(Xf,"__esModule",{value:!0});Xf.default=void 0;var aI=$n,lI=function(l){var f=new RegExp(aI.sexagesimalPattern).exec(l.toString().trim());if(typeof f>"u"||f===null)throw new Error("Given value is not in sexagesimal format");var w=Number(f[2])/60||0,C=Number(f[4])/3600||0,D=parseFloat(f[1])+w+C;return["S","W"].includes(f[7])?-D:D},uI=lI;Xf.default=uI;var Y0={},eg={};Object.defineProperty(eg,"__esModule",{value:!0});eg.default=void 0;var p1=$n,f1=cI(Zf);function cI(r){return r&&r.__esModule?r:{default:r}}function GA(r,l){var f=Object.keys(r);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);l&&(w=w.filter(function(C){return Object.getOwnPropertyDescriptor(r,C).enumerable})),f.push.apply(f,w)}return f}function hI(r){for(var l=1;l<arguments.length;l++){var f=arguments[l]!=null?arguments[l]:{};l%2?GA(Object(f),!0).forEach(function(w){dI(r,w,f[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(f)):GA(Object(f)).forEach(function(w){Object.defineProperty(r,w,Object.getOwnPropertyDescriptor(f,w))})}return r}function dI(r,l,f){return l in r?Object.defineProperty(r,l,{value:f,enumerable:!0,configurable:!0,writable:!0}):r[l]=f,r}var pI=function(l){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{longitude:p1.longitudeKeys,latitude:p1.latitudeKeys,altitude:p1.altitudeKeys},w=(0,f1.default)(l,f.longitude),C=(0,f1.default)(l,f.latitude),D=(0,f1.default)(l,f.altitude);return hI({latitude:C,longitude:w},D?{altitude:D}:{})},fI=pI;eg.default=fI;var Q0={};Object.defineProperty(Q0,"__esModule",{value:!0});Q0.default=void 0;var mI=lb(Wf),_I=lb(Kf),gI=lb(Xf),VA=$n;function lb(r){return r&&r.__esModule?r:{default:r}}var yI=function r(l){return(0,mI.default)(l)?!(parseFloat(l)>VA.MAXLAT||l<VA.MINLAT):(0,_I.default)(l)?r((0,gI.default)(l)):!1},vI=yI;Q0.default=vI;var ev={};Object.defineProperty(ev,"__esModule",{value:!0});ev.default=void 0;var xI=ub(Wf),wI=ub(Kf),bI=ub(Xf),jA=$n;function ub(r){return r&&r.__esModule?r:{default:r}}var AI=function r(l){return(0,xI.default)(l)?!(parseFloat(l)>jA.MAXLON||l<jA.MINLON):(0,wI.default)(l)?r((0,bI.default)(l)):!1},EI=AI;ev.default=EI;Object.defineProperty(Y0,"__esModule",{value:!0});Y0.default=void 0;var CI=cb(eg),qA=cb(Q0),HA=cb(ev);function cb(r){return r&&r.__esModule?r:{default:r}}var TI=function(l){var f=(0,CI.default)(l),w=f.latitude,C=f.longitude;if(Array.isArray(l)&&l.length>=2)return(0,HA.default)(l[0])&&(0,qA.default)(l[1]);if(typeof w>"u"||typeof C>"u")return!1;var D=l[C],O=l[w];return!(typeof O>"u"||typeof D>"u"||(0,qA.default)(O)===!1||(0,HA.default)(D)===!1)},SI=TI;Y0.default=SI;Object.defineProperty(Q_,"__esModule",{value:!0});Q_.default=void 0;var II=tg(Wf),MI=tg(Kf),BI=tg(Xf),$A=tg(Y0),DI=tg(eg);function tg(r){return r&&r.__esModule?r:{default:r}}function ZA(r,l){var f=Object.keys(r);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);l&&(w=w.filter(function(C){return Object.getOwnPropertyDescriptor(r,C).enumerable})),f.push.apply(f,w)}return f}function m1(r){for(var l=1;l<arguments.length;l++){var f=arguments[l]!=null?arguments[l]:{};l%2?ZA(Object(f),!0).forEach(function(w){dw(r,w,f[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(f)):ZA(Object(f)).forEach(function(w){Object.defineProperty(r,w,Object.getOwnPropertyDescriptor(f,w))})}return r}function dw(r,l,f){return l in r?Object.defineProperty(r,l,{value:f,enumerable:!0,configurable:!0,writable:!0}):r[l]=f,r}var kI=function r(l){if((0,II.default)(l))return Number(l);if((0,MI.default)(l))return(0,BI.default)(l);if((0,$A.default)(l)){var f=(0,DI.default)(l);return Array.isArray(l)?l.map(function(w,C){return[0,1].includes(C)?r(w):w}):m1(m1(m1({},l),f.latitude&&dw({},f.latitude,r(l[f.latitude]))),f.longitude&&dw({},f.longitude,r(l[f.longitude])))}return Array.isArray(l)?l.map(function(w){return(0,$A.default)(w)?r(w):w}):l},zI=kI;Q_.default=zI;Object.defineProperty(J0,"__esModule",{value:!0});J0.default=void 0;var PI=$n,LI=hC(Zf),FI=hC(Q_);function hC(r){return r&&r.__esModule?r:{default:r}}var RI=function(l,f){var w=(0,LI.default)(l,PI.latitudeKeys);if(!(typeof w>"u"||w===null)){var C=l[w];return f===!0?C:(0,FI.default)(C)}},OI=RI;J0.default=OI;var tv={};Object.defineProperty(tv,"__esModule",{value:!0});tv.default=void 0;var UI=$n,NI=dC(Zf),GI=dC(Q_);function dC(r){return r&&r.__esModule?r:{default:r}}var VI=function(l,f){var w=(0,NI.default)(l,UI.longitudeKeys);if(!(typeof w>"u"||w===null)){var C=l[w];return f===!0?C:(0,GI.default)(C)}},jI=VI;tv.default=jI;var nv={};Object.defineProperty(nv,"__esModule",{value:!0});nv.default=void 0;var qI=function(l){return l*Math.PI/180},HI=qI;nv.default=HI;var iv={};Object.defineProperty(iv,"__esModule",{value:!0});iv.default=void 0;var $I=function(l){return l>1?1:l<-1?-1:l},ZI=$I;iv.default=ZI;Object.defineProperty(ab,"__esModule",{value:!0});var hb=ab.default=void 0,WA=rv(J0),KA=rv(tv),_f=rv(nv),WI=rv(iv),KI=$n;function rv(r){return r&&r.__esModule?r:{default:r}}var XI=function(l,f){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;w=typeof w<"u"&&!isNaN(w)?w:1;var C=(0,WA.default)(l),D=(0,KA.default)(l),O=(0,WA.default)(f),s=(0,KA.default)(f),q=Math.acos((0,WI.default)(Math.sin((0,_f.default)(O))*Math.sin((0,_f.default)(C))+Math.cos((0,_f.default)(O))*Math.cos((0,_f.default)(C))*Math.cos((0,_f.default)(D)-(0,_f.default)(s))))*KI.earthRadius;return Math.round(q/w)*w},JI=XI;hb=ab.default=JI;const bn={majestic:{name:"Majestic Bus Stand",loc:[12.977529081680132,77.57247169985196],map:""},silk_institute:{name:"Silk Institute Metro Station",loc:[12.862231132000229,77.53020557184188]},airport:{name:"Airport Bus Stand",loc:[12.978463880366592,77.56932373193757],map:""},hal:{name:"HAL Main Gate",loc:[12.958498117866407,77.66518619680876],map:""},whitefield:{name:"Whitefield TTMC",loc:[12.976874051754933,77.72680679219907]},banashankari:{name:"Banashankari TTMC",loc:[12.917668361661741,77.5729031044554]},kadugodi:{name:"Kadugodi Bus Stop",loc:[12.995682104394492,77.75933511787484]},hsr:{name:"HSR BDA Shopping Complex",loc:[12.912696250372736,77.63815235881127]},ecity:{name:"Electronic City Bus Stop",loc:[12.846820291920075,77.67194606999932]},btm:{name:"BTM Layout Kuvempu Nagar TTMC",loc:[12.916077213466505,77.61613653753079]},chandapura:{name:"Chandapura Circle",loc:[12.802273131607688,77.70456150337426]},sarjapur:{name:"Sarjapur Road Wipro Gate",loc:[12.910761671396754,77.68409625549441]},ecity_wipro:{name:"Electronic City Wipro Gate Depot",loc:[12.836107341675932,77.65779655065786]},mysore_road:{name:"Mysore Road Satellite Bus Stand",loc:[12.953555019494152,77.54382623524201]},royal_meenakshi:{name:"Royal Meenakshi Mall",loc:[12.876412761573464,77.59560880964153]},kengeri:{name:"Kengeri Bus Terminal",loc:[12.913656066139644,77.48714794975331]}},XA={to:[{name:"KIA-4",route:"ka`yMg`bnAiA~A}@JGwCHiCVsA|AmCxBgCzDuGxHmMfCwDjAuBL@zDMpi@qDtLiAfNeBfGk@JSb@{CnBiQ\\_HHeDZyMNgFpDDrBB`UTtRVpYVfGFvCIdFUjF[zDGjAjAf@TrAp@`Al@VVvAfCbD|Er@r@dDlBhFjChCvAxCrAlElA|BTbCLBiBAaBF_@@_AIeC_@{CEy@?]B{FD{BMy@Uo@g@_AUOmBe@o@e@y@uBaBcFaAeAsAoAFML_@rAuJHqCM_P?[LUf@YdABtIz@r@j@d@~@r@_@^_@NSn@]xCyAfBqAfBmAx@m@`BcAv@_@pDgBbJkEvB}@bA[zB_@zBm@hAe@~A}@lDcCpCgB`AYtEKh@ExA_@fEgAfDeAzJoClCg@v@I@Sf@gAx@wAzAgEf@wArCaHt@yBh@cCv@aERk@RSrAcApCsAzHyCtQ{Lh@Gl@sBtC{F|JsQnCwE`BiCzA}BlCiDn@i@zCgAvAYvE]bEG~AF`@?ASGwF@k@Aa@OQH_N@sFGsBmA_Hg@aEAg@e@}CsAaIIm@HSEa@WeBk@yCe@}BiBqFu@mCyAsEqE{LYoAM{Ac@eC_CgIK_ACcAMeG?k@M{@QE_AeJg@wCcAaFy@iCu@qBw@iCc@{CMiB[sDoCsH_A_Ci@iBU{A?_@DY{AgJg@cEB_DTcGDcHKkN?{BEcCL{JNsAJuGBoBB_Fb@cN~@i]FkFCyFwAs^SsGEaBu@wEaEkN_BgEcCsHsCoJo@gDOsAu@oIY_BcBuHuBgHuBkHw@cD}BmMaBcK_@eBSo@Yy@o@{B}@uBmE{IyBuEyEgJuHuNiPe[oGqNcEmKaFyMiI_U_@u@u@w@oDqJcCwGi@{AcCuGgCaH{AyEs@_DKeAA}AFqGNQNkDFeTCyAQiEu@kMg@{CW}@}GePkA{CwB_FeBaEy@yAqC}EgFuIwDiFyGqJ_HgK}HeKwFiIc@u@{AuDsFkO}CoImAgDmByFcAgDe@{Am@sAqCeEwBuCu@UcGoJ_Ww_@uKuP_IwLVMKOsHeL[c@mD_DiA[}CcCcHqF_E{BqCeA{BiA_@i@kA}@}HqE{B_AsNqIuBsB{@uAo@cB{AiIe@cAm@k@{@]aAIoANgAn@oBlCyFzI_CdCsAz@iC|@}B^gDJw|@ZgYQe@K[Uc@Ic@HSTo@PkRJccBZy@_@_@Oa@BWNw@X}YHgAa@i@q@Yy@aAq@oKCg@a@",start:bn.hal,end:bn.airport,stops:[],contact:"",timings:[370,430,460,490,560,640,1020,1050,1140,1160,1210,1330,1380]},{name:"KIA-4A",route:"k_lyM{penAFdBr@CvAIxNs@`Uw@xT{@^JlF[dAi@zEYnRkA~BPb@T{C|LmFvSgBhG{@zCqChIw@jBi@p@aA^qGToEPqCv@cBx@q@p@u@nA]`CJ`Bv@fC`ChFzApCp@|Cl@vFlCjLpBjHn@|CaHj@D^`IGdEWpAKtOm@tc@{AbSq@zFQjEOvADzMrAxGn@~a@hEzLhA~]zAjKR~@IvBq@pG_C`RkHdKaDhDa@~Ic@bJKdBMZK?VzCEbDWRAEs@?cAAwCZoBj@qApE_GpMuT~BuDhAoBL@RAlAGdF[dL_ArRsAvOiAtMgBhJ_A\\gBd@{D`A}H`@uEZwHn@oWf^^bi@j@dJJjHWvMk@fA?NGIO{AgCgBsCaD_EsAmAcAw@l@@tCP~B?xFm@pEg@fD[nCFfHb@bCLxBn@h@gArAuJHqCM_PLq@f@YdABtIz@r@j@d@~@r@_@^_@~@q@`GkD~CyBxBsAhD_BpKgFfCgAxE}@pDwArGgE|BwAhASzEI~Cw@zIkC|IaC`Eo@Nw@rA{BpC_IlCqG~AsGn@{Cf@_ArAcAzBgA|EkBhE{BfL}HvA{@h@Gl@sBvBmEtIuOvHmMhFgHtA_A~C_AdGi@bH?`@?ASGwF?mAOQFyIDoFEgE_@uC}@{Fa@kE_CoN@aAUyAqAwG_D_KcEoLgB_Fg@kDc@eCgA_Ew@gCOcCMqHM{@QEgB}NcAaFy@iCu@qBw@iCc@{CMiBG}@SuBoCsHiBiFU{A?_@DYu@kEmA_JB_DTcG?yOKuNL{J^yMZaPH[VkGt@mZDuG_@_Om@_Oc@qMe@oDcAgEgBgGsCiIeF}OaBmHeAcLy@iEoByHiC{IqAsE{@mE_FcY}AeFcB_EwF_LqKwSaLaTkKoSmKoWuOkb@_@u@u@w@oDqJcCwGi@{AcCuGcF{Ns@_DMcDFqGNQFg@NcUCsCq@sOk@{GUy@{FmNcEcK{CcHkC_F{IoNaI_LyIsMqGqI_JqMyIqUgIcU{BqHm@sAqCeEwBuCu@UcRqY_LuPiCmEaAeC}NwT{IyMaC}B}@c@k@IgAaAeEyCsAaAcCqBkAq@aFuBuLaHiB_AeAg@Ua@e@WmFaDsFcDmBaBqBgDq@oCs@kEu@iBs@k@aAY_AE_ANgAn@qA`BsHhLkAnAyAdAsBx@}Bd@eDRuL@ui@T_a@Le@?_@p@e@~AeCdKeA`Am@Vg@ToC?uKDq[Hi]Lon@NqJHeBG{@QgAq@c@i@{DcIYuAGmBCi@[cBgAcBsAgBeFDiA?AdA",start:bn.whitefield,end:bn.airport,stops:[],contact:"",timings:[330,610,680,760,800,830,870,900,960,1040,1070]},{name:"KIA-5",route:"i~mxMo}ymAaBC?UAWOJ?XKjBEfD?jCFpA\\zE|AnJHxCGzFQnIs@lIFp@O?kD?kIDcN@cZNcAKwODFe@DoAGiI@uJBqEOcFCwF?{IBkA^?`FU`AIzAK?_CDe@Bc@AoHIeMKcI?_C?MO@qEHuEBMwQa@{@e@yDPgBZeAd@c@hG?hDAOsDIeOE}F_@uJ?gBHwDcEAAACCEAQw\\CyIF_AHI?YUM_@qCa@gAcAwAu@k@oC}@s@[cDo@yCKwEMsAeAcDwCoFmBsDuBsAs@[t@{AzDWx@yA~BoCdCc@\\s@qAyJgOzC_DpB{AnEmDpCoC}AsAwAyAjAcAnCcCxDuC|CkCvB_BRIK]IWIc@cC}ImCqIuDwMWm@m@i@{DyCcAaAcBsCm@gBg@{Ag@i@yC{BwAuAiAy@sCcCkFmDeAi@uBkA{C_CoI}EcC}@XcAhAcENWjD{A|F]bCSTk@y@yLC}@~CuCrAAfFEZiAzIwU~@aBVK~D_AdJsBxB_@nD_Ap@[Pa@D]dCs@zOqFbBi@h@i@e@gA{@}CScAFm@FGxAsAxKuIx@}@Vy@d@cFL_Cr@gITw@^u@FgAYy@TcCv@{F|@cHTmBpAeJ]mC?oCDsHOoDf@eWVsOEaKOkPC}JJqNMoGuAkIa@kEu@cEiAkHHWMkA[cBg@aCe@cCqBeGyCiJaCqGmA}DQuBk@oC}BgIUyJCu@Mg@CAWuA}@_IiBaJoCcIu@kFKkAGeAMaA[wAsCwHuAoESsAHO?_@iByKYmDJoDPiFDsIMyOAiIHuDZiJFuHHuCf@{Ov@u[?qDK}HsAq\\UmGUqCcAgEgBgGsCiIeF}OaBmHeAcLy@iEcAkEk@mBiC{IqAsE{@mEkD_SS}A_@eBY{@cAiDcB_EwF_LqKwSaLaTeF}JoEaJsJeVqOcb@iAoAuGiQqAqDaGaPwBgHc@wCDoJTc@PyRIyJ_@eHa@uGg@{CmCeHaFqLoFiMmFiJyFeJ_EyFcIeLuEeHgLsOuCmEuF_OgGwPyD{KgAuDg@qAgAqBcDmEw@kAQCc@QgBmCmMcSyPkW{KyPmE}GVMKOsHeL[c@iCeCmBu@aMuJ{FyCqEqBkBgBwIaFkA_@uM}HoCyBqBgDq@oCeA}Fc@w@s@k@aAYcB?oAf@eBrBqFtImCbDyAdAsBx@}Bd@eDRmd@PaUD_\\Kw@Ia@Wo@Ke@RILw@PwuBf@kAe@u@I]Nm@Xk@ByY?w@c@o@sAc@g@u@]{J@i@a@A?",start:bn.banashankari,end:bn.airport,stops:[],contact:"",timings:[240,300,330,360,420,480,510,540,570,600,630,665,690,720,750,780,825,855,885,915,930,945,960,975,1005,1035,1065,1095,1125,1155,1185,1215,1245,1275,1380]},{name:"KIA-5D",route:"ihexMwsnmASJOW_@y@eBaEcBuCw@yBwA{A_JmFiCiC_D_EkI{LcDaF}TwYiBoBgBsA}Aq@{EcB}DyAmBkByAiDJo@}AqEo@m@Uu@wDiMkCuI{@oAwAy@iO}BoTmEyRiEiOgDaFkBiHkEwFwEyEyE{QmOmLkLkLcOqByCgAkBu@_CgAuEi@cEDuC`@}FCoAQuFHwAn@cJ^iPBcEe@{FqAaIW}GF{DBoAhA@zACBiAEkBMIs@Ia@h@sAp@UpJNtDp@pHlA|H@nBYtPs@lIFp@O?aB?cGBiN@g_@HcQ@JaBGqH@sKMiRAwC@sHNk@fCIjGc@FyNUiWEgSv@yE?}Bc@oCSo@OsDIeOE}F_@}MHwDcEAAAAAECGyCKkd@Nc@_@eBmAoEaA{@gF_BmFy@oFImAQ}@y@cDwCkIaDcCqB]Be@t@e@lAaC}@kN}FoDgDvRwPbJmH\\If@p@XpAn@dBx@b@vAc@}@iEmB_IaCcIgC_KoDeM}Ao@sE{DoC_GNSj@El@KnAm@vC{FvCqD|@m@~Bq@|Hy@|Cb@dFh@jBHvDbApBnBL@f@QP[P{BdA}AbE}DlDsCfIaHlGiFtEkCVKa@m@wBiDeJcNgByCuGmNsFqJyEwLwBsFy@uC]yADs@JMxLqJ|BeCf@cEhAcOr@mBBkBQs@bCmQx@cIt@_EIyAQaDA}DDuDO}Dz@k`@I}YMoMLkWOoEoBgM[{Cq@mDm@}D?aAOyAkA}FeD}KyCeJyDcLaAoGuAyEe@_CQaJSuA_@uBgA{I{AmH{CeJu@{GKsAw@kDcDqIi@iBBu@YeADY{AgJg@cEB_DZgPKkNE_GL{J^yMB_Fb@cN~@i]BeNwAs^SsGEaBu@wEaEkNcF{NsCoJ_A{FoAoLcBuHuBgHmDoM_FqYmAoEmBqFmE{IsI}PuHuNiPe[oGqNcEmKaFyMiI_U_@u@u@w@oDqJcCwGi@{AgJqWs@_DMcDVcHNkDB_WgAuS_AyE}GePcE{J_D{GqC}E_L_QyGqJ_HgK}HeKwFiI_CkFqK{Y{DaLwCwIiG{Iu@UcGoJ_Ww_@iCmE_@eA}KiQuLsQ_CkCgBiAk@IgAaAeEyCsDyC_E}ByEkBwLgHeBy@e@i@aJoFgDqBuBsBkByDa@kBsAqGsAkAaCUcATgAv@qHfLeDvDsAz@iC|@}B^gDJyp@VqMB{XHmCtIk@nCi@hAy@p@iAd@wLB}c@Lku@Rc_@NeCm@kB_CaDeHOkAMyCk@yBo@_@o@AiIPOeA",start:bn.silk_institute,end:bn.airport,stops:[],contact:"",timings:[245,430,555,615,1005,1200,1270,1330]},{name:"KIA-6",route:"qeryMcfinAd@KLf@HX~@tCz@|CPjBXjAjDxEjEdGzBhEbD~KlF~PpAnEd@dClB|PnEt_@tBb[^jEt@xGdFjV~C`OBx@nAhD|E`LzAjEnApAlAh@z@@nDe@tCKrKEfLE`IGnCFl[tCxKd@fLZp\\P~RJvOB|BDrAMxOc@dOe@vQq@ba@oAtK_@jEOvADzMrAtTxBtU~BlJbA|H\\f`@|A`CO|FoBnZkLhFyAvDi@|F[nOWbAW?V`AA~DOpAMnDe@|Cg@tJuAjGi@x@AnGp@`L[vJWjOU`Vw@pWyApP_AbDOdAU`CE~SoAlOcBbDS~@DdGtAv@HbDu@pEiA~FeAlCc@rAg@`HiDv@{ArEeLT[fG_CxDgAzCWrANjDjATFFMj@i@^u@j@{Cf@yGd@oHPgDDqC@WYCm@GUCKAO@FeFQoFYaCBa@IaAL_GAwAcAqCi@[mBg@i@i@aBaFy@wBmCiCX}@rA_KBkEK_NTe@j@SlF`@jDd@TPx@rAfAq@Za@hEwBbEsCdBsAlIeElMaGxE}@lBm@`DgBrHaFhASzEItJgCnGqBrEkA`Eo@Nw@rA{BpC_IlCqG~AsGv@qDf@o@hBoAfCmArDsArBy@tAaAnKkHfAq@`Aa@NAf@eBL_@tDkHzEwIfIqNzEyGpBkBnDiAnD]|DS`DB`A@EuAAyFEOKK@uADiHDgEAkCKcCWoA}@{Fa@kE_CoNHWMkA[cBmAeG}DaMoE_MmA}DQuBk@oCyAcFc@cBKmFMaEMg@CAWuA}@_Ii@wC_AiEmAsDaAoCu@kFSqCMaA[wAsCwHuAoESsAHO?_@_AqFi@gDYmD\\yKEsSCcPHuDZiJFuH\\uL~@e\\J}KK}Hg@{Lw@kSIwBUqCkDoMsCiIeF}OaBmHeAcLy@iEcAkEk@mBiC{IqAsEgFmYs@cEY{@cAiDcB_EqJqRqJyQmPk[oEaJ_GsNmEmLoJmWgAyCiAoAqIiUwGsQwBgHc@wCDoJTc@PyRA{Eg@cMa@uGg@{CmCeHuHwQ{CcHkC_F{IoNaI_LgJcNoHyJ}HiLmMm]mEcMkCiIgAqBcDmEw@kAQCc@QgBmCmMcS}GcKmLsQiGmJmE}GVMKOsHeL[c@iCeCmBu@aMuJ{FyCqEqBkBgBwIaFaD}A_K_GoCyBqBgDmAaGi@kCc@w@s@k@aAYcB?oAf@eBrBqFtI{BrCqCjBsCz@}E`@iw@Ve_@KiASUQi@Go@`@w@PmFBulARga@Js@]g@Oc@FOLaAX{YD_@KaA{@Wu@c@g@u@]{J@i@c@A@",start:bn.kadugodi,end:bn.airport,stops:[],contact:"",timings:[360,420,480,520,540,600,810,890,920,940,1030,1080,1120,1170,1200,1260,1410]},{name:"KIA-6A",route:"qeryMcfinALE%5EbAPA%5CjA%5EbAZ%7C%40d%40~BPrBp%40hAfFdH~DbGx%40vBlAdEzDbMzDtMFNL%3FzA%5DjJsBbM%7BCjKsC~Bq%40fJ%7DAtGaA%7CKcB~O%3FdE%40bEKbIy%40bKw%40~P%7DA%7COwBz%40UdCuAtAg%40dI_B~Bg%40zBg%40~CsAbHkDbCKpE%40bIIv%40Rb%40Z%60C%7CBxEvDpA%60AvFrC%7C%40n%40h%40r%40lClAv%40PlAV~%40d%40fAh%40nAv%40l%40z%40nArChApDNrA%40N%60%40%3FZsAvCiNrBiJlAsFnB%7BIBYZ%3Fx%40CbAIjB%5DxJeBzIaBxEq%40lHeBfEo%40xDQpDc%40jDcAdF_BzA%5DlJ%7DB%7CH_DrBy%40xAgAbBqBjAiA%7C%40o%40~BgAjASzBMfJYpPIVD%60%40L%7C%40CbCEzB%3FvCHzFGxA%5ElAf%40lBl%40lCx%40jG%7CB%60WlJz%40BjBz%40xMdEnBf%40rA%40dAUbAgA~CgGzAwCXo%40Ls%40D%7DBf%40yUXoKtAwN%5EkFR%7BHh%40qRVwHL%7BCXoBVg%40f%40%5DvNyElVcIxJeCvi%40sQ%7Ce%40aPrC%7B%40bAMpKiAvEm%40hHoAvNoEdA%7B%40fBgF%7CKoYtE_LpBcEr%40u%40zBcBzD_CtEcHrBwCdAkApAq%40pBUzB%3FnW%5CxDJvAIzCg%40zEiAbBc%40hB%7B%40xAc%40tLgBrDk%40FA%40RfHkAnEi%40bGg%40xODfUEdCHnARjAj%40vBtAvBzAnBdAd%40LfBRvKCzAKj%40GTSlE_AlCe%40jDg%40n%40FvBScByEQwD_%40aDyAmD_FsMi%40iBU%7BA%3F_%40DKGk%40kAeHa%40oCOcD%5C%7DK%3FwKGaGEiFHkJRiDLgIDuG%60%40gM%7C%40g%5CHsNu%40%7BSu%40%7BRIuBS%7DBScAuAiF%7DAkFmJiYuAmGoAoMwAgH%7DAcF_CcIoA%7BE_CoMkB%7DKYqBOWa%40oAoAyDcD%7DGgIqPkJiQwOiZmEeJgHeQsD%7BJ%7BJeXa%40iAs%40u%40_AwByFmOk%40%7DAkImUkAgEYmCBkCBiEHKHMBSNoUCsCIqDg%40aJk%40%7BGUy%40aAqCyD%7BIyBsFsAaD%7DCeHuCkFyIiNyJkN%7DGaK%7DHiK_GqIkA%7BBwLi%5CmE_McC%7BHgCcE%7BByCg%40m%40UEWM%7BA%7DBsA%7DB%7BKuPsLmQmIsMgF%7DHcDcFVMmE%7DGqBwCmAuAwAsA_Ai%40m%40KgAaAyG%7BEgCsBwC_ByEmBs%40a%40_%40i%40uIiFiBaAeCqA%7BMeImB%7BBsAeDiAuGc%40qAk%40q%40%7D%40c%40cAMkBVgAv%40sJzN%7BBtBoAt%40sCz%40aCZ_u%40%5CqMBeWSiAi%40e%40D%5BVc%40PcGF%7DnB%5EkAk%40w%40Hu%40%5EsZHs%40Ym%40m%40g%40kAiAo%40%7BJ%40YQQO",start:bn.kadugodi,end:bn.airport,stops:[],contact:"",timings:[240,300,660,730,990,1100]},{name:"KIA-7",route:"%7DuzxMa%60ymA%5CA%40%7CAH%3FAaAE%40ImCG%7BDFM%40sCEwCGaD_%40sS%7B%40gEe%40qB_DkIo%40sBlBm%40dCw%40j%40UxAaAnB_AfAWfAGtQzAnMpApIl%40lB%40vAM%60%40MxHaCtRqGfQqFf%5CcJdCq%40d%40Bx%40FFO~B_ErA%7BCnAwA%60DcC~QkMzD%7DBfDgBpAa%40hEiAlAKdNgAxTcBbCo%40%60By%40ZG%7C%40mApB_DpAmDVwCt%40wN%7C%40oHZy%40%60%40_%40nBoA~Ay%40%7BBcEcEcGsBaDjAqAjDsCnAoAvB_B~%40w%40rAoAZ%5BYS%7BCyCfB%7DA%60DoCrFkEbCsB%7C%40e%40Mc%40a%40%7DAaEqNuCwJiBkGS_%40iBqAcDoCeBkCk%40qA_%40gAk%40%7BA_EaDMQwAaAmAiA%7BGkFeE%7BBmAo%40qHmFkDgBcC%7D%40dAqDb%40aBTSlD%7BAlGW%60BOJGNm%40_AoNjDuCvGIV%40%3FQ~BkGvEqMtAiCtCy%40pEeAfCk%40mFsGiGwETo%40jI_KlJuMvAaBt%40w%40h%40p%40tAfBl%40h%40zGzIjGdGrCxCNRZ%5Be%40gAq%40aC%5DyADs%40JMBItLgJ%7CAsA%5Eq%40f%40cEhAcOPu%40%60%40w%40JcAGg%40OYAYbCmQx%40cIt%40_EKaBQ%7B%40%40%7B%40AqAB%7BGI%7BACeF%7C%40y_%40%3FcNOwJIaOJsUGsBO%7D%40%7D%40aFi%40iFyB_NIm%40HSEa%40WeBqAwGiBqFu%40mCcEoLgB_FYoAM%7BAc%40eCgA_Ew%40gCOcCMqHM%7B%40QE_AeJg%40wCcAaFy%40iCu%40qBw%40iCc%40%7BCMiBG%7D%40SuBoCsHiBiFU%7BA%3F_%40DYu%40kEe%40%7BCg%40cEB_DTcGDcHE%7BGKkQHiDRiDRsOXeLx%40aYVsOCsF%5DeJiAyYE_BYiDi%40gCwBmHqBkGgG_RsAgF%5BgBi%40sGe%40%7BDc%40qBs%40uDaA_DsBcHwA_FgAkFeCmNwAeJ%5D%7B%40c%40%7DAgCoGgJcR%7D%5Bcn%40sDgHuFwMuE%7DLsJsWmBgF%7B%40gA_AwB_CmGqCsHgFgNmDsKg%40oCCmEBiEHKHMN_L%40oLCyAc%40wJw%40eKwAkEcHmPm%40_BoCmGkCqF%7BJePkImLgJeNqGqI_JqMsDoJ%7DF%7BOuB%7DFsD%7DKkAsDw%40%7DAmC%7BDoBcCUEWM%7BA%7DBsA%7DBeBmCyLyQaOcU_GcJcBeCcDcFVMmE%7DGqBwCwB_CqAcAiA%5BuHyFkC%7BBkBiAeFwB%7BBiA_%40i%40iKoGoAe%40_PkJuBsB%7B%40uAo%40cBiAsGa%40yAi%40w%40uAq%40_BGoA%5CuAnA%7DHxLeBnB%7DCjBkCr%40qCViUL%7Br%40NsPSc%40Yi%40Mk%40PKLo%40PkRJccBZiAi%40%7D%40Bk%40Zm%40H%7BYBs%40%5Di%40q%40Yy%40g%40c%40i%40SqJBs%40e%40A%40",start:bn.hsr,end:bn.airport,stops:[],contact:"",timings:[365,450,510,620,710,770,950,1035,1100,1210,1295,1360]},{name:"KIA-7A",route:"%7DuzxMa%60ymA%5CAJ%7CAG_AImC%40%7DIMyH_%40sS%7B%40gEe%40qB_DkIo%40sBlBm%40dCw%40j%40UxAaAnB_AfAWfAGtQzANBBSP_CdAuUZ%7BFl%40oC%60%40%7B%40vCuCpIoItSiTcCeBgBy%40iBs%40aDo%40oFEiG%3F_D%40%7BE%3FqAK%7BA%5D_CaAiBqAeAoAoDmG_LcTiDyGcCaFUsAR_BVi%40z%40%7B%40nD_Dn%40yAHiAYuAkAyC%7BDuHiC%7DF%5DsMFiF%40m%40%40a%40%5ECnG%5BlH_%40MmAw%40wJGc%40fBKtBOfGk%40dGw%40bDS~%40DdGtAv%40HbDu%40pEiA~FeAlCc%40rAg%40%60HiDv%40%7BArEeLT%5BfG_CxDgAzCWrANjDjATFFMj%40i%40%5Eu%40j%40%7BCf%40yGd%40oHPgDDqCtBApG%7B%40tRkCdc%40sGjBYRCAUs%40aDU%7D%40eAkDxK_CvXmGTEGWg%40_BeBmHQu%40i%40yBDe%40Z_B%3FOy%40sESUPAlAWTp%40f%40hAZdBEF_AZUT%5C~ArFcAlHyAcAcDhBo%40h%40YdEf%40lBRdC%40p%40%40v%40j%40HdCIpAR%60CPN%7CAx%40xAn%40jLgCdFmAv%40YTWJo%40tS_HxA%5Db%40_%40Z%5B%5Ds%40k%40qBQm%40YoADs%40JMBItLgJ%7CAsA%5Eq%40f%40cEhAcOPu%40%60%40w%40JcAGg%40Qs%40bCmQx%40cIt%40_EKaBOwBAqAB%7BGI%7BACeF%7C%40y_%40%3FcNOwJIaOJsUWqD%7D%40aFi%40iFyB_NIm%40HSEa%40WeBqAwG_D_KcEoLgB_FYoAM%7BAc%40eCgA_Ew%40gCOcCMqHM%7B%40QE_AeJg%40wCcAaFy%40iCu%40qBw%40iCc%40%7BCMiBG%7D%40SuBoCsHiBiFU%7BA%3F_%40DYu%40kEe%40%7BCg%40cEB_DTcGDcHE%7BGKkQHiDRiDRsOXeLx%40aYVsOCsF%5DeJiAyYE_BYiDi%40gCwBmHyJkZsAgF%5BgBi%40sGiAmHs%40uDaA_DsBcHwA_FmEyUwAeJ%5D%7B%40c%40%7DAgCoGgJcR%7D%5Bcn%40sDgHuFwMuE%7DLsJsWmBgF%7B%40gA_AwB_CmGqCsHgFgNmDsKg%40oCCmEBiEHKHMN_L%40oLCyAc%40wJw%40eKwAkEqImSoCmGkCqF%7BJePkImLgJeNqGqI_JqMsDoJ%7DF%7BOuB%7DFsD%7DKkAsDw%40%7DAmC%7BDoBcCUEWM%7BA%7DBsA%7DBeBmCyLyQaOcU_GcJcBeCcDcFVMmE%7DGqBwCwB_CqAcAiA%5BuHyFkC%7BBkBiAeFwB%7BBiA_%40i%40iKoGoAe%40_PkJuBsBkByDiAsGa%40yAi%40w%40uAq%40_BGoA%5CuAnA%7DHxLeBnB%7DCjBkCr%40qCViUL%7Br%40NsPSc%40Yi%40Mk%40P%7B%40%5EkRJccBZiAi%40%7D%40Bk%40Zm%40H%7BYBs%40%5Di%40q%40Yy%40g%40c%40i%40SqJBs%40e%40A%40",start:bn.hsr,end:bn.airport,stops:[],contact:"",timings:[270,330,380,420,480,530,560,590,640,680,740,805,855,915,965,1005,1060,1110,1140,1170,1220,1260,1320,1380]},{name:"KIA-8",route:"efayMoblmAOKd@s@hA_B~BeCdU_[zYma@bc@ql@lZoa@tEuGjFoG|LsNjDeFdEcI`Ra^fUec@|N}Xr[em@`GcLhC{EPm@fSa`@dQw\\h@g@lC{F~BcF{Ce@uIi@wBDaKhBwEv@gCHkHV_HTgPn@wCHqKt@oA?uBUkDaAkAo@kDkCoEwEgNaRsA{AaHgGmA_AaCkAkCi@yF_@wDKgCF}N|AyGp@mGbAcYbHiS`DeAb@iEd@gAAg@c@qAg@k@Yq@EaLkEqX{JoKuDgHsCsJsDiVwIuQmHeEiCoG_F{OgNuTyRcJoJiB{C}FwKqB_EgAcEkGgWaAiGiAqLeA}H{BaOiAuFQoCE{CMuGwAgPy@eJa@yLf@wD~@wClPy[bGiL|HuNnMcWvN{XfK_SjCgFdBiCjBwCpGsJpLuQnCqE`JwPb@c@d@[j@IhEItEDzGEvB`@`GpBbQrG|M`FvAXVAl@\\rBv@vNlEdAH~@EvAs@f@u@dDuGlBcE`Aq`@FqDh@wFpAaQp@uTh@yQLsB\\oA\\_@|Ak@rRmGzQcGbDw@zJ{Ch]eLt_@gMnOaFvOcBzEs@bF}@rCw@hH{BdB{@l@_A|DaLtKoXdFeL|A{AdEeCzAkA`GiJ`BsBx@o@`Bc@xAIdPLdOZbEg@fB[fG{ApCoAzScDHPfHkApJgAxIK`QJfLIdCHnARr@Zj@\\zEbDtCrAfBRxFAxFM`A[lE_AtGgAr@E~ADv@Qq@eBq@sBMsCQeCg@qBsA{CyF}OU{A?_@DY{AgJg@cEB_DTcGDcHKiPE}H\\sITmSf@cO~@y^AwJmB_h@YiDi@gCwBmHqBkGgG_RsAgF[gBi@sGiAmHs@uDaA_DsBcHwA_FgAkF}EsYaAyCgCoGiFeK_JkQoZ}k@mKoWwFiOgHwR{@gA_AwB_CmGqCsH]}@iEiLmDsKg@oCCmELuEHMN_LAiOc@wJw@eKwAkEcHmP}DmJkCqFsCwEgFmIsDgFqHkKkGqJkIyKgFwHsDoJsIuU_AgC}D_MyAkDmC{DoBcCUEsBkCyDkGqWo`@iLqQcBeCcDcFVMmE}GqBwCmAuAwC}Bm@KgAaAyG{EgCsBwC_ByEmBsAkAuIiFyCuAqPcKmB{BsAeDiAuGc@qAk@q@}@c@}AMqAVgAv@uB~C}FzI{BtB}CxAgEr@ig@Vg[HeWSs@a@i@Go@`@w@PmFBulARga@J{@c@q@GYJq@\\sZHiAi@a@s@]u@i@a@_@MkFBwCCc@_@",start:bn.ecity,end:bn.airport,stops:[],contact:"",timings:[5,30,60,90,210,440,480,520,560,570,600,620,650,670,680,700,710,740,750,780,800,860,920,980,1110,1040,1180,1200,1210,1220,1240,1260,1280,1300,1320,1330,1340,1360,1380,1420,1430]},{name:"KIA-8C",route:"_tgyM}lcmATKlC_@zEeApAe@nC}AxAoAbA_Bxk@_w@pRkWpG_Jr\\m^rFiIrE_LdBkHfAkFdCuLhBiHlFwR~@cCvBmDrUe\\|L_Q~A_CzBkCbBuBbQ{UdMkQfLwOh]ae@bPsTxOeTpKyNfNcPtDaF|DeHzJkRh]gp@pl@{hAvKqSPm@lKaSfVme@`CqDlC{F~BcF{Ce@uIi@wBDyQ`D{d@`ByLj@yFXwAKyDaAkAi@iDgCcE_EaCeD}IsLwCgDcI_HgCsAoFcA}HWwAAiGd@uN~AuFp@iQjEkJvBgKzAcC`@_Dl@YTyDj@iA@c@A]YSUcBk@q@MaX{JmWaJuKkEgWiJoPqGiL}EaHiF}P{NkE{DcOuMyJ_K}DcHqGyLwA}EiEcQyBoKm@kGeB}NyBaOs@sDk@eESqLgC}Ye@cHM_GXcC`AqDjHqNzJuRjHgNfG}K`D_H`HsM|EsJhV{d@zPsWjLkQrHkNxBsDp@a@nDOvJHfEKt@JzCfAfGnBtYxKfDbAz@LdBv@~InChFtApAAjAc@xBgDdEsIRcA^oQb@uQfBiSr@wQf@sSX_I`@mB\\g@vGwBhZwJlHyBzF_BzVoIjO_FpRqG~N_FvDsAxBi@dEa@lHw@hDe@~JoBzGuBxCgAt@{@dBmF~G{PlDmJfFoLbAcBn@k@bDwBdC_BtAoB|F{I`A}@|Ao@lBMzC@zYf@jDQrK{BhDwAfBa@jOyBbAS@RdCc@pHeAbD_@zGUdLFnVExBNfAZ|@d@pCjBpChBnAd@rBRrLCbBQbD_ApFaApC_@dAFhAOLCg@gAy@kCEi@SaE_@aCkEwKaCuGk@aDJWe@aDyAuJEuBZkH@yOMwOL{J^yMZaPj@uRf@aVWuNoAg[MeFu@wEqB_HoAkEcF{NsCoJ_A{FoAoLcBuHkFsQw@cD}BmMaBcKs@uCYy@mBqFgIqPyZkl@_EwHoGqNcGwOkOea@u@w@oDqJcCwGmDqJcF{Ns@_DMcDFqGNQNkDFeTUcHu@kMg@{CW}@}GePkA{CwG{NyJsPoTg[wRkX_CkFsFkOkEqLiDaKmAaEm@sAqCeEwBuCu@UcRqYub@cp@VMKOsHeLeDiDmBu@mG{EsDyCoBkA}I_EkBgBwIaFaD}A_K_GoCyBqBgDwBmKc@w@s@k@aAYcB?oAf@eBrBqFtI{BrCqCjBsCz@}E`@uL@si@Te_@KiASUQi@G_@NOPw@PmFBulARga@J{Am@s@TaAX{YD_@KaA{@Wu@c@g@u@]{J@i@c@A@",start:bn.chandapura,end:bn.airport,stops:[],contact:"",timings:[300,360,460,510,990,1050,1130,1230]},{name:"KIA-8D",route:"stcyMk|xmAjArC\\fAFPKB_B`@HRK[~Aa@hE{AlN_GrGkCvGgBlEu@dBg@jH{DbAaA~@uAf@wBB?DC@C`Ae@`GgCnDyAjCq@vHgBpH}C~D}AdCm@b@ICu@]YSUcBk@q@MmHoCyZ_LkMoEgHsCsJsDiVwIuQmHuBiAoA_AoG_F{OgNuTyRcJoJiB{C}FwKqB_EgAcEkGgWaAiGiAqLeA}H{BaOiAuFQoCE{CMuGwAgPy@eJa@yLf@wD~@wClPy[bGiL|HuNxDyHtGiMvN{XfK_SjCgFdBiCjBwCpGsJpLuQnCqE`JwPb@c@d@[j@IhEItED|@B|EIvB`@`GpBbQrG|M`FvAXVAl@\\rBv@vNlEdAH~@En@Qf@a@f@u@dDuGrAgCX{@RyIRsJXcJFqDh@wFbAkLLuCRgH\\mKh@yQLsB\\oA\\_@|Ak@xDkAxLaEzQcGbDw@zJ{Ch]eLt_@gMtFkBxGuBvOcBzEs@bF}@rCw@hH{BdB{@l@_A|DaLtKoXdFeL|A{ApA}@rBgAzAkA`GiJ`BsBx@o@`Bc@xAIdPLdOZvAIjB]fB[fG{ApCoAzScDFA@RfHkApJgAxIK`QJfLIdCHnARr@Zj@\\zEbDnBdAd@LfBRxFAxFMj@GTSlE_AtGgAr@E^F~@Av@Qq@eBq@sBMsCQeCg@qBsA{CoCsHiBiFU{A?_@DY{AgJg@cEB_DTcGDcHKiPE}HHiDRiDRsO@yBf@cO~@y^AwJmB_h@YiDi@gCwBmHqBkGgG_RsAgF[gBi@sGe@{Dc@qBs@uDaA_DsBcHwA_FgAkF}EsY]{@c@}AgCoGiFeK_JkQoZ}k@uFwMwCwHwFiOgHwR{@gA_AwB_CmGqCsH]}@iEiLmDsKg@oCCmEBiEHKHMN_LAiOc@wJw@eKwAkEcHmP}DmJkCqFsCwEgFmIsDgFqHkKkGqJkIyKgFwHsDoJsIuU_AgC}D_MyAkDmC{DoBcCUEWM{A}BsA}BeBmCyLyQwIuMiLqQcBeCcDcFVMmE}GqBwCmAuAwAsA_Ai@m@KgAaAyG{EgCsBwC_ByEmBs@a@_@i@uIiFmAu@kA_@aJoFoEsCmB{BsAeDiAuGc@qAk@q@}@c@}AMqAVgAv@uB~C}FzI{BtB}CxAgEr@ig@Vg[HeWSs@a@i@Go@`@w@PmFBulARga@J{@c@q@GYJq@\\sZHiAi@a@s@]u@i@a@_@MkFBwCCc@_@",start:bn.sarjapur,end:bn.airport,stops:[],contact:"",timings:[540,640,960,1060,1380]},{name:"KIA-8E",route:"il~xMmajmAaAB`@bA`@Oa@Na@cAo@_B}AcDcC_GMe@y@]{@m@o@iCiBiJMkBJ_Cb@_KGc@SCk@KgDs@cFCmSDiESaGmAwFuBqGyCKa@x@{A|L}P|P{U~D{FfHaKfFgH^_AhHsJpPcUpV}\\jJiMhUuXnEuGrNuX`Yki@vVoe@hx@{{AbAeB`FsJrS{`@@w@u@MmHc@sGFqNhCoXhAmTv@qKt@eEUwFqBkDkCoEwE{A{ByMeQeJ}HiEwB_HcBkDJYTkABqDT{Q|BuFp@iQjEkJvBgKzAqIzA}Dh@cBUyEsAoYuKeRoGeJqDwHyCuUoIwPwGmIyD_LwImRuPyNmMyJ_K}DcHqGyLwA}EiEcQyBoKm@kGyCgVcDoRSgLoBmV_A_MKqGx@yE`AeCvOwZ`Q_\\nMcW`NwWrJaRdE_IpDqFjGmJ~LmRpKiR~BaEp@e@pJSvCHzFGtGtBxKvD`WlJz@BjBz@vLvDbCr@jADfAMlAaA|CcG|BqETaCh@qVXgLnBmTl@cRd@uQf@cJ|@sAhc@sNtGmBzF_BzVoIjO_FpRqG~N_FvDsA~HkAlHw@tDo@pIiBfI_Cf@Um@{@Y_@w@cA{BeCwLoNqIiHkG}G{D_HiBkBsBoASe@_@gEKsLY}Ca@wAuAaG}@oBuDqE}BiE{@qD]sCa@iAeAiAyAeCKkBOiF]uFmBcLgBwGiBwDoBqCmAiAq@mBWsBO}Kk@qIq@wAgEoHwBk@mCc@o@k@G{HbAcb@AsPKmCa@aBoE}H}CuCg@w@SqBdBmNGsA}AyFcAeEYqC{@}Iu@}DOcBH{@`@{Cf@mDCkBKoCW{A[aDf@y@r@e@NmAi@}Nw@qCuB{CgDkDeAaC{CgHoDmG_DeEwBsGgFoK{@o@qKz@uIXs@_AcA{CwKyf@aF{UUaEXaDd@}EVqLU_IVgBv@sCXwD\\{A|AgB|AuEJuEh@cIc@aDm@aE`@kEuBkDk@a@y@Ms@[u@_Hg@qAyCiCeEsImDyNsAeDuGkHQ]aAqJcBqHsC{GeEaIoGqKwAeBePeMsD{DqNeU{KmSeNsZgBqBmFaHcDwL}@{D_AiCc@mBkE_Pi@uH}@mHw@kAs@sC}@yCcG_IgCwCu@q@XOLCbDg@hJq@rEVfLXh@DdEdAnXh@vI\\vBI`FHZ@xFAp@OBo@y@aNaA{FuAeUo@iIA{JNmA`DkMl@sBRw@[i@{@AuAl@kvBTeBi@_Bt@i[EqAeBg@q@aCmAeAsA{GABfB",start:bn.ecity_wipro,end:bn.airport,stops:[],contact:"",timings:[270,325,380,410,940,1070,1110,1150]},{name:"KIA-9",route:"wvmxMutenAB\\~C?@hCEh@If@GlABh@V|Af@hBZCCQ_@cA]eAMy@Ao@R{AR_C@o@?mAKcEUmEGa@@GCUKGq@M_DOeFi@_Fg@}@[[Wg@w@{@uBYe@[c@}BuB[MwAiA}AiA{@W{Bg@iAKcAC}Id@gA@[C_@Ks@_@uAu@Fs@Pi@lBsBpA{@IW~A_Et@_CgAoBS]yAsCkDqHeBeDcC{DeBqCw@iA{@cAe@c@UMI?oACGOCEEQTyB^oCVkBr@oEHsAJkA`@uDHIHa@d@uC?OIcASiA@}AA}DDuDKs@CmB?[?{ALuCH_Fb@yQFeJQwNMoMFyNDqGG{CEi@Ki@e@{Cc@eC[uCEu@[iBoAiHS{AHWUeBoAoGQ_AcAwCkAsDm@uBi@cBeAsCeCuGg@oBK}@MuAc@qBo@_C_A{CMk@E_AEmDImB?o@IaAKKI?MuA]aD_@}CUqAo@iDc@eBa@qA_AiCm@gBe@gCW_DGs@QcBCc@Ws@oAcDaCuGWmASsAJWAWc@iCu@mEc@gDEgA?m@ZkH@mBDeHEeCGgF?mBE{B?aEHiDBuANsALgIDuGTuH`@uMf@cRHoE?cHOkFqAk\\I_CIuB@SUiBScAUcA_AeD}AkFY_Aq@gBm@_By@qC_DmJYaAy@eD[gBi@sGe@{DwAgH}EgPo@{B_@_Bg@kCwAcIm@iD}@sFYqBOWa@oAOq@_AgCgAgC{AuCsDwHsCyFeGcLmMmVoDaHqCsF{@qByDeJmB_FgAwC{FqOmGaQs@u@OOo@gB_CmGyB_Gk@}AaBkEqBqFwBoGu@cCUcAQkAGaABkCBiEHKHMBSFoCB{FBcICsCIqDg@aJUmDUmBUy@aAqCyD{IyBsFsAaD}CeHgAuBmAuBsCuE}BwD[a@k@y@gCmDiAeBgDwE_AmAaCuD{A}BeBaCwEgG_GqIc@s@g@gAuFeO{F{OeB}EaA}CoAiE_@}@m@kAyAwB{ByC_@k@GAUEWM{A}BsA}B{KuPsLmQoCkEeLeQcDcFVMmE}GqBwC[c@{A{AqAcA[Om@K}CcCwCuBkC{B_E{BqCeA{BiA_@i@kA}@}HqE{B_AsNqImAeAg@m@{@uAo@cBa@kBy@}Ee@cAm@k@{@]aAI]@q@L]Ni@^k@n@cA|AyFzIaAlA}@v@sAz@o@XyAb@}B^gDJgRHoi@PkHA{OOe@K[Uc@Ic@HSTo@PkRJaaALaa@Le@Qs@]a@BWNw@X}YHa@Ie@Wi@q@Yy@g@c@YMOEoA?oH@g@c@?@",start:bn.majestic,end:bn.airport,stops:[],contact:"",timings:[5,25,50,80,100,120,260,280,305,320,340,360,375,390,405,425,445,465,480,495,510,525,540,555,570,585,600,620,640,660,680,705,720,740,760,780,795,810,820,830,840,855,870,885,900,915,930,945,955,965,975,990,1005,1020,1035,1050,1065,1080,1090,1100,1115,1110,1140,1155,1170,1185,1200,1215,1230,1245,1260,1275,1290,1305,1320,1340,1360,1380,1400,1440]},{name:"KIA-10",route:"ufhxM}w`nArAeG~Bf@tAl@dEjDzEpClD`CdA`@bCf@`An@n@WTaAdCaL`@_Ab@QnB{AlEoEj@qAz@uF|AuFz@_CdBiFNm@FoAKoAiBcGsEkNyAeEiCaHuBiGqBwHqCwKMa@a@cAg@s@yAuAaA_@cCe@gJmAoJgA}D[{GAyEAeDE_AWo@m@kAeBs@gA[}@OkAG{@AmOCwIC_NAiFSaCw@uEqA{Fs@gD_CuKg@qCOsBCiABMG}@GgE?{B`CwQjAgIbBwO\\{C\\iDz@eJJiBVaDNcBBsA[{GMoA_@aBaAcCK[iAoAkAqAiAkAoBy@kMeF[Wa@m@]o@QQKi@CcALuCFeAPuAOEMMMYE_@F}Bd@gETaATCa@vBI|@InBEz@Yl@[\\k@\\]FuA@w@Mw@[eBiAs@{@e@aABM?CQi@yByEaAuBq@S]A_@HmCrAw@f@OVeAj@sKdFcEhBgHrDcAl@O?ODqD`BgAb@]B}JSqTm@}FSiKWyDGmHAiSN{NVqCFYKy@o@AyFEOKK@uADiHDgEAkCKcCWoA}@{Fa@kEu@cEiAkHHWGi@UyAk@yCe@}BiBqFu@mCyAsEqE{LYoAM{Ac@eC_CgIK_ACcAMeG?k@M{@QE_AeJg@wCcAaFy@iCu@qBw@iCc@{CMiB[sDoCsH_A_Ci@iBU{A?_@DY{AgJg@cEB_DTcGDcHKiPE{B?aEHiDRiDRsO@yBf@cO~@y^AwJ{A{_@QcGEk@S}Bi@gCwBmHe@cBkAgDgG_RsAgF[gBi@sGe@{Dc@qBs@uDaA_DsBcHwA_FgAkFeCmNwAeJ]{@c@}A_AgCgAgCiFeK}B}EaFmJaJ_QmO}YuFwMwCwHwFiOgHwR{@gAOOo@gB_CmGqCsH]}@iEiLwBoGu@cCg@oCGaABkCBiEHKHMBSJkK@oLCyAc@wJKiBk@{GwAkEcHmP}DmJkCqFsCwEgFmIsDgFqHkKkGqJkIyKgFwHsDoJsIuUyD}KcAiDa@mAw@}AmC{DgAuAg@m@UEWM{A}BsA}BeBmCyLyQwIuMiLqQcBeCcDcFVMmE}GqBwCmAuAwAsA_Ai@m@KgAaAyG{EgCsBwC_ByEmBs@a@_@i@kA}@iGkDiBaAo@SuA}@{MeImB{Bw@_B[eAiAuGc@qAk@q@}@c@cAM}@Dm@PgAv@eDbFmEvG{BtBoAt@sCz@aCZqOF_s@XeWSc@Ue@Se@D[Vc@PcGFulARga@Jq@[YOw@Hu@^sZHs@Ym@m@g@kAiAo@{J@YQQO",start:bn.mysore_road,end:bn.airport,stops:[],contact:"",timings:[240,300,330,360,390,420,480,510,540,570,600,630,660,690,750,780,810,855,885,915,945,975,1005,1035,1065,1095,1125,1155,1185,1215,1245,1275,1320,1380]},{name:"KIA-12",route:"okvxMwrymAGoAVApCO~GWrZOzt@_@b@AlBA@N@f@AXCbBEdCCzAJd@LjMOjF_@vHWvFk@tC[l@aD|Ds@dA]jAJNVk@bAgBrA}AnBeCX@c@CRy@L_ABc@Zk@h@aMZ}FFuBB}@SCDcABw@AyDN_HEsCGa@tEC~GGtAA`EGfOAdROpCE?Y?wAIyEGsKDeAAqHCqLEoN?AfBaBp@SjDKx@Yp@y@Ru@^QxFShG?hDAOsDIeOE}F_@uJ?gBHwDcEAAACCEAQw\\CyIF_AHI?YUM_@qCa@gAcAwAu@k@oC}@s@[cDo@yCKwEMsAeAcDwCoFmBsDuBsAs@[t@{AzDWx@yA~BoCdCc@\\s@qAyJgOzC_DpB{AnEmDpCoC}AsAwAyAjAcAnCcCxDuC|CkCvB_BRIK]IWIc@cC}IcCoIgCqJaA}C@WUOcBu@aEqDgB}Ck@kBn@C~@Eh@Qp@m@`BmCt@oBhA_BlAgAx@i@hCq@hEk@hBIvCb@vAXlCNjBHvDbApBnBL@f@QP[P{BdA}AvAeBjBwAlDsCfIaHhGgFdCcBjBu@aBkCsBkDwGoJuBeDcGoMgEqHqByDsAwDoDkJwAiE[mA@}@LMnI{GzEgEd@kCr@}Jp@_Gb@y@HkBUo@`CeQv@uIRk@d@eDIcASiA@}AA}DDuDO}Dz@k`@FeJQwNMoMLkWG{CQsAeBwLa@_DoAiHS{AHWUeBoAoGaDkK}CmJeCuGs@mDMuAsAqF_A{CSkBO{G?]S@KaB_AeJkByJoB{Fw@iCc@{CMiB[sDyF}OU{A?_@DY{AgJg@cEB_DTcGDcHKiPE}H\\sITmSf@cO~@y^AwJmB_h@YiDi@gCwBmHqBkGgG_RsAgF[gBi@sGiAmHs@uDaA_DsBcHwA_FgAkF}EsYaAyCgCoGiFeK_JkQoZ}k@mKoWwFiOgHwR{@gA_AwB_CmGqCsH]}@iEiLmDsKg@oCCmELuEHMN_LAiOc@wJw@eKwAkEcHmP}DmJkCqFsCwEgFmIsDgFqHkKkGqJkIyKgFwHsDoJsIuU_AgC}D_MyAkDmC{DoBcCUEsBkCyDkGqWo`@iLqQcBeCcDcFVMmE}GqBwCmAuAwC}Bm@KgAaAyG{EgCsBwC_ByEmBsAkAuIiFiBaAeCqA{MeImB{BsAeDiAuGc@qAk@q@}@c@cAMkBVgAv@eDbFmEvG{BtBoAt@sCz@aCZqOF_s@XeWSc@Ue@Se@D_Ah@ytAZga@Jq@[YOw@Hu@^sZHs@Ym@m@g@kAiAo@{J@YQQO",start:bn.btm,end:bn.airport,stops:[],contact:"",timings:[340,400,460,590,650,710,925,985,1045,1175,1235,1315]},{name:"KIA-14",route:"}jrxMk|qmADObBIi@gFi@iEg@yEs@sCMmD@[RHWm@M{ASwBs@wHoAmPYeA_@mCiAaEyCkJkA{Dk@oD{AcLAmAUiAm@qC]g@eBaIqAuF{@sIc@wG{A_Jm@}CAmAf@oAbFyGd@iBLcATk@j@iMSAB]HoAX{IHaBCoDOcA@gHU}Oi@wUk@}WIsJ@i@S{@GuDFiBMcCCu@Pu@I_De@sDyAgKCqBSq@q@oEk@qCu@qF{AaRm@gF?aF\\wCXgEjC{@xDcA~@QTn@dGaBfBg@vAcAhEuBtB{CdD}GlAqC~IqIjBqAzBy@|EkA}BcIgAeEuDqMiEePu@sB@Y?Qq@SgAg@aEqDgB}Ck@kBn@Ch@CVCnAm@n@mAjAqBZ{@z@sAzBwBdBs@fCe@rEe@x@@`HfAbDJvBd@hA^x@`Av@l@b@CXWHOP{B|CcErTqQrFqEhAu@jBu@eDmFqBgDgFeHgByC_GgMgEqHqByDsAwDoDkJiAeDi@qB@}@LM@QYYE_A^}Kf@cKC{BWeCo@kCu@wCqAmDUiAHUd@iAhIuDtE}CpA_@vHi@|DD~AFpAMb@O`CcC@?D@B?HEFSQIIBABA@}CeCiCQo@_@Qc@KqAOwBAqAB{GI{ACeF|@y_@?cNOwJIaOJsUWmDeBwLa@_DoAiHS{AHWOuAkA}Fu@}CoB_GyCeJiB_FmA}DQuBk@oC}BgIUyJQ}ACAWuA?{@aA_Ia@wBoAyF]{@NGa@aBWq@SaE_@aCmImTk@aDJWe@aDyAuJEuBZkH@yOMqMHkJRiDLgIDuGTuH`@uMp@iX?qDK}HsAq\\KuCAu@Fc@Lc@@m@eBoHOqAEkCm@ePg@eRe@{PQcJ_@@IGcKwNiHsLmFeK{DeIs@q@cAiDcB_EqJqRqJyQmPk[eDqGuFwMaEsKeGcPeGaPu@w@oDqJcCwGmDqJcF{Ns@_DMcDFqGNQNkDFeTUcHu@kMg@{CW}@}GePkA{CiFuLiHaMwKgPiJ{MiC{DgLsOuCmEuF_OgGuP_AgC}D_MyAkDmC{DoBcCUEsBkCyDkGqWo`@gBqC@Q_@}@_FeI}DcGcI{LiE{FsBeBgAU}CcCcHqF_E}ByEkBwLgHuOkIwIeFaMyGuW{NwCsByK_LUPD\\LX~F|GdEdDbOvIh@x@VrAE`A_@dAqB`C}AnAeE|AyF\\sKR{g@T{P@mPQs@a@i@Go@`@w@Pmc@Jem@Bwc@Do@WSK}@Bk@^m@NsZBKYw@{@[u@aAo@yAw@eAyAyG@@hB",start:bn.royal_meenakshi,end:bn.airport,stops:[],contact:"",timings:[240,280,330,390,420,450,510,540,580,615,660,690,735,780,930,1050,1090,1120,1185,1240,1270,1310,1340,1410]},{name:"KIA-15",route:"k_lyM{penA}@BEuBMyGKkGq@mDe@oEk@qAsAyC}@iBy@uAsAaBsCwC}@i@uFsCWOFOH[Bq@B{E?QUDwBP_Gf@}Gd@sDLcDDaAAWYGE]?}E?IDWV{@AyEDeC\\wXnEqGvA}QbFwJ`CmARwCr@[FUw@e@eBGOa@sBu@aCkDgLqBcGwAcDiDgFwGaJ_@cDsByHa@qDQaCPyBbBwOvBePj@}EN}A@kB[gD_@kAuBeEqLmWuF}Lu@gCeAyE_AyIEoA\\G?i@QKO?CgA?wBNyLdAkRXaDnA{GjAgDrAyC`DiHxAeDjAgD^iDDgCOoB_AwH{CoS_B{Km@oEIcBJkHR{FGiGEoDSkGy@sHuEuUCe@@I@Sf@ThAh@fHbDpPbIxNrIrTrNtBrAFYlAcDrAaDd@q@bDsHlOo\\tBwEdJuRnI_QlEgDbC{BpCuD`FkHhAwCb@mB`@cCXeE`@qOXqJXqKf@sMJgDYsEiA_DmBoEmBoEgBiEQcAWwDUyCkBwH}@iG}BiHcDoLc@iBiAyDeAwBcAoCm@uCSoAM{B?cCIsBw@_Eo@cHc@_Fc@uFi@sM_@gGgBiPWuDAwF_@eXO_USeM@oBn@{A`C_GxA}Ej@yCVcDK_BwAuJkAmHo@cD{@kCcAoESoBQq@y@AkBRc@EOWYsA}@cH]iAQWWqBOqDRe@\\IzIgBdF}@h@Ix@o@`AgApBwA`DaBjCkA|DyAxGgBjCi@rCc@lCq@`I}BpH_BrUsEtD{@f@a@Pg@GcECaETs@hBcDVw@LgJ?sJGcFAm@XaAHWX{@~@aB|EgGnEqFpFuGn@_BZ_BF}CZwA@q@_@_I@u@hC_F~@sBlAoE~DsIbD}HrAiHt@wAxAkA~@mAv@aB~@cC`CqIb@cAPKt@kAxFaJXq@ASNuCdAqGn@eDxAgEx@_CxA`@|C|@dCn@~@DTK\\q@h@[pBa@hBORMDWBIjASdEo@~CYrFm@xA}A`AaAbCmArAq@xA_ARi@?mAbHIpE[~BEpAG`F}@dImAbCYp@]|Bq@x@LR^bApBn@dBd@r@f@SbDg@tDe@rDKrEVfFV~D@X@NBrA^pBd@bBFzLNfRn@pGMbBNdCGvB@v@GJSeAaMcB{Ks@_Mi@iNMaKNmAnA}EpAmFZ}APURw@Oa@a@Os@NOPw@Pmc@Jem@Bwc@Do@Wu@QgAh@m@NsZBKYw@{@[u@aAo@yAw@eAyAyG@@hB",start:bn.whitefield,end:bn.airport,stops:[],contact:"",timings:[255,315,375,495,555,615,675,810,870,930,990,1050,1110,1170,1230]},{name:"KIA-17",route:"}e}wM{eymAw@VFRJZx@CdCq@b@AdC|B~@fAbCxJf@p@bBp@nFK~BDjDfAjE|@f@\\lFlAb@SFa@Y_@oGsBQi@Cm@BUDg@YaAk@qBiBuGkDiMiBkG}EwQoE}PkAmFOg@e@{BmCwJaDaMgEwRq@aCm@k@g@MqKlBc@Cy@eAoAiBq@cBy@iCgAmBi@}EUgB_A}Mu@iHaCmIqAsDaD_HmCmEwE_JaB_JeByCyEwCaCcBYeBi@_CwAwCmA_C_FsGaDuFiBeFsGqToAkI[sBCsB`@oCHmFUcCy@sCeFsOw@wCsAeCcGiKuBcEiA_D{AqFcBwJwAoJm@iDGeFGcENq@Ru@PoAF{CU{Ay@{Aq@mAaAwB_A}CcA}DaGh@oD?}E_AgBc@kAEoBTgJbCqA`@qFmUk@qAg@yBs@wCiAoDcNa_@oKoYsAcEa@wBKiBAmD@{FQ_Hq@mDuA}C{EiFkB_C}CgFqBmEgAqDuBoJmAmGu@aGk@cGmAgGuA{DsFaLmNyYiAcCO[OHoBn@aA`@iItD_@J[w@sBuRiCeS}A{MWy@{LkKcBgA}DmAuI_CyNiDuK_CmIkBcDm@{@MSSo@EmHf@e@ESa@`@eCr@gBBADEBMIM[@q@`Cm@lB{@jA[Zq@JkLJkFKqAQaE{B_@C{L}H_DoAmAU}Kq@sLo@mNa@?McEGsACsCI}DI}DSwH[{BT_@LFNsA\\[Pg@XkJ|GqCvB{GtD_FpCyBp@kOhBqADeC_@qDy@c@QKQ@?HZS@i@NgAVNv@@Nq@FEWr@E~ADv@Qq@eBq@sBMsCQeCg@qBcFoMiBiFU{A?_@DYu@kEmA_JB_DTcG?_QKkQ\\sIRsOXeLx@aYVsOa@yQiAyYE_BYiDaDuLyJkZsAgFeA{JiAmHuBuIkEcOmEyUwAeJ]{@c@}AgCoGgJcR}[cn@sDgHuFwMuE}LsJsWmBgF{@gA_EeKqCsHgFgNmDsKg@oCCmELuEHMN_L@oLg@qMw@eKwAkEqImSoCmGkCqF{JePkImLgJeNqGqI_JqMgPic@sD}KkAsDeEyGoBcCUEsBkCyDkGyLyQaOcU_GcJcBeCcDcFVMmE}GqBwCmAuAwC}Bm@KgAaAyG{EgCsBwC_ByEmBsAkAuIiFyCuAqPcKmB{BsAeDiAuGc@qAk@q@}@c@}AMqAVgAv@uB~C}FzI{BtB}CxAgEr@ig@Vg[HeWSiAi@}@V}@Zmc@JiqAZaA[MKq@GkAh@sZHiAi@_AiBi@a@_@MkFBwCCc@_@",start:bn.kengeri,end:bn.airport,stops:[],contact:"",timings:[430,600,690,725,1065,1200,1270,1320]}],from:[{name:"KIA-15A",start:bn.airport,end:bn.whitefield,stops:[],contact:"",timings:[]}]},YI=({selected:r})=>zo.createElement("svg",{width:"10",height:"12",viewBox:"0 0 10 12",className:"route-item-icon"},zo.createElement("path",{fill:r?"#ffffff":"#000000",d:"M72.75,32h-7.5A1.268,1.268,0,0,0,64,33.286v8.571a1.3,1.3,0,0,0,.417.957V43.3a.687.687,0,0,0,.677.7h.729a.687.687,0,0,0,.677-.7v-.161h5V43.3a.687.687,0,0,0,.677.7h.729a.687.687,0,0,0,.677-.7v-.489A1.3,1.3,0,0,0,74,41.857V33.286A1.268,1.268,0,0,0,72.75,32Zm-6.576,9.852a.829.829,0,0,1-.842-.482.875.875,0,0,1,.162-.977.816.816,0,0,1,.949-.167.862.862,0,0,1,.468.866A.846.846,0,0,1,66.174,41.852Zm2.305-3H65.25a.423.423,0,0,1-.417-.429V35a.423.423,0,0,1,.417-.429h3.229a.106.106,0,0,1,.1.107V38.75A.106.106,0,0,1,68.479,38.857ZM69,33.714H65.262a.43.43,0,0,1-.428-.407.436.436,0,0,1,.114-.317.411.411,0,0,1,.3-.133h7.488a.43.43,0,0,1,.428.407.436.436,0,0,1-.114.317.411.411,0,0,1-.3.133Zm.521.857H72.75a.423.423,0,0,1,.417.429v3.429a.423.423,0,0,1-.417.429H69.521a.106.106,0,0,1-.1-.107V34.679A.106.106,0,0,1,69.521,34.571Zm1.567,6.522a.862.862,0,0,1,.468-.866.816.816,0,0,1,.949.167.875.875,0,0,1,.162.977.829.829,0,0,1-.842.482A.846.846,0,0,1,71.088,41.093Z",transform:"translate(-64 -32)"})),JA=r=>r<10?`0${r}`:r,QI=({msm:r,currentTime:l})=>{const f=Math.floor(r/60),w=r-f*60;return zo.createElement("div",{className:`route-item-time ${r<l?"disabled":""}`},JA(f),":",JA(w))},eM=({busDetails:r,selectedBus:l,setSelectedBus:f,toAirport:w,currentTime:C})=>{const{name:D,start:O,end:s,timings:q}=r,be=D===l;return zo.createElement("div",{className:`route-item ${be?"selected":""}`},zo.createElement("div",{className:"route-item-header",onClick:()=>f(be?null:D)},zo.createElement(YI,{selected:be}),zo.createElement("div",{className:"route-item-bus-name"},D),zo.createElement("div",{className:"route-item-bus-route"},zo.createElement("span",{className:"text-light"},"from")," ",w?O.name:bn.airport.name,zo.createElement("br",null),zo.createElement("span",{className:"text-light"},"to")," ",w?bn.airport.name:s.name)),zo.createElement("div",{className:"route-item-details"},zo.createElement("h3",{className:"mb-2"},"Departure times"),zo.createElement("div",{className:"flex"},q.map(je=>zo.createElement(QI,{msm:je,currentTime:C,key:je})))))},_1=[{text:"To airport",id:"ta"},{text:"From airport",id:"fa"}],Qy={PENDING:"Waiting for location...",UNAVAILABLE:"Location unavailable",DENIED:"Location permission denied",APPROVED:"Update location"},YA=()=>Math.floor((new Date-new Date().setHours(0,0,0,0))/6e4),tM=(r,l)=>l?VS.sortBy(r,f=>hb({latitude:l.lat,longitude:l.lng},{latitude:f.start.loc[0],longitude:f.start.loc[1]})):r,nM=()=>{const[r,l]=Kn.exports.useState(null),[f,w]=Kn.exports.useState(null),[C,D]=Kn.exports.useState(!1),[O,s]=Kn.exports.useState(null),[q,be]=Kn.exports.useState(Qy.PENDING),[je,Pe]=Kn.exports.useState(_1[0].id),[Le,ct]=Kn.exports.useState(null),[ht,yt]=Kn.exports.useState(YA()),hn=je==="ta"?XA.to:XA.from,Te=tM(hn,O);Kn.exports.useEffect(()=>{const ut=setInterval(()=>{yt(YA())},1e4);return()=>{clearInterval(ut)}},[yt]),Kn.exports.useEffect(()=>{if(!O)return;const{lat:ut,lng:bt}=O;hb({latitude:ut,longitude:bt},{latitude:13.199001,longitude:77.708176})<1e3&&Pe(_1[1].id)},[O]);const ge=()=>{navigator.geolocation.getCurrentPosition(ut=>{s({lat:ut.coords.latitude,lng:ut.coords.longitude}),be(Qy.APPROVED)},ut=>{ut.code===1?be(Qy.DENIED):console.log(ut)})};Kn.exports.useEffect(()=>{"geolocation"in navigator?ge():be(Qy.UNAVAILABLE)},[]);const Se=ut=>{window.innerWidth>999||l({x:ut.screenX,y:ut.screenY})},it=ut=>{if(!r)return;const{screenY:bt}=ut;w(bt-r.y),w(C?-window.innerHeight+90+bt-r.y:bt-r.y)},ke=()=>{!r||(l(null),C?f>-window.innerHeight+90+100?(D(!1),w(0)):w(-window.innerHeight+90):f<-100?(w(-window.innerHeight+90),D(!0)):w(0))};return Kn.exports.createElement("div",{id:"app-container",onPointerUp:ut=>{ke()},onPointerMove:ut=>{it(ut)}},Kn.exports.createElement("div",{id:"sidebar",onPointerDown:Se,style:{marginTop:`${f}px`}},Kn.exports.createElement("div",{className:"padding",id:"sidebar-header"},Kn.exports.createElement("div",{id:"logo-banner",className:"mb-1"},Kn.exports.createElement("img",{src:"/bmtc_logo.svg",alt:"BMTC logo",id:"bmtc-logo"}),"BMTC VAYU VAJRA"),Kn.exports.createElement("h1",{className:"mb-4"},"Bengaluru Airport Bus"),Kn.exports.createElement("div",{className:"tabs"},_1.map(ut=>Kn.exports.createElement("div",{key:ut.id,className:`tab-item ${je===ut.id?"selected":""}`,onClick:()=>Pe(ut.id)},ut.text)))),Kn.exports.createElement("div",{id:"sidebar-content"},Kn.exports.createElement("h2",{id:"sidebar-routes-heading"},"Routes and Schedules"),Kn.exports.createElement("div",{id:"sidebar-bus-list"},Te.map(ut=>Kn.exports.createElement(eM,{key:ut.name,busDetails:ut,selectedBus:Le,setSelectedBus:ct,toAirport:je==="ta",currentTime:ht})))),Kn.exports.createElement("div",{className:"padding link text"},q)),Kn.exports.createElement(GS,{busData:Te,location:O,selectedBus:Le,selectedTab:je}))},iM=lC(document.getElementById("root"));iM.render(Kn.exports.createElement(nM,null));
